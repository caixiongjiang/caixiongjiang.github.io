<!DOCTYPE html>
<html><head>
<title>PyTorch入门</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="在深度学习的框架选择上，选择PyTorch，tensorflow存在代码版本的问题，keras又太过简单了。">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="PyTorch入门" />
<meta property="og:description" content="在深度学习的框架选择上，选择PyTorch，tensorflow存在代码版本的问题，keras又太过简单了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/pytorch%E5%85%A5%E9%97%A8/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2022-07-28T18:18:05+08:00" />
<meta property="article:modified_time" content="2022-07-29T09:19:06+08:00" />












<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>


  




<link rel="icon" href="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/avater.jfif">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/dark-mode.min.c0082f0b082177f6fb3768ff91439a097de49689bd26f4d49f76d94ebb81e02d.css" integrity="sha256-wAgvCwghd/b7N2j/kUOaCX3klom9JvTUn3bZTruB4C0=" media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>


  
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script"
async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
MathJax.Hub.Queue(function() {



var all = MathJax.Hub.getAllJax(), i;
for(i = 0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';
}
});
</script>

<style>
code.has-jax {
font: inherit;
font-size: 100%;
background: inherit;
border: inherit;
color: #515151;
}
</style>





  
    <script src="/js/toc.js"></script>
  











<script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>




</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://caixiongjiang.github.io/">
    
        <div class="nav-title">
            🌀Jarson Cai&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            头脑是日用品，不是装饰品
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/blog">
                文章📖
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                分类📌
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                标签🏷️
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/series">
                系列📚
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/archive">
                归档📃
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                关于👋
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friends">
                友链🔗
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS📢
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://github.com/caixiongjiang">
    GitHub
</a>
<br>

<a href="https://jarson-cai.gitee.io/jarson-cai-blog">
    MiFeng
</a>
<br>

<a href="nau_cxj@163.com">
    Email
</a>
<br>

<a href="https://leetcode-cn.com/u/cai-xiong-jiang/">
    Leetcode
</a>
<br>

        <hr>
        
魔改自 <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2023 🌀Jarson Cai&#39;s Blog
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" onclick="onNavClick(`#pytorch学习笔记-nav`)" id="pytorch学习笔记-nav">
									PyTorch学习笔记
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ae%89%e8%a3%85%e5%8f%8a%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#pytorch安装及环境配置-nav`)" id="pytorch安装及环境配置-nav">
									PyTorch安装及环境配置
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#conda%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#conda环境安装-nav`)" id="conda环境安装-nav">
									conda环境安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8conda%e5%88%9b%e5%bb%ba%e5%b9%b6%e7%ae%a1%e7%90%86%e4%b8%8d%e5%90%8c%e7%9a%84%e7%8e%af%e5%a2%83" onclick="onNavClick(`#使用conda创建并管理不同的环境-nav`)" id="使用conda创建并管理不同的环境-nav">
									使用conda创建并管理不同的环境
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorh%e5%ae%89%e8%a3%85" onclick="onNavClick(`#pytorh安装-nav`)" id="pytorh安装-nav">
									PyTorh安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jupyter%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#jupyter环境安装-nav`)" id="jupyter环境安装-nav">
									Jupyter环境安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e8%af%ad%e6%b3%95" onclick="onNavClick(`#pytorch语法-nav`)" id="pytorch语法-nav">
									Pytorch语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#package%e5%b7%a5%e5%85%b7" onclick="onNavClick(`#package工具-nav`)" id="package工具-nav">
									Package工具
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#python%e6%96%87%e4%bb%b6vspython%e6%8e%a7%e5%88%b6%e5%8f%b0vsjupyter-notebook" onclick="onNavClick(`#python文件vspython控制台vsjupyter-notebook-nav`)" id="python文件vspython控制台vsjupyter-notebook-nav">
									Python文件vsPython控制台vsJupyter Notebook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorch%e8%af%bb%e5%8f%96%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#pytorch读取加载数据-nav`)" id="pytorch读取加载数据-nav">
									PyTorch读取/加载数据
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataset%e4%bb%a3%e7%a0%81%e5%ae%9e%e6%88%98" onclick="onNavClick(`#dataset代码实战-nav`)" id="dataset代码实战-nav">
									Dataset代码实战
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b8%b8%e8%a7%81%e7%9a%84%e6%b7%b1%e5%ba%a6%e5%ad%a6%e4%b9%a0%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#常见的深度学习工具使用-nav`)" id="常见的深度学习工具使用-nav">
									常见的深度学习工具使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tensorboard%e5%ae%89%e8%a3%85" onclick="onNavClick(`#tensorboard安装-nav`)" id="tensorboard安装-nav">
									Tensorboard安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tensorboard%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#tensorboard使用-nav`)" id="tensorboard使用-nav">
									Tensorboard使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transforms%e7%9a%84%e7%bb%93%e6%9e%84%e5%92%8c%e7%94%a8%e6%b3%95" onclick="onNavClick(`#transforms的结构和用法-nav`)" id="transforms的结构和用法-nav">
									Transforms的结构和用法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#torchvison%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e9%9b%86%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#torchvison中的数据集使用-nav`)" id="torchvison中的数据集使用-nav">
									torchvison中的数据集使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataloader%e7%9a%84%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#dataloader的使用-nav`)" id="dataloader的使用-nav">
									DataLoader的使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e5%86%99%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c" onclick="onNavClick(`#pytorch写神经网络-nav`)" id="pytorch写神经网络-nav">
									PyTorch写神经网络
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%9f%ba%e6%9c%ac%e9%aa%a8%e6%9e%b6nnmodule%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#神经网络基本骨架nnmodule使用-nav`)" id="神经网络基本骨架nnmodule使用-nav">
									神经网络基本骨架——nn.Module使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e5%8d%b7%e7%a7%af%e5%b1%82%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#神经网络-卷积层示例-nav`)" id="神经网络-卷积层示例-nav">
									神经网络-卷积层示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b7%e7%a7%af%e7%bd%91%e7%bb%9c-%e6%9c%80%e5%a4%a7%e6%b1%a0%e5%8c%96" onclick="onNavClick(`#卷积网络-最大池化-nav`)" id="卷积网络-最大池化-nav">
									卷积网络-最大池化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e9%9d%9e%e7%ba%bf%e6%80%a7%e6%bf%80%e6%b4%bb" onclick="onNavClick(`#神经网络-非线性激活-nav`)" id="神经网络-非线性激活-nav">
									神经网络-非线性激活
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sequential%e4%bd%bf%e7%94%a8%e4%bb%a5%e5%8f%8a%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%ae%9e%e6%88%98%e6%90%ad%e5%bb%ba" onclick="onNavClick(`#sequential使用以及神经网络实战搭建-nav`)" id="sequential使用以及神经网络实战搭建-nav">
									Sequential使用以及神经网络实战搭建
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad" onclick="onNavClick(`#神经网络-损失函数反向传播-nav`)" id="神经网络-损失函数反向传播-nav">
									神经网络-损失函数&amp;反向传播
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%98%e5%8c%96%e5%99%a8" onclick="onNavClick(`#优化器-nav`)" id="优化器-nav">
									优化器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b%e4%bf%ae%e6%94%b9%e5%92%8c%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#pytorch网络模型修改和使用-nav`)" id="pytorch网络模型修改和使用-nav">
									PyTorch网络模型修改和使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#pytorch网络模型-nav`)" id="pytorch网络模型-nav">
									PyTorch网络模型
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e7%9a%84%e4%bf%9d%e5%ad%98%e5%92%8c%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#模型的保存和加载-nav`)" id="模型的保存和加载-nav">
									模型的保存和加载
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#完整的模型训练-nav`)" id="完整的模型训练-nav">
									完整的模型训练
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83%e5%a5%97%e8%b7%afcifar10%e6%95%b0%e6%8d%ae%e9%9b%86%e4%b8%ba%e4%be%8b" onclick="onNavClick(`#完整的模型训练套路cifar10数据集为例-nav`)" id="完整的模型训练套路cifar10数据集为例-nav">
									完整的模型训练套路（CIFAR10数据集为例）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a9%e7%94%a8gpu%e8%bf%9b%e8%a1%8c%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#利用gpu进行训练-nav`)" id="利用gpu进行训练-nav">
									利用GPU进行训练
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e9%aa%8c%e8%af%81%e5%a5%97%e8%b7%af" onclick="onNavClick(`#完整的模型验证套路-nav`)" id="完整的模型验证套路-nav">
									完整的模型验证套路
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/blog">
                    文章📖
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    分类📌
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    标签🏷️
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/series">
                    系列📚
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/archive">
                    归档📃
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    关于👋
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friends">
                    友链🔗
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS📢
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" onclick="onNavClick(`#pytorch学习笔记-nav`)" id="pytorch学习笔记-nav">
									PyTorch学习笔记
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ae%89%e8%a3%85%e5%8f%8a%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#pytorch安装及环境配置-nav`)" id="pytorch安装及环境配置-nav">
									PyTorch安装及环境配置
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#conda%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#conda环境安装-nav`)" id="conda环境安装-nav">
									conda环境安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8conda%e5%88%9b%e5%bb%ba%e5%b9%b6%e7%ae%a1%e7%90%86%e4%b8%8d%e5%90%8c%e7%9a%84%e7%8e%af%e5%a2%83" onclick="onNavClick(`#使用conda创建并管理不同的环境-nav`)" id="使用conda创建并管理不同的环境-nav">
									使用conda创建并管理不同的环境
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorh%e5%ae%89%e8%a3%85" onclick="onNavClick(`#pytorh安装-nav`)" id="pytorh安装-nav">
									PyTorh安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jupyter%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#jupyter环境安装-nav`)" id="jupyter环境安装-nav">
									Jupyter环境安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e8%af%ad%e6%b3%95" onclick="onNavClick(`#pytorch语法-nav`)" id="pytorch语法-nav">
									Pytorch语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#package%e5%b7%a5%e5%85%b7" onclick="onNavClick(`#package工具-nav`)" id="package工具-nav">
									Package工具
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#python%e6%96%87%e4%bb%b6vspython%e6%8e%a7%e5%88%b6%e5%8f%b0vsjupyter-notebook" onclick="onNavClick(`#python文件vspython控制台vsjupyter-notebook-nav`)" id="python文件vspython控制台vsjupyter-notebook-nav">
									Python文件vsPython控制台vsJupyter Notebook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorch%e8%af%bb%e5%8f%96%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#pytorch读取加载数据-nav`)" id="pytorch读取加载数据-nav">
									PyTorch读取/加载数据
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataset%e4%bb%a3%e7%a0%81%e5%ae%9e%e6%88%98" onclick="onNavClick(`#dataset代码实战-nav`)" id="dataset代码实战-nav">
									Dataset代码实战
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b8%b8%e8%a7%81%e7%9a%84%e6%b7%b1%e5%ba%a6%e5%ad%a6%e4%b9%a0%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#常见的深度学习工具使用-nav`)" id="常见的深度学习工具使用-nav">
									常见的深度学习工具使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tensorboard%e5%ae%89%e8%a3%85" onclick="onNavClick(`#tensorboard安装-nav`)" id="tensorboard安装-nav">
									Tensorboard安装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tensorboard%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#tensorboard使用-nav`)" id="tensorboard使用-nav">
									Tensorboard使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transforms%e7%9a%84%e7%bb%93%e6%9e%84%e5%92%8c%e7%94%a8%e6%b3%95" onclick="onNavClick(`#transforms的结构和用法-nav`)" id="transforms的结构和用法-nav">
									Transforms的结构和用法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#torchvison%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e9%9b%86%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#torchvison中的数据集使用-nav`)" id="torchvison中的数据集使用-nav">
									torchvison中的数据集使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataloader%e7%9a%84%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#dataloader的使用-nav`)" id="dataloader的使用-nav">
									DataLoader的使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e5%86%99%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c" onclick="onNavClick(`#pytorch写神经网络-nav`)" id="pytorch写神经网络-nav">
									PyTorch写神经网络
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%9f%ba%e6%9c%ac%e9%aa%a8%e6%9e%b6nnmodule%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#神经网络基本骨架nnmodule使用-nav`)" id="神经网络基本骨架nnmodule使用-nav">
									神经网络基本骨架——nn.Module使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e5%8d%b7%e7%a7%af%e5%b1%82%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#神经网络-卷积层示例-nav`)" id="神经网络-卷积层示例-nav">
									神经网络-卷积层示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b7%e7%a7%af%e7%bd%91%e7%bb%9c-%e6%9c%80%e5%a4%a7%e6%b1%a0%e5%8c%96" onclick="onNavClick(`#卷积网络-最大池化-nav`)" id="卷积网络-最大池化-nav">
									卷积网络-最大池化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e9%9d%9e%e7%ba%bf%e6%80%a7%e6%bf%80%e6%b4%bb" onclick="onNavClick(`#神经网络-非线性激活-nav`)" id="神经网络-非线性激活-nav">
									神经网络-非线性激活
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sequential%e4%bd%bf%e7%94%a8%e4%bb%a5%e5%8f%8a%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%ae%9e%e6%88%98%e6%90%ad%e5%bb%ba" onclick="onNavClick(`#sequential使用以及神经网络实战搭建-nav`)" id="sequential使用以及神经网络实战搭建-nav">
									Sequential使用以及神经网络实战搭建
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad" onclick="onNavClick(`#神经网络-损失函数反向传播-nav`)" id="神经网络-损失函数反向传播-nav">
									神经网络-损失函数&amp;反向传播
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%98%e5%8c%96%e5%99%a8" onclick="onNavClick(`#优化器-nav`)" id="优化器-nav">
									优化器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b%e4%bf%ae%e6%94%b9%e5%92%8c%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#pytorch网络模型修改和使用-nav`)" id="pytorch网络模型修改和使用-nav">
									PyTorch网络模型修改和使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#pytorch网络模型-nav`)" id="pytorch网络模型-nav">
									PyTorch网络模型
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e7%9a%84%e4%bf%9d%e5%ad%98%e5%92%8c%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#模型的保存和加载-nav`)" id="模型的保存和加载-nav">
									模型的保存和加载
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#完整的模型训练-nav`)" id="完整的模型训练-nav">
									完整的模型训练
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83%e5%a5%97%e8%b7%afcifar10%e6%95%b0%e6%8d%ae%e9%9b%86%e4%b8%ba%e4%be%8b" onclick="onNavClick(`#完整的模型训练套路cifar10数据集为例-nav`)" id="完整的模型训练套路cifar10数据集为例-nav">
									完整的模型训练套路（CIFAR10数据集为例）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a9%e7%94%a8gpu%e8%bf%9b%e8%a1%8c%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#利用gpu进行训练-nav`)" id="利用gpu进行训练-nav">
									利用GPU进行训练
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e9%aa%8c%e8%af%81%e5%a5%97%e8%b7%af" onclick="onNavClick(`#完整的模型验证套路-nav`)" id="完整的模型验证套路-nav">
									完整的模型验证套路
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://caixiongjiang.github.io/">
            🌀Jarson Cai&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://caixiongjiang.github.io/">
        <div class="single-column-header-title">🌀Jarson Cai&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">头脑是日用品，不是装饰品</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/pytorch_title.jpg')"
                    
                
            >
                <div class="post-title">
                    PyTorch入门
                    
                    <div class="post-subtitle">
                        在深度学习的框架选择上，选择PyTorch，tensorflow存在代码版本的问题，keras又太过简单了。
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-07-28 18:18
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[深度学习]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/deep_learning">Deep_learning</a>
                                &nbsp;
                            
                                <a href="/tags/pytorch">PyTorch</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            49 min
                            
                            11 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="pytorch学习笔记">PyTorch学习笔记</h2>
<h3 id="pytorch安装及环境配置">PyTorch安装及环境配置</h3>
<h4 id="conda环境安装">conda环境安装</h4>
<p>这里我们使用的<code>anaconda</code>，目前它也已经适配了apple芯片。所以我在我的<code>M1 Pro</code>的电脑上将<code>miniforge3</code>的方案替换成了<code>anaconda3</code>。官网：<a href="https://www.anaconda.com/">https://www.anaconda.com/</a></p>
<p><em>Windows端无需多说，苹果端如果是apple芯片，选择M1版本，如果是intel芯片，选择普通版本。</em></p>
<p>下载完成之后安装，需要配置一下环境变量（MacOS）。</p>
<p>首先进入根目录，并配置环境变量：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; <span style="color:#658b00">cd</span> ~
</span></span><span style="display:flex;"><span>&gt; vim ~/.zshrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>在配置文件中加入一行：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#658b00">export</span> <span style="color:#00688b">PATH</span>=<span style="color:#cd5555">&#34;/Users/caixiongjiang/opt/anaconda3:</span><span style="color:#00688b">$PATH</span><span style="color:#cd5555">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 其中caixiongjiang是你的用户名</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># vim中按i进行编辑模式，按Ese推出编辑模式，在普通模式下输入“:wq”表示保存并退出</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动环境配置，并配置国内镜像源：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; <span style="color:#658b00">source</span> ~/.zshrc
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/msys2/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/menpo/
</span></span><span style="display:flex;"><span>&gt; conda config --set show_channel_urls yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>输入如下：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda info
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 最左边出现一个“(base)”表示已经成功了！</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用conda创建并管理不同的环境">使用conda创建并管理不同的环境</h4>
<p>创建环境：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># 创建一个python3.9的环境</span>
</span></span><span style="display:flex;"><span>&gt; conda create -n pytorch <span style="color:#00688b">python</span>=3.9
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 切换环境</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 查看环境列表和当前使用环境</span>
</span></span><span style="display:flex;"><span>&gt; conda info -e
</span></span><span style="display:flex;"><span><span style="color:#228b22"># conda environments:</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#</span>
</span></span><span style="display:flex;"><span>base                     /Users/caixiongjiang/opt/anaconda3
</span></span><span style="display:flex;"><span>pytorch               *  /Users/caixiongjiang/opt/anaconda3/envs/pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="pytorh安装">PyTorh安装</h4>
<ul>
<li>Windows端：PyTorch自带CUDA工具加速，如果想要使用GPU做深度学习，需要下载带有CUDA的版本。</li>
</ul>
<p>首先是只用CPU的版本：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision torchaudio cpuonly -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><p>带GPU加速的版本（选择一个CUDA11.3的版本）：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision torchaudio <span style="color:#00688b">cudatoolkit</span>=11.3 -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>mac端：</li>
</ul>
<p>如果是普通intel芯片的电脑（安装正式版）：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果是苹果的M1系列的芯片（安装预览版，2022年5月发布）：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision -c pytorch-nightly
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>检查pytorch是否可用：</p>
<ul>
<li>Windows端：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># 切换到pytorch环境</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch 
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 进入python环境</span>
</span></span><span style="display:flex;"><span>&gt; python
</span></span><span style="display:flex;"><span>&gt; import torch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 是否可以使用GPU加速</span>
</span></span><span style="display:flex;"><span>&gt; torch.cuda.is_avaliable()
</span></span><span style="display:flex;"><span>True <span style="color:#228b22"># True则代表可以使用</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>mac端</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># 切换到pytorch环境</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch 
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 进入python环境</span>
</span></span><span style="display:flex;"><span>&gt; python
</span></span><span style="display:flex;"><span>&gt; import torch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 是否可以使用GPU加速</span>
</span></span><span style="display:flex;"><span>&gt; torch.device(<span style="color:#cd5555">&#39;mps&#39;</span>)
</span></span><span style="display:flex;"><span>device(<span style="color:#00688b">type</span>=<span style="color:#cd5555">&#39;mps&#39;</span>) <span style="color:#228b22">#可以使用苹果自带的apple芯片进行GPU加速 </span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="jupyter环境安装">Jupyter环境安装</h4>
<p>因为annaconda是自带jupyter环境的，但是我们的新建的pytorch环境里面并没有支持jupyter环境的包，那就下载一下吧：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span>&gt; conda install nb_conda
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 启动jupyter notebook</span>
</span></span><span style="display:flex;"><span>&gt; jupyter notebook
</span></span></code></pre></td></tr></table>
</div>
</div><p>在新建代码时，点击<code>新建</code>可以选择先前创建的环境。</p>
<h3 id="pytorch语法">Pytorch语法</h3>
<h4 id="package工具">Package工具</h4>
<p>一个包里有有几个分隔区，每个分隔区里有几个工具箱。如何查看并使用工具箱：</p>
<ul>
<li>dir()函数，能让我们知道工具箱以及工具箱分隔区有什么东西。</li>
<li>help()函数，能让我们知道每个工具是如何使用的，工具的使用方法。</li>
</ul>
<h4 id="python文件vspython控制台vsjupyter-notebook">Python文件vsPython控制台vsJupyter Notebook</h4>
<p>如果代码是以块一个整体运行的话：</p>
<ul>
<li>Python文件的块是所有行的代码</li>
<li>Python控制台的块是每一行的代码</li>
<li>Jupyter Notebook的块是需要自己定义的，每一次in都是一个块</li>
</ul>
<p><em>需要注意的是Python控制台是可以看到变量的信息的，和matlab相似。</em></p>
<h4 id="pytorch读取加载数据">PyTorch读取/加载数据</h4>
<ul>
<li>Dataset:提供一种方式去获取数据其label值
<ul>
<li>如何获取每一个数据及其label</li>
<li>告诉我们总共有多少数据</li>
</ul>
</li>
<li>Dataloader：为神经网络提供不同的数据形式</li>
</ul>
<h4 id="dataset代码实战">Dataset代码实战</h4>
<p>首先需要介绍一点Python中类的知识：</p>
<p>在Python中，如果想实现创建类似于序列和映射的类（可以迭代以及通过[下标]返回元素），可以通过重写魔法方法的方式去实现。常见的魔法方法包括__getitem__（）、<strong>setitem</strong>（）、<strong>delitem</strong>（）、<strong>len</strong>（），它们的函数功能为：</p>
<pre><code>        1）__getitem__(self,key):返回键对应的值；
        2）__len__():返回元素的数量；
        3）__delitem__(self,key):删除给定键对应的元素；
        4）__setitem__(self,key,value)：设置给定键的值。
</code></pre>
<p><code>torch.utils.data.Dataset</code>是PyTorch中用来表示数据集的抽象类，Dataset是一个包装类，用来将数据包装为Dataset类，然后传入DataLoader中从而使DataLoader类更加快捷的对数据进行操作。当处理自定义的数据集的时候必须继承Dataset,然后重写 <strong>len</strong>（）和__getitem__（）函数。</p>
<pre><code>        1）__len__（）: 使得len(dataset)返回数据集的大小；

        2）__getitem__（）：使得支持dataset[i]能够返回第i个数据样本这样的下标操作，在__getitem__（）函数中完成图片的读取工作可以减小内存开销，只要在需要用到的时候才将图片读入。
</code></pre>
<p>深度学习<code>训练数据集</code>一般有两种表现形式，假设数据有c类：</p>
<ul>
<li>1.数据和标签混合：<code>训练数据集</code>下面会有c个文件夹的训练数据。标签通过文件的名称来定，数据则对应标签文件夹目录下的数据。</li>
<li>2.数据和标签分离：<code>训练数据集</code>下面会有2$\times$c个文件夹，c个文件放的不同类训练数据，另外c个类的文件夹则是不同类的训练标签。训练数据和训练标签的前缀是一一对应的，标签一般放在<code>.txt</code>文件夹中。</li>
</ul>
<p>下面针对1写一个加载数据的代码：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> Dataset
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyData</span>(Dataset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self, root_dir, label_dir):
</span></span><span style="display:flex;"><span>        self.root_dir = root_dir
</span></span><span style="display:flex;"><span>        self.label_dir = label_dir
</span></span><span style="display:flex;"><span>        self.path = os.path.join(self.root_dir, self.label_dir) <span style="color:#228b22"># 对地址进行拼接</span>
</span></span><span style="display:flex;"><span>        self.img_path = os.listdir(self.path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __getitem__(self, idx):
</span></span><span style="display:flex;"><span>        img_name = self.img_path[idx]
</span></span><span style="display:flex;"><span>        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name) <span style="color:#228b22"># 每一张图片相对于程序的相对路径</span>
</span></span><span style="display:flex;"><span>        img = Image.open(img_item_path) <span style="color:#228b22"># 读取图片</span>
</span></span><span style="display:flex;"><span>        label = self.label_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> img, label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __len__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#658b00">len</span>(self.img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root_dir = <span style="color:#cd5555">&#34;dataset/train&#34;</span>
</span></span><span style="display:flex;"><span>ants_label_dir = <span style="color:#cd5555">&#34;ants&#34;</span>
</span></span><span style="display:flex;"><span>bees_label_dir = <span style="color:#cd5555">&#34;bees&#34;</span>
</span></span><span style="display:flex;"><span>ants_dataset = MyData(root_dir, ants_label_dir)
</span></span><span style="display:flex;"><span>bees_dataset = MyData(root_dir, bees_label_dir)
</span></span><span style="display:flex;"><span>train_dataset = ants_dataset + bees_dataset
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="常见的深度学习工具使用">常见的深度学习工具使用</h3>
<h4 id="tensorboard安装">Tensorboard安装</h4>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span>&gt; pip3 install tensorboard
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tensorboard使用">Tensorboard使用</h4>
<p>先写一个简单的示例代码：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 如果要在logs后面加子文件可以加&#34;/文件夹名&#34;</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># writer.add_image()</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># y = x</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">100</span>):
</span></span><span style="display:flex;"><span>  	<span style="color:#228b22"># 这里的第一个参数代表标题，第二个参数代表y轴的真实值，第三个参数代表x轴的真实值</span>
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;y = x&#34;</span>, i, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行这段代码，就可以在代码的同级目录下，多出一个<code>logs</code>的文件夹，文件夹的名字是代码中设定的。</p>
<p>那么如何使用Tensorboard来查看图像呢？</p>
<p>首先需要打开<code>PyCharm</code>中的<code>Terminal</code>，输入：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># logdir代表事件文件所在的文件夹 port代表自定义端口</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 这里在=后面使用绝对路径和相对路径都是OK的</span>
</span></span><span style="display:flex;"><span>&gt; tensorboard --logdir=logs --port=<span style="color:#b452cd">9090</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 运行之后会发现一个本地的服务器地址，可以在浏览器打开</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>add_image</code>的使用</li>
</ul>
<p>通常来说，<code>add_image</code>一般是用来观察训练结果的。</p>
<p>写一段示例代码：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">numpy</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">np</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/2&#34;</span>)
</span></span><span style="display:flex;"><span>image_path = <span style="color:#cd5555">&#34;dataset/train/ants_image/0013035.jpg&#34;</span>
</span></span><span style="display:flex;"><span>img_PIL = Image.open(image_path)
</span></span><span style="display:flex;"><span>img_array = np.array(img_PIL)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 这里的dataformats=”HWC“代表数据的shape为高度，宽度，通道数</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 默认的shape为通道数，高度，宽度</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 数字1代表的是step</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 第二个参数传入时一般为张量，或者numpy类型</span>
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;test&#34;</span>, img_array, <span style="color:#b452cd">1</span>, dataformats=<span style="color:#cd5555">&#34;HWC&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="transforms的结构和用法">Transforms的结构和用法</h4>
<p>Transforms一般形式是在一个<code>.py</code>文件里使用，它的功能类似于一个工具箱，能对图片做一些处理。工具箱里包含<code>totensor</code>，<code>resize</code>等工具，图片经过工具的处理会输出一个我们想要的结果。</p>
<p>看一个简单的使用案例：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torchvision</span> <span style="color:#8b008b;font-weight:bold">import</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">cv2</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">cv</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># python的用法 -&gt; tensor数据类型</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 通过 transforms.ToTensor 解决两个问题</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 2.为什么需要Tensor数据类型</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 绝对路径 /Users/caixiongjiang/PycharmProjects/learn-pytorch/dataset/train/ants_image/0013035.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 相对路径 dataset/train/ants_image/0013035.jpg</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 读取成jpg格式</span>
</span></span><span style="display:flex;"><span>img_path = <span style="color:#cd5555">&#34;dataset/train/ants_image/0013035.jpg&#34;</span>
</span></span><span style="display:flex;"><span>img = Image.open(img_path)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 读取成numpy格式</span>
</span></span><span style="display:flex;"><span>cv_img = cv.imread(img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1.transforms该如何使用</span>
</span></span><span style="display:flex;"><span>tensor_trans = transforms.ToTensor() <span style="color:#228b22"># 创建具体的工具（实例化）</span>
</span></span><span style="display:flex;"><span>tensor_img = tensor_trans(img) <span style="color:#228b22"># 使用工具</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(tensor_img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/3&#34;</span>)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Tensor_img&#34;</span>, tensor_img)
</span></span><span style="display:flex;"><span>writer.close()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 2.为什么需要Tensor数据类型</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># tensor包含了一些神经网络中的一些信息，比如反向传播等</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>transforms的常用函数：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torchvision</span> <span style="color:#8b008b;font-weight:bold">import</span> transforms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/3&#34;</span>)
</span></span><span style="display:flex;"><span>img = Image.open(<span style="color:#cd5555">&#34;dataset/val/bees/26589803_5ba7000313.jpg&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trans_totensor = transforms.ToTensor()
</span></span><span style="display:flex;"><span>img_tensor = trans_totensor(img)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;ToTensor&#34;</span>, img_tensor)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Normalize</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 第一个参数是均值，第二个参数是方差。</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 这里每个参数都有三个，是因为输入的维度3维的。</span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">output[channel] = (input[channel] - mean[channel]) / std[channel]
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;变化前：&#34;</span> + <span style="color:#658b00">str</span>(img_tensor[<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>]))
</span></span><span style="display:flex;"><span>trans_norm = transforms.Normalize([<span style="color:#b452cd">6</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">2</span>], [<span style="color:#b452cd">9</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">5</span>])
</span></span><span style="display:flex;"><span>img_norm = trans_norm(img_tensor)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;变化后：&#34;</span> + <span style="color:#658b00">str</span>(img_tensor[<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>]))
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Normalize&#34;</span>, img_norm, <span style="color:#b452cd">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Resize</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img.size)
</span></span><span style="display:flex;"><span>trans_resize = transforms.Resize((<span style="color:#b452cd">512</span>, <span style="color:#b452cd">512</span>))
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img PIL -&gt; resize -&gt; img_resize PIL</span>
</span></span><span style="display:flex;"><span>img_resize = trans_resize(img)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img_resize PIL -&gt; img_resize tensor</span>
</span></span><span style="display:flex;"><span>img_resize = trans_totensor(img_resize)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Resize&#34;</span>, img_resize, <span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img_resize)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Compose - resize - 2</span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">Compose()用法：
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">相当于是多个转化操作合并到一个compose()函数中！
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">Compose()中的参数需要是一个列表，列表中的数据类型是transforms类型
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">所以得到，Compose([transforms参数1, transforms参数2, ...])
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>trans_resize_2 = transforms.Resize(<span style="color:#b452cd">512</span>) <span style="color:#228b22"># transforms.Resize(x):将图片短边缩放至x，长宽比保持不变</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># PIL -&gt; PIL -&gt; tensor</span>
</span></span><span style="display:flex;"><span>trans_compose = transforms.Compose([trans_resize_2, trans_totensor])
</span></span><span style="display:flex;"><span>img_resize_2 = trans_compose(img)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Compose&#34;</span>, img_resize_2, <span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># RandomCrop 随机裁剪</span>
</span></span><span style="display:flex;"><span>trans_random = transforms.RandomCrop((<span style="color:#b452cd">300</span>, <span style="color:#b452cd">450</span>)) <span style="color:#228b22"># 一个参数时，默认为a×a,两个参数则为a×b</span>
</span></span><span style="display:flex;"><span>trans_compose_2 = transforms.Compose([trans_random, trans_totensor])
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">10</span>):
</span></span><span style="display:flex;"><span>    img_crop = trans_compose_2(img)
</span></span><span style="display:flex;"><span>    writer.add_image(<span style="color:#cd5555">&#34;RandomCropHW&#34;</span>, img_crop, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="torchvison中的数据集使用">torchvison中的数据集使用</h4>
<p>在<code>PyTorch</code>的<code>torchvision</code>中自带了很多数据集，我们怎么使用它。这里可以参考官方的文档：<a href="https://pytorch.org/vision/stable/datasets.html">https://pytorch.org/vision/stable/datasets.html</a></p>
<p>我们这里使用一个<code>CIFAR10</code>的数据集进行演示：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset_transform = torchvision.transforms.Compose([
</span></span><span style="display:flex;"><span>    torchvision.transforms.ToTensor()
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span><span style="color:#228b22"># root代表保存路径</span>
</span></span><span style="display:flex;"><span>train_set = torchvision.datasets.CIFAR10(root=<span style="color:#cd5555">&#34;./torchvision_datasets_train&#34;</span>, transform=dataset_transform, train=<span style="color:#8b008b;font-weight:bold">True</span>, download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_set = torchvision.datasets.CIFAR10(root=<span style="color:#cd5555">&#34;./torchvison_datasets_test&#34;</span>, transform=dataset_transform, train=<span style="color:#8b008b;font-weight:bold">False</span>, download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set[0])</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set.classes)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img, target = test_set[0]</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(img)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(target)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set.classes[target])</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img.show()</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set[0])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/p10&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">10</span>):
</span></span><span style="display:flex;"><span>    img, target = test_set[i]
</span></span><span style="display:flex;"><span>    writer.add_image(<span style="color:#cd5555">&#34;test_set&#34;</span>, img, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dataloader的使用">DataLoader的使用</h4>
<p><code>dataset</code>可以理解为一个数据集，而<code>dataloader</code>可以理解为将数据集中的数据加载到神经网络中。<code>dataloader</code>的官方文档如下：<a href="https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader">https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader</a></p>
<p>来看一个使用案例：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 准备的测试数据集</span>
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;./torchvision_datasets_test&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># drop_last如果为True，代表最后一次数据集的batch不满batch-size，会被舍去</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># num_workers代表并行处理的数量</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># shuffle指打乱随机</span>
</span></span><span style="display:flex;"><span>test_loader = DataLoader(dataset=test_data, batch_size=<span style="color:#b452cd">64</span>, shuffle=<span style="color:#8b008b;font-weight:bold">True</span>, num_workers=<span style="color:#b452cd">0</span>, drop_last=<span style="color:#8b008b;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 测试数据集中第一张图片及target</span>
</span></span><span style="display:flex;"><span>img, target = test_data[<span style="color:#b452cd">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img.shape)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(target)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/dataloader&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> epoch <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">2</span>):
</span></span><span style="display:flex;"><span>    step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_loader:
</span></span><span style="display:flex;"><span>        imgs, target = data
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># print(img.shape)</span>
</span></span><span style="display:flex;"><span>        writer.add_images(<span style="color:#cd5555">&#34;Epoch:</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(epoch), imgs, step)
</span></span><span style="display:flex;"><span>        step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pytorch写神经网络">PyTorch写神经网络</h3>
<h4 id="神经网络基本骨架nnmodule使用">神经网络基本骨架——nn.Module使用</h4>
<p>首先，先贴一下神经网络模型的官方文档：<a href="https://pytorch.org/docs/stable/nn.html">https://pytorch.org/docs/stable/nn.html</a></p>
<p>主要写一下<code>Pytorch</code>中模型的写法：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">nn</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn.functional</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">F</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyModel</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    conv代表卷积层
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    relu代表ReLU激活函数
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>().__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = nn.Conv2d(<span style="color:#b452cd">1</span>, <span style="color:#b452cd">20</span>, <span style="color:#b452cd">5</span>)
</span></span><span style="display:flex;"><span>        self.conv2 = nn.Conv2d(<span style="color:#b452cd">20</span>, <span style="color:#b452cd">20</span>, <span style="color:#b452cd">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = F.relu(self.conv1(x))
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> F.relu(self.conv2(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>().__init__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = <span style="color:#658b00">input</span> + <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_md = Cai()
</span></span><span style="display:flex;"><span>x = torch.tensor(<span style="color:#b452cd">1.0</span>)
</span></span><span style="display:flex;"><span>output = test_md(x)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="神经网络-卷积层示例">神经网络-卷积层示例</h4>
<p>Pytorch中的Conv2d的对应函数（Tensor通道排列顺序是：[batch, channel, height, width]）：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>torch.nn.Conv2d(in_channels, 
</span></span><span style="display:flex;"><span>                out_channels, 
</span></span><span style="display:flex;"><span>                kernel_size, 
</span></span><span style="display:flex;"><span>                stride=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                padding=<span style="color:#b452cd">0</span>, 
</span></span><span style="display:flex;"><span>                dilation=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                groups=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                bias=<span style="color:#8b008b;font-weight:bold">True</span>, 
</span></span><span style="display:flex;"><span>                padding_mode=<span style="color:#cd5555">&#39;zeros&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>每个参数代表的含义如下：</p>
<p>in_channels参数代表输入特征矩阵的深度即channel，比如输入一张RGB彩色图像，那in_channels = 3；</p>
<p>out_channels参数代表卷积核的个数，使用n个卷积核输出的特征矩阵深度即channel就是n；</p>
<p>kernel_size参数代表卷积核的尺寸，输入可以是int类型如3 代表卷积核的height = width = 3，也可以是tuple类型如(3,  5)代表卷积核的height = 3，width = 5；</p>
<p>stride参数代表卷积核的步距默认为1，和kernel_size一样输入可以是int类型，也可以是tuple类型，这里注意，若为tuple类型即第一个int用于高度尺寸，第二个int用于宽度尺寸；</p>
<p>padding参数代表在输入特征矩阵四周补零的情况默认为0，同样输入可以为int型如1 代表上下方向各补一行0元素，左右方向各补一列0像素（即补一圈0），如果输入为tuple型如(2, 1) 代表在上方补两行下方补两行，左边补一列，右边补一列。可见下图，padding[0]是在H高度方向两侧填充的，padding[1]是在W宽度方向两侧填充的；</p>
</blockquote>
<p>在Pytorch中，**dilation = 1等同于没有dilation的标准卷积,dilation = 2等同于计算不同点之间的差距时会进行膨胀操作。**用一个例子来说明：</p>
<pre tabindex="0"><code>在一个维度上，一个大小为3的过滤器w会对输入的x进行如下计算：w[0] * x[0] + w[1] * x[1] + w[2] * x[2]。若dilation = 1，过滤器会计算：w[0] * x[0] + w[1] * x[2] + w[2] * x[4]；换句话说，在不同点之间有一个1的差距。
</code></pre><ul>
<li>对矩阵进行卷积：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn.functional</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">F</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.tensor([[<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">0</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">5</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kernel = torch.tensor([[<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>]])
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 将二维矩阵变为batch-size为1，通道为1，矩阵大小为5×5</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.reshape(<span style="color:#658b00">input</span>, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>))
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 将二维矩阵变为batch-size为1，通道为1，矩阵大小为3×3</span>
</span></span><span style="display:flex;"><span>kernel = torch.reshape(kernel, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output2 = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output3 = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">1</span>, padding=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(input.shape)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(kernel.shape)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>对具体的图片进行卷积操作：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = torch.nn.Conv2d(in_channels=<span style="color:#b452cd">3</span>, out_channels=<span style="color:#b452cd">6</span>, kernel_size=<span style="color:#b452cd">3</span>, stride=<span style="color:#b452cd">1</span>, padding=<span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.conv1(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(cai)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.size([64, 3, 32, 32])</span>
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.size([64, 6, 30, 30])</span>
</span></span><span style="display:flex;"><span>    output = torch.reshape(output, (-<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">30</span>, <span style="color:#b452cd">30</span>))
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>, output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="卷积网络-最大池化">卷积网络-最大池化</h4>
<p>首先解释一下最大池化，就是对输入图像做匹配，并取出匹配结果的最大值。它的目的是为了保留输入的特征，但是同时减少数据量。</p>
<p><code>MaxPool2d</code>这个类的实现十分简单。</p>
<p>我们先来看一下基本参数，一共六个：</p>
<blockquote>
<p>kernel_size ：表示做最大池化的窗口大小，可以是单个值，也可以是tuple元组</p>
<p>stride ：步长，可以是单个值，也可以是tuple元组，默认值为None。也就是如果不设置其就等于kernel_size的大小</p>
<p>padding ：填充，可以是单个值，也可以是tuple元组，默认padding=0</p>
<p>dilation ：控制窗口中元素匹配的步幅</p>
<p>return_indices ：布尔类型，返回最大值位置索引</p>
<p>ceil_mode ：布尔类型，为True，用向上取整的方法，计算输出形状；默认是向下取整。</p>
</blockquote>
<p><em>这里特别说明一下ceil_mode，如果ceil_mode=True时，当输入图像被匹配的形状不足时，我们对这组数据的池化结果是保留的；diation和卷积中的功能是一样的，默认都是不膨胀。</em></p>
<ul>
<li>写一个关于最大池化的例子：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1、 ./是当前目录 2、 ../是父级目录 3、 /是根目录 根目录是指逻辑驱动器的最上一层目录</span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.maxpool1 = torch.nn.MaxPool2d(kernel_size=<span style="color:#b452cd">3</span>, ceil_mode=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = self.maxpool1(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_maxpool&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>, output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="神经网络-非线性激活">神经网络-非线性激活</h4>
<p>其实就是如何使用激活函数：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.tensor([[<span style="color:#b452cd">1</span>, -<span style="color:#b452cd">0.5</span>],
</span></span><span style="display:flex;"><span>                      [-<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># inplace = True代表原地操作，值进行覆盖 inplace = False代表激活结果传给另一个变量(默认)</span>
</span></span><span style="display:flex;"><span>        self.relu1 = torch.nn.ReLU(inplace=<span style="color:#8b008b;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>        self.sigmoid1 = torch.nn.Sigmoid()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = self.sigmoid1(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_relu&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>,output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sequential使用以及神经网络实战搭建">Sequential使用以及神经网络实战搭建</h4>
<p><code>Sequential</code>其实是将神经网络的模型放在一个序列里面，简洁易懂。</p>
<p>实战的话就是针对我们之前一直使用的数据集<code>CIFAR10</code>来写一个简洁一点的神经网络模型。</p>
<p>使用的网络模型结构<code>CIFAR-quick model</code>，如下图所示：</p>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img45.jpg" alt=""></p>
<p>建立模型的代码如下：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(cai)
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.ones((<span style="color:#b452cd">64</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>output = cai(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output.shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 生成计算图</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_seq&#34;</span>)
</span></span><span style="display:flex;"><span>writer.add_graph(cai, <span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="神经网络-损失函数反向传播">神经网络-损失函数&amp;反向传播</h4>
<p>神经网络就是一个不断迭代的过程，损失函数就是它的一个指标，迭代的过程就是让这个指标越来越小。</p>
<ul>
<li>L1loss,MSEloss,交叉熵举例：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inputs = torch.tensor([<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>], dtype=torch.float32)
</span></span><span style="display:flex;"><span>targets = torch.tensor([<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">5</span>], dtype=torch.float32)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inputs = torch.reshape(inputs, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>targets = torch.reshape(targets, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = torch.nn.L1Loss(reduction=<span style="color:#cd5555">&#34;sum&#34;</span>)
</span></span><span style="display:flex;"><span>result = loss(inputs, targets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss_mse = nn.MSELoss()
</span></span><span style="display:flex;"><span>result_mse = loss_mse(inputs, targets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 当你应用一个分类问题的时候，分成c类，使用交叉熵</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># -0.2 + ln(exp(0.1) + exp(0.2) + exp(0.3))</span>
</span></span><span style="display:flex;"><span>x = torch.tensor([<span style="color:#b452cd">0.1</span>, <span style="color:#b452cd">0.2</span>, <span style="color:#b452cd">0.3</span>])
</span></span><span style="display:flex;"><span>y = torch.tensor([<span style="color:#b452cd">1</span>])
</span></span><span style="display:flex;"><span>x = torch.reshape(x, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>loss_cross = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>result_cross = loss_cross(x, y)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result_cross)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result_mse)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>神经网络中损失函数的后向传播</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    result_loss = loss(output, targets)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 后向传播</span>
</span></span><span style="display:flex;"><span>    result_loss.backward()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="优化器">优化器</h4>
<p>使用优化器，可以使用优化算法设置学习速率，自动计算反向传播，更新参数等。使用之前的<code>CIFAR10 quick_model</code>来计算梯度等,进行迭代。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 随机梯度下降</span>
</span></span><span style="display:flex;"><span>optim = torch.optim.SGD(cai.parameters(), lr=<span style="color:#b452cd">0.01</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> epoch <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">20</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 每一轮学习中所有数据的loss</span>
</span></span><span style="display:flex;"><span>    running_loss = <span style="color:#b452cd">0.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        output = cai(imgs)
</span></span><span style="display:flex;"><span>        result_loss = loss(output, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># 参数梯度重置为0</span>
</span></span><span style="display:flex;"><span>        optim.zero_grad()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># 后向传播(计算梯度)</span>
</span></span><span style="display:flex;"><span>        result_loss.backward()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># 更新参数</span>
</span></span><span style="display:flex;"><span>        optim.step()
</span></span><span style="display:flex;"><span>        running_loss += result_loss
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(running_loss)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pytorch网络模型修改和使用">PyTorch网络模型修改和使用</h3>
<h4 id="pytorch网络模型">PyTorch网络模型</h4>
<p>在PyTorch中已经集成了许多经典的网络模型，在<code>torchvision</code>中有分类模型，语义分割模型，目标检测的模型。这次我们还是采用<code>CIFAR10</code>做一个分类模型，分类模型使用的是<code>VGG模型</code>中的<code>vgg16</code>。</p>
<blockquote>
<p><code>torchvision.models.vgg16</code>(***, <em>weights: Optional[torchvision.models.vgg.VGG16_Weights] = None</em>, <em>progress: bool = True</em>, **kwargs: Any)</p>
</blockquote>
<p>参数：</p>
<ul>
<li>weight：默认为None值，代表没有预训练（该网络在其他公开数据集上运行一部分的结果）的权重。</li>
<li>progress：训练的过程中是否显示进度条，默认为True</li>
<li>**kwargs：传递给VGG基类的参数</li>
</ul>
<p>使用vgg16网络对CIFAR10数据集训练：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">本来想使用ImageNet数据集预训练VGG.vgg16网络模型，但由于数据集太大放弃了
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">然后训练CIFAR10数据集
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 目前能通过此方法下载，必须外部下载，放到根目录下才行，而且ImageNet有100多个G的训练集，属实有点大。</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># train_data = torchvision.datasets.ImageNet(&#34;../data_image_net&#34;, split=&#34;train&#34;, download=True,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># transform=torchvision.transforms.ToTensor())</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vgg16_false = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>vgg16_true = torchvision.models.vgg16(weights=torchvision.models.VGG16_Weights)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">由于VGG.vgg16是对1000个类进行分类，我们需要修改网络模型分成10类
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">可以使用添加一个线性层，也可以考虑修改最后的线性层
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 模型增加层</span>
</span></span><span style="display:flex;"><span>vgg16_true.classifier.add_module(<span style="color:#cd5555">&#34;add_linear&#34;</span>, nn.Linear(<span style="color:#b452cd">1000</span>, <span style="color:#b452cd">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16_true)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 模型修改层</span>
</span></span><span style="display:flex;"><span>vgg16_false.classifier[<span style="color:#b452cd">6</span>] = nn.Linear(<span style="color:#b452cd">4096</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16_false)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="模型的保存和加载">模型的保存和加载</h4>
<p>model_save.py:</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vgg16 = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 保存方式1 (网络模型结构+参数)</span>
</span></span><span style="display:flex;"><span>torch.save(vgg16, <span style="color:#cd5555">&#34;vgg16_method1.pth&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 保存方式2（只保存网络模型的参数，字典的格式)</span>
</span></span><span style="display:flex;"><span>torch.save(vgg16.state_dict(), <span style="color:#cd5555">&#34;vgg16_method2.pth&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 保存自己的模型</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">64</span>, kernel_size=<span style="color:#b452cd">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.conv1(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>torch.save(cai.state_dict(), <span style="color:#cd5555">&#34;my_model.pth&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>model_load.py:</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model_save</span> <span style="color:#8b008b;font-weight:bold">import</span> Cai
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 加载方式1-&gt;对应保存方式1</span>
</span></span><span style="display:flex;"><span>model1 = torch.load(<span style="color:#cd5555">&#34;vgg16_method1.pth&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(model1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 加载方式2-&gt;对应保存方式2</span>
</span></span><span style="display:flex;"><span>vgg16 = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>vgg16.load_state_dict(torch.load(<span style="color:#cd5555">&#34;vgg16_method2.pth&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 加载自己的模型</span>
</span></span><span style="display:flex;"><span>my_model = Cai()
</span></span><span style="display:flex;"><span>my_model.load_state_dict(torch.load(<span style="color:#cd5555">&#34;my_model.pth&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(my_model)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="完整的模型训练">完整的模型训练</h3>
<h4 id="完整的模型训练套路cifar10数据集为例">完整的模型训练套路（CIFAR10数据集为例）</h4>
<ul>
<li>首先，先说一下分类问题特有的正确率检验，看一个例子就明白了：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outputs = torch.tensor([[<span style="color:#b452cd">0.1</span>, <span style="color:#b452cd">0.2</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">0.3</span>, <span style="color:#b452cd">0.4</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(outputs.argmax(<span style="color:#b452cd">1</span>)) <span style="color:#228b22"># 横向比较，找到较大的那个数的位置（从0开始）</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(outputs.argmax(<span style="color:#b452cd">0</span>)) <span style="color:#228b22"># 竖向比较，找到较大的那个数的位置（从0开始）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>preds = outputs.argmax(<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>targets = torch.tensor([<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>])
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>((preds == targets).sum())
</span></span></code></pre></td></tr></table>
</div>
</div><p>完整的CIFAR10训练和测试，利用之前写过的<code>CIFAR10 quick_model</code>，训练10轮：</p>
<ul>
<li>model.py:</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 搭建神经网络模型</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Flatten(),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>*<span style="color:#b452cd">4</span>*<span style="color:#b452cd">4</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">if</span> __name__ == <span style="color:#cd5555">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    main函数用于测试模型
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    cai = Cai()
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 64张3通道32×32的图片</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">input</span> = torch.ones((<span style="color:#b452cd">64</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>    output = cai(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(output.shape)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>train.py:</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model</span> <span style="color:#8b008b;font-weight:bold">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 准备数据集</span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 数据集长度</span>
</span></span><span style="display:flex;"><span>train_data_size = <span style="color:#658b00">len</span>(train_data)
</span></span><span style="display:flex;"><span>test_data_size = <span style="color:#658b00">len</span>(test_data)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;训练数据集的长度为：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(train_data_size))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;测试数据集的长度为：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(test_data_size))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 利用 DataLoader 加载数据集</span>
</span></span><span style="display:flex;"><span>train_dataloader = DataLoader(train_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>test_dataloader = DataLoader(test_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 创建网络模型</span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 损失函数</span>
</span></span><span style="display:flex;"><span>loss_fn = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 优化器 SGD：随机梯度下降</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># learning_rate = 0.01</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1e-2 = 1×(10)^(-2) = 0.01</span>
</span></span><span style="display:flex;"><span>learning_rate = <span style="color:#b452cd">1e-2</span>
</span></span><span style="display:flex;"><span>optimizer = torch.optim.SGD(cai.parameters(), lr=learning_rate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 设置训练网络的一些参数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 记录训练和测试的次数</span>
</span></span><span style="display:flex;"><span>total_train_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>total_test_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 训练的轮数</span>
</span></span><span style="display:flex;"><span>epoch = <span style="color:#b452cd">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 添加tensorboard</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_train&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 模型训练</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(epoch):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;-------------第</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">轮训练开始--------------&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 训练步骤开始</span>
</span></span><span style="display:flex;"><span>    cai.train()  <span style="color:#228b22"># 这句话是为了在网络中如果有drop_out或者batch_normal等层时才会起作用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> train_dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        outputs = cai(imgs)
</span></span><span style="display:flex;"><span>        loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># 优化器优化模型</span>
</span></span><span style="display:flex;"><span>        optimizer.zero_grad()
</span></span><span style="display:flex;"><span>        loss.backward()
</span></span><span style="display:flex;"><span>        optimizer.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_train_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> total_train_step % <span style="color:#b452cd">100</span> == <span style="color:#b452cd">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#228b22"># 使用.item()取出tensor数据类型的内容</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;训练次数：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">，Loss：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_train_step, loss.item()))
</span></span><span style="display:flex;"><span>            writer.add_scalar(<span style="color:#cd5555">&#34;train_loss&#34;</span>, loss.item(), total_train_step)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 测试步骤开始</span>
</span></span><span style="display:flex;"><span>    cai.eval() <span style="color:#228b22"># 这句话是为了在网络中如果有drop_out或者batch_normal等层时才会起作用</span>
</span></span><span style="display:flex;"><span>    total_test_loss = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    total_accuracy = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_dataloader:
</span></span><span style="display:flex;"><span>            imgs, targets = data
</span></span><span style="display:flex;"><span>            outputs = cai(imgs)
</span></span><span style="display:flex;"><span>            loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>            total_test_loss = total_test_loss + loss.item()
</span></span><span style="display:flex;"><span>            accuracy = (outputs.argmax(<span style="color:#b452cd">1</span>) == targets).sum()
</span></span><span style="display:flex;"><span>            total_accuracy += accuracy
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;整体测试集上的Loss：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_test_loss))
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;整体测试集上的正确率：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_accuracy/test_data_size))
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_loss&#34;</span>, total_test_loss, total_test_step)
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_accuracy&#34;</span>, total_accuracy/test_data_size, total_test_step)
</span></span><span style="display:flex;"><span>    total_test_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 保存每一轮模型参数的结果</span>
</span></span><span style="display:flex;"><span>    torch.save(cai, <span style="color:#cd5555">&#34;cai_</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">.pth&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai.static_dict(), &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;模型已保存&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>训练的tensorboard结果（10轮）如下，训练集50000张，测试集10000张：</p>
<ul>
<li>
<p>运行时间：我用M1 pro的CPU跑完10轮花了将近10分钟。</p>
</li>
<li>
<p>训练损失：</p>
</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img46.jpg" alt=""></p>
<ul>
<li>测试损失：</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img47.jpg" alt=""></p>
<ul>
<li>测试准确率：</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img48.jpg" alt=""></p>
<h4 id="利用gpu进行训练">利用GPU进行训练</h4>
<p>主要的思想就是将用到的模型，损失函数，数据都放到gpu上！</p>
<ul>
<li>Windows端：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>  	model = model.cuda()
</span></span></code></pre></td></tr></table>
</div>
</div><p>训练结果（10轮）如下，训练集50000张，测试集10000张：</p>
<p>运行时间：桌面端<code>RTX 2060</code>时间为76s</p>
<ul>
<li>mac端：</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 返回得到默认的device</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_default_device</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cuda&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">elif</span> <span style="color:#658b00">getattr</span>(torch.backends, <span style="color:#cd5555">&#39;mps&#39;</span>, <span style="color:#8b008b;font-weight:bold">None</span>) <span style="color:#8b008b">is</span> <span style="color:#8b008b">not</span> <span style="color:#8b008b;font-weight:bold">None</span> <span style="color:#8b008b">and</span> torch.backends.mps.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;mps&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cpu&#39;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>device = get_default_device()
</span></span><span style="display:flex;"><span>model = Net()
</span></span><span style="display:flex;"><span>model.to(device)
</span></span><span style="display:flex;"><span>pred = model(X)
</span></span></code></pre></td></tr></table>
</div>
</div><p>我的<code>MBP</code>上的代码需要改成：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 选择设备的函数</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_default_device</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cuda&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">elif</span> <span style="color:#658b00">getattr</span>(torch.backends, <span style="color:#cd5555">&#39;mps&#39;</span>, <span style="color:#8b008b;font-weight:bold">None</span>) <span style="color:#8b008b">is</span> <span style="color:#8b008b">not</span> <span style="color:#8b008b;font-weight:bold">None</span> <span style="color:#8b008b">and</span> torch.backends.mps.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;mps&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cpu&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 定义训练的设备</span>
</span></span><span style="display:flex;"><span>device = get_default_device()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 准备数据集</span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 数据集长度</span>
</span></span><span style="display:flex;"><span>train_data_size = <span style="color:#658b00">len</span>(train_data)
</span></span><span style="display:flex;"><span>test_data_size = <span style="color:#658b00">len</span>(test_data)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;训练数据集的长度为：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(train_data_size))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;测试数据集的长度为：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(test_data_size))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 利用 DataLoader 加载数据集</span>
</span></span><span style="display:flex;"><span>train_dataloader = DataLoader(train_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>test_dataloader = DataLoader(test_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 搭建神经网络模型</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Flatten(),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>*<span style="color:#b452cd">4</span>*<span style="color:#b452cd">4</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 创建网络模型</span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 网络模型转移到苹果芯片的gpu</span>
</span></span><span style="display:flex;"><span>cai.to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 损失函数</span>
</span></span><span style="display:flex;"><span>loss_fn = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 损失函数转移到苹果芯片的gpu</span>
</span></span><span style="display:flex;"><span>loss_fn.to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 优化器 SGD：随机梯度下降</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># learning_rate = 0.01</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1e-2 = 1×(10)^(-2) = 0.01</span>
</span></span><span style="display:flex;"><span>learning_rate = <span style="color:#b452cd">1e-2</span>
</span></span><span style="display:flex;"><span>optimizer = torch.optim.SGD(cai.parameters(), lr=learning_rate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 设置训练网络的一些参数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 记录训练和测试的次数</span>
</span></span><span style="display:flex;"><span>total_train_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>total_test_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 训练的轮数</span>
</span></span><span style="display:flex;"><span>epoch = <span style="color:#b452cd">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 添加tensorboard</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_train&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_time = time.time()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 模型训练</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(epoch):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;-------------第</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">轮训练开始--------------&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 训练步骤开始</span>
</span></span><span style="display:flex;"><span>    cai.train()  <span style="color:#228b22"># 这句话是为了在网络中如果有drop_out或者batch_normal等层时才会起作用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> train_dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        imgs = imgs.to(device)
</span></span><span style="display:flex;"><span>        targets = targets.to(device)
</span></span><span style="display:flex;"><span>        outputs = cai(imgs)
</span></span><span style="display:flex;"><span>        loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># 优化器优化模型</span>
</span></span><span style="display:flex;"><span>        optimizer.zero_grad()
</span></span><span style="display:flex;"><span>        loss.backward()
</span></span><span style="display:flex;"><span>        optimizer.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_train_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> total_train_step % <span style="color:#b452cd">100</span> == <span style="color:#b452cd">0</span>:
</span></span><span style="display:flex;"><span>            end_time = time.time()
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(end_time - start_time)
</span></span><span style="display:flex;"><span>            <span style="color:#228b22"># 使用.item()取出tensor数据类型的内容</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;训练次数：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">，Loss：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_train_step, loss.item()))
</span></span><span style="display:flex;"><span>            writer.add_scalar(<span style="color:#cd5555">&#34;train_loss&#34;</span>, loss.item(), total_train_step)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 测试步骤开始</span>
</span></span><span style="display:flex;"><span>    cai.eval() <span style="color:#228b22"># 这句话是为了在网络中如果有drop_out或者batch_normal等层时才会起作用</span>
</span></span><span style="display:flex;"><span>    total_test_loss = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    total_accuracy = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_dataloader:
</span></span><span style="display:flex;"><span>            imgs, targets = data
</span></span><span style="display:flex;"><span>            imgs = imgs.to(device)
</span></span><span style="display:flex;"><span>            targets = targets.to(device)
</span></span><span style="display:flex;"><span>            outputs = cai(imgs)
</span></span><span style="display:flex;"><span>            loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>            total_test_loss = total_test_loss + loss.item()
</span></span><span style="display:flex;"><span>            accuracy = (outputs.argmax(<span style="color:#b452cd">1</span>) == targets).sum()
</span></span><span style="display:flex;"><span>            total_accuracy += accuracy
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;整体测试集上的Loss：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_test_loss))
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;整体测试集上的正确率：</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_accuracy.item()/test_data_size))
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_loss&#34;</span>, total_test_loss, total_test_step)
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_accuracy&#34;</span>, total_accuracy.item()/test_data_size, total_test_step)
</span></span><span style="display:flex;"><span>    total_test_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 保存每一轮模型参数的结果</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai, &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai.static_dict(), &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;模型已保存&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>训练结果（10轮）如下，训练集50000张，测试集10000张：</p>
<p>运行时间：我的M1 pro的GPU上运行时间为54s</p>
<p>正确率：将epoch加到50轮，最高正确率为0.65</p>
<ul>
<li>训练损失：</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img49.jpg" alt=""></p>
<ul>
<li>测试准确率：</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img50.jpg" alt=""></p>
<ul>
<li>测试损失：</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img51.jpg" alt=""></p>
<h4 id="完整的模型验证套路">完整的模型验证套路</h4>
<p>在网上找了一张狗的图片，放在<code>test_imgs</code>文件夹下，写一下验证套路代码：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.transforms</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model</span> <span style="color:#8b008b;font-weight:bold">import</span> Cai
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_path = <span style="color:#cd5555">&#34;../test_imgs/dog.png&#34;</span>
</span></span><span style="display:flex;"><span>image = Image.open(image_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">png格式的图片是4个通道，在RGB通道外，还有一个透明度的通道。
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">所以要将4通道转化为3通道
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>image = image.convert(<span style="color:#cd5555">&#39;RGB&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(image)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transform = torchvision.transforms.Compose([torchvision.transforms.Resize((<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>)),
</span></span><span style="display:flex;"><span>                                            torchvision.transforms.ToTensor()])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image = transform(image)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(image.shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 加载网络模型，模型在&#39;mps&#39;环境下运行，如果用cpu验证，则需要指定device=’cpu‘</span>
</span></span><span style="display:flex;"><span>model = torch.load(<span style="color:#cd5555">&#34;cai_25.pth&#34;</span>, map_location=torch.device(<span style="color:#cd5555">&#39;cpu&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(model)
</span></span><span style="display:flex;"><span>image = torch.reshape(image, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.eval()
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>    output = model(image)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output.argmax(<span style="color:#b452cd">1</span>).item())
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 结果为5,为dog，正确预测</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
                    
                    <HR width="100%" id="EOF">
		            <p style="color:#777;">最后修改于 2022-07-29</p>
                    
                    
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://image-1252109614.cos.ap-beijing.myqcloud.com/img/20210508215939.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-11%E8%8A%82/">
			下回<br>深度学习笔记（10-11节） 
                </a>
                
                
                
                <a class="older-posts" href="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-9%E8%8A%82/">
			上回<br>深度学习笔记（8-9节） 
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="tcomment"></div>



            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
魔改自 <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2023 🌀Jarson Cai&#39;s Blog
	</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            },
            debounce(func, wait, options) {
                let lastArgs,
                    lastThis,
                    maxWait,
                    result,
                    timerId,
                    lastCallTime

                let lastInvokeTime = 0
                let leading = false
                let maxing = false
                let trailing = true

                
                const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function')

                if (typeof func !== 'function') {
                    throw new TypeError('Expected a function')
                }
                function isObject(value) {
                    const type = typeof value
                    return value != null && (type === 'object' || type === 'function')
                }

                wait = +wait || 0
                if (isObject(options)) {
                    leading = !!options.leading
                    maxing = 'maxWait' in options
                    maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait
                    trailing = 'trailing' in options ? !!options.trailing : trailing
                }

                function invokeFunc(time) {
                    const args = lastArgs
                    const thisArg = lastThis

                    lastArgs = lastThis = undefined
                    lastInvokeTime = time
                    result = func.apply(thisArg, args)
                    return result
                }

                function startTimer(pendingFunc, wait) {
                    if (useRAF) {
                    root.cancelAnimationFrame(timerId)
                    return root.requestAnimationFrame(pendingFunc)
                    }
                    return setTimeout(pendingFunc, wait)
                }

                function cancelTimer(id) {
                    if (useRAF) {
                    return root.cancelAnimationFrame(id)
                    }
                    clearTimeout(id)
                }

                function leadingEdge(time) {
                    
                    lastInvokeTime = time
                    
                    timerId = startTimer(timerExpired, wait)
                    
                    return leading ? invokeFunc(time) : result
                }

                function remainingWait(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime
                    const timeWaiting = wait - timeSinceLastCall

                    return maxing
                    ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke)
                    : timeWaiting
                }

                function shouldInvoke(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime

                    
                    
                    
                    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
                    (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait))
                }

                function timerExpired() {
                    const time = Date.now()
                    if (shouldInvoke(time)) {
                    return trailingEdge(time)
                    }
                    
                    timerId = startTimer(timerExpired, remainingWait(time))
                }

                function trailingEdge(time) {
                    timerId = undefined

                    
                    
                    if (trailing && lastArgs) {
                    return invokeFunc(time)
                    }
                    lastArgs = lastThis = undefined
                    return result
                }

                function cancel() {
                    if (timerId !== undefined) {
                    cancelTimer(timerId)
                    }
                    lastInvokeTime = 0
                    lastArgs = lastCallTime = lastThis = timerId = undefined
                }

                function flush() {
                    return timerId === undefined ? result : trailingEdge(Date.now())
                }

                function pending() {
                    return timerId !== undefined
                }

                function debounced(...args) {
                    const time = Date.now()
                    const isInvoking = shouldInvoke(time)

                    lastArgs = args
                    lastThis = this
                    lastCallTime = time

                    if (isInvoking) {
                    if (timerId === undefined) {
                        return leadingEdge(lastCallTime)
                    }
                    if (maxing) {
                        
                        timerId = startTimer(timerExpired, wait)
                        return invokeFunc(lastCallTime)
                    }
                    }
                    if (timerId === undefined) {
                    timerId = startTimer(timerExpired, wait)
                    }
                    return result
                }
                debounced.cancel = cancel
                debounced.flush = flush
                debounced.pending = pending
                return debounced
                }

    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
        
        
            twikoo.init({
                envId: "https://twikoo-rho-olive.vercel.app/",
                el: '#tcomment',
                region:  null ,
            });
        

        document.querySelectorAll("table").forEach(function(elem){
            elem.classList.add("table-striped");
            elem.classList.add("table");
            elem.classList.add("table-responsive");
            elem.classList.add("table-hover");
        })

        
        spy();
        window.addEventListener('scroll', this.debounce(spy, 250, { 'maxWait': 250 }), false);
        
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});



</script>
    </body>
</html>
