<!DOCTYPE html>
<html><head>
<title>PyTorchå…¥é—¨</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="åœ¨æ·±åº¦å­¦ä¹ çš„æ¡†æ¶é€‰æ‹©ä¸Šï¼Œé€‰æ‹©PyTorchï¼Œtensorflowå­˜åœ¨ä»£ç ç‰ˆæœ¬çš„é—®é¢˜ï¼Œkerasåˆå¤ªè¿‡ç®€å•äº†ã€‚">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="PyTorchå…¥é—¨" />
<meta property="og:description" content="åœ¨æ·±åº¦å­¦ä¹ çš„æ¡†æ¶é€‰æ‹©ä¸Šï¼Œé€‰æ‹©PyTorchï¼Œtensorflowå­˜åœ¨ä»£ç ç‰ˆæœ¬çš„é—®é¢˜ï¼Œkerasåˆå¤ªè¿‡ç®€å•äº†ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/pytorch%E5%85%A5%E9%97%A8/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2022-07-28T18:18:05+08:00" />
<meta property="article:modified_time" content="2022-07-29T09:19:06+08:00" />












<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>


  




<link rel="icon" href="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/avater.jfif">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/dark-mode.min.c0082f0b082177f6fb3768ff91439a097de49689bd26f4d49f76d94ebb81e02d.css" integrity="sha256-wAgvCwghd/b7N2j/kUOaCX3klom9JvTUn3bZTruB4C0=" media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>


  
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script"
async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
MathJax.Hub.Queue(function() {



var all = MathJax.Hub.getAllJax(), i;
for(i = 0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';
}
});
</script>

<style>
code.has-jax {
font: inherit;
font-size: 100%;
background: inherit;
border: inherit;
color: #515151;
}
</style>





  
    <script src="/js/toc.js"></script>
  











<script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>




</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://caixiongjiang.github.io/">
    
        <div class="nav-title">
            ğŸŒ€Jarson Cai&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            å¤´è„‘æ˜¯æ—¥ç”¨å“ï¼Œä¸æ˜¯è£…é¥°å“
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/blog">
                æ–‡ç« ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                åˆ†ç±»ğŸ“Œ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ ‡ç­¾ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/series">
                ç³»åˆ—ğŸ“š
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/archive">
                å½’æ¡£ğŸ“ƒ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                å…³äºğŸ‘‹
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friends">
                å‹é“¾ğŸ”—
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSSğŸ“¢
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://github.com/caixiongjiang">
    GitHub
</a>
<br>

<a href="https://jarson-cai.gitee.io/jarson-cai-blog">
    MiFeng
</a>
<br>

<a href="nau_cxj@163.com">
    Email
</a>
<br>

<a href="https://leetcode-cn.com/u/cai-xiong-jiang/">
    Leetcode
</a>
<br>

        <hr>
        
é­”æ”¹è‡ª <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2023 ğŸŒ€Jarson Cai&#39;s Blog
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®å½• -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" onclick="onNavClick(`#pytorchå­¦ä¹ ç¬”è®°-nav`)" id="pytorchå­¦ä¹ ç¬”è®°-nav">
									PyTorchå­¦ä¹ ç¬”è®°
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ae%89%e8%a3%85%e5%8f%8a%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#pytorchå®‰è£…åŠç¯å¢ƒé…ç½®-nav`)" id="pytorchå®‰è£…åŠç¯å¢ƒé…ç½®-nav">
									PyTorchå®‰è£…åŠç¯å¢ƒé…ç½®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#conda%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#condaç¯å¢ƒå®‰è£…-nav`)" id="condaç¯å¢ƒå®‰è£…-nav">
									condaç¯å¢ƒå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8conda%e5%88%9b%e5%bb%ba%e5%b9%b6%e7%ae%a1%e7%90%86%e4%b8%8d%e5%90%8c%e7%9a%84%e7%8e%af%e5%a2%83" onclick="onNavClick(`#ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ-nav`)" id="ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ-nav">
									ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorh%e5%ae%89%e8%a3%85" onclick="onNavClick(`#pytorhå®‰è£…-nav`)" id="pytorhå®‰è£…-nav">
									PyTorhå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jupyter%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#jupyterç¯å¢ƒå®‰è£…-nav`)" id="jupyterç¯å¢ƒå®‰è£…-nav">
									Jupyterç¯å¢ƒå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e8%af%ad%e6%b3%95" onclick="onNavClick(`#pytorchè¯­æ³•-nav`)" id="pytorchè¯­æ³•-nav">
									Pytorchè¯­æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#package%e5%b7%a5%e5%85%b7" onclick="onNavClick(`#packageå·¥å…·-nav`)" id="packageå·¥å…·-nav">
									Packageå·¥å…·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#python%e6%96%87%e4%bb%b6vspython%e6%8e%a7%e5%88%b6%e5%8f%b0vsjupyter-notebook" onclick="onNavClick(`#pythonæ–‡ä»¶vspythonæ§åˆ¶å°vsjupyter-notebook-nav`)" id="pythonæ–‡ä»¶vspythonæ§åˆ¶å°vsjupyter-notebook-nav">
									Pythonæ–‡ä»¶vsPythonæ§åˆ¶å°vsJupyter Notebook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorch%e8%af%bb%e5%8f%96%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#pytorchè¯»å–åŠ è½½æ•°æ®-nav`)" id="pytorchè¯»å–åŠ è½½æ•°æ®-nav">
									PyTorchè¯»å–/åŠ è½½æ•°æ®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataset%e4%bb%a3%e7%a0%81%e5%ae%9e%e6%88%98" onclick="onNavClick(`#datasetä»£ç å®æˆ˜-nav`)" id="datasetä»£ç å®æˆ˜-nav">
									Datasetä»£ç å®æˆ˜
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b8%b8%e8%a7%81%e7%9a%84%e6%b7%b1%e5%ba%a6%e5%ad%a6%e4%b9%a0%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨-nav`)" id="å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨-nav">
									å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tensorboard%e5%ae%89%e8%a3%85" onclick="onNavClick(`#tensorboardå®‰è£…-nav`)" id="tensorboardå®‰è£…-nav">
									Tensorboardå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tensorboard%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#tensorboardä½¿ç”¨-nav`)" id="tensorboardä½¿ç”¨-nav">
									Tensorboardä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transforms%e7%9a%84%e7%bb%93%e6%9e%84%e5%92%8c%e7%94%a8%e6%b3%95" onclick="onNavClick(`#transformsçš„ç»“æ„å’Œç”¨æ³•-nav`)" id="transformsçš„ç»“æ„å’Œç”¨æ³•-nav">
									Transformsçš„ç»“æ„å’Œç”¨æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#torchvison%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e9%9b%86%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨-nav`)" id="torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨-nav">
									torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataloader%e7%9a%84%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#dataloaderçš„ä½¿ç”¨-nav`)" id="dataloaderçš„ä½¿ç”¨-nav">
									DataLoaderçš„ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e5%86%99%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c" onclick="onNavClick(`#pytorchå†™ç¥ç»ç½‘ç»œ-nav`)" id="pytorchå†™ç¥ç»ç½‘ç»œ-nav">
									PyTorchå†™ç¥ç»ç½‘ç»œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%9f%ba%e6%9c%ac%e9%aa%a8%e6%9e%b6nnmodule%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶nnmoduleä½¿ç”¨-nav`)" id="ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶nnmoduleä½¿ç”¨-nav">
									ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶â€”â€”nn.Moduleä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e5%8d%b7%e7%a7%af%e5%b1%82%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹-nav`)" id="ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹-nav">
									ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b7%e7%a7%af%e7%bd%91%e7%bb%9c-%e6%9c%80%e5%a4%a7%e6%b1%a0%e5%8c%96" onclick="onNavClick(`#å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–-nav`)" id="å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–-nav">
									å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e9%9d%9e%e7%ba%bf%e6%80%a7%e6%bf%80%e6%b4%bb" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»-nav`)" id="ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»-nav">
									ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sequential%e4%bd%bf%e7%94%a8%e4%bb%a5%e5%8f%8a%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%ae%9e%e6%88%98%e6%90%ad%e5%bb%ba" onclick="onNavClick(`#sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º-nav`)" id="sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º-nav">
									Sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°åå‘ä¼ æ’­-nav`)" id="ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°åå‘ä¼ æ’­-nav">
									ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°&amp;åå‘ä¼ æ’­
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%98%e5%8c%96%e5%99%a8" onclick="onNavClick(`#ä¼˜åŒ–å™¨-nav`)" id="ä¼˜åŒ–å™¨-nav">
									ä¼˜åŒ–å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b%e4%bf%ae%e6%94%b9%e5%92%8c%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#pytorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨-nav`)" id="pytorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨-nav">
									PyTorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#pytorchç½‘ç»œæ¨¡å‹-nav`)" id="pytorchç½‘ç»œæ¨¡å‹-nav">
									PyTorchç½‘ç»œæ¨¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e7%9a%84%e4%bf%9d%e5%ad%98%e5%92%8c%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½-nav`)" id="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½-nav">
									æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ-nav`)" id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ-nav">
									å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83%e5%a5%97%e8%b7%afcifar10%e6%95%b0%e6%8d%ae%e9%9b%86%e4%b8%ba%e4%be%8b" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯cifar10æ•°æ®é›†ä¸ºä¾‹-nav`)" id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯cifar10æ•°æ®é›†ä¸ºä¾‹-nav">
									å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯ï¼ˆCIFAR10æ•°æ®é›†ä¸ºä¾‹ï¼‰
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a9%e7%94%a8gpu%e8%bf%9b%e8%a1%8c%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#åˆ©ç”¨gpuè¿›è¡Œè®­ç»ƒ-nav`)" id="åˆ©ç”¨gpuè¿›è¡Œè®­ç»ƒ-nav">
									åˆ©ç”¨GPUè¿›è¡Œè®­ç»ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e9%aa%8c%e8%af%81%e5%a5%97%e8%b7%af" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯-nav`)" id="å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯-nav">
									å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/blog">
                    æ–‡ç« ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    åˆ†ç±»ğŸ“Œ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ ‡ç­¾ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/series">
                    ç³»åˆ—ğŸ“š
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/archive">
                    å½’æ¡£ğŸ“ƒ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    å…³äºğŸ‘‹
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friends">
                    å‹é“¾ğŸ”—
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSSğŸ“¢
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®å½• -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" onclick="onNavClick(`#pytorchå­¦ä¹ ç¬”è®°-nav`)" id="pytorchå­¦ä¹ ç¬”è®°-nav">
									PyTorchå­¦ä¹ ç¬”è®°
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e5%ae%89%e8%a3%85%e5%8f%8a%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" onclick="onNavClick(`#pytorchå®‰è£…åŠç¯å¢ƒé…ç½®-nav`)" id="pytorchå®‰è£…åŠç¯å¢ƒé…ç½®-nav">
									PyTorchå®‰è£…åŠç¯å¢ƒé…ç½®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#conda%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#condaç¯å¢ƒå®‰è£…-nav`)" id="condaç¯å¢ƒå®‰è£…-nav">
									condaç¯å¢ƒå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8conda%e5%88%9b%e5%bb%ba%e5%b9%b6%e7%ae%a1%e7%90%86%e4%b8%8d%e5%90%8c%e7%9a%84%e7%8e%af%e5%a2%83" onclick="onNavClick(`#ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ-nav`)" id="ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ-nav">
									ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorh%e5%ae%89%e8%a3%85" onclick="onNavClick(`#pytorhå®‰è£…-nav`)" id="pytorhå®‰è£…-nav">
									PyTorhå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jupyter%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" onclick="onNavClick(`#jupyterç¯å¢ƒå®‰è£…-nav`)" id="jupyterç¯å¢ƒå®‰è£…-nav">
									Jupyterç¯å¢ƒå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e8%af%ad%e6%b3%95" onclick="onNavClick(`#pytorchè¯­æ³•-nav`)" id="pytorchè¯­æ³•-nav">
									Pytorchè¯­æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#package%e5%b7%a5%e5%85%b7" onclick="onNavClick(`#packageå·¥å…·-nav`)" id="packageå·¥å…·-nav">
									Packageå·¥å…·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#python%e6%96%87%e4%bb%b6vspython%e6%8e%a7%e5%88%b6%e5%8f%b0vsjupyter-notebook" onclick="onNavClick(`#pythonæ–‡ä»¶vspythonæ§åˆ¶å°vsjupyter-notebook-nav`)" id="pythonæ–‡ä»¶vspythonæ§åˆ¶å°vsjupyter-notebook-nav">
									Pythonæ–‡ä»¶vsPythonæ§åˆ¶å°vsJupyter Notebook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pytorch%e8%af%bb%e5%8f%96%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae" onclick="onNavClick(`#pytorchè¯»å–åŠ è½½æ•°æ®-nav`)" id="pytorchè¯»å–åŠ è½½æ•°æ®-nav">
									PyTorchè¯»å–/åŠ è½½æ•°æ®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataset%e4%bb%a3%e7%a0%81%e5%ae%9e%e6%88%98" onclick="onNavClick(`#datasetä»£ç å®æˆ˜-nav`)" id="datasetä»£ç å®æˆ˜-nav">
									Datasetä»£ç å®æˆ˜
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b8%b8%e8%a7%81%e7%9a%84%e6%b7%b1%e5%ba%a6%e5%ad%a6%e4%b9%a0%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨-nav`)" id="å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨-nav">
									å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tensorboard%e5%ae%89%e8%a3%85" onclick="onNavClick(`#tensorboardå®‰è£…-nav`)" id="tensorboardå®‰è£…-nav">
									Tensorboardå®‰è£…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tensorboard%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#tensorboardä½¿ç”¨-nav`)" id="tensorboardä½¿ç”¨-nav">
									Tensorboardä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#transforms%e7%9a%84%e7%bb%93%e6%9e%84%e5%92%8c%e7%94%a8%e6%b3%95" onclick="onNavClick(`#transformsçš„ç»“æ„å’Œç”¨æ³•-nav`)" id="transformsçš„ç»“æ„å’Œç”¨æ³•-nav">
									Transformsçš„ç»“æ„å’Œç”¨æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#torchvison%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e9%9b%86%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨-nav`)" id="torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨-nav">
									torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#dataloader%e7%9a%84%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#dataloaderçš„ä½¿ç”¨-nav`)" id="dataloaderçš„ä½¿ç”¨-nav">
									DataLoaderçš„ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e5%86%99%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c" onclick="onNavClick(`#pytorchå†™ç¥ç»ç½‘ç»œ-nav`)" id="pytorchå†™ç¥ç»ç½‘ç»œ-nav">
									PyTorchå†™ç¥ç»ç½‘ç»œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%9f%ba%e6%9c%ac%e9%aa%a8%e6%9e%b6nnmodule%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶nnmoduleä½¿ç”¨-nav`)" id="ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶nnmoduleä½¿ç”¨-nav">
									ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶â€”â€”nn.Moduleä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e5%8d%b7%e7%a7%af%e5%b1%82%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹-nav`)" id="ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹-nav">
									ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b7%e7%a7%af%e7%bd%91%e7%bb%9c-%e6%9c%80%e5%a4%a7%e6%b1%a0%e5%8c%96" onclick="onNavClick(`#å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–-nav`)" id="å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–-nav">
									å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e9%9d%9e%e7%ba%bf%e6%80%a7%e6%bf%80%e6%b4%bb" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»-nav`)" id="ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»-nav">
									ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sequential%e4%bd%bf%e7%94%a8%e4%bb%a5%e5%8f%8a%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e5%ae%9e%e6%88%98%e6%90%ad%e5%bb%ba" onclick="onNavClick(`#sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º-nav`)" id="sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º-nav">
									Sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c-%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad" onclick="onNavClick(`#ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°åå‘ä¼ æ’­-nav`)" id="ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°åå‘ä¼ æ’­-nav">
									ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°&amp;åå‘ä¼ æ’­
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bc%98%e5%8c%96%e5%99%a8" onclick="onNavClick(`#ä¼˜åŒ–å™¨-nav`)" id="ä¼˜åŒ–å™¨-nav">
									ä¼˜åŒ–å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b%e4%bf%ae%e6%94%b9%e5%92%8c%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#pytorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨-nav`)" id="pytorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨-nav">
									PyTorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#pytorch%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#pytorchç½‘ç»œæ¨¡å‹-nav`)" id="pytorchç½‘ç»œæ¨¡å‹-nav">
									PyTorchç½‘ç»œæ¨¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e7%9a%84%e4%bf%9d%e5%ad%98%e5%92%8c%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½-nav`)" id="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½-nav">
									æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ-nav`)" id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ-nav">
									å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%ae%ad%e7%bb%83%e5%a5%97%e8%b7%afcifar10%e6%95%b0%e6%8d%ae%e9%9b%86%e4%b8%ba%e4%be%8b" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯cifar10æ•°æ®é›†ä¸ºä¾‹-nav`)" id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯cifar10æ•°æ®é›†ä¸ºä¾‹-nav">
									å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯ï¼ˆCIFAR10æ•°æ®é›†ä¸ºä¾‹ï¼‰
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a9%e7%94%a8gpu%e8%bf%9b%e8%a1%8c%e8%ae%ad%e7%bb%83" onclick="onNavClick(`#åˆ©ç”¨gpuè¿›è¡Œè®­ç»ƒ-nav`)" id="åˆ©ç”¨gpuè¿›è¡Œè®­ç»ƒ-nav">
									åˆ©ç”¨GPUè¿›è¡Œè®­ç»ƒ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%95%b4%e7%9a%84%e6%a8%a1%e5%9e%8b%e9%aa%8c%e8%af%81%e5%a5%97%e8%b7%af" onclick="onNavClick(`#å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯-nav`)" id="å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯-nav">
									å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://caixiongjiang.github.io/">
            ğŸŒ€Jarson Cai&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://caixiongjiang.github.io/">
        <div class="single-column-header-title">ğŸŒ€Jarson Cai&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">å¤´è„‘æ˜¯æ—¥ç”¨å“ï¼Œä¸æ˜¯è£…é¥°å“</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/pytorch_title.jpg')"
                    
                
            >
                <div class="post-title">
                    PyTorchå…¥é—¨
                    
                    <div class="post-subtitle">
                        åœ¨æ·±åº¦å­¦ä¹ çš„æ¡†æ¶é€‰æ‹©ä¸Šï¼Œé€‰æ‹©PyTorchï¼Œtensorflowå­˜åœ¨ä»£ç ç‰ˆæœ¬çš„é—®é¢˜ï¼Œkerasåˆå¤ªè¿‡ç®€å•äº†ã€‚
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-07-28 18:18
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[æ·±åº¦å­¦ä¹ ]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/deep_learning">Deep_learning</a>
                                &nbsp;
                            
                                <a href="/tags/pytorch">PyTorch</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            49 min
                            
                            11 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="pytorchå­¦ä¹ ç¬”è®°">PyTorchå­¦ä¹ ç¬”è®°</h2>
<h3 id="pytorchå®‰è£…åŠç¯å¢ƒé…ç½®">PyTorchå®‰è£…åŠç¯å¢ƒé…ç½®</h3>
<h4 id="condaç¯å¢ƒå®‰è£…">condaç¯å¢ƒå®‰è£…</h4>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„<code>anaconda</code>ï¼Œç›®å‰å®ƒä¹Ÿå·²ç»é€‚é…äº†appleèŠ¯ç‰‡ã€‚æ‰€ä»¥æˆ‘åœ¨æˆ‘çš„<code>M1 Pro</code>çš„ç”µè„‘ä¸Šå°†<code>miniforge3</code>çš„æ–¹æ¡ˆæ›¿æ¢æˆäº†<code>anaconda3</code>ã€‚å®˜ç½‘ï¼š<a href="https://www.anaconda.com/">https://www.anaconda.com/</a></p>
<p><em>Windowsç«¯æ— éœ€å¤šè¯´ï¼Œè‹¹æœç«¯å¦‚æœæ˜¯appleèŠ¯ç‰‡ï¼Œé€‰æ‹©M1ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯intelèŠ¯ç‰‡ï¼Œé€‰æ‹©æ™®é€šç‰ˆæœ¬ã€‚</em></p>
<p>ä¸‹è½½å®Œæˆä¹‹åå®‰è£…ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼ˆMacOSï¼‰ã€‚</p>
<p>é¦–å…ˆè¿›å…¥æ ¹ç›®å½•ï¼Œå¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; <span style="color:#658b00">cd</span> ~
</span></span><span style="display:flex;"><span>&gt; vim ~/.zshrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#658b00">export</span> <span style="color:#00688b">PATH</span>=<span style="color:#cd5555">&#34;/Users/caixiongjiang/opt/anaconda3:</span><span style="color:#00688b">$PATH</span><span style="color:#cd5555">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å…¶ä¸­caixiongjiangæ˜¯ä½ çš„ç”¨æˆ·å</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># vimä¸­æŒ‰iè¿›è¡Œç¼–è¾‘æ¨¡å¼ï¼ŒæŒ‰Eseæ¨å‡ºç¼–è¾‘æ¨¡å¼ï¼Œåœ¨æ™®é€šæ¨¡å¼ä¸‹è¾“å…¥â€œ:wqâ€è¡¨ç¤ºä¿å­˜å¹¶é€€å‡º</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨ç¯å¢ƒé…ç½®ï¼Œå¹¶é…ç½®å›½å†…é•œåƒæºï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; <span style="color:#658b00">source</span> ~/.zshrc
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/msys2/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/
</span></span><span style="display:flex;"><span>&gt; conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/menpo/
</span></span><span style="display:flex;"><span>&gt; conda config --set show_channel_urls yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å…¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda info
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æœ€å·¦è¾¹å‡ºç°ä¸€ä¸ªâ€œ(base)â€è¡¨ç¤ºå·²ç»æˆåŠŸäº†ï¼</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ">ä½¿ç”¨condaåˆ›å»ºå¹¶ç®¡ç†ä¸åŒçš„ç¯å¢ƒ</h4>
<p>åˆ›å»ºç¯å¢ƒï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># åˆ›å»ºä¸€ä¸ªpython3.9çš„ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; conda create -n pytorch <span style="color:#00688b">python</span>=3.9
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åˆ‡æ¢ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æŸ¥çœ‹ç¯å¢ƒåˆ—è¡¨å’Œå½“å‰ä½¿ç”¨ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; conda info -e
</span></span><span style="display:flex;"><span><span style="color:#228b22"># conda environments:</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#</span>
</span></span><span style="display:flex;"><span>base                     /Users/caixiongjiang/opt/anaconda3
</span></span><span style="display:flex;"><span>pytorch               *  /Users/caixiongjiang/opt/anaconda3/envs/pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="pytorhå®‰è£…">PyTorhå®‰è£…</h4>
<ul>
<li>Windowsç«¯ï¼šPyTorchè‡ªå¸¦CUDAå·¥å…·åŠ é€Ÿï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨GPUåšæ·±åº¦å­¦ä¹ ï¼Œéœ€è¦ä¸‹è½½å¸¦æœ‰CUDAçš„ç‰ˆæœ¬ã€‚</li>
</ul>
<p>é¦–å…ˆæ˜¯åªç”¨CPUçš„ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision torchaudio cpuonly -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸¦GPUåŠ é€Ÿçš„ç‰ˆæœ¬ï¼ˆé€‰æ‹©ä¸€ä¸ªCUDA11.3çš„ç‰ˆæœ¬ï¼‰ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision torchaudio <span style="color:#00688b">cudatoolkit</span>=11.3 -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>macç«¯ï¼š</li>
</ul>
<p>å¦‚æœæ˜¯æ™®é€šintelèŠ¯ç‰‡çš„ç”µè„‘ï¼ˆå®‰è£…æ­£å¼ç‰ˆï¼‰ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision -c pytorch
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯è‹¹æœçš„M1ç³»åˆ—çš„èŠ¯ç‰‡ï¼ˆå®‰è£…é¢„è§ˆç‰ˆï¼Œ2022å¹´5æœˆå‘å¸ƒï¼‰ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda install pytorch torchvision -c pytorch-nightly
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>æ£€æŸ¥pytorchæ˜¯å¦å¯ç”¨ï¼š</p>
<ul>
<li>Windowsç«¯ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># åˆ‡æ¢åˆ°pytorchç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch 
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿›å…¥pythonç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; python
</span></span><span style="display:flex;"><span>&gt; import torch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ˜¯å¦å¯ä»¥ä½¿ç”¨GPUåŠ é€Ÿ</span>
</span></span><span style="display:flex;"><span>&gt; torch.cuda.is_avaliable()
</span></span><span style="display:flex;"><span>True <span style="color:#228b22"># Trueåˆ™ä»£è¡¨å¯ä»¥ä½¿ç”¨</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>macç«¯</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># åˆ‡æ¢åˆ°pytorchç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; conda activate pytorch 
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿›å…¥pythonç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>&gt; python
</span></span><span style="display:flex;"><span>&gt; import torch
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ˜¯å¦å¯ä»¥ä½¿ç”¨GPUåŠ é€Ÿ</span>
</span></span><span style="display:flex;"><span>&gt; torch.device(<span style="color:#cd5555">&#39;mps&#39;</span>)
</span></span><span style="display:flex;"><span>device(<span style="color:#00688b">type</span>=<span style="color:#cd5555">&#39;mps&#39;</span>) <span style="color:#228b22">#å¯ä»¥ä½¿ç”¨è‹¹æœè‡ªå¸¦çš„appleèŠ¯ç‰‡è¿›è¡ŒGPUåŠ é€Ÿ </span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="jupyterç¯å¢ƒå®‰è£…">Jupyterç¯å¢ƒå®‰è£…</h4>
<p>å› ä¸ºannacondaæ˜¯è‡ªå¸¦jupyterç¯å¢ƒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ–°å»ºçš„pytorchç¯å¢ƒé‡Œé¢å¹¶æ²¡æœ‰æ”¯æŒjupyterç¯å¢ƒçš„åŒ…ï¼Œé‚£å°±ä¸‹è½½ä¸€ä¸‹å§ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span>&gt; conda install nb_conda
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å¯åŠ¨jupyter notebook</span>
</span></span><span style="display:flex;"><span>&gt; jupyter notebook
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æ–°å»ºä»£ç æ—¶ï¼Œç‚¹å‡»<code>æ–°å»º</code>å¯ä»¥é€‰æ‹©å…ˆå‰åˆ›å»ºçš„ç¯å¢ƒã€‚</p>
<h3 id="pytorchè¯­æ³•">Pytorchè¯­æ³•</h3>
<h4 id="packageå·¥å…·">Packageå·¥å…·</h4>
<p>ä¸€ä¸ªåŒ…é‡Œæœ‰æœ‰å‡ ä¸ªåˆ†éš”åŒºï¼Œæ¯ä¸ªåˆ†éš”åŒºé‡Œæœ‰å‡ ä¸ªå·¥å…·ç®±ã€‚å¦‚ä½•æŸ¥çœ‹å¹¶ä½¿ç”¨å·¥å…·ç®±ï¼š</p>
<ul>
<li>dir()å‡½æ•°ï¼Œèƒ½è®©æˆ‘ä»¬çŸ¥é“å·¥å…·ç®±ä»¥åŠå·¥å…·ç®±åˆ†éš”åŒºæœ‰ä»€ä¹ˆä¸œè¥¿ã€‚</li>
<li>help()å‡½æ•°ï¼Œèƒ½è®©æˆ‘ä»¬çŸ¥é“æ¯ä¸ªå·¥å…·æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œå·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€‚</li>
</ul>
<h4 id="pythonæ–‡ä»¶vspythonæ§åˆ¶å°vsjupyter-notebook">Pythonæ–‡ä»¶vsPythonæ§åˆ¶å°vsJupyter Notebook</h4>
<p>å¦‚æœä»£ç æ˜¯ä»¥å—ä¸€ä¸ªæ•´ä½“è¿è¡Œçš„è¯ï¼š</p>
<ul>
<li>Pythonæ–‡ä»¶çš„å—æ˜¯æ‰€æœ‰è¡Œçš„ä»£ç </li>
<li>Pythonæ§åˆ¶å°çš„å—æ˜¯æ¯ä¸€è¡Œçš„ä»£ç </li>
<li>Jupyter Notebookçš„å—æ˜¯éœ€è¦è‡ªå·±å®šä¹‰çš„ï¼Œæ¯ä¸€æ¬¡inéƒ½æ˜¯ä¸€ä¸ªå—</li>
</ul>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯Pythonæ§åˆ¶å°æ˜¯å¯ä»¥çœ‹åˆ°å˜é‡çš„ä¿¡æ¯çš„ï¼Œå’Œmatlabç›¸ä¼¼ã€‚</em></p>
<h4 id="pytorchè¯»å–åŠ è½½æ•°æ®">PyTorchè¯»å–/åŠ è½½æ•°æ®</h4>
<ul>
<li>Dataset:æä¾›ä¸€ç§æ–¹å¼å»è·å–æ•°æ®å…¶labelå€¼
<ul>
<li>å¦‚ä½•è·å–æ¯ä¸€ä¸ªæ•°æ®åŠå…¶label</li>
<li>å‘Šè¯‰æˆ‘ä»¬æ€»å…±æœ‰å¤šå°‘æ•°æ®</li>
</ul>
</li>
<li>Dataloaderï¼šä¸ºç¥ç»ç½‘ç»œæä¾›ä¸åŒçš„æ•°æ®å½¢å¼</li>
</ul>
<h4 id="datasetä»£ç å®æˆ˜">Datasetä»£ç å®æˆ˜</h4>
<p>é¦–å…ˆéœ€è¦ä»‹ç»ä¸€ç‚¹Pythonä¸­ç±»çš„çŸ¥è¯†ï¼š</p>
<p>åœ¨Pythonä¸­ï¼Œå¦‚æœæƒ³å®ç°åˆ›å»ºç±»ä¼¼äºåºåˆ—å’Œæ˜ å°„çš„ç±»ï¼ˆå¯ä»¥è¿­ä»£ä»¥åŠé€šè¿‡[ä¸‹æ ‡]è¿”å›å…ƒç´ ï¼‰ï¼Œå¯ä»¥é€šè¿‡é‡å†™é­”æ³•æ–¹æ³•çš„æ–¹å¼å»å®ç°ã€‚å¸¸è§çš„é­”æ³•æ–¹æ³•åŒ…æ‹¬__getitem__ï¼ˆï¼‰ã€<strong>setitem</strong>ï¼ˆï¼‰ã€<strong>delitem</strong>ï¼ˆï¼‰ã€<strong>len</strong>ï¼ˆï¼‰ï¼Œå®ƒä»¬çš„å‡½æ•°åŠŸèƒ½ä¸ºï¼š</p>
<pre><code>        1ï¼‰__getitem__(self,key):è¿”å›é”®å¯¹åº”çš„å€¼ï¼›
        2ï¼‰__len__():è¿”å›å…ƒç´ çš„æ•°é‡ï¼›
        3ï¼‰__delitem__(self,key):åˆ é™¤ç»™å®šé”®å¯¹åº”çš„å…ƒç´ ï¼›
        4ï¼‰__setitem__(self,key,value)ï¼šè®¾ç½®ç»™å®šé”®çš„å€¼ã€‚
</code></pre>
<p><code>torch.utils.data.Dataset</code>æ˜¯PyTorchä¸­ç”¨æ¥è¡¨ç¤ºæ•°æ®é›†çš„æŠ½è±¡ç±»ï¼ŒDatasetæ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼Œç”¨æ¥å°†æ•°æ®åŒ…è£…ä¸ºDatasetç±»ï¼Œç„¶åä¼ å…¥DataLoaderä¸­ä»è€Œä½¿DataLoaderç±»æ›´åŠ å¿«æ·çš„å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚å½“å¤„ç†è‡ªå®šä¹‰çš„æ•°æ®é›†çš„æ—¶å€™å¿…é¡»ç»§æ‰¿Dataset,ç„¶åé‡å†™ <strong>len</strong>ï¼ˆï¼‰å’Œ__getitem__ï¼ˆï¼‰å‡½æ•°ã€‚</p>
<pre><code>        1ï¼‰__len__ï¼ˆï¼‰: ä½¿å¾—len(dataset)è¿”å›æ•°æ®é›†çš„å¤§å°ï¼›

        2ï¼‰__getitem__ï¼ˆï¼‰ï¼šä½¿å¾—æ”¯æŒdataset[i]èƒ½å¤Ÿè¿”å›ç¬¬iä¸ªæ•°æ®æ ·æœ¬è¿™æ ·çš„ä¸‹æ ‡æ“ä½œï¼Œåœ¨__getitem__ï¼ˆï¼‰å‡½æ•°ä¸­å®Œæˆå›¾ç‰‡çš„è¯»å–å·¥ä½œå¯ä»¥å‡å°å†…å­˜å¼€é”€ï¼Œåªè¦åœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‰å°†å›¾ç‰‡è¯»å…¥ã€‚
</code></pre>
<p>æ·±åº¦å­¦ä¹ <code>è®­ç»ƒæ•°æ®é›†</code>ä¸€èˆ¬æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ï¼Œå‡è®¾æ•°æ®æœ‰cç±»ï¼š</p>
<ul>
<li>1.æ•°æ®å’Œæ ‡ç­¾æ··åˆï¼š<code>è®­ç»ƒæ•°æ®é›†</code>ä¸‹é¢ä¼šæœ‰cä¸ªæ–‡ä»¶å¤¹çš„è®­ç»ƒæ•°æ®ã€‚æ ‡ç­¾é€šè¿‡æ–‡ä»¶çš„åç§°æ¥å®šï¼Œæ•°æ®åˆ™å¯¹åº”æ ‡ç­¾æ–‡ä»¶å¤¹ç›®å½•ä¸‹çš„æ•°æ®ã€‚</li>
<li>2.æ•°æ®å’Œæ ‡ç­¾åˆ†ç¦»ï¼š<code>è®­ç»ƒæ•°æ®é›†</code>ä¸‹é¢ä¼šæœ‰2$\times$cä¸ªæ–‡ä»¶å¤¹ï¼Œcä¸ªæ–‡ä»¶æ”¾çš„ä¸åŒç±»è®­ç»ƒæ•°æ®ï¼Œå¦å¤–cä¸ªç±»çš„æ–‡ä»¶å¤¹åˆ™æ˜¯ä¸åŒç±»çš„è®­ç»ƒæ ‡ç­¾ã€‚è®­ç»ƒæ•°æ®å’Œè®­ç»ƒæ ‡ç­¾çš„å‰ç¼€æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ ‡ç­¾ä¸€èˆ¬æ”¾åœ¨<code>.txt</code>æ–‡ä»¶å¤¹ä¸­ã€‚</li>
</ul>
<p>ä¸‹é¢é’ˆå¯¹1å†™ä¸€ä¸ªåŠ è½½æ•°æ®çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> Dataset
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyData</span>(Dataset):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self, root_dir, label_dir):
</span></span><span style="display:flex;"><span>        self.root_dir = root_dir
</span></span><span style="display:flex;"><span>        self.label_dir = label_dir
</span></span><span style="display:flex;"><span>        self.path = os.path.join(self.root_dir, self.label_dir) <span style="color:#228b22"># å¯¹åœ°å€è¿›è¡Œæ‹¼æ¥</span>
</span></span><span style="display:flex;"><span>        self.img_path = os.listdir(self.path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __getitem__(self, idx):
</span></span><span style="display:flex;"><span>        img_name = self.img_path[idx]
</span></span><span style="display:flex;"><span>        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name) <span style="color:#228b22"># æ¯ä¸€å¼ å›¾ç‰‡ç›¸å¯¹äºç¨‹åºçš„ç›¸å¯¹è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        img = Image.open(img_item_path) <span style="color:#228b22"># è¯»å–å›¾ç‰‡</span>
</span></span><span style="display:flex;"><span>        label = self.label_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> img, label
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __len__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#658b00">len</span>(self.img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root_dir = <span style="color:#cd5555">&#34;dataset/train&#34;</span>
</span></span><span style="display:flex;"><span>ants_label_dir = <span style="color:#cd5555">&#34;ants&#34;</span>
</span></span><span style="display:flex;"><span>bees_label_dir = <span style="color:#cd5555">&#34;bees&#34;</span>
</span></span><span style="display:flex;"><span>ants_dataset = MyData(root_dir, ants_label_dir)
</span></span><span style="display:flex;"><span>bees_dataset = MyData(root_dir, bees_label_dir)
</span></span><span style="display:flex;"><span>train_dataset = ants_dataset + bees_dataset
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨">å¸¸è§çš„æ·±åº¦å­¦ä¹ å·¥å…·ä½¿ç”¨</h3>
<h4 id="tensorboardå®‰è£…">Tensorboardå®‰è£…</h4>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; conda activate pytorch
</span></span><span style="display:flex;"><span>&gt; pip3 install tensorboard
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tensorboardä½¿ç”¨">Tensorboardä½¿ç”¨</h4>
<p>å…ˆå†™ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å¦‚æœè¦åœ¨logsåé¢åŠ å­æ–‡ä»¶å¯ä»¥åŠ &#34;/æ–‡ä»¶å¤¹å&#34;</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># writer.add_image()</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># y = x</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">100</span>):
</span></span><span style="display:flex;"><span>  	<span style="color:#228b22"># è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ ‡é¢˜ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨yè½´çš„çœŸå®å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨xè½´çš„çœŸå®å€¼</span>
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;y = x&#34;</span>, i, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œè¿™æ®µä»£ç ï¼Œå°±å¯ä»¥åœ¨ä»£ç çš„åŒçº§ç›®å½•ä¸‹ï¼Œå¤šå‡ºä¸€ä¸ª<code>logs</code>çš„æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹çš„åå­—æ˜¯ä»£ç ä¸­è®¾å®šçš„ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨Tensorboardæ¥æŸ¥çœ‹å›¾åƒå‘¢ï¼Ÿ</p>
<p>é¦–å…ˆéœ€è¦æ‰“å¼€<code>PyCharm</code>ä¸­çš„<code>Terminal</code>ï¼Œè¾“å…¥ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#228b22"># logdirä»£è¡¨äº‹ä»¶æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ portä»£è¡¨è‡ªå®šä¹‰ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿™é‡Œåœ¨=åé¢ä½¿ç”¨ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„éƒ½æ˜¯OKçš„</span>
</span></span><span style="display:flex;"><span>&gt; tensorboard --logdir=logs --port=<span style="color:#b452cd">9090</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿è¡Œä¹‹åä¼šå‘ç°ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ‰“å¼€</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>add_image</code>çš„ä½¿ç”¨</li>
</ul>
<p>é€šå¸¸æ¥è¯´ï¼Œ<code>add_image</code>ä¸€èˆ¬æ˜¯ç”¨æ¥è§‚å¯Ÿè®­ç»ƒç»“æœçš„ã€‚</p>
<p>å†™ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">numpy</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">np</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/2&#34;</span>)
</span></span><span style="display:flex;"><span>image_path = <span style="color:#cd5555">&#34;dataset/train/ants_image/0013035.jpg&#34;</span>
</span></span><span style="display:flex;"><span>img_PIL = Image.open(image_path)
</span></span><span style="display:flex;"><span>img_array = np.array(img_PIL)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿™é‡Œçš„dataformats=â€HWCâ€œä»£è¡¨æ•°æ®çš„shapeä¸ºé«˜åº¦ï¼Œå®½åº¦ï¼Œé€šé“æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># é»˜è®¤çš„shapeä¸ºé€šé“æ•°ï¼Œé«˜åº¦ï¼Œå®½åº¦</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ•°å­—1ä»£è¡¨çš„æ˜¯step</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ—¶ä¸€èˆ¬ä¸ºå¼ é‡ï¼Œæˆ–è€…numpyç±»å‹</span>
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;test&#34;</span>, img_array, <span style="color:#b452cd">1</span>, dataformats=<span style="color:#cd5555">&#34;HWC&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="transformsçš„ç»“æ„å’Œç”¨æ³•">Transformsçš„ç»“æ„å’Œç”¨æ³•</h4>
<p>Transformsä¸€èˆ¬å½¢å¼æ˜¯åœ¨ä¸€ä¸ª<code>.py</code>æ–‡ä»¶é‡Œä½¿ç”¨ï¼Œå®ƒçš„åŠŸèƒ½ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç®±ï¼Œèƒ½å¯¹å›¾ç‰‡åšä¸€äº›å¤„ç†ã€‚å·¥å…·ç®±é‡ŒåŒ…å«<code>totensor</code>ï¼Œ<code>resize</code>ç­‰å·¥å…·ï¼Œå›¾ç‰‡ç»è¿‡å·¥å…·çš„å¤„ç†ä¼šè¾“å‡ºä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚</p>
<p>çœ‹ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torchvision</span> <span style="color:#8b008b;font-weight:bold">import</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">cv2</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">cv</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># pythonçš„ç”¨æ³• -&gt; tensoræ•°æ®ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># é€šè¿‡ transforms.ToTensor è§£å†³ä¸¤ä¸ªé—®é¢˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 2.ä¸ºä»€ä¹ˆéœ€è¦Tensoræ•°æ®ç±»å‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç»å¯¹è·¯å¾„ /Users/caixiongjiang/PycharmProjects/learn-pytorch/dataset/train/ants_image/0013035.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç›¸å¯¹è·¯å¾„ dataset/train/ants_image/0013035.jpg</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¯»å–æˆjpgæ ¼å¼</span>
</span></span><span style="display:flex;"><span>img_path = <span style="color:#cd5555">&#34;dataset/train/ants_image/0013035.jpg&#34;</span>
</span></span><span style="display:flex;"><span>img = Image.open(img_path)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¯»å–æˆnumpyæ ¼å¼</span>
</span></span><span style="display:flex;"><span>cv_img = cv.imread(img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1.transformsè¯¥å¦‚ä½•ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>tensor_trans = transforms.ToTensor() <span style="color:#228b22"># åˆ›å»ºå…·ä½“çš„å·¥å…·ï¼ˆå®ä¾‹åŒ–ï¼‰</span>
</span></span><span style="display:flex;"><span>tensor_img = tensor_trans(img) <span style="color:#228b22"># ä½¿ç”¨å·¥å…·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(tensor_img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/3&#34;</span>)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Tensor_img&#34;</span>, tensor_img)
</span></span><span style="display:flex;"><span>writer.close()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 2.ä¸ºä»€ä¹ˆéœ€è¦Tensoræ•°æ®ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># tensoråŒ…å«äº†ä¸€äº›ç¥ç»ç½‘ç»œä¸­çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚åå‘ä¼ æ’­ç­‰</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>transformsçš„å¸¸ç”¨å‡½æ•°ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torchvision</span> <span style="color:#8b008b;font-weight:bold">import</span> transforms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/3&#34;</span>)
</span></span><span style="display:flex;"><span>img = Image.open(<span style="color:#cd5555">&#34;dataset/val/bees/26589803_5ba7000313.jpg&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trans_totensor = transforms.ToTensor()
</span></span><span style="display:flex;"><span>img_tensor = trans_totensor(img)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;ToTensor&#34;</span>, img_tensor)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Normalize</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹å·®ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿™é‡Œæ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸‰ä¸ªï¼Œæ˜¯å› ä¸ºè¾“å…¥çš„ç»´åº¦3ç»´çš„ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">output[channel] = (input[channel] - mean[channel]) / std[channel]
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;å˜åŒ–å‰ï¼š&#34;</span> + <span style="color:#658b00">str</span>(img_tensor[<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>]))
</span></span><span style="display:flex;"><span>trans_norm = transforms.Normalize([<span style="color:#b452cd">6</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">2</span>], [<span style="color:#b452cd">9</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">5</span>])
</span></span><span style="display:flex;"><span>img_norm = trans_norm(img_tensor)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;å˜åŒ–åï¼š&#34;</span> + <span style="color:#658b00">str</span>(img_tensor[<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>][<span style="color:#b452cd">0</span>]))
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Normalize&#34;</span>, img_norm, <span style="color:#b452cd">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Resize</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img.size)
</span></span><span style="display:flex;"><span>trans_resize = transforms.Resize((<span style="color:#b452cd">512</span>, <span style="color:#b452cd">512</span>))
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img PIL -&gt; resize -&gt; img_resize PIL</span>
</span></span><span style="display:flex;"><span>img_resize = trans_resize(img)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img_resize PIL -&gt; img_resize tensor</span>
</span></span><span style="display:flex;"><span>img_resize = trans_totensor(img_resize)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Resize&#34;</span>, img_resize, <span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img_resize)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># Compose - resize - 2</span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">Compose()ç”¨æ³•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">ç›¸å½“äºæ˜¯å¤šä¸ªè½¬åŒ–æ“ä½œåˆå¹¶åˆ°ä¸€ä¸ªcompose()å‡½æ•°ä¸­ï¼
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">Compose()ä¸­çš„å‚æ•°éœ€è¦æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ•°æ®ç±»å‹æ˜¯transformsç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">æ‰€ä»¥å¾—åˆ°ï¼ŒCompose([transformså‚æ•°1, transformså‚æ•°2, ...])
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>trans_resize_2 = transforms.Resize(<span style="color:#b452cd">512</span>) <span style="color:#228b22"># transforms.Resize(x):å°†å›¾ç‰‡çŸ­è¾¹ç¼©æ”¾è‡³xï¼Œé•¿å®½æ¯”ä¿æŒä¸å˜</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># PIL -&gt; PIL -&gt; tensor</span>
</span></span><span style="display:flex;"><span>trans_compose = transforms.Compose([trans_resize_2, trans_totensor])
</span></span><span style="display:flex;"><span>img_resize_2 = trans_compose(img)
</span></span><span style="display:flex;"><span>writer.add_image(<span style="color:#cd5555">&#34;Compose&#34;</span>, img_resize_2, <span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># RandomCrop éšæœºè£å‰ª</span>
</span></span><span style="display:flex;"><span>trans_random = transforms.RandomCrop((<span style="color:#b452cd">300</span>, <span style="color:#b452cd">450</span>)) <span style="color:#228b22"># ä¸€ä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤ä¸ºaÃ—a,ä¸¤ä¸ªå‚æ•°åˆ™ä¸ºaÃ—b</span>
</span></span><span style="display:flex;"><span>trans_compose_2 = transforms.Compose([trans_random, trans_totensor])
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">10</span>):
</span></span><span style="display:flex;"><span>    img_crop = trans_compose_2(img)
</span></span><span style="display:flex;"><span>    writer.add_image(<span style="color:#cd5555">&#34;RandomCropHW&#34;</span>, img_crop, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨">torchvisonä¸­çš„æ•°æ®é›†ä½¿ç”¨</h4>
<p>åœ¨<code>PyTorch</code>çš„<code>torchvision</code>ä¸­è‡ªå¸¦äº†å¾ˆå¤šæ•°æ®é›†ï¼Œæˆ‘ä»¬æ€ä¹ˆä½¿ç”¨å®ƒã€‚è¿™é‡Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ï¼š<a href="https://pytorch.org/vision/stable/datasets.html">https://pytorch.org/vision/stable/datasets.html</a></p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ä¸€ä¸ª<code>CIFAR10</code>çš„æ•°æ®é›†è¿›è¡Œæ¼”ç¤ºï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset_transform = torchvision.transforms.Compose([
</span></span><span style="display:flex;"><span>    torchvision.transforms.ToTensor()
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span><span style="color:#228b22"># rootä»£è¡¨ä¿å­˜è·¯å¾„</span>
</span></span><span style="display:flex;"><span>train_set = torchvision.datasets.CIFAR10(root=<span style="color:#cd5555">&#34;./torchvision_datasets_train&#34;</span>, transform=dataset_transform, train=<span style="color:#8b008b;font-weight:bold">True</span>, download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_set = torchvision.datasets.CIFAR10(root=<span style="color:#cd5555">&#34;./torchvison_datasets_test&#34;</span>, transform=dataset_transform, train=<span style="color:#8b008b;font-weight:bold">False</span>, download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set[0])</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set.classes)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img, target = test_set[0]</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(img)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(target)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set.classes[target])</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># img.show()</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(test_set[0])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/p10&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">10</span>):
</span></span><span style="display:flex;"><span>    img, target = test_set[i]
</span></span><span style="display:flex;"><span>    writer.add_image(<span style="color:#cd5555">&#34;test_set&#34;</span>, img, i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dataloaderçš„ä½¿ç”¨">DataLoaderçš„ä½¿ç”¨</h4>
<p><code>dataset</code>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ•°æ®é›†ï¼Œè€Œ<code>dataloader</code>å¯ä»¥ç†è§£ä¸ºå°†æ•°æ®é›†ä¸­çš„æ•°æ®åŠ è½½åˆ°ç¥ç»ç½‘ç»œä¸­ã€‚<code>dataloader</code>çš„å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼š<a href="https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader">https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader</a></p>
<p>æ¥çœ‹ä¸€ä¸ªä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å‡†å¤‡çš„æµ‹è¯•æ•°æ®é›†</span>
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;./torchvision_datasets_test&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># drop_lastå¦‚æœä¸ºTrueï¼Œä»£è¡¨æœ€åä¸€æ¬¡æ•°æ®é›†çš„batchä¸æ»¡batch-sizeï¼Œä¼šè¢«èˆå»</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># num_workersä»£è¡¨å¹¶è¡Œå¤„ç†çš„æ•°é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># shuffleæŒ‡æ‰“ä¹±éšæœº</span>
</span></span><span style="display:flex;"><span>test_loader = DataLoader(dataset=test_data, batch_size=<span style="color:#b452cd">64</span>, shuffle=<span style="color:#8b008b;font-weight:bold">True</span>, num_workers=<span style="color:#b452cd">0</span>, drop_last=<span style="color:#8b008b;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æµ‹è¯•æ•°æ®é›†ä¸­ç¬¬ä¸€å¼ å›¾ç‰‡åŠtarget</span>
</span></span><span style="display:flex;"><span>img, target = test_data[<span style="color:#b452cd">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(img.shape)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(target)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;logs/dataloader&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> epoch <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">2</span>):
</span></span><span style="display:flex;"><span>    step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_loader:
</span></span><span style="display:flex;"><span>        imgs, target = data
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># print(img.shape)</span>
</span></span><span style="display:flex;"><span>        writer.add_images(<span style="color:#cd5555">&#34;Epoch:</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(epoch), imgs, step)
</span></span><span style="display:flex;"><span>        step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pytorchå†™ç¥ç»ç½‘ç»œ">PyTorchå†™ç¥ç»ç½‘ç»œ</h3>
<h4 id="ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶nnmoduleä½¿ç”¨">ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶â€”â€”nn.Moduleä½¿ç”¨</h4>
<p>é¦–å…ˆï¼Œå…ˆè´´ä¸€ä¸‹ç¥ç»ç½‘ç»œæ¨¡å‹çš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pytorch.org/docs/stable/nn.html">https://pytorch.org/docs/stable/nn.html</a></p>
<p>ä¸»è¦å†™ä¸€ä¸‹<code>Pytorch</code>ä¸­æ¨¡å‹çš„å†™æ³•ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">nn</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn.functional</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">F</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyModel</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    convä»£è¡¨å·ç§¯å±‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    reluä»£è¡¨ReLUæ¿€æ´»å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>().__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = nn.Conv2d(<span style="color:#b452cd">1</span>, <span style="color:#b452cd">20</span>, <span style="color:#b452cd">5</span>)
</span></span><span style="display:flex;"><span>        self.conv2 = nn.Conv2d(<span style="color:#b452cd">20</span>, <span style="color:#b452cd">20</span>, <span style="color:#b452cd">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = F.relu(self.conv1(x))
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> F.relu(self.conv2(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>().__init__()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = <span style="color:#658b00">input</span> + <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_md = Cai()
</span></span><span style="display:flex;"><span>x = torch.tensor(<span style="color:#b452cd">1.0</span>)
</span></span><span style="display:flex;"><span>output = test_md(x)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹">ç¥ç»ç½‘ç»œ-å·ç§¯å±‚ç¤ºä¾‹</h4>
<p>Pytorchä¸­çš„Conv2dçš„å¯¹åº”å‡½æ•°ï¼ˆTensoré€šé“æ’åˆ—é¡ºåºæ˜¯ï¼š[batch, channel, height, width]ï¼‰ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>torch.nn.Conv2d(in_channels, 
</span></span><span style="display:flex;"><span>                out_channels, 
</span></span><span style="display:flex;"><span>                kernel_size, 
</span></span><span style="display:flex;"><span>                stride=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                padding=<span style="color:#b452cd">0</span>, 
</span></span><span style="display:flex;"><span>                dilation=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                groups=<span style="color:#b452cd">1</span>, 
</span></span><span style="display:flex;"><span>                bias=<span style="color:#8b008b;font-weight:bold">True</span>, 
</span></span><span style="display:flex;"><span>                padding_mode=<span style="color:#cd5555">&#39;zeros&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ¯ä¸ªå‚æ•°ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<p>in_channelså‚æ•°ä»£è¡¨è¾“å…¥ç‰¹å¾çŸ©é˜µçš„æ·±åº¦å³channelï¼Œæ¯”å¦‚è¾“å…¥ä¸€å¼ RGBå½©è‰²å›¾åƒï¼Œé‚£in_channels = 3ï¼›</p>
<p>out_channelså‚æ•°ä»£è¡¨å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œä½¿ç”¨nä¸ªå·ç§¯æ ¸è¾“å‡ºçš„ç‰¹å¾çŸ©é˜µæ·±åº¦å³channelå°±æ˜¯nï¼›</p>
<p>kernel_sizeå‚æ•°ä»£è¡¨å·ç§¯æ ¸çš„å°ºå¯¸ï¼Œè¾“å…¥å¯ä»¥æ˜¯intç±»å‹å¦‚3 ä»£è¡¨å·ç§¯æ ¸çš„height = width = 3ï¼Œä¹Ÿå¯ä»¥æ˜¯tupleç±»å‹å¦‚(3,  5)ä»£è¡¨å·ç§¯æ ¸çš„height = 3ï¼Œwidth = 5ï¼›</p>
<p>strideå‚æ•°ä»£è¡¨å·ç§¯æ ¸çš„æ­¥è·é»˜è®¤ä¸º1ï¼Œå’Œkernel_sizeä¸€æ ·è¾“å…¥å¯ä»¥æ˜¯intç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯tupleç±»å‹ï¼Œè¿™é‡Œæ³¨æ„ï¼Œè‹¥ä¸ºtupleç±»å‹å³ç¬¬ä¸€ä¸ªintç”¨äºé«˜åº¦å°ºå¯¸ï¼Œç¬¬äºŒä¸ªintç”¨äºå®½åº¦å°ºå¯¸ï¼›</p>
<p>paddingå‚æ•°ä»£è¡¨åœ¨è¾“å…¥ç‰¹å¾çŸ©é˜µå››å‘¨è¡¥é›¶çš„æƒ…å†µé»˜è®¤ä¸º0ï¼ŒåŒæ ·è¾“å…¥å¯ä»¥ä¸ºintå‹å¦‚1 ä»£è¡¨ä¸Šä¸‹æ–¹å‘å„è¡¥ä¸€è¡Œ0å…ƒç´ ï¼Œå·¦å³æ–¹å‘å„è¡¥ä¸€åˆ—0åƒç´ ï¼ˆå³è¡¥ä¸€åœˆ0ï¼‰ï¼Œå¦‚æœè¾“å…¥ä¸ºtupleå‹å¦‚(2, 1) ä»£è¡¨åœ¨ä¸Šæ–¹è¡¥ä¸¤è¡Œä¸‹æ–¹è¡¥ä¸¤è¡Œï¼Œå·¦è¾¹è¡¥ä¸€åˆ—ï¼Œå³è¾¹è¡¥ä¸€åˆ—ã€‚å¯è§ä¸‹å›¾ï¼Œpadding[0]æ˜¯åœ¨Hé«˜åº¦æ–¹å‘ä¸¤ä¾§å¡«å……çš„ï¼Œpadding[1]æ˜¯åœ¨Wå®½åº¦æ–¹å‘ä¸¤ä¾§å¡«å……çš„ï¼›</p>
</blockquote>
<p>åœ¨Pytorchä¸­ï¼Œ**dilation = 1ç­‰åŒäºæ²¡æœ‰dilationçš„æ ‡å‡†å·ç§¯,dilation = 2ç­‰åŒäºè®¡ç®—ä¸åŒç‚¹ä¹‹é—´çš„å·®è·æ—¶ä¼šè¿›è¡Œè†¨èƒ€æ“ä½œã€‚**ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p>
<pre tabindex="0"><code>åœ¨ä¸€ä¸ªç»´åº¦ä¸Šï¼Œä¸€ä¸ªå¤§å°ä¸º3çš„è¿‡æ»¤å™¨wä¼šå¯¹è¾“å…¥çš„xè¿›è¡Œå¦‚ä¸‹è®¡ç®—ï¼šw[0] * x[0] + w[1] * x[1] + w[2] * x[2]ã€‚è‹¥dilation = 1ï¼Œè¿‡æ»¤å™¨ä¼šè®¡ç®—ï¼šw[0] * x[0] + w[1] * x[2] + w[2] * x[4]ï¼›æ¢å¥è¯è¯´ï¼Œåœ¨ä¸åŒç‚¹ä¹‹é—´æœ‰ä¸€ä¸ª1çš„å·®è·ã€‚
</code></pre><ul>
<li>å¯¹çŸ©é˜µè¿›è¡Œå·ç§¯ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch.nn.functional</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">F</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.tensor([[<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">0</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">5</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                      [<span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kernel = torch.tensor([[<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">2</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">0</span>]])
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å°†äºŒç»´çŸ©é˜µå˜ä¸ºbatch-sizeä¸º1ï¼Œé€šé“ä¸º1ï¼ŒçŸ©é˜µå¤§å°ä¸º5Ã—5</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.reshape(<span style="color:#658b00">input</span>, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>))
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å°†äºŒç»´çŸ©é˜µå˜ä¸ºbatch-sizeä¸º1ï¼Œé€šé“ä¸º1ï¼ŒçŸ©é˜µå¤§å°ä¸º3Ã—3</span>
</span></span><span style="display:flex;"><span>kernel = torch.reshape(kernel, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output2 = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output3 = F.conv2d(<span style="color:#658b00">input</span>, kernel, stride=<span style="color:#b452cd">1</span>, padding=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(input.shape)</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(kernel.shape)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯¹å…·ä½“çš„å›¾ç‰‡è¿›è¡Œå·ç§¯æ“ä½œï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = torch.nn.Conv2d(in_channels=<span style="color:#b452cd">3</span>, out_channels=<span style="color:#b452cd">6</span>, kernel_size=<span style="color:#b452cd">3</span>, stride=<span style="color:#b452cd">1</span>, padding=<span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.conv1(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># print(cai)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.size([64, 3, 32, 32])</span>
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.size([64, 6, 30, 30])</span>
</span></span><span style="display:flex;"><span>    output = torch.reshape(output, (-<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">30</span>, <span style="color:#b452cd">30</span>))
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>, output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–">å·ç§¯ç½‘ç»œ-æœ€å¤§æ± åŒ–</h4>
<p>é¦–å…ˆè§£é‡Šä¸€ä¸‹æœ€å¤§æ± åŒ–ï¼Œå°±æ˜¯å¯¹è¾“å…¥å›¾åƒåšåŒ¹é…ï¼Œå¹¶å–å‡ºåŒ¹é…ç»“æœçš„æœ€å¤§å€¼ã€‚å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†ä¿ç•™è¾“å…¥çš„ç‰¹å¾ï¼Œä½†æ˜¯åŒæ—¶å‡å°‘æ•°æ®é‡ã€‚</p>
<p><code>MaxPool2d</code>è¿™ä¸ªç±»çš„å®ç°ååˆ†ç®€å•ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŸºæœ¬å‚æ•°ï¼Œä¸€å…±å…­ä¸ªï¼š</p>
<blockquote>
<p>kernel_size ï¼šè¡¨ç¤ºåšæœ€å¤§æ± åŒ–çš„çª—å£å¤§å°ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯tupleå…ƒç»„</p>
<p>stride ï¼šæ­¥é•¿ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯tupleå…ƒç»„ï¼Œé»˜è®¤å€¼ä¸ºNoneã€‚ä¹Ÿå°±æ˜¯å¦‚æœä¸è®¾ç½®å…¶å°±ç­‰äºkernel_sizeçš„å¤§å°</p>
<p>padding ï¼šå¡«å……ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯tupleå…ƒç»„ï¼Œé»˜è®¤padding=0</p>
<p>dilation ï¼šæ§åˆ¶çª—å£ä¸­å…ƒç´ åŒ¹é…çš„æ­¥å¹…</p>
<p>return_indices ï¼šå¸ƒå°”ç±»å‹ï¼Œè¿”å›æœ€å¤§å€¼ä½ç½®ç´¢å¼•</p>
<p>ceil_mode ï¼šå¸ƒå°”ç±»å‹ï¼Œä¸ºTrueï¼Œç”¨å‘ä¸Šå–æ•´çš„æ–¹æ³•ï¼Œè®¡ç®—è¾“å‡ºå½¢çŠ¶ï¼›é»˜è®¤æ˜¯å‘ä¸‹å–æ•´ã€‚</p>
</blockquote>
<p><em>è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ceil_modeï¼Œå¦‚æœceil_mode=Trueæ—¶ï¼Œå½“è¾“å…¥å›¾åƒè¢«åŒ¹é…çš„å½¢çŠ¶ä¸è¶³æ—¶ï¼Œæˆ‘ä»¬å¯¹è¿™ç»„æ•°æ®çš„æ± åŒ–ç»“æœæ˜¯ä¿ç•™çš„ï¼›diationå’Œå·ç§¯ä¸­çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œé»˜è®¤éƒ½æ˜¯ä¸è†¨èƒ€ã€‚</em></p>
<ul>
<li>å†™ä¸€ä¸ªå…³äºæœ€å¤§æ± åŒ–çš„ä¾‹å­ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1ã€ ./æ˜¯å½“å‰ç›®å½• 2ã€ ../æ˜¯çˆ¶çº§ç›®å½• 3ã€ /æ˜¯æ ¹ç›®å½• æ ¹ç›®å½•æ˜¯æŒ‡é€»è¾‘é©±åŠ¨å™¨çš„æœ€ä¸Šä¸€å±‚ç›®å½•</span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.maxpool1 = torch.nn.MaxPool2d(kernel_size=<span style="color:#b452cd">3</span>, ceil_mode=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = self.maxpool1(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_maxpool&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>, output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»">ç¥ç»ç½‘ç»œ-éçº¿æ€§æ¿€æ´»</h4>
<p>å…¶å®å°±æ˜¯å¦‚ä½•ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.tensor([[<span style="color:#b452cd">1</span>, -<span style="color:#b452cd">0.5</span>],
</span></span><span style="display:flex;"><span>                      [-<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># inplace = Trueä»£è¡¨åŸåœ°æ“ä½œï¼Œå€¼è¿›è¡Œè¦†ç›– inplace = Falseä»£è¡¨æ¿€æ´»ç»“æœä¼ ç»™å¦ä¸€ä¸ªå˜é‡(é»˜è®¤)</span>
</span></span><span style="display:flex;"><span>        self.relu1 = torch.nn.ReLU(inplace=<span style="color:#8b008b;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>        self.sigmoid1 = torch.nn.Sigmoid()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, <span style="color:#658b00">input</span>):
</span></span><span style="display:flex;"><span>        output = self.sigmoid1(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_relu&#34;</span>)
</span></span><span style="display:flex;"><span>step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;input&#34;</span>, imgs, step)
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    writer.add_images(<span style="color:#cd5555">&#34;output&#34;</span>,output, step)
</span></span><span style="display:flex;"><span>    step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º">Sequentialä½¿ç”¨ä»¥åŠç¥ç»ç½‘ç»œå®æˆ˜æ­å»º</h4>
<p><code>Sequential</code>å…¶å®æ˜¯å°†ç¥ç»ç½‘ç»œçš„æ¨¡å‹æ”¾åœ¨ä¸€ä¸ªåºåˆ—é‡Œé¢ï¼Œç®€æ´æ˜“æ‡‚ã€‚</p>
<p>å®æˆ˜çš„è¯å°±æ˜¯é’ˆå¯¹æˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ•°æ®é›†<code>CIFAR10</code>æ¥å†™ä¸€ä¸ªç®€æ´ä¸€ç‚¹çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p>
<p>ä½¿ç”¨çš„ç½‘ç»œæ¨¡å‹ç»“æ„<code>CIFAR-quick model</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img45.jpg" alt=""></p>
<p>å»ºç«‹æ¨¡å‹çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(cai)
</span></span><span style="display:flex;"><span><span style="color:#658b00">input</span> = torch.ones((<span style="color:#b452cd">64</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>output = cai(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output.shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç”Ÿæˆè®¡ç®—å›¾</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_seq&#34;</span>)
</span></span><span style="display:flex;"><span>writer.add_graph(cai, <span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°åå‘ä¼ æ’­">ç¥ç»ç½‘ç»œ-æŸå¤±å‡½æ•°&amp;åå‘ä¼ æ’­</h4>
<p>ç¥ç»ç½‘ç»œå°±æ˜¯ä¸€ä¸ªä¸æ–­è¿­ä»£çš„è¿‡ç¨‹ï¼ŒæŸå¤±å‡½æ•°å°±æ˜¯å®ƒçš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œè¿­ä»£çš„è¿‡ç¨‹å°±æ˜¯è®©è¿™ä¸ªæŒ‡æ ‡è¶Šæ¥è¶Šå°ã€‚</p>
<ul>
<li>L1loss,MSEloss,äº¤å‰ç†µä¸¾ä¾‹ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inputs = torch.tensor([<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">3</span>], dtype=torch.float32)
</span></span><span style="display:flex;"><span>targets = torch.tensor([<span style="color:#b452cd">1</span>, <span style="color:#b452cd">2</span>, <span style="color:#b452cd">5</span>], dtype=torch.float32)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inputs = torch.reshape(inputs, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>targets = torch.reshape(targets, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = torch.nn.L1Loss(reduction=<span style="color:#cd5555">&#34;sum&#34;</span>)
</span></span><span style="display:flex;"><span>result = loss(inputs, targets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss_mse = nn.MSELoss()
</span></span><span style="display:flex;"><span>result_mse = loss_mse(inputs, targets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å½“ä½ åº”ç”¨ä¸€ä¸ªåˆ†ç±»é—®é¢˜çš„æ—¶å€™ï¼Œåˆ†æˆcç±»ï¼Œä½¿ç”¨äº¤å‰ç†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># -0.2 + ln(exp(0.1) + exp(0.2) + exp(0.3))</span>
</span></span><span style="display:flex;"><span>x = torch.tensor([<span style="color:#b452cd">0.1</span>, <span style="color:#b452cd">0.2</span>, <span style="color:#b452cd">0.3</span>])
</span></span><span style="display:flex;"><span>y = torch.tensor([<span style="color:#b452cd">1</span>])
</span></span><span style="display:flex;"><span>x = torch.reshape(x, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>))
</span></span><span style="display:flex;"><span>loss_cross = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>result_cross = loss_cross(x, y)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result_cross)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(result_mse)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¥ç»ç½‘ç»œä¸­æŸå¤±å‡½æ•°çš„åå‘ä¼ æ’­</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>    imgs, targets = data
</span></span><span style="display:flex;"><span>    output = cai(imgs)
</span></span><span style="display:flex;"><span>    result_loss = loss(output, targets)
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># åå‘ä¼ æ’­</span>
</span></span><span style="display:flex;"><span>    result_loss.backward()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¼˜åŒ–å™¨">ä¼˜åŒ–å™¨</h4>
<p>ä½¿ç”¨ä¼˜åŒ–å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜åŒ–ç®—æ³•è®¾ç½®å­¦ä¹ é€Ÿç‡ï¼Œè‡ªåŠ¨è®¡ç®—åå‘ä¼ æ’­ï¼Œæ›´æ–°å‚æ•°ç­‰ã€‚ä½¿ç”¨ä¹‹å‰çš„<code>CIFAR10 quick_model</code>æ¥è®¡ç®—æ¢¯åº¦ç­‰,è¿›è¡Œè¿­ä»£ã€‚</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(), download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>dataloader = DataLoader(dataset, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module1 = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, <span style="color:#b452cd">5</span>, padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Flatten(),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">1024</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            torch.nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module1(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loss = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># éšæœºæ¢¯åº¦ä¸‹é™</span>
</span></span><span style="display:flex;"><span>optim = torch.optim.SGD(cai.parameters(), lr=<span style="color:#b452cd">0.01</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> epoch <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(<span style="color:#b452cd">20</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># æ¯ä¸€è½®å­¦ä¹ ä¸­æ‰€æœ‰æ•°æ®çš„loss</span>
</span></span><span style="display:flex;"><span>    running_loss = <span style="color:#b452cd">0.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        output = cai(imgs)
</span></span><span style="display:flex;"><span>        result_loss = loss(output, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># å‚æ•°æ¢¯åº¦é‡ç½®ä¸º0</span>
</span></span><span style="display:flex;"><span>        optim.zero_grad()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># åå‘ä¼ æ’­(è®¡ç®—æ¢¯åº¦)</span>
</span></span><span style="display:flex;"><span>        result_loss.backward()
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æ›´æ–°å‚æ•°</span>
</span></span><span style="display:flex;"><span>        optim.step()
</span></span><span style="display:flex;"><span>        running_loss += result_loss
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(running_loss)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pytorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨">PyTorchç½‘ç»œæ¨¡å‹ä¿®æ”¹å’Œä½¿ç”¨</h3>
<h4 id="pytorchç½‘ç»œæ¨¡å‹">PyTorchç½‘ç»œæ¨¡å‹</h4>
<p>åœ¨PyTorchä¸­å·²ç»é›†æˆäº†è®¸å¤šç»å…¸çš„ç½‘ç»œæ¨¡å‹ï¼Œåœ¨<code>torchvision</code>ä¸­æœ‰åˆ†ç±»æ¨¡å‹ï¼Œè¯­ä¹‰åˆ†å‰²æ¨¡å‹ï¼Œç›®æ ‡æ£€æµ‹çš„æ¨¡å‹ã€‚è¿™æ¬¡æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨<code>CIFAR10</code>åšä¸€ä¸ªåˆ†ç±»æ¨¡å‹ï¼Œåˆ†ç±»æ¨¡å‹ä½¿ç”¨çš„æ˜¯<code>VGGæ¨¡å‹</code>ä¸­çš„<code>vgg16</code>ã€‚</p>
<blockquote>
<p><code>torchvision.models.vgg16</code>(***, <em>weights: Optional[torchvision.models.vgg.VGG16_Weights] = None</em>, <em>progress: bool = True</em>, **kwargs: Any)</p>
</blockquote>
<p>å‚æ•°ï¼š</p>
<ul>
<li>weightï¼šé»˜è®¤ä¸ºNoneå€¼ï¼Œä»£è¡¨æ²¡æœ‰é¢„è®­ç»ƒï¼ˆè¯¥ç½‘ç»œåœ¨å…¶ä»–å…¬å¼€æ•°æ®é›†ä¸Šè¿è¡Œä¸€éƒ¨åˆ†çš„ç»“æœï¼‰çš„æƒé‡ã€‚</li>
<li>progressï¼šè®­ç»ƒçš„è¿‡ç¨‹ä¸­æ˜¯å¦æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œé»˜è®¤ä¸ºTrue</li>
<li>**kwargsï¼šä¼ é€’ç»™VGGåŸºç±»çš„å‚æ•°</li>
</ul>
<p>ä½¿ç”¨vgg16ç½‘ç»œå¯¹CIFAR10æ•°æ®é›†è®­ç»ƒï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">æœ¬æ¥æƒ³ä½¿ç”¨ImageNetæ•°æ®é›†é¢„è®­ç»ƒVGG.vgg16ç½‘ç»œæ¨¡å‹ï¼Œä½†ç”±äºæ•°æ®é›†å¤ªå¤§æ”¾å¼ƒäº†
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">ç„¶åè®­ç»ƒCIFAR10æ•°æ®é›†
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç›®å‰èƒ½é€šè¿‡æ­¤æ–¹æ³•ä¸‹è½½ï¼Œå¿…é¡»å¤–éƒ¨ä¸‹è½½ï¼Œæ”¾åˆ°æ ¹ç›®å½•ä¸‹æ‰è¡Œï¼Œè€Œä¸”ImageNetæœ‰100å¤šä¸ªGçš„è®­ç»ƒé›†ï¼Œå±å®æœ‰ç‚¹å¤§ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># train_data = torchvision.datasets.ImageNet(&#34;../data_image_net&#34;, split=&#34;train&#34;, download=True,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># transform=torchvision.transforms.ToTensor())</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vgg16_false = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>vgg16_true = torchvision.models.vgg16(weights=torchvision.models.VGG16_Weights)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">ç”±äºVGG.vgg16æ˜¯å¯¹1000ä¸ªç±»è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç½‘ç»œæ¨¡å‹åˆ†æˆ10ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">å¯ä»¥ä½¿ç”¨æ·»åŠ ä¸€ä¸ªçº¿æ€§å±‚ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä¿®æ”¹æœ€åçš„çº¿æ€§å±‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ¨¡å‹å¢åŠ å±‚</span>
</span></span><span style="display:flex;"><span>vgg16_true.classifier.add_module(<span style="color:#cd5555">&#34;add_linear&#34;</span>, nn.Linear(<span style="color:#b452cd">1000</span>, <span style="color:#b452cd">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16_true)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ¨¡å‹ä¿®æ”¹å±‚</span>
</span></span><span style="display:flex;"><span>vgg16_false.classifier[<span style="color:#b452cd">6</span>] = nn.Linear(<span style="color:#b452cd">4096</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16_false)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½">æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½</h4>
<p>model_save.py:</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vgg16 = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä¿å­˜æ–¹å¼1 (ç½‘ç»œæ¨¡å‹ç»“æ„+å‚æ•°)</span>
</span></span><span style="display:flex;"><span>torch.save(vgg16, <span style="color:#cd5555">&#34;vgg16_method1.pth&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä¿å­˜æ–¹å¼2ï¼ˆåªä¿å­˜ç½‘ç»œæ¨¡å‹çš„å‚æ•°ï¼Œå­—å…¸çš„æ ¼å¼)</span>
</span></span><span style="display:flex;"><span>torch.save(vgg16.state_dict(), <span style="color:#cd5555">&#34;vgg16_method2.pth&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä¿å­˜è‡ªå·±çš„æ¨¡å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.conv1 = nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">64</span>, kernel_size=<span style="color:#b452cd">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.conv1(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>torch.save(cai.state_dict(), <span style="color:#cd5555">&#34;my_model.pth&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>model_load.py:</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model_save</span> <span style="color:#8b008b;font-weight:bold">import</span> Cai
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åŠ è½½æ–¹å¼1-&gt;å¯¹åº”ä¿å­˜æ–¹å¼1</span>
</span></span><span style="display:flex;"><span>model1 = torch.load(<span style="color:#cd5555">&#34;vgg16_method1.pth&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(model1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åŠ è½½æ–¹å¼2-&gt;å¯¹åº”ä¿å­˜æ–¹å¼2</span>
</span></span><span style="display:flex;"><span>vgg16 = torchvision.models.vgg16(weights=<span style="color:#8b008b;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>vgg16.load_state_dict(torch.load(<span style="color:#cd5555">&#34;vgg16_method2.pth&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(vgg16)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åŠ è½½è‡ªå·±çš„æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>my_model = Cai()
</span></span><span style="display:flex;"><span>my_model.load_state_dict(torch.load(<span style="color:#cd5555">&#34;my_model.pth&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(my_model)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ">å®Œæ•´çš„æ¨¡å‹è®­ç»ƒ</h3>
<h4 id="å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯cifar10æ•°æ®é›†ä¸ºä¾‹">å®Œæ•´çš„æ¨¡å‹è®­ç»ƒå¥—è·¯ï¼ˆCIFAR10æ•°æ®é›†ä¸ºä¾‹ï¼‰</h4>
<ul>
<li>é¦–å…ˆï¼Œå…ˆè¯´ä¸€ä¸‹åˆ†ç±»é—®é¢˜ç‰¹æœ‰çš„æ­£ç¡®ç‡æ£€éªŒï¼Œçœ‹ä¸€ä¸ªä¾‹å­å°±æ˜ç™½äº†ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outputs = torch.tensor([[<span style="color:#b452cd">0.1</span>, <span style="color:#b452cd">0.2</span>],
</span></span><span style="display:flex;"><span>                       [<span style="color:#b452cd">0.3</span>, <span style="color:#b452cd">0.4</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(outputs.argmax(<span style="color:#b452cd">1</span>)) <span style="color:#228b22"># æ¨ªå‘æ¯”è¾ƒï¼Œæ‰¾åˆ°è¾ƒå¤§çš„é‚£ä¸ªæ•°çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(outputs.argmax(<span style="color:#b452cd">0</span>)) <span style="color:#228b22"># ç«–å‘æ¯”è¾ƒï¼Œæ‰¾åˆ°è¾ƒå¤§çš„é‚£ä¸ªæ•°çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>preds = outputs.argmax(<span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>targets = torch.tensor([<span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>])
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>((preds == targets).sum())
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®Œæ•´çš„CIFAR10è®­ç»ƒå’Œæµ‹è¯•ï¼Œåˆ©ç”¨ä¹‹å‰å†™è¿‡çš„<code>CIFAR10 quick_model</code>ï¼Œè®­ç»ƒ10è½®ï¼š</p>
<ul>
<li>model.py:</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ­å»ºç¥ç»ç½‘ç»œæ¨¡å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Flatten(),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>*<span style="color:#b452cd">4</span>*<span style="color:#b452cd">4</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">if</span> __name__ == <span style="color:#cd5555">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    mainå‡½æ•°ç”¨äºæµ‹è¯•æ¨¡å‹
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    cai = Cai()
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># 64å¼ 3é€šé“32Ã—32çš„å›¾ç‰‡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">input</span> = torch.ones((<span style="color:#b452cd">64</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>    output = cai(<span style="color:#658b00">input</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(output.shape)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>train.py:</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model</span> <span style="color:#8b008b;font-weight:bold">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å‡†å¤‡æ•°æ®é›†</span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ•°æ®é›†é•¿åº¦</span>
</span></span><span style="display:flex;"><span>train_data_size = <span style="color:#658b00">len</span>(train_data)
</span></span><span style="display:flex;"><span>test_data_size = <span style="color:#658b00">len</span>(test_data)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;è®­ç»ƒæ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(train_data_size))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æµ‹è¯•æ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(test_data_size))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åˆ©ç”¨ DataLoader åŠ è½½æ•°æ®é›†</span>
</span></span><span style="display:flex;"><span>train_dataloader = DataLoader(train_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>test_dataloader = DataLoader(test_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åˆ›å»ºç½‘ç»œæ¨¡å‹</span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æŸå¤±å‡½æ•°</span>
</span></span><span style="display:flex;"><span>loss_fn = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä¼˜åŒ–å™¨ SGDï¼šéšæœºæ¢¯åº¦ä¸‹é™</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># learning_rate = 0.01</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1e-2 = 1Ã—(10)^(-2) = 0.01</span>
</span></span><span style="display:flex;"><span>learning_rate = <span style="color:#b452cd">1e-2</span>
</span></span><span style="display:flex;"><span>optimizer = torch.optim.SGD(cai.parameters(), lr=learning_rate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®¾ç½®è®­ç»ƒç½‘ç»œçš„ä¸€äº›å‚æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®°å½•è®­ç»ƒå’Œæµ‹è¯•çš„æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>total_train_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>total_test_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®­ç»ƒçš„è½®æ•°</span>
</span></span><span style="display:flex;"><span>epoch = <span style="color:#b452cd">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ·»åŠ tensorboard</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_train&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ¨¡å‹è®­ç»ƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(epoch):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;-------------ç¬¬</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">è½®è®­ç»ƒå¼€å§‹--------------&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># è®­ç»ƒæ­¥éª¤å¼€å§‹</span>
</span></span><span style="display:flex;"><span>    cai.train()  <span style="color:#228b22"># è¿™å¥è¯æ˜¯ä¸ºäº†åœ¨ç½‘ç»œä¸­å¦‚æœæœ‰drop_outæˆ–è€…batch_normalç­‰å±‚æ—¶æ‰ä¼šèµ·ä½œç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> train_dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        outputs = cai(imgs)
</span></span><span style="display:flex;"><span>        loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># ä¼˜åŒ–å™¨ä¼˜åŒ–æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        optimizer.zero_grad()
</span></span><span style="display:flex;"><span>        loss.backward()
</span></span><span style="display:flex;"><span>        optimizer.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_train_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> total_train_step % <span style="color:#b452cd">100</span> == <span style="color:#b452cd">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#228b22"># ä½¿ç”¨.item()å–å‡ºtensoræ•°æ®ç±»å‹çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;è®­ç»ƒæ¬¡æ•°ï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">ï¼ŒLossï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_train_step, loss.item()))
</span></span><span style="display:flex;"><span>            writer.add_scalar(<span style="color:#cd5555">&#34;train_loss&#34;</span>, loss.item(), total_train_step)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># æµ‹è¯•æ­¥éª¤å¼€å§‹</span>
</span></span><span style="display:flex;"><span>    cai.eval() <span style="color:#228b22"># è¿™å¥è¯æ˜¯ä¸ºäº†åœ¨ç½‘ç»œä¸­å¦‚æœæœ‰drop_outæˆ–è€…batch_normalç­‰å±‚æ—¶æ‰ä¼šèµ·ä½œç”¨</span>
</span></span><span style="display:flex;"><span>    total_test_loss = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    total_accuracy = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_dataloader:
</span></span><span style="display:flex;"><span>            imgs, targets = data
</span></span><span style="display:flex;"><span>            outputs = cai(imgs)
</span></span><span style="display:flex;"><span>            loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>            total_test_loss = total_test_loss + loss.item()
</span></span><span style="display:flex;"><span>            accuracy = (outputs.argmax(<span style="color:#b452cd">1</span>) == targets).sum()
</span></span><span style="display:flex;"><span>            total_accuracy += accuracy
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ•´ä½“æµ‹è¯•é›†ä¸Šçš„Lossï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_test_loss))
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ•´ä½“æµ‹è¯•é›†ä¸Šçš„æ­£ç¡®ç‡ï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_accuracy/test_data_size))
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_loss&#34;</span>, total_test_loss, total_test_step)
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_accuracy&#34;</span>, total_accuracy/test_data_size, total_test_step)
</span></span><span style="display:flex;"><span>    total_test_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># ä¿å­˜æ¯ä¸€è½®æ¨¡å‹å‚æ•°çš„ç»“æœ</span>
</span></span><span style="display:flex;"><span>    torch.save(cai, <span style="color:#cd5555">&#34;cai_</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">.pth&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai.static_dict(), &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ¨¡å‹å·²ä¿å­˜&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®­ç»ƒçš„tensorboardç»“æœï¼ˆ10è½®ï¼‰å¦‚ä¸‹ï¼Œè®­ç»ƒé›†50000å¼ ï¼Œæµ‹è¯•é›†10000å¼ ï¼š</p>
<ul>
<li>
<p>è¿è¡Œæ—¶é—´ï¼šæˆ‘ç”¨M1 proçš„CPUè·‘å®Œ10è½®èŠ±äº†å°†è¿‘10åˆ†é’Ÿã€‚</p>
</li>
<li>
<p>è®­ç»ƒæŸå¤±ï¼š</p>
</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img46.jpg" alt=""></p>
<ul>
<li>æµ‹è¯•æŸå¤±ï¼š</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img47.jpg" alt=""></p>
<ul>
<li>æµ‹è¯•å‡†ç¡®ç‡ï¼š</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img48.jpg" alt=""></p>
<h4 id="åˆ©ç”¨gpuè¿›è¡Œè®­ç»ƒ">åˆ©ç”¨GPUè¿›è¡Œè®­ç»ƒ</h4>
<p>ä¸»è¦çš„æ€æƒ³å°±æ˜¯å°†ç”¨åˆ°çš„æ¨¡å‹ï¼ŒæŸå¤±å‡½æ•°ï¼Œæ•°æ®éƒ½æ”¾åˆ°gpuä¸Šï¼</p>
<ul>
<li>Windowsç«¯ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>  	model = model.cuda()
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®­ç»ƒç»“æœï¼ˆ10è½®ï¼‰å¦‚ä¸‹ï¼Œè®­ç»ƒé›†50000å¼ ï¼Œæµ‹è¯•é›†10000å¼ ï¼š</p>
<p>è¿è¡Œæ—¶é—´ï¼šæ¡Œé¢ç«¯<code>RTX 2060</code>æ—¶é—´ä¸º76s</p>
<ul>
<li>macç«¯ï¼š</li>
</ul>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¿”å›å¾—åˆ°é»˜è®¤çš„device</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_default_device</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cuda&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">elif</span> <span style="color:#658b00">getattr</span>(torch.backends, <span style="color:#cd5555">&#39;mps&#39;</span>, <span style="color:#8b008b;font-weight:bold">None</span>) <span style="color:#8b008b">is</span> <span style="color:#8b008b">not</span> <span style="color:#8b008b;font-weight:bold">None</span> <span style="color:#8b008b">and</span> torch.backends.mps.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;mps&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cpu&#39;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>device = get_default_device()
</span></span><span style="display:flex;"><span>model = Net()
</span></span><span style="display:flex;"><span>model.to(device)
</span></span><span style="display:flex;"><span>pred = model(X)
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘çš„<code>MBP</code>ä¸Šçš„ä»£ç éœ€è¦æ”¹æˆï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.datasets</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch</span> <span style="color:#8b008b;font-weight:bold">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.data</span> <span style="color:#8b008b;font-weight:bold">import</span> DataLoader
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">torch.utils.tensorboard</span> <span style="color:#8b008b;font-weight:bold">import</span> SummaryWriter
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># é€‰æ‹©è®¾å¤‡çš„å‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_default_device</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cuda&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">elif</span> <span style="color:#658b00">getattr</span>(torch.backends, <span style="color:#cd5555">&#39;mps&#39;</span>, <span style="color:#8b008b;font-weight:bold">None</span>) <span style="color:#8b008b">is</span> <span style="color:#8b008b">not</span> <span style="color:#8b008b;font-weight:bold">None</span> <span style="color:#8b008b">and</span> torch.backends.mps.is_available():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;mps&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#39;cpu&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å®šä¹‰è®­ç»ƒçš„è®¾å¤‡</span>
</span></span><span style="display:flex;"><span>device = get_default_device()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å‡†å¤‡æ•°æ®é›†</span>
</span></span><span style="display:flex;"><span>train_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">True</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>test_data = torchvision.datasets.CIFAR10(<span style="color:#cd5555">&#34;../data&#34;</span>, train=<span style="color:#8b008b;font-weight:bold">False</span>, transform=torchvision.transforms.ToTensor(),
</span></span><span style="display:flex;"><span>                                          download=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ•°æ®é›†é•¿åº¦</span>
</span></span><span style="display:flex;"><span>train_data_size = <span style="color:#658b00">len</span>(train_data)
</span></span><span style="display:flex;"><span>test_data_size = <span style="color:#658b00">len</span>(test_data)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;è®­ç»ƒæ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(train_data_size))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æµ‹è¯•æ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(test_data_size))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åˆ©ç”¨ DataLoader åŠ è½½æ•°æ®é›†</span>
</span></span><span style="display:flex;"><span>train_dataloader = DataLoader(train_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>test_dataloader = DataLoader(test_data, batch_size=<span style="color:#b452cd">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ­å»ºç¥ç»ç½‘ç»œæ¨¡å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Cai</span>(torch.nn.Module):
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">super</span>(Cai, self).__init__()
</span></span><span style="display:flex;"><span>        self.module = torch.nn.Sequential(
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Conv2d(<span style="color:#b452cd">32</span>, <span style="color:#b452cd">64</span>, (<span style="color:#b452cd">5</span>, <span style="color:#b452cd">5</span>), padding=<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.MaxPool2d(<span style="color:#b452cd">2</span>),
</span></span><span style="display:flex;"><span>            nn.Flatten(),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>*<span style="color:#b452cd">4</span>*<span style="color:#b452cd">4</span>, <span style="color:#b452cd">64</span>),
</span></span><span style="display:flex;"><span>            nn.Linear(<span style="color:#b452cd">64</span>, <span style="color:#b452cd">10</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        x = self.module(x)
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åˆ›å»ºç½‘ç»œæ¨¡å‹</span>
</span></span><span style="display:flex;"><span>cai = Cai()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç½‘ç»œæ¨¡å‹è½¬ç§»åˆ°è‹¹æœèŠ¯ç‰‡çš„gpu</span>
</span></span><span style="display:flex;"><span>cai.to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æŸå¤±å‡½æ•°</span>
</span></span><span style="display:flex;"><span>loss_fn = nn.CrossEntropyLoss()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æŸå¤±å‡½æ•°è½¬ç§»åˆ°è‹¹æœèŠ¯ç‰‡çš„gpu</span>
</span></span><span style="display:flex;"><span>loss_fn.to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä¼˜åŒ–å™¨ SGDï¼šéšæœºæ¢¯åº¦ä¸‹é™</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># learning_rate = 0.01</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 1e-2 = 1Ã—(10)^(-2) = 0.01</span>
</span></span><span style="display:flex;"><span>learning_rate = <span style="color:#b452cd">1e-2</span>
</span></span><span style="display:flex;"><span>optimizer = torch.optim.SGD(cai.parameters(), lr=learning_rate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®¾ç½®è®­ç»ƒç½‘ç»œçš„ä¸€äº›å‚æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®°å½•è®­ç»ƒå’Œæµ‹è¯•çš„æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>total_train_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>total_test_step = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è®­ç»ƒçš„è½®æ•°</span>
</span></span><span style="display:flex;"><span>epoch = <span style="color:#b452cd">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ·»åŠ tensorboard</span>
</span></span><span style="display:flex;"><span>writer = SummaryWriter(<span style="color:#cd5555">&#34;../logs_train&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_time = time.time()
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ¨¡å‹è®­ç»ƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> i <span style="color:#8b008b">in</span> <span style="color:#658b00">range</span>(epoch):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;-------------ç¬¬</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">è½®è®­ç»ƒå¼€å§‹--------------&#34;</span>.format(i + <span style="color:#b452cd">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># è®­ç»ƒæ­¥éª¤å¼€å§‹</span>
</span></span><span style="display:flex;"><span>    cai.train()  <span style="color:#228b22"># è¿™å¥è¯æ˜¯ä¸ºäº†åœ¨ç½‘ç»œä¸­å¦‚æœæœ‰drop_outæˆ–è€…batch_normalç­‰å±‚æ—¶æ‰ä¼šèµ·ä½œç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> train_dataloader:
</span></span><span style="display:flex;"><span>        imgs, targets = data
</span></span><span style="display:flex;"><span>        imgs = imgs.to(device)
</span></span><span style="display:flex;"><span>        targets = targets.to(device)
</span></span><span style="display:flex;"><span>        outputs = cai(imgs)
</span></span><span style="display:flex;"><span>        loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># ä¼˜åŒ–å™¨ä¼˜åŒ–æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        optimizer.zero_grad()
</span></span><span style="display:flex;"><span>        loss.backward()
</span></span><span style="display:flex;"><span>        optimizer.step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_train_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> total_train_step % <span style="color:#b452cd">100</span> == <span style="color:#b452cd">0</span>:
</span></span><span style="display:flex;"><span>            end_time = time.time()
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(end_time - start_time)
</span></span><span style="display:flex;"><span>            <span style="color:#228b22"># ä½¿ç”¨.item()å–å‡ºtensoræ•°æ®ç±»å‹çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;è®­ç»ƒæ¬¡æ•°ï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">ï¼ŒLossï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_train_step, loss.item()))
</span></span><span style="display:flex;"><span>            writer.add_scalar(<span style="color:#cd5555">&#34;train_loss&#34;</span>, loss.item(), total_train_step)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># æµ‹è¯•æ­¥éª¤å¼€å§‹</span>
</span></span><span style="display:flex;"><span>    cai.eval() <span style="color:#228b22"># è¿™å¥è¯æ˜¯ä¸ºäº†åœ¨ç½‘ç»œä¸­å¦‚æœæœ‰drop_outæˆ–è€…batch_normalç­‰å±‚æ—¶æ‰ä¼šèµ·ä½œç”¨</span>
</span></span><span style="display:flex;"><span>    total_test_loss = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    total_accuracy = <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> data <span style="color:#8b008b">in</span> test_dataloader:
</span></span><span style="display:flex;"><span>            imgs, targets = data
</span></span><span style="display:flex;"><span>            imgs = imgs.to(device)
</span></span><span style="display:flex;"><span>            targets = targets.to(device)
</span></span><span style="display:flex;"><span>            outputs = cai(imgs)
</span></span><span style="display:flex;"><span>            loss = loss_fn(outputs, targets)
</span></span><span style="display:flex;"><span>            total_test_loss = total_test_loss + loss.item()
</span></span><span style="display:flex;"><span>            accuracy = (outputs.argmax(<span style="color:#b452cd">1</span>) == targets).sum()
</span></span><span style="display:flex;"><span>            total_accuracy += accuracy
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ•´ä½“æµ‹è¯•é›†ä¸Šçš„Lossï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_test_loss))
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ•´ä½“æµ‹è¯•é›†ä¸Šçš„æ­£ç¡®ç‡ï¼š</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(total_accuracy.item()/test_data_size))
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_loss&#34;</span>, total_test_loss, total_test_step)
</span></span><span style="display:flex;"><span>    writer.add_scalar(<span style="color:#cd5555">&#34;test_accuracy&#34;</span>, total_accuracy.item()/test_data_size, total_test_step)
</span></span><span style="display:flex;"><span>    total_test_step += <span style="color:#b452cd">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># ä¿å­˜æ¯ä¸€è½®æ¨¡å‹å‚æ•°çš„ç»“æœ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai, &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># torch.save(cai.static_dict(), &#34;cai_{}.pth&#34;.format(i + 1))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;æ¨¡å‹å·²ä¿å­˜&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>writer.close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®­ç»ƒç»“æœï¼ˆ10è½®ï¼‰å¦‚ä¸‹ï¼Œè®­ç»ƒé›†50000å¼ ï¼Œæµ‹è¯•é›†10000å¼ ï¼š</p>
<p>è¿è¡Œæ—¶é—´ï¼šæˆ‘çš„M1 proçš„GPUä¸Šè¿è¡Œæ—¶é—´ä¸º54s</p>
<p>æ­£ç¡®ç‡ï¼šå°†epochåŠ åˆ°50è½®ï¼Œæœ€é«˜æ­£ç¡®ç‡ä¸º0.65</p>
<ul>
<li>è®­ç»ƒæŸå¤±ï¼š</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img49.jpg" alt=""></p>
<ul>
<li>æµ‹è¯•å‡†ç¡®ç‡ï¼š</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img50.jpg" alt=""></p>
<ul>
<li>æµ‹è¯•æŸå¤±ï¼š</li>
</ul>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/deep-learning%26computer-vision/img51.jpg" alt=""></p>
<h4 id="å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯">å®Œæ•´çš„æ¨¡å‹éªŒè¯å¥—è·¯</h4>
<p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€å¼ ç‹—çš„å›¾ç‰‡ï¼Œæ”¾åœ¨<code>test_imgs</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå†™ä¸€ä¸‹éªŒè¯å¥—è·¯ä»£ç ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torchvision.transforms</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">PIL</span> <span style="color:#8b008b;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">model</span> <span style="color:#8b008b;font-weight:bold">import</span> Cai
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_path = <span style="color:#cd5555">&#34;../test_imgs/dog.png&#34;</span>
</span></span><span style="display:flex;"><span>image = Image.open(image_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">pngæ ¼å¼çš„å›¾ç‰‡æ˜¯4ä¸ªé€šé“ï¼Œåœ¨RGBé€šé“å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé€æ˜åº¦çš„é€šé“ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">æ‰€ä»¥è¦å°†4é€šé“è½¬åŒ–ä¸º3é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>image = image.convert(<span style="color:#cd5555">&#39;RGB&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(image)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transform = torchvision.transforms.Compose([torchvision.transforms.Resize((<span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>)),
</span></span><span style="display:flex;"><span>                                            torchvision.transforms.ToTensor()])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image = transform(image)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(image.shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># åŠ è½½ç½‘ç»œæ¨¡å‹ï¼Œæ¨¡å‹åœ¨&#39;mps&#39;ç¯å¢ƒä¸‹è¿è¡Œï¼Œå¦‚æœç”¨cpuéªŒè¯ï¼Œåˆ™éœ€è¦æŒ‡å®šdevice=â€™cpuâ€˜</span>
</span></span><span style="display:flex;"><span>model = torch.load(<span style="color:#cd5555">&#34;cai_25.pth&#34;</span>, map_location=torch.device(<span style="color:#cd5555">&#39;cpu&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(model)
</span></span><span style="display:flex;"><span>image = torch.reshape(image, (<span style="color:#b452cd">1</span>, <span style="color:#b452cd">3</span>, <span style="color:#b452cd">32</span>, <span style="color:#b452cd">32</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.eval()
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">with</span> torch.no_grad():
</span></span><span style="display:flex;"><span>    output = model(image)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(output.argmax(<span style="color:#b452cd">1</span>).item())
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ç»“æœä¸º5,ä¸ºdogï¼Œæ­£ç¡®é¢„æµ‹</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
                    
                    <HR width="100%" id="EOF">
		            <p style="color:#777;">æœ€åä¿®æ”¹äº 2022-07-29</p>
                    
                    
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://image-1252109614.cos.ap-beijing.myqcloud.com/img/20210508215939.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-11%E8%8A%82/">
			ä¸‹å›<br>æ·±åº¦å­¦ä¹ ç¬”è®°ï¼ˆ10-11èŠ‚ï¼‰ 
                </a>
                
                
                
                <a class="older-posts" href="https://caixiongjiang.github.io/blog/2022/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-9%E8%8A%82/">
			ä¸Šå›<br>æ·±åº¦å­¦ä¹ ç¬”è®°ï¼ˆ8-9èŠ‚ï¼‰ 
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="tcomment"></div>



            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
é­”æ”¹è‡ª <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2023 ğŸŒ€Jarson Cai&#39;s Blog
	</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            },
            debounce(func, wait, options) {
                let lastArgs,
                    lastThis,
                    maxWait,
                    result,
                    timerId,
                    lastCallTime

                let lastInvokeTime = 0
                let leading = false
                let maxing = false
                let trailing = true

                
                const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function')

                if (typeof func !== 'function') {
                    throw new TypeError('Expected a function')
                }
                function isObject(value) {
                    const type = typeof value
                    return value != null && (type === 'object' || type === 'function')
                }

                wait = +wait || 0
                if (isObject(options)) {
                    leading = !!options.leading
                    maxing = 'maxWait' in options
                    maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait
                    trailing = 'trailing' in options ? !!options.trailing : trailing
                }

                function invokeFunc(time) {
                    const args = lastArgs
                    const thisArg = lastThis

                    lastArgs = lastThis = undefined
                    lastInvokeTime = time
                    result = func.apply(thisArg, args)
                    return result
                }

                function startTimer(pendingFunc, wait) {
                    if (useRAF) {
                    root.cancelAnimationFrame(timerId)
                    return root.requestAnimationFrame(pendingFunc)
                    }
                    return setTimeout(pendingFunc, wait)
                }

                function cancelTimer(id) {
                    if (useRAF) {
                    return root.cancelAnimationFrame(id)
                    }
                    clearTimeout(id)
                }

                function leadingEdge(time) {
                    
                    lastInvokeTime = time
                    
                    timerId = startTimer(timerExpired, wait)
                    
                    return leading ? invokeFunc(time) : result
                }

                function remainingWait(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime
                    const timeWaiting = wait - timeSinceLastCall

                    return maxing
                    ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke)
                    : timeWaiting
                }

                function shouldInvoke(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime

                    
                    
                    
                    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
                    (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait))
                }

                function timerExpired() {
                    const time = Date.now()
                    if (shouldInvoke(time)) {
                    return trailingEdge(time)
                    }
                    
                    timerId = startTimer(timerExpired, remainingWait(time))
                }

                function trailingEdge(time) {
                    timerId = undefined

                    
                    
                    if (trailing && lastArgs) {
                    return invokeFunc(time)
                    }
                    lastArgs = lastThis = undefined
                    return result
                }

                function cancel() {
                    if (timerId !== undefined) {
                    cancelTimer(timerId)
                    }
                    lastInvokeTime = 0
                    lastArgs = lastCallTime = lastThis = timerId = undefined
                }

                function flush() {
                    return timerId === undefined ? result : trailingEdge(Date.now())
                }

                function pending() {
                    return timerId !== undefined
                }

                function debounced(...args) {
                    const time = Date.now()
                    const isInvoking = shouldInvoke(time)

                    lastArgs = args
                    lastThis = this
                    lastCallTime = time

                    if (isInvoking) {
                    if (timerId === undefined) {
                        return leadingEdge(lastCallTime)
                    }
                    if (maxing) {
                        
                        timerId = startTimer(timerExpired, wait)
                        return invokeFunc(lastCallTime)
                    }
                    }
                    if (timerId === undefined) {
                    timerId = startTimer(timerExpired, wait)
                    }
                    return result
                }
                debounced.cancel = cancel
                debounced.flush = flush
                debounced.pending = pending
                return debounced
                }

    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
        
        
            twikoo.init({
                envId: "https://twikoo-rho-olive.vercel.app/",
                el: '#tcomment',
                region:  null ,
            });
        

        document.querySelectorAll("table").forEach(function(elem){
            elem.classList.add("table-striped");
            elem.classList.add("table");
            elem.classList.add("table-responsive");
            elem.classList.add("table-hover");
        })

        
        spy();
        window.addEventListener('scroll', this.debounce(spy, 250, { 'maxWait': 250 }), false);
        
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});



</script>
    </body>
</html>
