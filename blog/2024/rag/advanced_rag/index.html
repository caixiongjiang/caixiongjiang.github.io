<!DOCTYPE html>
<html><head>
<title>Advanced-RAG: RAG进阶使用技巧</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="RAG在工程中的进阶使用技巧">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="Advanced-RAG: RAG进阶使用技巧" />
<meta property="og:description" content="RAG在工程中的进阶使用技巧" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://caixiongjiang.github.io/blog/2024/rag/advanced_rag/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-08-25T18:18:05+08:00" />
<meta property="article:modified_time" content="2024-08-27T09:19:06+08:00" />












<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>


  




<link rel="icon" href="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/avater.jfif">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/dark-mode.min.c0082f0b082177f6fb3768ff91439a097de49689bd26f4d49f76d94ebb81e02d.css" integrity="sha256-wAgvCwghd/b7N2j/kUOaCX3klom9JvTUn3bZTruB4C0=" media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>


  
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script"
async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
MathJax.Hub.Queue(function() {



var all = MathJax.Hub.getAllJax(), i;
for(i = 0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';
}
});
</script>

<style>
code.has-jax {
font: inherit;
font-size: 100%;
background: inherit;
border: inherit;
color: #515151;
}
</style>





  
    <script src="/js/toc.js"></script>
  











<script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>




</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://caixiongjiang.github.io/">
    
        <div class="nav-title">
            🌀Jarson Cai&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            头脑是日用品，不是装饰品
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/blog">
                文章📖
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                分类📌
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                标签🏷️
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/series">
                系列📚
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/archive">
                归档📃
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                关于👋
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friends">
                友链🔗
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS📢
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://github.com/caixiongjiang">
    GitHub
</a>
<br>

<a href="mailto:nau_cxj@163.com">
    Email
</a>
<br>

<a href="https://leetcode-cn.com/u/cai-xiong-jiang/">
    Leetcode
</a>
<br>

        <hr>
        
魔改自 <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2024 🌀Jarson Cai&#39;s Blog
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#naive-rag" onclick="onNavClick(`#naive-rag-nav`)" id="naive-rag-nav">
									Naive RAG
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#advanced-rag-rag%e8%bf%9b%e9%98%b6%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7" onclick="onNavClick(`#advanced-rag-rag进阶使用技巧-nav`)" id="advanced-rag-rag进阶使用技巧-nav">
									Advanced-RAG: RAG进阶使用技巧
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%87%e6%a1%a3%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#文档加载-nav`)" id="文档加载-nav">
									文档加载
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%96%87%e6%9c%ac%e5%88%86%e5%9d%97" onclick="onNavClick(`#文本分块-nav`)" id="文本分块-nav">
									文本分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%95%bf%e7%9f%ad%e4%b8%8d%e4%b8%80%e7%9a%84%e6%96%87%e6%9c%ac%e5%88%87%e5%88%86" onclick="onNavClick(`#长短不一的文本切分-nav`)" id="长短不一的文本切分-nav">
									长短不一的文本切分
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97chunking%e8%80%83%e8%99%91%e5%9b%a0%e7%b4%a0" onclick="onNavClick(`#分块chunking考虑因素-nav`)" id="分块chunking考虑因素-nav">
									分块（chunking）考虑因素
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97%e6%96%b9%e6%b3%95" onclick="onNavClick(`#分块方法-nav`)" id="分块方法-nav">
									分块方法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9b%ba%e5%ae%9a%e5%a4%a7%e5%b0%8f%e5%88%86%e5%9d%97fixed-size-chunking" onclick="onNavClick(`#固定大小分块fixed-size-chunking-nav`)" id="固定大小分块fixed-size-chunking-nav">
									固定大小分块（Fixed-size Chunking）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%86%85%e5%ae%b9%e6%84%9f%e7%9f%a5%e5%88%86%e5%9d%97content-aware-chunking" onclick="onNavClick(`#内容感知分块content-aware-chunking-nav`)" id="内容感知分块content-aware-chunking-nav">
									“内容感知”分块（“Content-aware” Chunking）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%80%92%e5%bd%92%e5%88%86%e5%9d%97" onclick="onNavClick(`#递归分块-nav`)" id="递归分块-nav">
									递归分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%93%e7%94%a8%e5%88%86%e5%9d%97" onclick="onNavClick(`#专用分块-nav`)" id="专用分块-nav">
									专用分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%af%ad%e4%b9%89%e5%88%86%e5%89%b2" onclick="onNavClick(`#语义分割-nav`)" id="语义分割-nav">
									语义分割
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%a1%ae%e5%ae%9a%e9%80%82%e7%94%a8%e4%ba%8e%e5%ba%94%e7%94%a8%e7%9a%84%e6%9c%80%e4%bd%b3%e5%9d%97%e5%a4%a7%e5%b0%8f" onclick="onNavClick(`#确定适用于应用的最佳块大小-nav`)" id="确定适用于应用的最佳块大小-nav">
									确定适用于应用的最佳块大小
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%90%91%e9%87%8f%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#向量检索-nav`)" id="向量检索-nav">
									向量检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%85%b3%e9%94%ae%e8%af%8d%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#关键词检索-nav`)" id="关键词检索-nav">
									关键词检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bm25%e6%a3%80%e7%b4%a2%e5%99%a8" onclick="onNavClick(`#bm25检索器-nav`)" id="bm25检索器-nav">
									BM25检索器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" onclick="onNavClick(`#基本原理-nav`)" id="基本原理-nav">
									基本原理
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%a3%e7%a0%81%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#代码使用-nav`)" id="代码使用-nav">
									代码使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#elasticsearch%e6%a3%80%e7%b4%a2%e5%99%a8" onclick="onNavClick(`#elasticsearch检索器-nav`)" id="elasticsearch检索器-nav">
									ElasticSearch检索器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#混合检索-nav`)" id="混合检索-nav">
									混合检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e7%ba%a7%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#分级检索-nav`)" id="分级检索-nav">
									分级检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%93%e6%9e%9c%e6%8e%92%e5%ba%8f" onclick="onNavClick(`#结果排序-nav`)" id="结果排序-nav">
									结果排序
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8c%87%e6%a0%87%e8%af%84%e4%bc%b0" onclick="onNavClick(`#指标评估-nav`)" id="指标评估-nav">
									指标评估
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1%e5%9c%a8rag%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" onclick="onNavClick(`#知识图谱在rag中的应用-nav`)" id="知识图谱在rag中的应用-nav">
									知识图谱在RAG中的应用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ae%e9%a2%98%e6%94%b9%e5%86%99" onclick="onNavClick(`#问题改写-nav`)" id="问题改写-nav">
									问题改写
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/blog">
                    文章📖
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    分类📌
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    标签🏷️
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/series">
                    系列📚
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/archive">
                    归档📃
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    关于👋
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friends">
                    友链🔗
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS📢
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#naive-rag" onclick="onNavClick(`#naive-rag-nav`)" id="naive-rag-nav">
									Naive RAG
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#advanced-rag-rag%e8%bf%9b%e9%98%b6%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7" onclick="onNavClick(`#advanced-rag-rag进阶使用技巧-nav`)" id="advanced-rag-rag进阶使用技巧-nav">
									Advanced-RAG: RAG进阶使用技巧
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%87%e6%a1%a3%e5%8a%a0%e8%bd%bd" onclick="onNavClick(`#文档加载-nav`)" id="文档加载-nav">
									文档加载
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%96%87%e6%9c%ac%e5%88%86%e5%9d%97" onclick="onNavClick(`#文本分块-nav`)" id="文本分块-nav">
									文本分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%95%bf%e7%9f%ad%e4%b8%8d%e4%b8%80%e7%9a%84%e6%96%87%e6%9c%ac%e5%88%87%e5%88%86" onclick="onNavClick(`#长短不一的文本切分-nav`)" id="长短不一的文本切分-nav">
									长短不一的文本切分
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97chunking%e8%80%83%e8%99%91%e5%9b%a0%e7%b4%a0" onclick="onNavClick(`#分块chunking考虑因素-nav`)" id="分块chunking考虑因素-nav">
									分块（chunking）考虑因素
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97%e6%96%b9%e6%b3%95" onclick="onNavClick(`#分块方法-nav`)" id="分块方法-nav">
									分块方法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9b%ba%e5%ae%9a%e5%a4%a7%e5%b0%8f%e5%88%86%e5%9d%97fixed-size-chunking" onclick="onNavClick(`#固定大小分块fixed-size-chunking-nav`)" id="固定大小分块fixed-size-chunking-nav">
									固定大小分块（Fixed-size Chunking）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%86%85%e5%ae%b9%e6%84%9f%e7%9f%a5%e5%88%86%e5%9d%97content-aware-chunking" onclick="onNavClick(`#内容感知分块content-aware-chunking-nav`)" id="内容感知分块content-aware-chunking-nav">
									“内容感知”分块（“Content-aware” Chunking）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%80%92%e5%bd%92%e5%88%86%e5%9d%97" onclick="onNavClick(`#递归分块-nav`)" id="递归分块-nav">
									递归分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%93%e7%94%a8%e5%88%86%e5%9d%97" onclick="onNavClick(`#专用分块-nav`)" id="专用分块-nav">
									专用分块
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%af%ad%e4%b9%89%e5%88%86%e5%89%b2" onclick="onNavClick(`#语义分割-nav`)" id="语义分割-nav">
									语义分割
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%a1%ae%e5%ae%9a%e9%80%82%e7%94%a8%e4%ba%8e%e5%ba%94%e7%94%a8%e7%9a%84%e6%9c%80%e4%bd%b3%e5%9d%97%e5%a4%a7%e5%b0%8f" onclick="onNavClick(`#确定适用于应用的最佳块大小-nav`)" id="确定适用于应用的最佳块大小-nav">
									确定适用于应用的最佳块大小
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%90%91%e9%87%8f%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#向量检索-nav`)" id="向量检索-nav">
									向量检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%85%b3%e9%94%ae%e8%af%8d%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#关键词检索-nav`)" id="关键词检索-nav">
									关键词检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bm25%e6%a3%80%e7%b4%a2%e5%99%a8" onclick="onNavClick(`#bm25检索器-nav`)" id="bm25检索器-nav">
									BM25检索器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" onclick="onNavClick(`#基本原理-nav`)" id="基本原理-nav">
									基本原理
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%a3%e7%a0%81%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#代码使用-nav`)" id="代码使用-nav">
									代码使用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#elasticsearch%e6%a3%80%e7%b4%a2%e5%99%a8" onclick="onNavClick(`#elasticsearch检索器-nav`)" id="elasticsearch检索器-nav">
									ElasticSearch检索器
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#混合检索-nav`)" id="混合检索-nav">
									混合检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e7%ba%a7%e6%a3%80%e7%b4%a2" onclick="onNavClick(`#分级检索-nav`)" id="分级检索-nav">
									分级检索
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bb%93%e6%9e%9c%e6%8e%92%e5%ba%8f" onclick="onNavClick(`#结果排序-nav`)" id="结果排序-nav">
									结果排序
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8c%87%e6%a0%87%e8%af%84%e4%bc%b0" onclick="onNavClick(`#指标评估-nav`)" id="指标评估-nav">
									指标评估
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%9f%a5%e8%af%86%e5%9b%be%e8%b0%b1%e5%9c%a8rag%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" onclick="onNavClick(`#知识图谱在rag中的应用-nav`)" id="知识图谱在rag中的应用-nav">
									知识图谱在RAG中的应用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ae%e9%a2%98%e6%94%b9%e5%86%99" onclick="onNavClick(`#问题改写-nav`)" id="问题改写-nav">
									问题改写
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://caixiongjiang.github.io/">
            🌀Jarson Cai&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://caixiongjiang.github.io/">
        <div class="single-column-header-title">🌀Jarson Cai&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">头脑是日用品，不是装饰品</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/rag/rag_title.jpg')"
                    
                
            >
                <div class="post-title">
                    Advanced-RAG: RAG进阶使用技巧
                    
                    <div class="post-subtitle">
                        RAG在工程中的进阶使用技巧
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-08-25 18:18
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[NLP]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/rag">RAG</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            23 min
                            
                            1 second.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="naive-rag">Naive RAG</h1>
<p>前言：目前下述的代码都基于Langchain 0.1的版本进行，目前Langchain已经更新到0.2，还有在构建RAG应用的时候还是不要过分依赖框架，降低灵活性，这有时候会让你的工程开发陷入被动！</p>
<p>首先先介绍一下最简单的RAG的流程，其主要的流程如下图所示：</p>
<p><img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/rag/img7.jpg" alt=""></p>
<p>将知识库文本拆分为块，然后使用一些Transformer Encoder模型将这些块嵌入向量中，将所有这些向量放入索引中，最后为LLM创建一个提示，告诉模型根据我们在搜索步骤中发现的上下文，回答用户的查询。</p>
<p>在运行时，我们使用相同的编码器模型矢量化用户的查询，然后针对索引执行此查询矢量的搜索，找到top-k结果，从我们的数据库中检索相应的文本块，并将其作为上下文输入LLM提示符。</p>
<p>示例的RAG提示词模版如下：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#228b22"># 英文提示词</span>
</span></span><span style="display:flex;"><span>prompt_template = <span style="color:#cd5555">&#34;&#34;&#34;Give the answer to the user query delimited by triple backticks ```</span><span style="color:#cd5555">{query}</span><span style="color:#cd5555">```</span><span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#cd5555">                using the information given in context delimited by triple backticks ```</span><span style="color:#cd5555">{context}</span><span style="color:#cd5555">```.</span><span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#cd5555">                If there is no relevant information in the provided context, try to answer yourself, 
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">                but tell user that you did not have any relevant context to base your answer on.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">                Be concise and output the answer of size less than 80 tokens.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 中文版本</span>
</span></span><span style="display:flex;"><span>prompt_template_zh = <span style="color:#cd5555">&#34;&#34;&#34;给出由三重反引号分隔的用户查询的答案````</span><span style="color:#cd5555">{query}</span><span style="color:#cd5555">```</span><span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">使用由三重反引号```</span><span style="color:#cd5555">{context}</span><span style="color:#cd5555">```分隔的上下文中给出的信息。</span><span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">如果提供的上下文中没有相关信息，请尝试回答自己，
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">但告诉用户，您没有任何相关上下文来作为答案的基础。
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">简明扼要，并输出大小小于80个代币的答案。
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="advanced-rag-rag进阶使用技巧">Advanced-RAG: RAG进阶使用技巧</h1>
<p>做过RAG应用的都知道一句话叫“RAG demo5分钟，上线上一年。”</p>
<p>使用简单的RAG流程必然不可能有很好的检索效果，大模型的回答也一定是一塌糊涂。</p>
<p>放一张国外的博客的图：
<img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/rag/img8.jpg" alt="">
绿色的部分下面我们将会深入展开，蓝色部分则是处理好的文本元素。</p>
<p>下面将会记录的所有RAG相关的技术都或多或少与上面这个图相关。我们将会介绍所有与RAG相关的步骤中相关的进阶技术，以及RAG效果测试数据集的建立、评估、测试。</p>
<h2 id="文档加载">文档加载</h2>
<h2 id="文本分块">文本分块</h2>
<p><strong>分块的目的主要是为了确保在内容向量化时尽可能减少噪声，同时保持语义相关性。<strong>例如，在</strong>语义搜索</strong>(semantic search)中为一个包含特定主题信息的文档语料库建立索引。可以通过应用有效的分块策略，确保搜索结果准确捕捉用户查询的真实意图。如果分块太小或太大，可能导致搜索结果不精确或错过表面相关内容。作为经验之谈，如果文本块在没有周围上下文的情况下对人类来说可读可理解，它对语言模型也同样有意义。因此，找到语料库中文档的最佳块大小对于确保搜索结果的准确性和相关性至关重要。</p>
<h3 id="长短不一的文本切分">长短不一的文本切分</h3>
<p><strong>短内容向量化</strong>：当一个句子被向量化时，生成的向量专注于该句子的具体含义，在与其他句子向量进行比较时也会更多关注句子层面的上。这也意味着<strong>短内容向量化可能会丢失句子在段落或全文中所包含的上下文信息。</strong></p>
<p><strong>长内容向量化</strong>：当整个段落或文档被向量化时，向量化过程考虑了整体上下文以及文本内部句子和短语之间的关系，这样向量化时包含的内容可能更全面，捕捉到的文本含义和主题更准确。但是，<strong>较大的文本块大小可能更容易引入噪声，或稀释某些句子或短语的重要性，使得在查询索引时的精确匹配变得更加困难。</strong></p>
<blockquote>
<p>较短的查询，如单个句子或短语，将集中于具体细节，并可能更适合与句子级别的向量匹配。较长的查询，跨越多个句子或段落，可能与段落或文档级别的向量更为协调。</p>
</blockquote>
<p>索引可能也是非均质的，包含不同大小的块向量。这可能在查询结果相关性方面带来挑战，但也可能带来一些积好处。一方面，由于<strong>长短内容之间语义表示的差异可能会导致查询与结果相关性的波动</strong>。另一方面，<strong>非均质索引可能捕捉到更全面的上下文信息，因为不同大小的块代表了文本中不同层次的细节</strong>。这样可能会有利于更灵活地适应不同类型的查询。</p>
<h3 id="分块chunking考虑因素">分块（chunking）考虑因素</h3>
<ul>
<li><strong>内容的性质</strong>：处理的是长文档（如文章或书籍）还是较短的内容（如推文或即时消息）？这将决定哪种模型更适合您的目标，从而影响应用的分块策略。</li>
<li><strong>使用的向量模型</strong>：接下来要考虑的是应该使用的向量模型，以及它在哪些块大小上表现最佳。这部分主要是探究模型在多少个数量的令牌（token）上表现更好，以此来辅助决定分块的大小。</li>
<li><strong>用户查询的预期长度和复杂度</strong>：RAG是与用户相关的应用问题，一般来说都会预先定义一些查询结果样例，这些<strong>样例的形式和长度</strong>在文本分块中起到重要的作用。</li>
<li><strong>检索结果在特定应用中的使用方式</strong>：如果检索结果要被放入大模型里使用，则需要检索结果的内容长度作一定的限制，因为大模型支持的令牌（token）数是有限的。（按照经验来说，带多轮对话的RAG一般上下文长度限定在8K个token左右）</li>
</ul>
<h3 id="分块方法">分块方法</h3>
<p>在文本分块方面，有几种不同的方法可供选择，每种方法适用于不同的情况。以下是一些主要的分块方法，以及它们的优势和劣势。</p>
<h4 id="固定大小分块fixed-size-chunking">固定大小分块（Fixed-size Chunking）</h4>
<p>这是最常见且直接的分块方法，简单地决定每个块中的token数量，并可选择性地决定它们之间是否应该有重叠。通常用户会希望在块之间保持一些重叠，以确保上下文语义不会在块之间丢失。<strong>在多数情况下，固定大小分块将是最优方法。</strong></p>
<p>Langchain中执行的例子：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text = <span style="color:#cd5555">&#34;...&#34;</span> <span style="color:#228b22"># your text</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> CharacterTextSplitter
</span></span><span style="display:flex;"><span>text_splitter = CharacterTextSplitter(
</span></span><span style="display:flex;"><span>    separator = <span style="color:#cd5555">&#34;</span><span style="color:#cd5555">\n\n</span><span style="color:#cd5555">&#34;</span>,
</span></span><span style="display:flex;"><span>    chunk_size = <span style="color:#b452cd">256</span>,
</span></span><span style="display:flex;"><span>    chunk_overlap  = <span style="color:#b452cd">20</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>docs = text_splitter.create_documents([text])
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="内容感知分块content-aware-chunking">“内容感知”分块（“Content-aware” Chunking）</h4>
<p>1、<strong>原始分割法</strong>：一种按照简单的标点符号或者换行符来分割文本。这种方法快速且易于实现，但可能不会考虑到所有可能的边界情况，如缩写、省略号或带有句号的引用等。所以虽然朴素分割在某些情况下足够有效，但它可能无法准确地处理<strong>相对复杂的文本结构</strong>。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text = <span style="color:#cd5555">&#34;...&#34;</span> <span style="color:#228b22"># your text</span>
</span></span><span style="display:flex;"><span>docs = text.split(<span style="color:#cd5555">&#34;.&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>2、 <strong>自然语言工具包</strong>（Nature Language Toolkit, NLTK）：NLTK是一个比较流行的Python库，用于处理人类语言数据。其中有一个文本分割器，可以将文本分割成单独的句子，NLTK句子分词器考虑了更多的语言规则和边界情况，更加精确。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text = <span style="color:#cd5555">&#34;...&#34;</span> <span style="color:#228b22"># your text</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> NLTKTextSplitter
</span></span><span style="display:flex;"><span>text_splitter = NLTKTextSplitter()
</span></span><span style="display:flex;"><span>docs = text_splitter.split_text(text)
</span></span></code></pre></td></tr></table>
</div>
</div><p>3、<strong>spaCy</strong>是另一个强大的Python库，用于各种NLP任务。它提供了一个高级的句子分割功能，<strong>能够有效地将文本划分为单独的句子，从而在生成的块中更好地保留上下文</strong>。spaCy的句子分割功能使用复杂的算法和模型来理解文本结构，因此它能够更准确地处理各种文本格式和风格。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text = <span style="color:#cd5555">&#34;...&#34;</span> <span style="color:#228b22"># your text</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> SpacyTextSplitter
</span></span><span style="display:flex;"><span>text_splitter = SpaCyTextSplitter()
</span></span><span style="display:flex;"><span>docs = text_splitter.split_text(text)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="递归分块">递归分块</h4>
<p>递归分块使用一组分隔符以分层和迭代的方式将输入文本分割成更小的块。<strong>如果最初的分割尝试没有产生所需大小或结构的块，该方法会递归地在结果块上使用不同的分隔符或标准进行调用</strong>，直到达到所需的块大小或结构。这意味着虽然块的大小不会完全相同，但它们仍然会“努力”达到类似的大小。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text = <span style="color:#cd5555">&#34;...&#34;</span> <span style="color:#228b22"># your text</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> RecursiveCharacterTextSplitter
</span></span><span style="display:flex;"><span>text_splitter = RecursiveCharacterTextSplitter(
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># Set a really small chunk size, just to show.</span>
</span></span><span style="display:flex;"><span>    chunk_size = <span style="color:#b452cd">256</span>,
</span></span><span style="display:flex;"><span>    chunk_overlap  = <span style="color:#b452cd">20</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docs = text_splitter.create_documents([text])
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="专用分块">专用分块</h4>
<p>这部分的内容主要是针对文本的类型来决定的，比如特殊的文本类型，<code>markdown</code>和<code>latex</code>等。
这两种文本类型都具有高度的结构化属性，它们可以通过语法来生成高质量的结构化文本。前者往往用于工程代码的说明书和文档，后者则一般用于论文的编写。</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> MarkdownTextSplitter
</span></span><span style="display:flex;"><span>markdown_text = <span style="color:#cd5555">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>markdown_splitter = MarkdownTextSplitter(chunk_size=<span style="color:#b452cd">100</span>, chunk_overlap=<span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span>docs = markdown_splitter.create_documents([markdown_text])
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> LatexTextSplitter
</span></span><span style="display:flex;"><span>latex_text = <span style="color:#cd5555">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>latex_splitter = LatexTextSplitter(chunk_size=<span style="color:#b452cd">100</span>, chunk_overlap=<span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span>docs = latex_splitter.create_documents([latex_text])
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="语义分割">语义分割</h4>
<p>Greg Kamradt首次引入了一种新的接近块状的实验技术。在他的笔记本中，Kamradt正确地指出，一个事实是，即全局块大小可能太微不足道，无法考虑文档中段的含义。如果我们使用这种类型的机制，我们无法知道我们是否在组合彼此有任何关系的片段。</p>
<p>幸运的是，如果您正在使用LLM构建应用程序，您很可能已经有能力创建嵌入——嵌入可用于提取数据中存在的语义。这种语义分析可用于创建由谈论相同主题或话题的句子组成的块。</p>
<p>以下是使语义分块的步骤：
1、将文档分解成句子。</p>
<p>2、创建句子组：对于每个句子，创建一个包含给定句子前后一些句子的组。该组本质上被用于创建它的句子“安置”。您可以决定每个组之前或之后的具体数字，但组中的所有句子都将与一个“anchor”句子相关联。</p>
<p>3、为每个句子组生成嵌入，并将其与他们的“anchor”句子相关联。</p>
<p>4、按顺序比较每个组之间的距离：当您按顺序查看文档中的句子时，只要主题或主题相同-为给定句子嵌入的句子组和它前面的句子组之间的距离将很低。另一方面，更高的语义距离表明主题或话题已经改变。这可以有效地从下一个块中划定一个块。</p>
<p>Langchain中已经将这种方法集成进去了，但它是一个实验性的方法：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_experimental.text_splitter</span> <span style="color:#8b008b;font-weight:bold">import</span> SemanticChunker
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_openai.embeddings</span> <span style="color:#8b008b;font-weight:bold">import</span> OpenAIEmbeddings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">with</span> <span style="color:#658b00">open</span>(<span style="color:#cd5555">&#34;../../state_of_the_union.txt&#34;</span>) <span style="color:#8b008b;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    state_of_the_union = f.read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_splitter = SemanticChunker(OpenAIEmbeddings())
</span></span><span style="display:flex;"><span>docs = text_splitter.create_documents([state_of_the_union])
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(docs[<span style="color:#b452cd">0</span>].page_content)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="确定适用于应用的最佳块大小">确定适用于应用的最佳块大小</h3>
<p>说了这么多，我们还没有研究如何确定最佳的分块大小（比如是固定大小分块），只是一些通用的建议。</p>
<ul>
<li>数据预处理：首先拿到语料需要对数据进行一定的数据预处理确保数据的质量，然后才能确定块的大小。（去掉一些不合理的标签，文档数据的不合理读取）。</li>
<li><strong>选择一系列块大小</strong>：一旦数据预处理完成，下一步是选择一系列潜在的块大小进行测试。如文章前面提到的，选择时应考虑<strong>内容的性质（例如，短消息或长文档）</strong>、将要使用的<strong>向量模型及其能力（例如，token数量限制）</strong>。目标是在保留上下文语境和维持准确性之间找到平衡点。开始时可以探索各种块大小，包括较小的块（例如，128或256个token）以捕获更细粒度的语义信息，然后再探索较大的块（例如，512或1024个token）以保留更多上下文语境。</li>
<li><strong>评估每种块大小的性能</strong>：可以使用多个索引或一个带有多个命名空间的单一索引测试不同的块大小的性能。使用代表性数据集为想要测试的块大小创建向量，并将它们保存在一个或多个索引中。然后运行一系列查询以评估质量，并比较各种块大小的性能。这很可能是一个迭代过程，需要测试不同的块大小针对不同的查询，直到能够确定最适合内容和预期查询的块大小。</li>
</ul>
<h2 id="向量检索">向量检索</h2>
<h2 id="关键词检索">关键词检索</h2>
<h3 id="bm25检索器">BM25检索器</h3>
<p>BM25 是一种基于概率的排名函数，用于信息检索系统。<strong>BM25原理是根据查询词在文档中的出现频率以及查询词在整个文本集中的出现频率，来计算查询词和文档的相似度</strong>。BM25模型的主要思想是：如果一个词在一份文档（这里的文档一般是指分块之后的document）中出现的频率高，且在其他文档中出现的频率低，那么这个词对于这份文档的重要性就越高，相似度就越高。BM25模型对于长文档和短文档有一个平衡处理，防止因文档长度不同，而导致的词频偏差。</p>
<h4 id="基本原理">基本原理</h4>
<p>BM25基于这样一个假设：对于一个特定的查询项，它在相关文档中出现的频率高于在非相关文档中的频率。算法通过结合词项频率（TF）和文档频率（DF）来计算文档的得分。</p>
<p><strong>TF（词项频率）</strong>
词项频率是指一个词项在文档中出现的次数。BM25对传统TF的计算方法进行了调整，引入了饱和度和长度归一化，以防止长文档由于包含更多词项而获得不公平的高评分。</p>
<p><strong>IDF（逆文档频率）</strong>
逆文档频率是衡量词项稀有程度的指标。它的计算基于整个文档集合，用来降低常见词项的权重，并提升罕见词项的权重。</p>
<p><strong>计算公式</strong>：
$$
\text{BM25}(D, Q) = \sum_{i=1}^n\text{IDF}(q_i)\cdot\frac{f(q_i, D)\cdot(k_1 + 1)}{f(q_i, D) + k_1\cdot(1-b+b\cdot \frac{\text{len}(D)}{\text{avg_len}})}
$$</p>
<p>其中：</p>
<ul>
<li>$n$是查询中的词项数。</li>
<li>$q_i$是查询中的第$i$个词项。</li>
<li>$\text{IDF}(q_i)$是逆文档频率，计算方式通常是$\text{log}\frac{N-n(q_i)+0.5}{n(q_i)+0.5}$，其中$N$是文档总数，$n(q_i)$ 是包含词项$q_i$的文档数。</li>
<li>$\text{len}(D)$是文档$D$的长度。</li>
<li>$\text{avg_len}$是所有文档的平均长度。</li>
<li>$k_1$和$b$是调整参数，通常设置为$k_1=1.5$和$b=0.75$</li>
</ul>
<h4 id="代码使用">代码使用</h4>
<p>在LangChain中已经集成了该方法，模块名叫<code>BM25Retriever</code>。</p>
<p>示例使用代码：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">typing</span> <span style="color:#8b008b;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>    List
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.schema</span> <span style="color:#8b008b;font-weight:bold">import</span> Document
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">jieba</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">jieba.posseg</span> <span style="color:#8b008b;font-weight:bold">as</span> <span style="color:#008b45;text-decoration:underline">pseg</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># jieba_dictionnary为分词内部自带的分词文件地址</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># jieba_user_dict为自己定义的特殊分词表</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">func</span>(text: <span style="color:#658b00">str</span>) -&gt; List[<span style="color:#658b00">str</span>]:
</span></span><span style="display:flex;"><span>    jieba.set_dictionary(jieba_dictionary)
</span></span><span style="display:flex;"><span>    jieba.load_userdict(jieba_user_dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    jieba_list = jieba.lcut(text, cut_all=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    words = pseg.cut(text)
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> word, flag <span style="color:#8b008b">in</span> words:
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> flag == <span style="color:#cd5555">&#34;nr&#34;</span>:
</span></span><span style="display:flex;"><span>            jieba_list.append(word)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> jieba_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># 该部分为通过文本切分之后的chunk块</span>
</span></span><span style="display:flex;"><span>texts: List[Document] = [...]
</span></span><span style="display:flex;"><span><span style="color:#228b22"># BM25检索器，获取前5个最相关的结果</span>
</span></span><span style="display:flex;"><span>bm25_retriever = BM25Retriever(docs=texts, k=<span style="color:#b452cd">5</span>) 
</span></span><span style="display:flex;"><span><span style="color:#228b22"># BM25检索器有默认的前处理分词策略，你也可以实现自己的分词策略，这里我使用jieba分词</span>
</span></span><span style="display:flex;"><span>my_bm25_retriever = BM25Retriever(docs=texts, k=<span style="color:#b452cd">5</span>, preprocess_func=func)
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中词汇的内容通常用以下格式：</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span># 名称 词频 词性（词频越高，优先级越高）
</span></span><span style="display:flex;"><span>苹果 3 n
</span></span><span style="display:flex;"><span>iPhone 5 nz
</span></span><span style="display:flex;"><span>Python 10 n
</span></span><span style="display:flex;"><span>深度学习 8 n
</span></span><span style="display:flex;"><span>jieba 5 nr
</span></span></code></pre></td></tr></table>
</div>
</div><p>除了上述的格式，词频和词性都是可以省略的，当然，标注完整效果会更佳。</p>
<h3 id="elasticsearch检索器">ElasticSearch检索器</h3>
<h2 id="混合检索">混合检索</h2>
<h2 id="分级检索">分级检索</h2>
<h2 id="结果排序">结果排序</h2>
<h2 id="指标评估">指标评估</h2>
<h2 id="知识图谱在rag中的应用">知识图谱在RAG中的应用</h2>
<h2 id="问题改写">问题改写</h2>

                    
                    <HR width="100%" id="EOF">
		            <p style="color:#777;">最后修改于 2024-08-27</p>
                    
                    
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://image-1252109614.cos.ap-beijing.myqcloud.com/img/20210508215939.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			下回<br>已经到头啦。
                </a>
                
                
                
                <a class="older-posts" href="https://caixiongjiang.github.io/blog/2024/rag/document_ai/">
			上回<br>Document-AI: 使用模型工具处理非结构化、复杂的各类文档
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="tcomment"></div>



            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
魔改自 <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2024 🌀Jarson Cai&#39;s Blog
	</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            },
            debounce(func, wait, options) {
                let lastArgs,
                    lastThis,
                    maxWait,
                    result,
                    timerId,
                    lastCallTime

                let lastInvokeTime = 0
                let leading = false
                let maxing = false
                let trailing = true

                
                const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function')

                if (typeof func !== 'function') {
                    throw new TypeError('Expected a function')
                }
                function isObject(value) {
                    const type = typeof value
                    return value != null && (type === 'object' || type === 'function')
                }

                wait = +wait || 0
                if (isObject(options)) {
                    leading = !!options.leading
                    maxing = 'maxWait' in options
                    maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait
                    trailing = 'trailing' in options ? !!options.trailing : trailing
                }

                function invokeFunc(time) {
                    const args = lastArgs
                    const thisArg = lastThis

                    lastArgs = lastThis = undefined
                    lastInvokeTime = time
                    result = func.apply(thisArg, args)
                    return result
                }

                function startTimer(pendingFunc, wait) {
                    if (useRAF) {
                    root.cancelAnimationFrame(timerId)
                    return root.requestAnimationFrame(pendingFunc)
                    }
                    return setTimeout(pendingFunc, wait)
                }

                function cancelTimer(id) {
                    if (useRAF) {
                    return root.cancelAnimationFrame(id)
                    }
                    clearTimeout(id)
                }

                function leadingEdge(time) {
                    
                    lastInvokeTime = time
                    
                    timerId = startTimer(timerExpired, wait)
                    
                    return leading ? invokeFunc(time) : result
                }

                function remainingWait(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime
                    const timeWaiting = wait - timeSinceLastCall

                    return maxing
                    ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke)
                    : timeWaiting
                }

                function shouldInvoke(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime

                    
                    
                    
                    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
                    (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait))
                }

                function timerExpired() {
                    const time = Date.now()
                    if (shouldInvoke(time)) {
                    return trailingEdge(time)
                    }
                    
                    timerId = startTimer(timerExpired, remainingWait(time))
                }

                function trailingEdge(time) {
                    timerId = undefined

                    
                    
                    if (trailing && lastArgs) {
                    return invokeFunc(time)
                    }
                    lastArgs = lastThis = undefined
                    return result
                }

                function cancel() {
                    if (timerId !== undefined) {
                    cancelTimer(timerId)
                    }
                    lastInvokeTime = 0
                    lastArgs = lastCallTime = lastThis = timerId = undefined
                }

                function flush() {
                    return timerId === undefined ? result : trailingEdge(Date.now())
                }

                function pending() {
                    return timerId !== undefined
                }

                function debounced(...args) {
                    const time = Date.now()
                    const isInvoking = shouldInvoke(time)

                    lastArgs = args
                    lastThis = this
                    lastCallTime = time

                    if (isInvoking) {
                    if (timerId === undefined) {
                        return leadingEdge(lastCallTime)
                    }
                    if (maxing) {
                        
                        timerId = startTimer(timerExpired, wait)
                        return invokeFunc(lastCallTime)
                    }
                    }
                    if (timerId === undefined) {
                    timerId = startTimer(timerExpired, wait)
                    }
                    return result
                }
                debounced.cancel = cancel
                debounced.flush = flush
                debounced.pending = pending
                return debounced
                }

    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
        
        
            twikoo.init({
                envId: "https://twikoo-rho-olive.vercel.app/",
                el: '#tcomment',
                region:  null ,
            });
        

        document.querySelectorAll("table").forEach(function(elem){
            elem.classList.add("table-striped");
            elem.classList.add("table");
            elem.classList.add("table-responsive");
            elem.classList.add("table-hover");
        })

        
        spy();
        window.addEventListener('scroll', this.debounce(spy, 250, { 'maxWait': 250 }), false);
        
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});



</script>
    </body>
</html>
