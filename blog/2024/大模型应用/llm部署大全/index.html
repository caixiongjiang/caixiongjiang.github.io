<!DOCTYPE html>
<html><head>
<title>LLMå¯åŠ¨å¤§å…¨</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="è®°å½•ä¸€ä¸‹å½“å‰å¸‚åœºä¸Šå„ç§æ¡†æ¶å¯åŠ¨å¤§æ¨¡å‹ï¼Œä»¥åŠä½¿ç”¨æ–¹æ³•è®°å½•">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="LLMå¯åŠ¨å¤§å…¨" />
<meta property="og:description" content="è®°å½•ä¸€ä¸‹å½“å‰å¸‚åœºä¸Šå„ç§æ¡†æ¶å¯åŠ¨å¤§æ¨¡å‹ï¼Œä»¥åŠä½¿ç”¨æ–¹æ³•è®°å½•" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://caixiongjiang.github.io/blog/2024/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/llm%E9%83%A8%E7%BD%B2%E5%A4%A7%E5%85%A8/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-05-06T18:18:05+08:00" />
<meta property="article:modified_time" content="2024-05-07T09:19:06+08:00" />
<meta property="og:see_also" content="https://caixiongjiang.github.io/blog/2024/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/vllm%E5%B9%B6%E5%8F%91/" /><meta property="og:see_also" content="https://caixiongjiang.github.io/blog/2024/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/nlpllm/" /><meta property="og:see_also" content="https://caixiongjiang.github.io/blog/2024/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/langchain%E5%85%A5%E9%97%A8/" /><meta property="og:see_also" content="https://caixiongjiang.github.io/blog/2023/llm/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%AB%98%E6%95%88%E5%BE%AE%E8%B0%83%E6%8A%80%E6%9C%AF/" />











<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>


  




<link rel="icon" href="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/avater.jfif">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://caixiongjiang.github.io/scss/dark-mode.min.c0082f0b082177f6fb3768ff91439a097de49689bd26f4d49f76d94ebb81e02d.css" integrity="sha256-wAgvCwghd/b7N2j/kUOaCX3klom9JvTUn3bZTruB4C0=" media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>


  
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script"
async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
MathJax.Hub.Queue(function() {



var all = MathJax.Hub.getAllJax(), i;
for(i = 0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';
}
});
</script>

<style>
code.has-jax {
font: inherit;
font-size: 100%;
background: inherit;
border: inherit;
color: #515151;
}
</style>





  
    <script src="/js/toc.js"></script>
  











<script src="https://cdn.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>




</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://caixiongjiang.github.io/">
    
        <div class="nav-title">
            ğŸŒ€Jarson Cai&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            å¤´è„‘æ˜¯æ—¥ç”¨å“ï¼Œä¸æ˜¯è£…é¥°å“
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/blog">
                æ–‡ç« ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                åˆ†ç±»ğŸ“Œ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ ‡ç­¾ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/series">
                ç³»åˆ—ğŸ“š
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/archive">
                å½’æ¡£ğŸ“ƒ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                å…³äºğŸ‘‹
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friends">
                å‹é“¾ğŸ”—
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSSğŸ“¢
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://github.com/caixiongjiang">
    GitHub
</a>
<br>

<a href="mailto:nau_cxj@163.com">
    Email
</a>
<br>

<a href="https://leetcode-cn.com/u/cai-xiong-jiang/">
    Leetcode
</a>
<br>

        <hr>
        
é­”æ”¹è‡ª <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2024 ğŸŒ€Jarson Cai&#39;s Blog
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®å½• -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#llm%e5%90%af%e5%8a%a8%e5%a4%a7%e5%85%a8" onclick="onNavClick(`#llmå¯åŠ¨å¤§å…¨-nav`)" id="llmå¯åŠ¨å¤§å…¨-nav">
									LLMå¯åŠ¨å¤§å…¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e4%b8%8b%e8%bd%bd" onclick="onNavClick(`#æ¨¡å‹ä¸‹è½½-nav`)" id="æ¨¡å‹ä¸‹è½½-nav">
									æ¨¡å‹ä¸‹è½½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e5%90%af%e5%8a%a8" onclick="onNavClick(`#æ¨¡å‹å¯åŠ¨-nav`)" id="æ¨¡å‹å¯åŠ¨-nav">
									æ¨¡å‹å¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8e%9f%e7%94%9ftransformers%e5%ba%93%e5%90%af%e5%8a%a8" onclick="onNavClick(`#åŸç”Ÿtransformersåº“å¯åŠ¨-nav`)" id="åŸç”Ÿtransformersåº“å¯åŠ¨-nav">
									åŸç”ŸTransformersåº“å¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#llamacpp%e5%90%af%e5%8a%a8" onclick="onNavClick(`#llamacppå¯åŠ¨-nav`)" id="llamacppå¯åŠ¨-nav">
									llama.cppå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#ollama%e5%90%af%e5%8a%a8" onclick="onNavClick(`#ollamaå¯åŠ¨-nav`)" id="ollamaå¯åŠ¨-nav">
									Ollamaå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vllm%e5%90%af%e5%8a%a8" onclick="onNavClick(`#vllmå¯åŠ¨-nav`)" id="vllmå¯åŠ¨-nav">
									vLLMå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#skypilot%e9%83%a8%e7%bd%b2" onclick="onNavClick(`#skypilotéƒ¨ç½²-nav`)" id="skypilotéƒ¨ç½²-nav">
									SkyPilotéƒ¨ç½²
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9llm%e6%a1%86%e6%9e%b6%e6%8e%a5%e5%85%a5" onclick="onNavClick(`#ç¬¬ä¸‰æ–¹llmæ¡†æ¶æ¥å…¥-nav`)" id="ç¬¬ä¸‰æ–¹llmæ¡†æ¶æ¥å…¥-nav">
									ç¬¬ä¸‰æ–¹LLMæ¡†æ¶æ¥å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#langchain-llama_index%e6%9c%ac%e5%9c%b0%e5%90%af%e5%8a%a8%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#langchain-llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹-nav`)" id="langchain-llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹-nav">
									LangChain, llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#langchain-llama_index%e8%b0%83%e7%94%a8%e6%9c%ac%e5%9c%b0openai%e6%8e%a5%e5%8f%a3%e6%9c%8d%e5%8a%a1" onclick="onNavClick(`#langchain-llama_indexè°ƒç”¨æœ¬åœ°openaiæ¥å£æœåŠ¡-nav`)" id="langchain-llama_indexè°ƒç”¨æœ¬åœ°openaiæ¥å£æœåŠ¡-nav">
									Langchain, llama_indexè°ƒç”¨æœ¬åœ°OpenAIæ¥å£æœåŠ¡
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/blog">
                    æ–‡ç« ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    åˆ†ç±»ğŸ“Œ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ ‡ç­¾ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/series">
                    ç³»åˆ—ğŸ“š
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/archive">
                    å½’æ¡£ğŸ“ƒ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    å…³äºğŸ‘‹
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friends">
                    å‹é“¾ğŸ”—
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSSğŸ“¢
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®å½• -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#llm%e5%90%af%e5%8a%a8%e5%a4%a7%e5%85%a8" onclick="onNavClick(`#llmå¯åŠ¨å¤§å…¨-nav`)" id="llmå¯åŠ¨å¤§å…¨-nav">
									LLMå¯åŠ¨å¤§å…¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e4%b8%8b%e8%bd%bd" onclick="onNavClick(`#æ¨¡å‹ä¸‹è½½-nav`)" id="æ¨¡å‹ä¸‹è½½-nav">
									æ¨¡å‹ä¸‹è½½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9e%8b%e5%90%af%e5%8a%a8" onclick="onNavClick(`#æ¨¡å‹å¯åŠ¨-nav`)" id="æ¨¡å‹å¯åŠ¨-nav">
									æ¨¡å‹å¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8e%9f%e7%94%9ftransformers%e5%ba%93%e5%90%af%e5%8a%a8" onclick="onNavClick(`#åŸç”Ÿtransformersåº“å¯åŠ¨-nav`)" id="åŸç”Ÿtransformersåº“å¯åŠ¨-nav">
									åŸç”ŸTransformersåº“å¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#llamacpp%e5%90%af%e5%8a%a8" onclick="onNavClick(`#llamacppå¯åŠ¨-nav`)" id="llamacppå¯åŠ¨-nav">
									llama.cppå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#ollama%e5%90%af%e5%8a%a8" onclick="onNavClick(`#ollamaå¯åŠ¨-nav`)" id="ollamaå¯åŠ¨-nav">
									Ollamaå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vllm%e5%90%af%e5%8a%a8" onclick="onNavClick(`#vllmå¯åŠ¨-nav`)" id="vllmå¯åŠ¨-nav">
									vLLMå¯åŠ¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#skypilot%e9%83%a8%e7%bd%b2" onclick="onNavClick(`#skypilotéƒ¨ç½²-nav`)" id="skypilotéƒ¨ç½²-nav">
									SkyPilotéƒ¨ç½²
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9llm%e6%a1%86%e6%9e%b6%e6%8e%a5%e5%85%a5" onclick="onNavClick(`#ç¬¬ä¸‰æ–¹llmæ¡†æ¶æ¥å…¥-nav`)" id="ç¬¬ä¸‰æ–¹llmæ¡†æ¶æ¥å…¥-nav">
									ç¬¬ä¸‰æ–¹LLMæ¡†æ¶æ¥å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#langchain-llama_index%e6%9c%ac%e5%9c%b0%e5%90%af%e5%8a%a8%e6%a8%a1%e5%9e%8b" onclick="onNavClick(`#langchain-llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹-nav`)" id="langchain-llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹-nav">
									LangChain, llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#langchain-llama_index%e8%b0%83%e7%94%a8%e6%9c%ac%e5%9c%b0openai%e6%8e%a5%e5%8f%a3%e6%9c%8d%e5%8a%a1" onclick="onNavClick(`#langchain-llama_indexè°ƒç”¨æœ¬åœ°openaiæ¥å£æœåŠ¡-nav`)" id="langchain-llama_indexè°ƒç”¨æœ¬åœ°openaiæ¥å£æœåŠ¡-nav">
									Langchain, llama_indexè°ƒç”¨æœ¬åœ°OpenAIæ¥å£æœåŠ¡
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://caixiongjiang.github.io/">
            ğŸŒ€Jarson Cai&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://caixiongjiang.github.io/">
        <div class="single-column-header-title">ğŸŒ€Jarson Cai&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">å¤´è„‘æ˜¯æ—¥ç”¨å“ï¼Œä¸æ˜¯è£…é¥°å“</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/LLM/LLM_title.jpg')"
                    
                
            >
                <div class="post-title">
                    LLMå¯åŠ¨å¤§å…¨
                    
                    <div class="post-subtitle">
                        è®°å½•ä¸€ä¸‹å½“å‰å¸‚åœºä¸Šå„ç§æ¡†æ¶å¯åŠ¨å¤§æ¨¡å‹ï¼Œä»¥åŠä½¿ç”¨æ–¹æ³•è®°å½•
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-05-06 18:18
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[å¤§æ¨¡å‹]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/deep_learning">Deep_learning</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            39 min
                            
                            18 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="llmå¯åŠ¨å¤§å…¨">LLMå¯åŠ¨å¤§å…¨</h2>
<p>å¤§æ¨¡å‹å‘å±•è‡³ä»Šï¼Œå·²ç»è¯ç”Ÿäº†å„ç§å„æ ·çš„éƒ¨ç½²æ¡†æ¶ä»¥åŠä½¿ç”¨æ–¹å¼ï¼Œä»–ä»¬é€šå¸¸é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ç°åœ¨é€šè¿‡è‡ªå·±äº†è§£çš„çŸ¥è¯†å¯¹å¤§æ¨¡å‹çš„å„ç§å¯åŠ¨æ–¹å¼åšä¸€ä¸ªæ€»ç»“ã€‚</p>
<h3 id="æ¨¡å‹ä¸‹è½½">æ¨¡å‹ä¸‹è½½</h3>
<p>é¦–å…ˆå¯åŠ¨å¤§æ¨¡å‹ï¼Œé¦–å…ˆéœ€è¦ä¸‹è½½ä¸€ä¸ªæ¨¡å‹ï¼Œæ¨¡å‹çš„ä¸‹è½½é¦–é€‰åœ°å€ä¸ºHFå®˜ç½‘æ¨¡å‹åº“ï¼šhttps://huggingface.co/models</p>
<p>å‡è®¾ä½ çš„ç½‘ç»œä¸èƒ½è¿›å…¥ä¸Šè¿°ç½‘å€ï¼Œå¯ä»¥è¿›å…¥é­”æ­ç¤¾åŒºä¸‹è½½ï¼Œå¤§éƒ¨åˆ†æ¨¡å‹éƒ½ä¼šåŒæ­¥åˆ°è¿™é‡Œï¼šhttps://www.modelscope.cn/models</p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨Qwen1.5ç³»åˆ—çš„æ¨¡å‹åšç¤ºä¾‹ï¼Œå…·ä½“çš„æ¨¡å‹å‹å·ä¸º<a href="https://www.modelscope.cn/models/qwen/Qwen1.5-4B-Chat/summary">Qwen1.5-4B-Chat</a>ã€‚</p>
<h3 id="æ¨¡å‹å¯åŠ¨">æ¨¡å‹å¯åŠ¨</h3>
<h4 id="åŸç”Ÿtransformersåº“å¯åŠ¨">åŸç”ŸTransformersåº“å¯åŠ¨</h4>
<p>ä½¿ç”¨æœ€åŸå§‹çš„Transformeræ¡†æ¶å¯åŠ¨ï¼Œéœ€è¦å†™ä¸€å°éƒ¨åˆ†ä»£ç ï¼Œå®˜æ–¹å·²ç»ä¸ºä½ å†™å¥½äº†Demoï¼Œåœ°å€åœ¨https://www.modelscope.cn/models/qwen/Qwen1.5-4B-Chat/summaryã€‚</p>
<p>ä¸ºäº†é€šç”¨æ€§ï¼Œæˆ‘å¯¹ä»£ç åšäº†ç•¥å¾®çš„ä¿®æ”¹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">transformers</span> <span style="color:#8b008b;font-weight:bold">import</span> AutoTokenizer, AutoModelForCausalLM, TextStreamer, TextIteratorStreamer
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">threading</span> <span style="color:#8b008b;font-weight:bold">import</span> Thread
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">os</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">.model_zoo</span> <span style="color:#8b008b;font-weight:bold">import</span> *
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">.utils</span> <span style="color:#8b008b;font-weight:bold">import</span> highlight_text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Qwen1_5</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self, modelName) -&gt; <span style="color:#8b008b;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æ£€æŸ¥æ˜¯å¦æ”¯æŒæ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> modelName <span style="color:#8b008b">in</span> llm_weight_zoo, <span style="color:#cd5555">&#34;modelName should be in </span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(llm_weight_zoo.keys())
</span></span><span style="display:flex;"><span>        modelWeightPath = llm_weight_zoo[modelName]
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æ£€æŸ¥æœ¬åœ°æ˜¯å¦ä¸‹è½½æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> os.path.exists(modelWeightPath), <span style="color:#cd5555">&#34;Model weight file: </span><span style="color:#cd5555">{}</span><span style="color:#cd5555"> &#34;</span>.format(modelWeightPath) + \
</span></span><span style="display:flex;"><span>                                                <span style="color:#cd5555">&#34;does not exist.</span><span style="color:#cd5555">\n</span><span style="color:#cd5555"> Please download </span><span style="color:#cd5555">{}</span><span style="color:#cd5555"> &#34;</span>.format(modelName) + \
</span></span><span style="display:flex;"><span>                                                <span style="color:#cd5555">&#34;model in &#34;</span> + \
</span></span><span style="display:flex;"><span>                                                highlight_text(<span style="color:#cd5555">&#34;&#39;</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#39;&#34;</span>.format(llm_model_url_zoo[modelName]))
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># åŠ è½½åˆ†è¯å™¨</span>
</span></span><span style="display:flex;"><span>        self.tokenizer = AutoTokenizer.from_pretrained(modelWeightPath, trust_remote_code=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># åŠ è½½æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        self.model =  AutoModelForCausalLM.from_pretrained(modelWeightPath, torch_dtype=<span style="color:#cd5555">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>                                                           device_map=<span style="color:#cd5555">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>                                                           trust_remote_code=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        self.device = torch.device(<span style="color:#cd5555">&#34;cuda&#34;</span> <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available() <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#cd5555">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>        self.model_name = modelName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_prompt</span>(self, user_message, system_message):
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> system_message == <span style="color:#cd5555">&#34;&#34;</span>:
</span></span><span style="display:flex;"><span>            system_message = <span style="color:#cd5555">&#34;You are a helpful assistant.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> user_message != <span style="color:#8b008b;font-weight:bold">None</span>, <span style="color:#cd5555">&#34;æˆ‘æ˜¯</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">å¤§æ¨¡å‹,ä½ å¿…é¡»è¾“å…¥æé—®é—®é¢˜&#34;</span>.format(self.model_name)
</span></span><span style="display:flex;"><span>        messages = [
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: system_message},
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: user_message}
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">chat</span>(self, messages, max_tokens=<span style="color:#b452cd">2048</span>, temperature=<span style="color:#b452cd">0.6</span>, top_p=<span style="color:#b452cd">0.9</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># è°ƒç”¨æ¨¡å‹è¿›è¡Œå¯¹è¯ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>        input_ids = self.tokenizer.apply_chat_template(messages, tokenize=<span style="color:#8b008b;font-weight:bold">False</span>, add_generation_prompt=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        model_inputs = self.tokenizer([input_ids], return_tensors=<span style="color:#cd5555">&#34;pt&#34;</span>).to(self.device)
</span></span><span style="display:flex;"><span>        generated_ids = self.model.generate(model_inputs.input_ids, max_new_tokens=max_tokens,
</span></span><span style="display:flex;"><span>                                            temperature=temperature,
</span></span><span style="display:flex;"><span>                                            top_p=top_p)
</span></span><span style="display:flex;"><span>        generated_ids = [
</span></span><span style="display:flex;"><span>            output_ids[<span style="color:#658b00">len</span>(input_ids):] <span style="color:#8b008b;font-weight:bold">for</span> input_ids, output_ids <span style="color:#8b008b">in</span> <span style="color:#658b00">zip</span>(model_inputs.input_ids, generated_ids)
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        response = self.tokenizer.batch_decode(generated_ids, skip_special_tokens=<span style="color:#8b008b;font-weight:bold">True</span>)[<span style="color:#b452cd">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">streamChat</span>(self, messages, max_tokens=<span style="color:#b452cd">2048</span>, temperature=<span style="color:#b452cd">0.6</span>, top_p=<span style="color:#b452cd">0.9</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æµå¼è¾“å‡ºå¯¹è¯</span>
</span></span><span style="display:flex;"><span>        input_ids = self.tokenizer.apply_chat_template(messages, tokenize=<span style="color:#8b008b;font-weight:bold">False</span>, add_generation_prompt=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        model_inputs = self.tokenizer([input_ids], return_tensors=<span style="color:#cd5555">&#34;pt&#34;</span>).to(self.device)
</span></span><span style="display:flex;"><span>        streamer = TextStreamer(self.tokenizer, skip_prompt=<span style="color:#8b008b;font-weight:bold">True</span>, skip_special_tokens=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        generated_ids = self.model.generate(model_inputs.input_ids, max_new_tokens=max_tokens,
</span></span><span style="display:flex;"><span>                                            temperature=temperature,
</span></span><span style="display:flex;"><span>                                            top_p=top_p, 
</span></span><span style="display:flex;"><span>                                            streamer=streamer)
</span></span><span style="display:flex;"><span>        generated_ids = [
</span></span><span style="display:flex;"><span>            output_ids[<span style="color:#658b00">len</span>(input_ids):] <span style="color:#8b008b;font-weight:bold">for</span> input_ids, output_ids <span style="color:#8b008b">in</span> <span style="color:#658b00">zip</span>(model_inputs.input_ids, generated_ids)
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        response = self.tokenizer.batch_decode(generated_ids, skip_special_tokens=<span style="color:#8b008b;font-weight:bold">True</span>)[<span style="color:#b452cd">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">streamIterChat</span>(self, messages, max_tokens=<span style="color:#b452cd">2048</span>, temperature=<span style="color:#b452cd">0.6</span>, top_p=<span style="color:#b452cd">0.9</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æµå¼è¾“å‡ºå¯¹è¯è¿­ä»£å™¨</span>
</span></span><span style="display:flex;"><span>        input_ids = self.tokenizer.apply_chat_template(messages, tokenize=<span style="color:#8b008b;font-weight:bold">False</span>, add_generation_prompt=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        model_inputs = self.tokenizer([input_ids], return_tensors=<span style="color:#cd5555">&#34;pt&#34;</span>).to(self.device)
</span></span><span style="display:flex;"><span>        streamer = TextIteratorStreamer(self.tokenizer, skip_prompt=<span style="color:#8b008b;font-weight:bold">True</span>, skip_special_tokens=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        generation_kwargs = <span style="color:#658b00">dict</span>(model_inputs, max_new_tokens=max_tokens,
</span></span><span style="display:flex;"><span>                                 temperature=temperature,
</span></span><span style="display:flex;"><span>                                 top_p=top_p, 
</span></span><span style="display:flex;"><span>                                 streamer=streamer)
</span></span><span style="display:flex;"><span>        thread = Thread(target=self.model.generate, kwargs=generation_kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        thread.start()
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">yield from</span> streamer
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­<code>model_zoo.py</code>ç”¨äºåšæ¨¡å‹åå­—å’Œæ¨¡å‹æ–‡ä»¶åœ°å€çš„æ˜ å°„ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦å®ä¾‹åŒ–Qwen1_5è¿™ä¸ªç±»ä¾¿ä¼šåœ¨æœ¬åœ°åŠ è½½å¤§æ¨¡å‹ï¼Œç„¶åè°ƒç”¨ä¸åŒçš„æ–¹æ³•è¿›è¡Œå¤§æ¨¡å‹é—®ç­”ã€‚</p>
<blockquote>
<p>æ¨¡å‹è°ƒç”¨ç»“æœç¤ºä¾‹</p>
</blockquote>
<p>ä½¿ç”¨Postmanè¿›è¡Œå¤–éƒ¨è°ƒç”¨ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;prompt&#34;</span>: <span style="color:#cd5555">&#34;ä½ å¥½,è¯·ç»™æˆ‘è®²ä¸€ä¸ªæ•…äº‹ï¼Œéšä¾¿ç¼–ä¸€ä¸ª&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;system_prompt&#34;</span>: <span style="color:#cd5555">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;response&#34;</span>: <span style="color:#cd5555">&#34;å¥½çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºå°çŒ«å’ªçš„æ•…äº‹ï¼š\n\nä»å‰æœ‰ä¸€åªå¯çˆ±çš„å°çŒ«å’ªï¼Œåå«å’ªå’ªã€‚å®ƒä½åœ¨ä¸€ä¸ªç¾ä¸½çš„èŠ±å›­é‡Œï¼Œæ¯å¤©éƒ½ä¼šåœ¨èŠ±å›­é‡Œç©è€å’Œæ¢ç´¢ã€‚\n\næœ‰ä¸€å¤©ï¼Œå’ªå’ªå‘ç°äº†ä¸€ä¸ªéšè—çš„æ´ç©´ã€‚è¿™ä¸ªæ´ç©´çœ‹èµ·æ¥éå¸¸ç¥ç§˜ï¼Œé‡Œé¢å……æ»¡äº†æœªçŸ¥çš„å†’é™©ã€‚äºæ˜¯ï¼Œå’ªå’ªå†³å®šè¦æ·±å…¥æ´ç©´æ¢é™©ã€‚\n\nå’ªå’ªèµ°è¿›æ´ç©´ï¼Œå‘ç°é‡Œé¢æœ‰è®¸å¤šæœ‰è¶£çš„ç”Ÿç‰©å’Œå¥‡å¦™çš„äº‹ç‰©ã€‚å®ƒé‡åˆ°äº†ä¸€äº›å‹å–„çš„å…”å­ï¼Œè¿˜æœ‰ä¸€äº›å‡¶çŒ›çš„é‡çŒ«ã€‚ä½†æ˜¯ï¼Œå’ªå’ªå¹¶æ²¡æœ‰è¢«å“åˆ°ï¼Œåè€Œæ›´åŠ å…´å¥‹åœ°æ¢ç´¢è¿™ä¸ªç¥ç§˜çš„ä¸–ç•Œã€‚\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå’ªå’ªè¿˜å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨å®ƒçš„çˆªå­æŒ–æ˜æ´ç©´ï¼Œå¦‚ä½•ç”¨é¼»å­å¯»æ‰¾é£Ÿç‰©ï¼Œç”šè‡³å¦‚ä½•åœ¨é»‘æš—ä¸­æ‰¾åˆ°å›å®¶çš„è·¯ã€‚å®ƒä¹Ÿç»“è¯†äº†ä¸€äº›æ–°çš„æœ‹å‹ï¼Œå¹¶ä¸”ä»ä¸­å­¦åˆ°äº†å¾ˆå¤šæ–°çŸ¥è¯†ã€‚\n\næœ€ç»ˆï¼Œå’ªå’ªæˆåŠŸåœ°å›åˆ°äº†å®¶ï¼Œå‘Šè¯‰äº†ä¸»äººå®ƒçš„å†’é™©ç»å†ã€‚è™½ç„¶å®ƒæœ‰äº›ç–²æƒ«ï¼Œä½†å®ƒéå¸¸å¼€å¿ƒï¼Œå› ä¸ºå®ƒçŸ¥é“å®ƒå·²ç»æˆé•¿äº†è®¸å¤šã€‚\n\nè¿™å°±æ˜¯å…³äºå’ªå’ªçš„ä¸€ä¸ªæ•…äº‹ï¼Œå¸Œæœ›ä½ å–œæ¬¢ï¼&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;status&#34;</span>: <span style="color:#b452cd">200</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµå¼æ¥å£è°ƒç”¨ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;prompt&#34;</span>: <span style="color:#cd5555">&#34;ä½ å¥½,è¯·ç»™æˆ‘è®²ä¸€ä¸ªæ•…äº‹ï¼Œéšä¾¿ç¼–ä¸€ä¸ª&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;system_prompt&#34;</span>: <span style="color:#cd5555">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨ç»“æœï¼š
<img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/LLM/img52.jpg" alt=""></p>
<h4 id="llamacppå¯åŠ¨">llama.cppå¯åŠ¨</h4>
<p><code>llama.cpp</code>æ˜¯ä¸€ä¸ªC++åº“ï¼Œç”¨äºç®€åŒ–LLMæ¨ç†çš„è®¾ç½®ã€‚è¯¥åº“æ˜¯ä¸€ä¸ªçº¯C/C++å®ç°ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨åº“ï¼Œå¹¶ä¸”é’ˆå¯¹x86æ¶æ„æä¾›äº†AVXã€AVX2å’ŒAVX512åŠ é€Ÿæ”¯æŒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†2ã€3ã€4ã€5ã€6ä»¥åŠ8ä½é‡åŒ–åŠŸèƒ½ï¼Œä»¥åŠ å¿«æ¨ç†é€Ÿåº¦å¹¶å‡å°‘å†…å­˜å ç”¨ã€‚å¯¹äºå¤§äºæ€»VRAMå®¹é‡çš„å¤§è§„æ¨¡æ¨¡å‹ï¼Œè¯¥åº“è¿˜æ”¯æŒCPU+GPUæ··åˆæ¨ç†æ¨¡å¼è¿›è¡Œéƒ¨åˆ†åŠ é€Ÿã€‚æœ¬è´¨ä¸Šï¼Œllama.cppçš„ç”¨é€”åœ¨äºè¿è¡ŒGGUFï¼ˆç”±GPTç”Ÿæˆçš„ç»Ÿä¸€æ ¼å¼ï¼‰æ¨¡å‹ã€‚llama.cppçš„å®˜æ–¹ä»“åº“åœ°å€å¦‚ä¸‹ï¼šhttps://github.com/ggerganov/llama.cppã€‚æˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨llama.cppè¿è¡ŒQwenã€‚</p>
<blockquote>
<p>å®‰è£…llama.cpp</p>
</blockquote>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/ggerganov/llama.cpp
</span></span><span style="display:flex;"><span><span style="color:#658b00">cd</span> llama.cpp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä¸‹è½½GGUFæ–‡ä»¶å¹¶å¯åŠ¨</p>
</blockquote>
<p>æ‰¾åˆ°<code>Qwen1.5-4B-Chat</code>å®˜æ–¹çš„GGUFæ–‡ä»¶ï¼šhttps://www.modelscope.cn/models/qwen/Qwen1.5-4B-Chat-GGUF/summaryï¼Œä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./main -m Qwen1.5-7B-Chat-GGUF -n <span style="color:#b452cd">512</span> --color -i -cml -f prompts/chat-with-qwen.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>-n</code>ä»£è¡¨è¦ç”Ÿæˆçš„æœ€å¤§tokenæ•°é‡ï¼Œå¦‚æœè¦æŸ¥çœ‹å¯åŠ¨å‘½ä»¤ä¸­çš„å…¶ä»–è¶…å‚æ•°ä»‹ç»ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./main -h 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ollamaå¯åŠ¨">Ollamaå¯åŠ¨</h4>
<p><code>Ollama</code>å¸®åŠ©æ‚¨é€šè¿‡å°‘é‡å‘½ä»¤å³å¯åœ¨æœ¬åœ°è¿è¡ŒLLMã€‚å®ƒé€‚ç”¨äºMacOSã€Linuxå’ŒWindowsæ“ä½œç³»ç»Ÿã€‚</p>
<blockquote>
<p>ä¸‹è½½Ollama</p>
</blockquote>
<p>Ollamaçš„å®˜æ–¹ä»“åº“ï¼šhttps://github.com/ollama/ollama
Ollamaå®˜ç½‘ï¼šhttps://ollama.com/</p>
<p>Ollamaçš„è¿è¡Œéå¸¸ç®€å•ï¼Œå¯¹äºWindowså’ŒMacOSï¼Œå…¶ä¸“é—¨åˆ¶ä½œäº†APPæ¥è¿è¡Œã€‚</p>
<p>Linuxç³»ç»Ÿå®‰è£…Ollamaï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://ollama.com/install.sh | sh
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿è¡ŒQwen1.5-4B-Chat</p>
</blockquote>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ollama run qwen:4b
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½¿ç”¨Ollamaæä¾›ä¸€ä¸ªAPIæœåŠ¡</p>
</blockquote>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ollama serve
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªåœ°å€æ¥è®¿é—®ï¼Œä¸€èˆ¬ä¸ºhttp://localhost:11434
å…·ä½“è¯¦ç»†ä½¿ç”¨ï¼šhttps://github.com/ollama/ollama/blob/main/docs/api.md</p>
<p>è¿™é‡Œå†™ä¸€ä¸‹ç½‘ä¸Šåˆ«äººä½¿ç”¨çš„è®°å½•ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:11434/api/generate -d <span style="color:#cd5555">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;model&#34;:&#34;llama3&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;prompt&#34;: &#34;è¯·åˆ†åˆ«ç¿»è¯‘æˆä¸­æ–‡ã€éŸ©æ–‡ã€æ—¥æ–‡ -&gt; Meta Llama 3: The most capable openly available LLM to date&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;stream&#34;: false
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–è¯¦ç»†çš„å‚æ•°è§£é‡Šï¼šhttps://ducafecat.medium.com/%E7%A7%81%E6%9C%89%E5%8C%96%E9%83%A8%E7%BD%B2-llama3-%E5%A4%A7%E6%A8%A1%E5%9E%8B-%E6%94%AF%E6%8C%81-api-%E8%AE%BF%E9%97%AE-9012e17d9400</p>
<p>è¿”å›jsonæ•°æ®:</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;llama3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;created_at&#34;</span>: <span style="color:#cd5555">&#34;2024-04-23T08:05:11.020314Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;response&#34;</span>: <span style="color:#cd5555">&#34;Here are the translations:\n\n**Chinese:** ã€ŠMeta Llama 3ã€‹ï¼šè¿„ä»Šæœ€å¼ºå¤§çš„å…¬å¼€å¯ç”¨çš„LLM\n\n**Korean:** ã€ŠMeta Llama 3ã€‹ï¼ší˜„ì¬ ê°€ì¥ ê°•ë ¥í•œ ê³µê°œ ì‚¬ìš© ê°€ëŠ¥í•œ LLM\n\n**Japanese:**\n\nã€ŠMeta Llama 3ã€‹ï¼šç¾åœ¨æœ€å¼·ã®å…¬é–‹ä½¿ç”¨å¯èƒ½ãªLLM\n\n\n\nNote: (Meta Llama 3) is a literal translation, as there is no direct equivalent for \&#34;Meta\&#34; in Japanese. In Japan, it&#39;s common to use the English term \&#34;\&#34; or \&#34;\&#34; when referring to Meta.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;done&#34;</span>: <span style="color:#8b008b;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;context&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#a61717;background-color:#e3d2d2">...</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;total_duration&#34;</span>: <span style="color:#b452cd">30786629492</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;load_duration&#34;</span>: <span style="color:#b452cd">3000782</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;prompt_eval_count&#34;</span>: <span style="color:#b452cd">32</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;prompt_eval_duration&#34;</span>: <span style="color:#b452cd">6142245000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;eval_count&#34;</span>: <span style="color:#b452cd">122</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;eval_duration&#34;</span>: <span style="color:#b452cd">24639975000</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="vllmå¯åŠ¨">vLLMå¯åŠ¨</h4>
<p>vLLMä¼˜åŒ–äº†å†…å­˜çš„åˆ†é…å’Œæ¬è¿ï¼Œå®ƒæ˜“äºä½¿ç”¨ï¼Œä¸”å…·æœ‰æœ€å…ˆè¿›çš„æœåŠ¡ååé‡ã€é«˜æ•ˆçš„æ³¨æ„åŠ›é”®å€¼å†…å­˜ç®¡ç†ï¼ˆé€šè¿‡PagedAttentionå®ç°ï¼‰ã€è¿ç»­æ‰¹å¤„ç†è¾“å…¥è¯·æ±‚ã€ä¼˜åŒ–çš„CUDAå†…æ ¸ç­‰åŠŸèƒ½ã€‚è¦äº†è§£æ›´å¤šå…³äºvLLMçš„ä¿¡æ¯ã€‚</p>
<p>æ–‡æ¡£ï¼šhttps://vllm.readthedocs.io/</p>
<blockquote>
<p>vLLMç¯å¢ƒä¾èµ–</p>
</blockquote>
<p>vLLMå¯¹ç¯å¢ƒåŠGPUå¡è¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œæ”¯æŒ<code>CUDA118+Pytroch212</code>å’Œ<code>CUDA121+Pytorch212</code>ã€‚
å‰è€…éœ€è¦ä¸‹è½½ä¸“é—¨çš„pipåŒ…ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#228b22"># Install vLLM with CUDA 11.8.</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">export</span> <span style="color:#00688b">VLLM_VERSION</span>=0.4.0
</span></span><span style="display:flex;"><span><span style="color:#658b00">export</span> <span style="color:#00688b">PYTHON_VERSION</span>=<span style="color:#b452cd">39</span>
</span></span><span style="display:flex;"><span>pip install https://github.com/vllm-project/vllm/releases/download/v<span style="color:#cd5555">${</span><span style="color:#00688b">VLLM_VERSION</span><span style="color:#cd5555">}</span>/vllm-<span style="color:#cd5555">${</span><span style="color:#00688b">VLLM_VERSION</span><span style="color:#cd5555">}</span>+cu118-cp<span style="color:#cd5555">${</span><span style="color:#00688b">PYTHON_VERSION</span><span style="color:#cd5555">}</span>-cp<span style="color:#cd5555">${</span><span style="color:#00688b">PYTHON_VERSION</span><span style="color:#cd5555">}</span>-manylinux1_x86_64.whl --extra-index-url https://download.pytorch.org/whl/cu118
</span></span></code></pre></td></tr></table>
</div>
</div><p>åè€…åˆ™ç›´æ¥ä¸‹è½½vllmå³å¯ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install vllm
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å‰åœ¨æœåŠ¡å™¨ä¸Šèƒ½å¤ŸæˆåŠŸçš„Dockerç¯å¢ƒç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#cd5555"> nvidia/cuda:12.1.0-cudnn8-devel-ubuntu22.04</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># è®¾ç½®ç¯å¢ƒå˜é‡ éäº¤äº’å¼</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">ENV</span> <span style="color:#00688b">DEBIAN_FRONTEND</span>=noninteractive
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æŒ‡å®šå·¥ä½œç›®å½•</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">WORKDIR</span><span style="color:#cd5555"> /model_infer</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># æ›¿æ¢ä¸ºé˜¿é‡Œäº‘çš„ Ubuntu æº</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> sed -i <span style="color:#cd5555">&#39;s/archive.ubuntu.com/mirrors.aliyun.com/g&#39;</span> /etc/apt/sources.list<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> sed -i <span style="color:#cd5555">&#39;s/security.ubuntu.com/mirrors.aliyun.com/g&#39;</span> /etc/apt/sources.list<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># æ›´æ–°å…¶ä»–å¿…éœ€çš„åŒ…</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> apt-get update &amp;&amp; apt-get install -y <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    zlib1g-dev <span style="color:#cd5555">\ </span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span>    libbz2-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libssl-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libncurses5-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libsqlite3-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libreadline-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    tk-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libgdbm-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libdb-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libpcap-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    xz-utils <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libexpat1-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    liblzma-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libffi-dev <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    libc6-dev<span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    wget <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    vim <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    curl<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># æŒ‡å®šå®¹å™¨ä½ç½®å’Œæ—¶åŒº</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#34;Asia/Shanghai&#34;</span> &gt; /etc/timezone<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># å®‰è£…Python3.10</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> <span style="color:#658b00">cd</span> /usr/local &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    wget https://mirrors.huaweicloud.com/python/3.10.0/Python-3.10.0.tgz &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    chmod +x Python-3.10.0.tgz &amp;&amp; tar -xvf Python-3.10.0.tgz &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    rm -rf Python-3.10.0.tgz &amp;&amp; <span style="color:#658b00">cd</span> Python-3.10.0 &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    ./configure --prefix=/usr/local/python3 --enable-optimizations &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    make &amp;&amp; make install &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    rm -rf Python-3.10.0 &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    ln -s /usr/local/python3/bin/python3.10 /usr/bin/python3 &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># æ›¿æ¢ä¸ºæ¸…åå¤§å­¦ pip æº</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> mkdir -p /root/.pip <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    &amp;&amp; <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#34;[global]&#34;</span> &gt; /root/.pip/pip.conf <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    &amp;&amp; <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#34;index-url = https://pypi.tuna.tsinghua.edu.cn/simple&#34;</span> &gt;&gt; /root/.pip/pip.conf <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    &amp;&amp; <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#34;trusted-host = pypi.tuna.tsinghua.edu.cn&#34;</span> &gt;&gt; /root/.pip/pip.conf<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># å®‰è£…Pytorch</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> python3 -m pip install --upgrade pip &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    pip3 install <span style="color:#00688b">torch</span>==2.1.2 <span style="color:#00688b">torchvision</span>==0.16.2 <span style="color:#00688b">torchaudio</span>==2.1.2 --index-url https://mirror.sjtu.edu.cn/pytorch-wheels/cu121<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># å®‰è£…ç›¸å…³çš„åŒ…</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> pip3 install transformers fastapi sse_starlette vllm accelerate openai<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># æ¸…é™¤ pip ç¼“å­˜</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> rm -rf /root/.cache/pip/*<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#228b22"># è®¾ç½®å®¹å™¨çš„ç¼–ç ä¸ºUTF-8</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#8b008b;font-weight:bold">RUN</span> <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#39;LANG=en_US.UTF-8&#39;</span> &gt; /etc/locale.conf &amp;&amp; <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    <span style="color:#658b00">echo</span> <span style="color:#cd5555">&#39;LC_ALL=en_US.UTF-8&#39;</span> &gt;&gt; /etc/locale.conf<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æœ¬åœ°åŠ è½½æ¨¡å‹å¯åŠ¨vLLM</p>
</blockquote>
<p>vLLMå’ŒTransformerå¯åŠ¨æ¨¡å‹çš„ä»£ç ç•¥æœ‰ä¸åŒã€‚</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">transformers</span> <span style="color:#8b008b;font-weight:bold">import</span> AutoTokenizer
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">vllm</span> <span style="color:#8b008b;font-weight:bold">import</span> LLM, SamplingParams
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">threading</span> <span style="color:#8b008b;font-weight:bold">import</span> Thread
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">os</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">.model_zoo</span> <span style="color:#8b008b;font-weight:bold">import</span> *
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">.utils</span> <span style="color:#8b008b;font-weight:bold">import</span> highlight_text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">vllmQwen1_5</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> __init__(self, modelName) -&gt; <span style="color:#8b008b;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æ£€æŸ¥æ˜¯å¦æ”¯æŒæ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> modelName <span style="color:#8b008b">in</span> llm_weight_zoo, <span style="color:#cd5555">&#34;modelName should be in </span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#34;</span>.format(llm_weight_zoo.keys())
</span></span><span style="display:flex;"><span>        modelWeightPath = llm_weight_zoo[modelName]
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># æ£€æŸ¥æœ¬åœ°æ˜¯å¦ä¸‹è½½æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> os.path.exists(modelWeightPath), <span style="color:#cd5555">&#34;Model weight file: </span><span style="color:#cd5555">{}</span><span style="color:#cd5555"> &#34;</span>.format(modelWeightPath) + \
</span></span><span style="display:flex;"><span>                                                <span style="color:#cd5555">&#34;does not exist.</span><span style="color:#cd5555">\n</span><span style="color:#cd5555"> Please download </span><span style="color:#cd5555">{}</span><span style="color:#cd5555"> &#34;</span>.format(modelName) + \
</span></span><span style="display:flex;"><span>                                                <span style="color:#cd5555">&#34;model in &#34;</span> + \
</span></span><span style="display:flex;"><span>                                                highlight_text(<span style="color:#cd5555">&#34;&#39;</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">&#39;&#34;</span>.format(llm_model_url_zoo[modelName]))
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># åŠ è½½åˆ†è¯å™¨</span>
</span></span><span style="display:flex;"><span>        self.tokenizer = AutoTokenizer.from_pretrained(modelWeightPath)
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># åŠ è½½æ¨¡å‹ Tesla T4éœ€è¦ä½¿ç”¨float16 tokenizer=Noneä¼šé»˜è®¤ä½¿ç”¨é…å¥—çš„æ ‡è®°å™¨</span>
</span></span><span style="display:flex;"><span>        self.model = LLM(model=modelWeightPath, tokenizer=<span style="color:#8b008b;font-weight:bold">None</span>, 
</span></span><span style="display:flex;"><span>                         dtype=<span style="color:#cd5555">&#34;auto&#34;</span>, trust_remote_code=<span style="color:#8b008b;font-weight:bold">True</span>,
</span></span><span style="display:flex;"><span>                         max_model_len=<span style="color:#b452cd">2048</span>)
</span></span><span style="display:flex;"><span>        self.device = torch.device(<span style="color:#cd5555">&#34;cuda&#34;</span> <span style="color:#8b008b;font-weight:bold">if</span> torch.cuda.is_available() <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#cd5555">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>        self.model_name = modelName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">get_prompt</span>(self, user_message, system_message):
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> system_message == <span style="color:#cd5555">&#34;&#34;</span>:
</span></span><span style="display:flex;"><span>            system_message = <span style="color:#cd5555">&#34;You are a helpful assistant.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">assert</span> user_message != <span style="color:#8b008b;font-weight:bold">None</span>, <span style="color:#cd5555">&#34;æˆ‘æ˜¯</span><span style="color:#cd5555">{}</span><span style="color:#cd5555">å¤§æ¨¡å‹,ä½ å¿…é¡»è¾“å…¥æé—®é—®é¢˜&#34;</span>.format(self.model_name)
</span></span><span style="display:flex;"><span>        messages = [
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: system_message},
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: user_message}
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">chat</span>(self, messages, max_tokens=<span style="color:#b452cd">2048</span>, temperature=<span style="color:#b452cd">0.9</span>, top_p=<span style="color:#b452cd">0.8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#228b22"># è°ƒç”¨æ¨¡å‹è¿›è¡Œå¯¹è¯ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>        sampling_params = SamplingParams(temperature=temperature, top_p=top_p, max_tokens=max_tokens)
</span></span><span style="display:flex;"><span>        input_ids = self.tokenizer.apply_chat_template(messages, tokenize=<span style="color:#8b008b;font-weight:bold">False</span>, add_generation_prompt=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        output = self.model.generate([input_ids], sampling_params)[<span style="color:#b452cd">0</span>]
</span></span><span style="display:flex;"><span>        response = output.outputs[<span style="color:#b452cd">0</span>].text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> response
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå¹¶æ²¡æœ‰å®ç°æµå¼æ¥å£ï¼Œå¯¹äºæ¨¡å‹å¯åŠ¨çš„å‚æ•°è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.vllm.ai/en/latest/models/engine_args.html</p>
<blockquote>
<p>æœ¬åœ°å¯åŠ¨æ¨¡å‹åŠ è½½openai APIæœåŠ¡</p>
</blockquote>
<p>ä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼ŒvLLMåŒ…å†…éƒ¨å·²ç»å†™å¥½äº†è°ƒç”¨apiçš„æœåŠ¡ï¼Œå®ƒçš„æ¥å£å½¢å¼ä¸OpenAIçš„æ¥å£æ ¼å¼æ˜¯ç›¸åŒçš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æœ¬åœ°ç§åŸŸå¤§æ¨¡å‹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è°ƒç”¨OpenAIæ¥å£çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œæ›´å®¹æ˜“é›†æˆã€‚</p>
<p>å¯åŠ¨apiï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#00688b">CUDA_VISIBLE_DEVICES</span>=<span style="color:#b452cd">0</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>python3 -m vllm.entrypoints.openai.api_server <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--model ./data/model_zoo/llm_weight/qwen1.5-4b-chat <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--served-model-name qwen1.5-4b-chat <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--host 0.0.0.0 <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--port <span style="color:#b452cd">10005</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--max-model-len <span style="color:#b452cd">2048</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--dtype half <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--max-num-seqs <span style="color:#b452cd">256</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--gpu-memory-utilization 0.9 <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--lora-dtype=<span style="color:#cd5555">&#34;auto&#34;</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>--trust-remote-code
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ<code>dtype</code>å‚æ•°è®¾ç½®ä¸ºäº†<code>half</code>ï¼Œæ˜¯å› ä¸ºTesla T4 GPUä¸æ”¯æŒBfloat16çš„æ•°æ®æ ¼å¼ã€‚æ›´å¤šçš„å‚æ•°è®¾ç½®åŒæ ·å¯ä»¥çœ‹æ¨¡å‹å¯åŠ¨çš„å‚æ•°è®¾ç½®ï¼Œä¸ä»£ç ä¸­çš„å‚æ•°è®¾ç½®æ˜¯ç›¸åŒçš„ï¼šhttps://docs.vllm.ai/en/latest/models/engine_args.html</p>
<blockquote>
<p>æœåŠ¡è°ƒç”¨ç»“æœç¤ºä¾‹</p>
</blockquote>
<p>éæµå¼è°ƒç”¨ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;messages&#34;</span>: [
</span></span><span style="display:flex;"><span>        {<span style="color:#8b008b;font-weight:bold">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#8b008b;font-weight:bold">&#34;content&#34;</span>: <span style="color:#cd5555">&#34;You are a helpful assistant.&#34;</span>},
</span></span><span style="display:flex;"><span>        {<span style="color:#8b008b;font-weight:bold">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#8b008b;font-weight:bold">&#34;content&#34;</span>: <span style="color:#cd5555">&#34;ä½ å¥½,è¯·ç»™æˆ‘è®²ä¸€ä¸ªçš„æ•…äº‹&#34;</span>}
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;temperature&#34;</span>: <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;id&#34;</span>: <span style="color:#cd5555">&#34;cmpl-6a53f4f0464c4088a55342a842927c64&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;object&#34;</span>: <span style="color:#cd5555">&#34;chat.completion&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;created&#34;</span>: <span style="color:#b452cd">1715152496</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;choices&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;index&#34;</span>: <span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;message&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;assistant&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">&#34;content&#34;</span>: <span style="color:#cd5555">&#34;å¥½çš„ï¼Œæˆ‘æ¥ç»™ä½ è®²ä¸€ä¸ªæ•…äº‹ã€‚ä»å‰ï¼Œæœ‰ä¸€ä¸ªå°æ‘åº„ï¼Œæ‘åº„é‡Œçš„äººä»¬è¿‡ç€å¹³é™çš„ç”Ÿæ´»ã€‚æœ‰ä¸€å¤©ï¼Œæ‘åº„é‡Œæ¥äº†ä¸€ä½ç¥ç§˜çš„è€äººï¼Œä»–å‘Šè¯‰æ‘æ°‘ä»¬ï¼Œæ‘åº„çš„æ°´æºå°†ä¼šè¢«æ±¡æŸ“ï¼Œåªæœ‰æ‰¾åˆ°ä¸€ç§ç¥å¥‡çš„è‰è¯ï¼Œæ‰èƒ½æ‹¯æ•‘æ‘åº„ã€‚æ‘æ°‘ä»¬å¼€å§‹å¯»æ‰¾è¿™ç§è‰è¯ï¼Œæœ€åï¼Œä»–ä»¬æ‰¾åˆ°äº†ä¸€ç§å«åšâ€œç”Ÿå‘½ä¹‹è‰â€çš„è‰è¯ï¼Œç”¨å®ƒå‡€åŒ–äº†æ°´æºï¼Œæ‘åº„æ¢å¤äº†å¹³é™ã€‚&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;logprobs&#34;</span>: <span style="color:#8b008b;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;finish_reason&#34;</span>: <span style="color:#cd5555">&#34;stop&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;stop_reason&#34;</span>: <span style="color:#8b008b;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;usage&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;prompt_tokens&#34;</span>: <span style="color:#b452cd">26</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;total_tokens&#34;</span>: <span style="color:#b452cd">117</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;completion_tokens&#34;</span>: <span style="color:#b452cd">91</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµå¼è°ƒç”¨ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;messages&#34;</span>: [
</span></span><span style="display:flex;"><span>        {<span style="color:#8b008b;font-weight:bold">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#8b008b;font-weight:bold">&#34;content&#34;</span>: <span style="color:#cd5555">&#34;You are a helpful assistant.&#34;</span>},
</span></span><span style="display:flex;"><span>        {<span style="color:#8b008b;font-weight:bold">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#8b008b;font-weight:bold">&#34;content&#34;</span>: <span style="color:#cd5555">&#34;ä½ å¥½,è¯·ç»™æˆ‘è®²ä¸€ä¸ªçš„æ•…äº‹&#34;</span>}
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;temperature&#34;</span>: <span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;stream&#34;</span>: <span style="color:#8b008b;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨ç»“æœï¼š
<img src="https://blog-1311257248.cos.ap-nanjing.myqcloud.com/imgs/LLM/img53.jpg" alt=""></p>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Pythonè„šæœ¬æ¥è°ƒç”¨OpenAIçš„æ¥å£ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>headers = {
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Content-Type&#34;</span>: <span style="color:#cd5555">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">post</span>(url, json, headers):
</span></span><span style="display:flex;"><span>    response = requests.post(url, json=json, headers=headers)
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">def</span> <span style="color:#008b45">streamPost</span>(url, json, headers):
</span></span><span style="display:flex;"><span>    response = requests.post(url, json=json, headers=headers, stream=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">if</span> __name__ == <span style="color:#cd5555">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    ip = <span style="color:#cd5555">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>    port = <span style="color:#b452cd">10005</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sys_prompt = <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    prompt = <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    è¯·ç»™æˆ‘è®²ä¸€ä¸ªæ•…äº‹
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    body = {
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;messages&#34;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: sys_prompt},
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: prompt}
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;temperature&#34;</span>: <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    stream_body = {
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;model&#34;</span>: <span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;messages&#34;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: sys_prompt},
</span></span><span style="display:flex;"><span>            {<span style="color:#cd5555">&#34;role&#34;</span>: <span style="color:#cd5555">&#34;user&#34;</span>, <span style="color:#cd5555">&#34;content&#34;</span>: prompt}
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;temperature&#34;</span>: <span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#cd5555">&#34;stream&#34;</span>: <span style="color:#8b008b;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    url = <span style="color:#cd5555">f</span><span style="color:#cd5555">&#34;http://</span><span style="color:#cd5555">{</span>ip<span style="color:#cd5555">}</span><span style="color:#cd5555">:</span><span style="color:#cd5555">{</span>port<span style="color:#cd5555">}</span><span style="color:#cd5555">/v1/chat/completions&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># å‘é€ POST è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>    response = post(url, json=body, headers=headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># è§£æå“åº”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> response.status_code == <span style="color:#b452cd">200</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;Return:&#34;</span>, response.text)
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;Error:&#34;</span>, response.text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22"># å‘é€stream Post è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>    response = streamPost(url, json=stream_body, headers=headers)
</span></span><span style="display:flex;"><span>    full_text = <span style="color:#cd5555">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> line <span style="color:#8b008b">in</span> response.iter_lines():
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> line:
</span></span><span style="display:flex;"><span>            line_str = line.decode(<span style="color:#cd5555">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">print</span>(line_str)
</span></span><span style="display:flex;"><span>            data = json.loads(line_str.split(<span style="color:#cd5555">&#34;: &#34;</span>, <span style="color:#b452cd">1</span>)[<span style="color:#b452cd">1</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> data[<span style="color:#cd5555">&#34;choices&#34;</span>][<span style="color:#b452cd">0</span>][<span style="color:#cd5555">&#34;finish_reason&#34;</span>] != <span style="color:#cd5555">&#34;stop&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">if</span> data[<span style="color:#cd5555">&#34;choices&#34;</span>][<span style="color:#b452cd">0</span>][<span style="color:#cd5555">&#34;delta&#34;</span>].get(<span style="color:#cd5555">&#34;content&#34;</span>) <span style="color:#8b008b">is</span> <span style="color:#8b008b">not</span> <span style="color:#8b008b;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>                    full_text += data[<span style="color:#cd5555">&#34;choices&#34;</span>][<span style="color:#b452cd">0</span>][<span style="color:#cd5555">&#34;delta&#34;</span>][<span style="color:#cd5555">&#34;content&#34;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#8b008b;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(<span style="color:#cd5555">&#34;å¤§æ¨¡å‹å®Œæ•´å›ç­”ï¼š</span><span style="color:#cd5555">\n</span><span style="color:#cd5555">&#34;</span>, full_text)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="skypilotéƒ¨ç½²">SkyPilotéƒ¨ç½²</h4>
<p><code>SkyPilot</code>æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ä»»ä½•äº‘ä¸Šè¿è¡ŒLLMã€AIåº”ç”¨ä»¥åŠæ‰¹é‡ä»»åŠ¡çš„æ¡†æ¶ï¼Œæ—¨åœ¨å®ç°æœ€å¤§ç¨‹åº¦çš„æˆæœ¬èŠ‚çœã€æœ€é«˜çš„GPUå¯ç”¨æ€§ä»¥åŠå—ç®¡ç†çš„æ‰§è¡Œè¿‡ç¨‹ã€‚å…¶ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>é€šè¿‡è·¨åŒºåŸŸå’Œè·¨äº‘å……åˆ†åˆ©ç”¨å¤šä¸ªèµ„æºæ± ï¼Œä»¥è·å¾—æœ€ä½³çš„GPUå¯ç”¨æ€§ã€‚</p>
</li>
<li>
<p>æŠŠè´¹ç”¨é™åˆ°æœ€ä½â€”â€” SkyPilotåœ¨å„åŒºåŸŸå’Œäº‘å¹³å°ä¸­ä¸ºæ‚¨æŒ‘é€‰æœ€ä¾¿å®œçš„èµ„æºã€‚æ— éœ€ä»»ä½•æ‰˜ç®¡è§£å†³æ–¹æ¡ˆçš„é¢å¤–åŠ ä»·ã€‚</p>
</li>
<li>
<p>å°†æœåŠ¡æ‰©å±•åˆ°å¤šä¸ªå‰¯æœ¬ä¸Šï¼Œæ‰€æœ‰å‰¯æœ¬é€šè¿‡å•ä¸€endpointå¯¹å¤–æä¾›æœåŠ¡</p>
</li>
<li>
<p>æ‰€æœ‰å†…å®¹å‡ä¿å­˜åœ¨æ‚¨çš„äº‘è´¦æˆ·ä¸­ï¼ˆåŒ…æ‹¬æ‚¨çš„è™šæ‹Ÿæœºå’Œbucketï¼‰</p>
</li>
<li>
<p>å®Œå…¨ç§å¯† - æ²¡æœ‰å…¶ä»–äººèƒ½çœ‹åˆ°æ‚¨çš„èŠå¤©è®°å½•</p>
</li>
</ul>
<blockquote>
<p>å®‰è£…SkyPilot</p>
</blockquote>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install <span style="color:#cd5555">&#34;skypilot-nightly[aws,gcp]&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ£€æŸ¥æ˜¯å¦å¯ç”¨</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sky check
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ ä¹Ÿå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://skypilot.readthedocs.io/en/latest/getting-started/installation.html</p>
<blockquote>
<p>è¿è¡ŒQwen1.5-72B-Chat</p>
</blockquote>
<ol>
<li>å¯ä»¥ä½¿ç”¨ serve-72b.yaml ä¸­çš„å¯ç”¨çš„ GPU æ¥åœ¨å•ä¸ªå®ä¾‹ä¸Šéƒ¨ç½² Qwen1.5-72B-Chatçš„åŸºäºvLLMçš„é€‚é…OpenAI APIçš„æœåŠ¡</li>
</ol>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sky launch -c qwen serve-72b.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘è¯¥endpointå‘é€<code>ç»­å†™</code>è¯·æ±‚ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#00688b">IP</span>=<span style="color:#8b008b;font-weight:bold">$(</span>sky status --ip qwen<span style="color:#8b008b;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -L http://<span style="color:#00688b">$IP</span>:8000/v1/completions <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    -H <span style="color:#cd5555">&#34;Content-Type: application/json&#34;</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    -d <span style="color:#cd5555">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;model&#34;: &#34;Qwen/Qwen1.5-72B-Chat&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;prompt&#34;: &#34;My favorite food is&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;max_tokens&#34;: 512
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">  }&#39;</span> | jq -r <span style="color:#cd5555">&#39;.choices[0].text&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘è¯¥endpointå‘é€<code>chat</code>è¯·æ±‚</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -L http://<span style="color:#00688b">$IP</span>:8000/v1/chat/completions <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    -H <span style="color:#cd5555">&#34;Content-Type: application/json&#34;</span> <span style="color:#cd5555">\
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span>    -d <span style="color:#cd5555">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;model&#34;: &#34;Qwen/Qwen1.5-72B-Chat&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;messages&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">        {
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">          &#34;role&#34;: &#34;system&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">          &#34;content&#34;: &#34;You are a helpful and honest chat expert.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">        },
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">        {
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">          &#34;role&#34;: &#34;user&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">          &#34;content&#34;: &#34;What is the best food?&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">        }
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      ],
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">      &#34;max_tokens&#34;: 512
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">  }&#39;</span> | jq -r <span style="color:#cd5555">&#39;.choices[0].message.content&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬ä¸‰æ–¹llmæ¡†æ¶æ¥å…¥">ç¬¬ä¸‰æ–¹LLMæ¡†æ¶æ¥å…¥</h3>
<p>ç›®å‰ä½¿ç”¨å¤§æ¨¡å‹åšåº”ç”¨çš„æˆç†Ÿæ¡†æ¶æœ‰ä¸¤æ¬¾ï¼š<code>LangChain</code>ä»¥åŠ<code>llama_index</code>ã€‚</p>
<p><code>LangChain</code>ç›¸å¯¹ä½¿ç”¨æ›´ä¸ºå¹¿æ³›ï¼Œä»£ç æ›´æ–°é¢‘ç‡ç›¸å¯¹è¾ƒæ…¢ï¼ŒåŠŸèƒ½èŒƒå›´æ›´å¹¿æ³›ã€‚
<code>llama_index</code>ä½¿ç”¨å¹¶æ²¡æœ‰é‚£ä¹ˆå¹¿æ³›ï¼Œä»£ç æ›´æ–°é¢‘ç‡å¾ˆå¿«ï¼Œæ”¯æŒçš„ä¸œè¥¿æ›´ç»†è‡´ï¼Œé›†æˆåº¦æ›´é«˜ï¼Œå…¶æœ¬èº«ä¹Ÿå…¼å®¹äº†<code>LangChain</code>çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œæ–‡æ¡£æ›´åŠ ç»†è‡´ã€‚</p>
<p>LangChainå®˜æ–¹æ–‡æ¡£ï¼šhttps://python.langchain.com/docs/get_started/introduction
llama_indexå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.llamaindex.ai/en/stable</p>
<h4 id="langchain-llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹">LangChain, llama_indexæœ¬åœ°å¯åŠ¨æ¨¡å‹</h4>
<p><code>LangChain</code>å’Œ<code>llama_index</code>éƒ½æ”¯æŒæœ¬åœ°åŠ è½½æ¨¡å‹åšå¯¹åº”çš„åº”ç”¨ã€‚å…¶ä¹Ÿæ”¯æŒä¸åŒçš„å¯åŠ¨æ¡†æ¶ï¼ŒåŒ…æ‹¬<code>åŸç”ŸTransformers</code>ï¼Œ<code>llama.cpp</code>ï¼Œ<code>Ollama</code>ä»¥åŠ<code>vLLM</code>ç­‰ã€‚</p>
<p>å…·ä½“å®ç°è¯·æŸ¥çœ‹å…¶å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h4 id="langchain-llama_indexè°ƒç”¨æœ¬åœ°openaiæ¥å£æœåŠ¡">Langchain, llama_indexè°ƒç”¨æœ¬åœ°OpenAIæ¥å£æœåŠ¡</h4>
<p>ç”±äºGPUèµ„æºæœ‰é™ï¼Œå¯¹äºå¤§æ¨¡å‹æœåŠ¡é€šå¸¸ä¼šä½¿ç”¨å¹¶å‘æ¡†æ¶<code>vLLM</code>å•ç‹¬å°è£…å¯åŠ¨OpenAIæ ¼å¼çš„æ¥å£ï¼Œä¸Šå±‚åº”ç”¨è°ƒç”¨ä¸‹å±‚æš´éœ²çš„æ¥å£ã€‚</p>
<blockquote>
<p>LangChainè°ƒç”¨</p>
</blockquote>
<p>ä½¿ç”¨<code>ChatOpenAI</code>å‡½æ•°ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain.prompts</span> <span style="color:#8b008b;font-weight:bold">import</span> PromptTemplate
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_openai</span> <span style="color:#8b008b;font-weight:bold">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_community.llms</span> <span style="color:#8b008b;font-weight:bold">import</span> VLLMOpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>template = <span style="color:#cd5555">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">ä½ æ˜¯ä¸€åNLPç®—æ³•å·¥ç¨‹å¸ˆï¼Œç°åœ¨ä½ éœ€è¦æ‰§è¡Œä¸€ä¸ªä¿¡æ¯æ¦‚è¿°çš„ä»»åŠ¡ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„äº§å“ç›¸å…³ä¿¡æ¯ï¼Œæ€»ç»“ç”Ÿæˆä¸€æ®µè¯¥äº§å“çš„ä»‹ç»æ€§è¯æœ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">ä¸ºäº†å¾—åˆ°ç¬¦åˆè¦æ±‚çš„ç­”æ¡ˆï¼Œè¯·æŒ‰ç…§ä¸‹é¢çš„è¿‡ç¨‹ï¼Œä¸€æ­¥æ­¥æ€è€ƒå¹¶å¾—å‡ºå›ç­”ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">1ã€è§‚å¯Ÿä»¥ä¸‹è¯æœ¯æ ·ä¾‹ï¼Œå­¦ä¹ äº§å“ä»‹ç»æ€§è¯æœ¯çš„æè¿°æ–¹å¼ï¼š[å’Œå¯¹è®²æ˜¯èåˆé›†ç¾¤è°ƒåº¦å’Œè§†é¢‘èƒ½åŠ›çš„å…¬ç½‘å¯¹è®²äº§å“ï¼Œä¾æ‰˜äºä¸­å›½ç§»åŠ¨é€šä¿¡ç½‘ç»œé¢å‘ç”¨æˆ·æä¾›æ— è·ç¦»é™åˆ¶ã€å®‰å…¨å¯é ã€ä½æ—¶å»¶çš„è¶…é«˜æ¸…è§†é¢‘å¯¹è®²æœåŠ¡å…·å¤‡çµæ´»ç»„ç»‡æ¶æ„ç®¡ç†ã€åœ°å›¾å¯è§†åŒ–è°ƒåº¦ã€è½¯ç¡¬ç»ˆç«¯äº’é€šã€æ•°æ®äº‘åŒ–å¤‡ä»½ç­‰ä¼˜åŠ¿å¯æ ¹æ®å®¢æˆ·éœ€æ±‚è¿›è¡Œå…¥é©»å¼å’Œå®šåˆ¶åŒ–å¼€å‘ï¼Œä¸ºè¡Œä¸šç”¨æˆ·æä¾›å…¨æ–¹ä½ç»¼åˆè°ƒåº¦ç®¡ç†ç³»ç»Ÿã€‚]ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">2ã€ä½ ä¼šæ‹¿åˆ°äº§å“åç§°ã€äº§å“ç®€ä»‹ã€äº§å“åº”ç”¨åœºæ™¯ã€äº§å“åŠŸèƒ½ã€äº§å“ä¼˜åŠ¿ä¿¡æ¯è¿™å…­ä¸ªå­—æ®µä¿¡æ¯ï¼Œä½ éœ€è¦é€å­—é€å¥çš„é˜…è¯»è¿‡å»ï¼Œäº†è§£è¯¥äº§å“çš„å…¨è²Œä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">3ã€ä»¿é€ ç¬¬1æ­¥çš„è¯æœ¯æè¿°æ–¹å¼ï¼Œç»“åˆä½ æ‹¿åˆ°çš„äº§å“ä¿¡æ¯ï¼Œç”¨ä½ è‡ªå·±çš„è¯­è¨€ç”Ÿæˆä¸€æ®µé’ˆå¯¹è¯¥äº§å“çš„ä»‹ç»æ€§è¯æœ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">4ã€ä½¿ç”¨ç¬¬ä¸‰æ­¥ç”Ÿæˆçš„è¯æœ¯ï¼Œè¿›è¡Œç²¾ç®€æ¶¦è‰²ï¼Œæœ€ç»ˆå‹ç¼©åˆ°200å­—ä»¥å†…ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">æœ€åå¼ºè°ƒä¸€ä¸‹ï¼šç”Ÿæˆçš„ç­”æ¡ˆå¿…é¡»ä¸¥æ ¼ç»è¿‡è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸”ä¸¥æ ¼é™åˆ¶åªèƒ½ä½¿ç”¨æˆ‘æä¾›ç»™ä½ çš„ä¿¡æ¯ï¼Œä¸¥ç¦ç”Ÿæˆé¢å¤–ä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">% USER INPUT:
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#cd5555">{user_input}</span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">YOUR RESPONSE:
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å°†æˆ‘ä»¬çš„æ ¼å¼æè¿°åµŒå…¥åˆ°promptä¸­å»ï¼Œå‘Šè¯‰llmæˆ‘ä»¬éœ€è¦ä»–è¾“å‡ºä»€ä¹ˆæ ·æ ¼å¼çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>prompt = PromptTemplate(
</span></span><span style="display:flex;"><span>    input_variables=[<span style="color:#cd5555">&#34;user_input&#34;</span>],
</span></span><span style="display:flex;"><span>    template=template
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>llm = ChatOpenAI(
</span></span><span style="display:flex;"><span>    openai_api_key=<span style="color:#cd5555">&#34;EMPTY&#34;</span>,
</span></span><span style="display:flex;"><span>    openai_api_base=<span style="color:#cd5555">&#34;http://20.20.136.251:10005/v1&#34;</span>,
</span></span><span style="display:flex;"><span>    model_name=<span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    temperature=<span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>    streaming=<span style="color:#8b008b;font-weight:bold">True</span> 
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä½¿ç”¨è¿™ç§æ¥å£è¾“å‡ºçš„æ ¼å¼ä¸ä¸Šè¿°å‡½æ•°æ˜¯ç›¸åŒçš„</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># llm = VLLMOpenAI(</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#     openai_api_key=&#34;EMPTY&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#     openai_api_base=&#34;http://20.20.136.251:10005/v1&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#     model_name=&#34;qwen1.5-4b-chat&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#     temperature=0.8,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#     streaming=True,</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># )</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>llm_chain = LLMChain(prompt=prompt, llm=llm)
</span></span><span style="display:flex;"><span>user_input = <span style="color:#cd5555">&#34;äº§å“åç§°ï¼šå•†åŠ¡å¿«çº¿ã€‚äº§å“ç®€ä»‹ï¼šå•†åŠ¡å¿«çº¿æ˜¯æŒ‡ä»¥æœ‰çº¿æ–¹å¼æä¾›çš„ã€é¢å‘ä¸­å°ä¼ä¸šå®¢æˆ·çš„äº’è”ç½‘å®½å¸¦æ¥å…¥æœåŠ¡ã€‚å…¶æ»¡è¶³å®¢æˆ·å¯¹é™æ€IPéœ€æ±‚çš„åŒæ—¶ï¼Œå¯æä¾›å¤šç§å¢å€¼ä¸šåŠ¡ï¼Œä¸€ç«™å¼è§£å†³ä¼ä¸šå®¢æˆ·å¤šç§ä¿¡æ¯åŒ–éœ€æ±‚ã€‚äº§å“åº”ç”¨åœºæ™¯ï¼šï¼ˆé«˜ç«¯é…’åº—ã€å•†åŠ¡æ¥¼å®‡ã€äº§ä¸šå›­åŒºï¼‰ã€‚äº§å“åŠŸèƒ½ï¼šï¼ˆæä¾›åƒå…†å®½å¸¦é«˜é€Ÿä¸Šç½‘ï¼Œå¤šæ ·åŒ–å®æƒ å¥—é¤ï¼Œä»¥åŠä¸“å¸­å®¢æœä¿éšœçš„é«˜å“è´¨æœåŠ¡ã€‚ï¼‰ã€‚äº§å“ä¼˜åŠ¿ä¿¡æ¯ï¼šï¼ˆæä¾›é™æ€IPçš„å¤§å®½å¸¦ç½‘ç»œæ¥å…¥ï¼Œç¡®ä¿æµç•…ä¸Šç½‘ä½“éªŒï¼Œå¹¶ä»¥ç½‘ç»œæ¥å…¥ä¸ºåŸºç¡€ï¼Œæä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œè¦†ç›–å…¬å…±WiFiã€è¯­éŸ³é€šè¯ã€å¨±ä¹ã€å®‰å…¨ã€ç›‘æ§å’Œä¼ä¸šåŠå…¬ç­‰å¤šæ ·åŒ–éœ€æ±‚ã€‚ï¼‰ã€‚è¯·é’ˆå¯¹ä»¥ä¸Šäº§å“ï¼Œç”Ÿæˆä¸€æ®µ200å­—ä»¥å†…çš„ä»‹ç»æ€§è¯æœ¯ã€‚&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(llm_chain.invoke(user_input))
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>{<span style="color:#cd5555">&#39;user_input&#39;</span>: <span style="color:#cd5555">&#39;äº§å“åç§°ï¼šå•†åŠ¡å¿«çº¿ã€‚äº§å“ç®€ä»‹ï¼šå•†åŠ¡å¿«çº¿æ˜¯æŒ‡ä»¥æœ‰çº¿æ–¹å¼æä¾›çš„ã€é¢å‘ä¸­å°ä¼ä¸šå®¢æˆ·çš„äº’è”ç½‘å®½å¸¦æ¥å…¥æœåŠ¡ã€‚å…¶æ»¡è¶³å®¢æˆ·å¯¹é™æ€IPéœ€æ±‚çš„åŒæ—¶ï¼Œå¯æä¾›å¤šç§å¢å€¼ä¸šåŠ¡ï¼Œä¸€ç«™å¼è§£å†³ä¼ä¸šå®¢æˆ·å¤šç§ä¿¡æ¯åŒ–éœ€æ±‚ã€‚äº§å“åº”ç”¨åœºæ™¯ï¼šï¼ˆé«˜ç«¯é…’åº—ã€å•†åŠ¡æ¥¼å®‡ã€äº§ä¸šå›­åŒºï¼‰ã€‚äº§å“åŠŸèƒ½ï¼šï¼ˆæä¾›åƒå…†å®½å¸¦é«˜é€Ÿä¸Šç½‘ï¼Œå¤šæ ·åŒ–å®æƒ å¥—é¤ï¼Œä»¥åŠä¸“å¸­å®¢æœä¿éšœçš„é«˜å“è´¨æœåŠ¡ã€‚ï¼‰ã€‚äº§å“ä¼˜åŠ¿ä¿¡æ¯ï¼šï¼ˆæä¾›é™æ€IPçš„å¤§å®½å¸¦ç½‘ç»œæ¥å…¥ï¼Œç¡®ä¿æµç•…ä¸Šç½‘ä½“éªŒï¼Œå¹¶ä»¥ç½‘ç»œæ¥å…¥ä¸ºåŸºç¡€ï¼Œæä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œè¦†ç›–å…¬å…±WiFiã€è¯­éŸ³é€šè¯ã€å¨±ä¹ã€å®‰å…¨ã€ç›‘æ§å’Œä¼ä¸šåŠå…¬ç­‰å¤šæ ·åŒ–éœ€æ±‚ã€‚ï¼‰ã€‚è¯·é’ˆå¯¹ä»¥ä¸Šäº§å“ï¼Œç”Ÿæˆä¸€æ®µ200å­—ä»¥å†…çš„ä»‹ç»æ€§è¯æœ¯ã€‚&#39;</span>, <span style="color:#cd5555">&#39;text&#39;</span>: <span style="color:#cd5555">&#39;å•†åŠ¡å¿«çº¿æ˜¯é¢å‘ä¸­å°ä¼ä¸šå®¢æˆ·çš„äº’è”ç½‘å®½å¸¦æ¥å…¥æœåŠ¡ï¼Œä»¥æœ‰çº¿æ–¹å¼æä¾›ï¼Œæ»¡è¶³å®¢æˆ·å¯¹é™æ€IPçš„éœ€æ±‚ï¼ŒåŒæ—¶æä¾›å¤šç§å¢å€¼ä¸šåŠ¡ï¼Œä¸€ç«™å¼è§£å†³ä¼ä¸šå®¢æˆ·å¤šç§ä¿¡æ¯åŒ–éœ€æ±‚ã€‚å…¶åº”ç”¨åœºæ™¯å¹¿æ³›ï¼ŒåŒ…æ‹¬é«˜ç«¯é…’åº—ã€å•†åŠ¡æ¥¼å®‡ã€äº§ä¸šå›­åŒºç­‰ã€‚å•†åŠ¡å¿«çº¿æä¾›åƒå…†å®½å¸¦é«˜é€Ÿä¸Šç½‘ï¼Œå¤šæ ·åŒ–å®æƒ å¥—é¤ï¼Œä»¥åŠä¸“å¸­å®¢æœä¿éšœçš„é«˜å“è´¨æœåŠ¡ã€‚å•†åŠ¡å¿«çº¿çš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒæä¾›é™æ€IPçš„å¤§å®½å¸¦ç½‘ç»œæ¥å…¥ï¼Œç¡®ä¿æµç•…ä¸Šç½‘ä½“éªŒï¼Œå¹¶ä»¥ç½‘ç»œæ¥å…¥ä¸ºåŸºç¡€ï¼Œæä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œè¦†ç›–å…¬å…±WiFiã€è¯­éŸ³é€šè¯ã€å¨±ä¹ã€å®‰å…¨ã€ç›‘æ§å’Œä¼ä¸šåŠå…¬ç­‰å¤šæ ·åŒ–éœ€æ±‚ã€‚&#39;</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨llmçš„æµå¼è¾“å‡ºæ¥å£ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_openai</span> <span style="color:#8b008b;font-weight:bold">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">langchain_community.llms</span> <span style="color:#8b008b;font-weight:bold">import</span> VLLMOpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>llm = ChatOpenAI(
</span></span><span style="display:flex;"><span>    openai_api_key=<span style="color:#cd5555">&#34;EMPTY&#34;</span>,
</span></span><span style="display:flex;"><span>    openai_api_base=<span style="color:#cd5555">&#34;http://20.20.136.251:10005/v1&#34;</span>,
</span></span><span style="display:flex;"><span>    model_name=<span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    temperature=<span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>    streaming=<span style="color:#8b008b;font-weight:bold">True</span> 
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>messages = [
</span></span><span style="display:flex;"><span>    (<span style="color:#cd5555">&#34;system&#34;</span>, <span style="color:#cd5555">&#34;ä½ æ˜¯ç¼–ç¨‹åŠ©æ‰‹ã€‚&#34;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#cd5555">&#34;human&#34;</span>, <span style="color:#cd5555">&#34;æŠŠä¸‹é¢è¿™å¥ä»£ç å†™ä¸€ä¸‹æ³¨é‡Šï¼šprint(&#39;ä½ å¥½&#39;)&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(llm.invoke(messages)) <span style="color:#228b22"># æ™®é€šè¾“å‡º</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æµå¼è¾“å‡º</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> chunk <span style="color:#8b008b">in</span> llm.stream(messages):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(chunk)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºå†…å®¹ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;```python\n# è¿™æ˜¯Pythonè¯­è¨€çš„printå‡½æ•°ï¼Œç”¨äºåœ¨æ§åˆ¶å°è¾“å‡ºæ–‡æœ¬\nprint(\&#39;</span>ä½ å¥½<span style="color:#cd5555">\&#39;</span>)<span style="color:#cd5555">\n</span><span style="color:#cd5555">```</span><span style="color:#cd5555">\n\n</span>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åœ¨æ§åˆ¶å°è¾“å‡ºå­—ç¬¦ä¸² <span style="color:#cd5555">&#34;ä½ å¥½&#34;</span>ã€‚<span style="color:#cd5555">&#39; response_metadata={&#39;</span>finish_reason<span style="color:#cd5555">&#39;: &#39;</span>stop<span style="color:#cd5555">&#39;} id=&#39;</span>run-8e6c2718-d53f-4693-9bd3-25fa70c36bdd-0<span style="color:#cd5555">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">content=&#39;&#39; id=&#39;</span>run-70885497-4254-4dca-a50e-c0a376165907<span style="color:#cd5555">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">content=&#39;</span><span style="color:#cd5555">```</span><span style="color:#cd5555">&#39; id=&#39;</span>run-70885497-4254-4dca-a50e-c0a376165907<span style="color:#cd5555">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">content=&#39;</span>python<span style="color:#cd5555">&#39; id=&#39;</span>run-70885497-4254-4dca-a50e-c0a376165907<span style="color:#cd5555">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">content=&#39;</span><span style="color:#cd5555">\n</span><span style="color:#cd5555">&#39; id=&#39;</span>run-70885497-4254-4dca-a50e-c0a376165907<span style="color:#cd5555">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">content=&#39;</span><span style="color:#228b22">#&#39; id=&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39; è¿™&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;æ˜¯&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;Python&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;è¯­è¨€&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;çš„&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;print&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;å‡½æ•°&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ï¼Œ&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ç”¨äº&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;åœ¨&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;æ§åˆ¶&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;å°&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;è¾“å‡º&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;æ–‡æœ¬&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;\n&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;print&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#34;(&#39;&#34;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ä½ å¥½&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#34;&#39;)\n&#34;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;``&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;`\n\n&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;è¿™æ®µ&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ä»£ç &#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;çš„ä½œç”¨&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;æ˜¯åœ¨&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;æ§åˆ¶&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;å°&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;è¾“å‡º&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;å­—ç¬¦ä¸²&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39; &#34;&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ä½ å¥½&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;&#34;&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;ã€‚&#39;</span> <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00688b">content</span>=<span style="color:#cd5555">&#39;&#39;</span> <span style="color:#00688b">response_metadata</span>={<span style="color:#cd5555">&#39;finish_reason&#39;</span>: <span style="color:#cd5555">&#39;stop&#39;</span>} <span style="color:#00688b">id</span>=<span style="color:#cd5555">&#39;run-70885497-4254-4dca-a50e-c0a376165907&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>llama_indexè°ƒç”¨</p>
</blockquote>
<p>llama_indexè°ƒç”¨OpenAIçš„æ¥å£éƒ½ä½¿ç”¨<code>OpenAILike</code>æ¨¡å—ï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">llama_index.llms.openai_like</span> <span style="color:#8b008b;font-weight:bold">import</span> OpenAILike
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">from</span> <span style="color:#008b45;text-decoration:underline">llama_index.llms</span> <span style="color:#8b008b;font-weight:bold">import</span> ChatMessage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>llm3 = OpenAILike(
</span></span><span style="display:flex;"><span>    model=<span style="color:#cd5555">&#34;qwen1.5-4b-chat&#34;</span>,
</span></span><span style="display:flex;"><span>    api_base=<span style="color:#cd5555">&#34;http://20.20.136.251:10005/v1&#34;</span>, 
</span></span><span style="display:flex;"><span>    api_key=<span style="color:#cd5555">&#34;EMPTY&#34;</span>,
</span></span><span style="display:flex;"><span>    is_chat_model=<span style="color:#8b008b;font-weight:bold">True</span>,
</span></span><span style="display:flex;"><span>    temperature=<span style="color:#cd5555">&#34;0.8&#34;</span>,
</span></span><span style="display:flex;"><span>    timeout=<span style="color:#b452cd">60</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>messages_2 = [
</span></span><span style="display:flex;"><span>                ChatMessage(role=<span style="color:#cd5555">&#34;system&#34;</span>, content=<span style="color:#cd5555">&#34;You are a helpful assistant.&#34;</span>),  
</span></span><span style="display:flex;"><span>                ChatMessage(role=<span style="color:#cd5555">&#34;user&#34;</span>, content=<span style="color:#cd5555">&#34;ä½ å¥½ï¼Œè¯·ç»™æˆ‘è®²ä¸€ä¸ªæ•…äº‹&#34;</span>),
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>response = llm3.chat(messages=messages_2)
</span></span><span style="display:flex;"><span><span style="color:#658b00">print</span>(response)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æµå¼è¾“å‡º</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">for</span> chunk <span style="color:#8b008b">in</span> llm3.stream_chat(messages=messages_2):
</span></span><span style="display:flex;"><span>    <span style="color:#658b00">print</span>(chunk, flush=<span style="color:#8b008b;font-weight:bold">True</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨ç»“æœï¼š</p>
<div class="highlight"><div style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#228b22"># éæµå¼</span>
</span></span><span style="display:flex;"><span>assistant: å¥½çš„ï¼Œæˆ‘æ¥ç»™ä½ è®²ä¸€ä¸ªæ•…äº‹å§ã€‚ä»å‰ï¼Œæœ‰ä¸€åªå°çŒ«ï¼Œä»–å¾ˆèªæ˜ï¼Œä¹Ÿå¾ˆå‹‡æ•¢ã€‚æœ‰ä¸€å¤©ï¼Œå°çŒ«å†³å®šå»æ£®æ—æ¢é™©ï¼Œä»–é‡åˆ°äº†ä¸€åªå‡¶çŒ›çš„è€è™ï¼Œä½†æ˜¯å°çŒ«æ²¡æœ‰å®³æ€•ï¼Œä»–ç”¨æ™ºæ…§å’Œå‹‡æ°”æˆ˜èƒœäº†è€è™ã€‚æœ€åï¼Œå°çŒ«æˆåŠŸåœ°å›åˆ°äº†å®¶ã€‚
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æµå¼</span>
</span></span><span style="display:flex;"><span>assistant: 
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œ
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰ï¼Œ
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰ï¼Œæœ‰ä¸€ä¸ª
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰ï¼Œæœ‰ä¸€ä¸ªç”·å­©
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰ï¼Œæœ‰ä¸€ä¸ªç”·å­©å«
</span></span><span style="display:flex;"><span>assistant: å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•…äº‹çš„å¼€å§‹ï¼š
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä»å‰ï¼Œæœ‰ä¸€ä¸ªç”·å­©å«æ°
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ç›®å‰llama_indexçš„æµå¼è°ƒç”¨è¾“å‡ºå¾ˆæ€ªï¼Œåç»­ä¼šç»§ç»­ä¿®æ”¹ï¼</em></p>

                    
                    <HR width="100%" id="EOF">
		            <p style="color:#777;">æœ€åä¿®æ”¹äº 2024-05-07</p>
                    
                    
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://image-1252109614.cos.ap-beijing.myqcloud.com/img/20210508215939.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			ä¸‹å›<br>å·²ç»åˆ°å¤´å•¦ã€‚
                </a>
                
                
                
                <a class="older-posts" href="https://caixiongjiang.github.io/blog/2024/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/vllm%E5%B9%B6%E5%8F%91/">
			ä¸Šå›<br>vLLMå¦‚ä½•æé«˜å¹¶å‘ï¼Ÿ
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="tcomment"></div>



            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
é­”æ”¹è‡ª <a href="https://github.com/riba2534/hugo-blog">Riba2534</a> by <a href="https://caixiongjiang.github.io">Jarson Cai</a>
<br>

&copy;
	
	2024 ğŸŒ€Jarson Cai&#39;s Blog
	</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            },
            debounce(func, wait, options) {
                let lastArgs,
                    lastThis,
                    maxWait,
                    result,
                    timerId,
                    lastCallTime

                let lastInvokeTime = 0
                let leading = false
                let maxing = false
                let trailing = true

                
                const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function')

                if (typeof func !== 'function') {
                    throw new TypeError('Expected a function')
                }
                function isObject(value) {
                    const type = typeof value
                    return value != null && (type === 'object' || type === 'function')
                }

                wait = +wait || 0
                if (isObject(options)) {
                    leading = !!options.leading
                    maxing = 'maxWait' in options
                    maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait
                    trailing = 'trailing' in options ? !!options.trailing : trailing
                }

                function invokeFunc(time) {
                    const args = lastArgs
                    const thisArg = lastThis

                    lastArgs = lastThis = undefined
                    lastInvokeTime = time
                    result = func.apply(thisArg, args)
                    return result
                }

                function startTimer(pendingFunc, wait) {
                    if (useRAF) {
                    root.cancelAnimationFrame(timerId)
                    return root.requestAnimationFrame(pendingFunc)
                    }
                    return setTimeout(pendingFunc, wait)
                }

                function cancelTimer(id) {
                    if (useRAF) {
                    return root.cancelAnimationFrame(id)
                    }
                    clearTimeout(id)
                }

                function leadingEdge(time) {
                    
                    lastInvokeTime = time
                    
                    timerId = startTimer(timerExpired, wait)
                    
                    return leading ? invokeFunc(time) : result
                }

                function remainingWait(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime
                    const timeWaiting = wait - timeSinceLastCall

                    return maxing
                    ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke)
                    : timeWaiting
                }

                function shouldInvoke(time) {
                    const timeSinceLastCall = time - lastCallTime
                    const timeSinceLastInvoke = time - lastInvokeTime

                    
                    
                    
                    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
                    (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait))
                }

                function timerExpired() {
                    const time = Date.now()
                    if (shouldInvoke(time)) {
                    return trailingEdge(time)
                    }
                    
                    timerId = startTimer(timerExpired, remainingWait(time))
                }

                function trailingEdge(time) {
                    timerId = undefined

                    
                    
                    if (trailing && lastArgs) {
                    return invokeFunc(time)
                    }
                    lastArgs = lastThis = undefined
                    return result
                }

                function cancel() {
                    if (timerId !== undefined) {
                    cancelTimer(timerId)
                    }
                    lastInvokeTime = 0
                    lastArgs = lastCallTime = lastThis = timerId = undefined
                }

                function flush() {
                    return timerId === undefined ? result : trailingEdge(Date.now())
                }

                function pending() {
                    return timerId !== undefined
                }

                function debounced(...args) {
                    const time = Date.now()
                    const isInvoking = shouldInvoke(time)

                    lastArgs = args
                    lastThis = this
                    lastCallTime = time

                    if (isInvoking) {
                    if (timerId === undefined) {
                        return leadingEdge(lastCallTime)
                    }
                    if (maxing) {
                        
                        timerId = startTimer(timerExpired, wait)
                        return invokeFunc(lastCallTime)
                    }
                    }
                    if (timerId === undefined) {
                    timerId = startTimer(timerExpired, wait)
                    }
                    return result
                }
                debounced.cancel = cancel
                debounced.flush = flush
                debounced.pending = pending
                return debounced
                }

    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
        
        
            twikoo.init({
                envId: "https://twikoo-rho-olive.vercel.app/",
                el: '#tcomment',
                region:  null ,
            });
        

        document.querySelectorAll("table").forEach(function(elem){
            elem.classList.add("table-striped");
            elem.classList.add("table");
            elem.classList.add("table-responsive");
            elem.classList.add("table-hover");
        })

        
        spy();
        window.addEventListener('scroll', this.debounce(spy, 250, { 'maxWait': 250 }), false);
        
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});



</script>
    </body>
</html>
