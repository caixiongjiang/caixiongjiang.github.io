<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ğŸŒ€Jarson Cai&#39;s Blog</title>
    <link>https://caixiongjiang.github.io/</link>
    <description>Recent content on ğŸŒ€Jarson Cai&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 13 Apr 2022 20:16:48 +0800</lastBuildDate>
    
        <atom:link href="https://caixiongjiang.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 24 ç«  åˆ¶ä½œ HTTP æœåŠ¡å™¨ç«¯ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-24-%E7%AB%A0-%E5%88%B6%E4%BD%9C-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Wed, 13 Apr 2022 20:16:48 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-24-%E7%AB%A0-%E5%88%B6%E4%BD%9C-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-24-%E7%AB%A0-%E5%88%B6%E4%BD%9C-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-24-ç« -åˆ¶ä½œ-http-æœåŠ¡å™¨ç«¯&#34;&gt;ç¬¬ 24 ç«  åˆ¶ä½œ HTTP æœåŠ¡å™¨ç«¯&lt;/h2&gt;
&lt;h3 id=&#34;241-http-æ¦‚è¦&#34;&gt;24.1 HTTP æ¦‚è¦&lt;/h3&gt;
&lt;p&gt;æœ¬ç« å°†ç¼–å†™ HTTPï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æœåŠ¡å™¨ç«¯ï¼Œå³ Web æœåŠ¡å™¨ç«¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;2411-ç†è§£-web-æœåŠ¡å™¨ç«¯&#34;&gt;24.1.1 ç†è§£ Web æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;webæœåŠ¡å™¨ç«¯å°±æ˜¯è¦åŸºäº HTTP åè®®ï¼Œå°†ç½‘é¡µå¯¹åº”æ–‡ä»¶ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ç«¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;2412-http&#34;&gt;24.1.2 HTTP&lt;/h4&gt;
&lt;p&gt;æ— çŠ¶æ€çš„ Stateless åè®®&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/07/5c5bc6973a4d0.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡å™¨ç«¯ç›¸åº”å®¢æˆ·ç«¯è¯·æ±‚åç«‹å³æ–­å¼€è¿æ¥ã€‚æ¢è¨€ä¹‹ï¼ŒæœåŠ¡å™¨ç«¯ä¸ä¼šç»´æŒå®¢æˆ·ç«¯çŠ¶æ€ã€‚å³ä½¿åŒä¸€å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿæ— æ³•è¾¨è®¤å‡ºæ˜¯åŸå…ˆé‚£ä¸ªï¼Œè€Œä¼šä»¥ç›¸åŒæ–¹å¼å¤„ç†æ–°è¯·æ±‚ã€‚å› æ­¤ï¼ŒHTTP åˆç§°ã€Œæ— çŠ¶æ€çš„ Stateless åè®®ã€&lt;/p&gt;
&lt;h4 id=&#34;2413-è¯·æ±‚æ¶ˆæ¯request-messageçš„ç»“æ„&#34;&gt;24.1.3 è¯·æ±‚æ¶ˆæ¯ï¼ˆRequest Messageï¼‰çš„ç»“æ„&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ¶ˆæ¯çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/07/5c5bcbb75202f.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¯·æ±‚æ¶ˆæ¯å¯ä»¥åˆ†ä¸ºè¯·æ±‚å¤´ã€æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“ 3 ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­ï¼Œè¯·æ±‚è¡Œå«æœ‰è¯·æ±‚æ–¹å¼ï¼ˆè¯·æ±‚ç›®çš„ï¼‰ä¿¡æ¯ã€‚å…¸å‹çš„è¯·æ±‚æ–¹å¼æœ‰ GET å’Œ POST ï¼ŒGET ä¸»è¦ç”¨äºè¯·æ±‚æ•°æ®ï¼ŒPOST ä¸»è¦ç”¨äºä¼ è¾“æ•°æ®ã€‚ä¸ºäº†é™ä½å¤æ‚åº¦ï¼Œæˆ‘ä»¬å®ç°åªèƒ½å“åº” GET è¯·æ±‚çš„ Web æœåŠ¡å™¨ç«¯ï¼Œä¸‹é¢è§£é‡Šå›¾ä¸­çš„è¯·æ±‚è¡Œä¿¡æ¯ã€‚å…¶ä¸­ã€ŒGET/index.html HTTP/1.1ã€ å…·æœ‰å¦‚ä¸‹å«ä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯·æ±‚ï¼ˆGETï¼‰index.html æ–‡ä»¶ï¼Œé€šå¸¸ä»¥ 1.1 ç‰ˆæœ¬çš„ HTTP åè®®è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¯·æ±‚è¡Œåªèƒ½é€šè¿‡  1 è¡Œï¼ˆlineï¼‰å‘é€ï¼Œå› æ­¤ï¼ŒæœåŠ¡å™¨ç«¯å¾ˆå®¹æ˜“ä» HTTP è¯·æ±‚ä¸­æå–ç¬¬ä¸€è¡Œï¼Œå¹¶åˆ†åˆ«åˆ†æè¯·æ±‚è¡Œä¸­çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ±‚è¡Œä¸‹é¢çš„æ¶ˆæ¯å¤´ä¸­åŒ…å«å‘é€è¯·æ±‚çš„æµè§ˆå™¨ä¿¡æ¯ã€ç”¨æˆ·è®¤è¯ä¿¡æ¯ç­‰å…³äº HTTP æ¶ˆæ¯çš„é™„åŠ ä¿¡æ¯ã€‚æœ€åçš„æ¶ˆæ¯ä½“ä¸­è£…æœ‰å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯ä¼ è¾“çš„æ•°æ®ï¼Œä¸ºäº†è£…å…¥æ•°æ®ï¼Œéœ€è¦ä»¥ POST æ–¹å¼å‘é€è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç° GET æ–¹å¼çš„æœåŠ¡å™¨ç«¯ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥è¿™éƒ¨åˆ†å†…å®¹ã€‚å¦å¤–ï¼Œæ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´ä¸ä¹‹é—´ä»¥ç©ºè¡Œéš”å¼€ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿè¾¹ç•Œé—®é¢˜&lt;/p&gt;
&lt;h4 id=&#34;2414-å“åº”æ¶ˆæ¯response-messageçš„ç»“æ„&#34;&gt;24.1.4 å“åº”æ¶ˆæ¯ï¼ˆResponse Messageï¼‰çš„ç»“æ„&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Web æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯ä¼ é€’çš„å“åº”ä¿¡æ¯çš„ç»“æ„ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¯¥å“åº”æ¶ˆæ¯ç”±çŠ¶æ€è¡Œã€å¤´ä¿¡æ¯ã€æ¶ˆæ¯ä½“ç­‰ 3 ä¸ªéƒ¨åˆ†ç»„æˆã€‚çŠ¶æ€è¡Œä¸­æœ‰å…³äºè¯·æ±‚çš„çŠ¶æ€ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸è¯·æ±‚æ¶ˆæ¯ç›¸æ¯”æœ€ä¸ºæ˜¾è‘—åœ°åŒºåˆ«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/07/5c5bf9ad1b5f9.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çŠ¶æ€è¡Œä¸­å«æœ‰å…³äºå®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†ç»“æœã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ index.html æ–‡ä»¶æ—¶ï¼Œè¡¨ç¤º index.html æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€æœåŠ¡ç«¯æ˜¯å¦å‘ç”Ÿé—®é¢˜è€Œæ— æ³•å“åº”ç­‰ä¸åŒæƒ…å†µçš„ä¿¡æ¯å†™å…¥çŠ¶æ€è¡Œã€‚å›¾ä¸­çš„ã€ŒHTTP/1.1 200 OKã€å…·æœ‰å¦‚ä¸‹å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;200 OK : æˆåŠŸå¤„ç†äº†è¯·æ±‚!&lt;/li&gt;
&lt;li&gt;404 Not Found : è¯·æ±‚çš„æ–‡ä»¶ä¸å­˜åœ¨!&lt;/li&gt;
&lt;li&gt;400 Bad Request : è¯·æ±‚æ–¹å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¶ˆæ¯å¤´ä¸­å«æœ‰ä¼ è¾“çš„æ•°æ®ç±»å‹å’Œé•¿åº¦ç­‰ä¿¡æ¯ã€‚å›¾ä¸­çš„æ¶ˆæ¯å¤´å«æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡ç«¯åä¸º SimpleWebServer ï¼Œä¼ è¾“çš„æ•°æ®ç±»å‹ä¸º text/htmlã€‚æ•°æ®é•¿åº¦ä¸è¶…è¿‡ 2048 ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ€åæ’å…¥ä¸€ä¸ªç©ºè¡Œåï¼Œé€šè¿‡æ¶ˆæ¯ä½“å‘é€å®¢æˆ·ç«¯è¯·æ±‚çš„æ–‡ä»¶æ•°æ®ã€‚ä»¥ä¸Šå°±æ˜¯å®ç° Web æœåŠ¡ç«¯è¿‡ç¨‹ä¸­å¿…è¦çš„ HTTP åè®®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;242-å®ç°ç®€å•çš„-web-æœåŠ¡å™¨ç«¯&#34;&gt;24.2 å®ç°ç®€å•çš„ Web æœåŠ¡å™¨ç«¯&lt;/h3&gt;
&lt;h4 id=&#34;2421-å®ç°åŸºäº-windows-çš„å¤šçº¿ç¨‹-web-æœåŠ¡å™¨ç«¯&#34;&gt;24.2.1 å®ç°åŸºäº Windows çš„å¤šçº¿ç¨‹ Web æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;æš‚ç•¥&lt;/p&gt;
&lt;h4 id=&#34;2422-å®ç°åŸºäº-linux-çš„å¤šçº¿ç¨‹-web-æœåŠ¡å™¨ç«¯&#34;&gt;24.2.2 å®ç°åŸºäº Linux çš„å¤šçº¿ç¨‹ Web æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch24/webserv_linux.c&#34;&gt;webserv_linux.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;  9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 40
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 41
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 42
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 43
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 44
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 45
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 46
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 47
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 48
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 49
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 50
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 51
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 52
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 53
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 54
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 55
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 56
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 57
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 58
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 59
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 60
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 61
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 62
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 63
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 64
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 65
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 66
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 67
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 68
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 69
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 70
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 71
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 72
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 73
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 74
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 75
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 76
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 77
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 78
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 79
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 80
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 81
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 82
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 83
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 84
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 85
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 86
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 87
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 88
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 89
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 90
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 91
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 92
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 93
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 94
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 95
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 96
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 97
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 98
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 99
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;100
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;101
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;102
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;103
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;104
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;105
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;106
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;107
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;108
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;109
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;110
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;111
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;112
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;113
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;114
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;115
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;116
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;117
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;118
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;119
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;120
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;121
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;122
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;123
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;124
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;125
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;126
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;127
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;128
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;129
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;130
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;131
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;132
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;133
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;134
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;135
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;136
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;137
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;138
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;139
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;140
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;141
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;142
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;143
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;144
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;145
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;146
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;147
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;148
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;149
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;150
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;151
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;152
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;153
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;arpa/inet.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#1e889b&#34;&gt;#define BUF_SIZE 1024
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define SMALL_BUF 100
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;request_handler&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;send_data&lt;/span&gt;(FILE *fp, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *ct, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *file_name);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;content_type&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *file);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;send_error&lt;/span&gt;(FILE *fp);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;error_handling&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *message);

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; serv_sock, clnt_sock;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sockaddr_in serv_adr, clnt_adr;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; clnt_adr_size;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf[BUF_SIZE];
    pthread_t t_id;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (argc != &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;)
    {
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Usage : %s &amp;lt;port&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, argv[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;]);
        exit(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
    }

    serv_sock = socket(PF_INET, SOCK_STREAM, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
    memset(&amp;amp;serv_adr, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(serv_adr));
    serv_adr.sin_family = AF_INET;
    serv_adr.sin_addr.s_addr = htonl(INADDR_ANY);
    serv_adr.sin_port = htons(atoi(argv[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;]));
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (bind(serv_sock, (&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sockaddr *)&amp;amp;serv_adr, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(serv_adr)) == -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;)
        error_handling(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;bind() error&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (listen(serv_sock, &lt;span style=&#34;color:#b452cd&#34;&gt;20&lt;/span&gt;) == -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;)
        error_handling(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;listen() error&amp;#34;&lt;/span&gt;);

    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;)
    {
        clnt_adr_size = &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(clnt_adr);
        clnt_sock = accept(serv_sock, (&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sockaddr *)&amp;amp;clnt_adr, &amp;amp;clnt_adr_size);
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Connection Request : %s:%d&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;,
               inet_ntoa(clnt_adr.sin_addr), ntohs(clnt_adr.sin_port));
        pthread_create(&amp;amp;t_id, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, request_handler, &amp;amp;clnt_sock);
        pthread_detach(t_id);
    }
    close(serv_sock);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;request_handler&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; clnt_sock = *((&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *)arg);
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; req_line[SMALL_BUF];
    FILE *clnt_read;
    FILE *clnt_write;

    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; method[&lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; ct[&lt;span style=&#34;color:#b452cd&#34;&gt;15&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; file_name[&lt;span style=&#34;color:#b452cd&#34;&gt;30&lt;/span&gt;];

    clnt_read = fdopen(clnt_sock, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;r&amp;#34;&lt;/span&gt;);
    clnt_write = fdopen(dup(clnt_sock), &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;);
    fgets(req_line, SMALL_BUF, clnt_read);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (strstr(req_line, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;HTTP/&amp;#34;&lt;/span&gt;) == &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;)
    {
        send_error(clnt_write);
        fclose(clnt_read);
        fclose(clnt_write);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt;;
    }
    strcpy(method, strtok(req_line, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34; /&amp;#34;&lt;/span&gt;));
    strcpy(file_name, strtok(&lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34; /&amp;#34;&lt;/span&gt;));
    strcpy(ct, content_type(file_name));
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (strcmp(method, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;) != &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        send_error(clnt_write);
        fclose(clnt_read);
        fclose(clnt_write);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt;;
    }
    fclose(clnt_read);
    send_data(clnt_write, ct, file_name);
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;send_data&lt;/span&gt;(FILE *fp, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *ct, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *file_name)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; protocol[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;HTTP/1.0 200 OK&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; server[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Server:Linux Web Server &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; cnt_len[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Content-length:2048&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; cnt_type[SMALL_BUF];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf[BUF_SIZE];
    FILE *send_file;

    sprintf(cnt_type, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Content-type:%s&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, ct);
    send_file = fopen(file_name, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;r&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (send_file == &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;)
    {
        send_error(fp);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt;;
    }

    &lt;span style=&#34;color:#228b22&#34;&gt;//ä¼ è¾“å¤´ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    fputs(protocol, fp);
    fputs(server, fp);
    fputs(cnt_len, fp);
    fputs(cnt_type, fp);

    &lt;span style=&#34;color:#228b22&#34;&gt;//ä¼ è¾“è¯·æ±‚æ•°æ®
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;while&lt;/span&gt; (fgets(buf, BUF_SIZE, send_file) != &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;)
    {
        fputs(buf, fp);
        fflush(fp);
    }
    fflush(fp);
    fclose(fp);
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;content_type&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *file)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; extension[SMALL_BUF];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; file_name[SMALL_BUF];
    strcpy(file_name, file);
    strtok(file_name, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;);
    strcpy(extension, strtok(&lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;));

    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (!strcmp(extension, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;html&amp;#34;&lt;/span&gt;) || !strcmp(extension, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;htm&amp;#34;&lt;/span&gt;))
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;text/html&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;text/plain&amp;#34;&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;send_error&lt;/span&gt;(FILE *fp)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; protocol[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;HTTP/1.0 400 Bad Request&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; server[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Server:Linux Web Server &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; cnt_len[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Content-length:2048&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; cnt_type[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Content-type:text/html&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\r\n\r\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; content[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;NETWORK&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;#34;&lt;/span&gt;
                     &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&amp;lt;body&amp;gt;&amp;lt;font size=+5&amp;gt;&amp;lt;br&amp;gt;å‘ç”Ÿé”™è¯¯ï¼ æŸ¥çœ‹è¯·æ±‚æ–‡ä»¶åå’Œè¯·æ±‚æ–¹å¼!&amp;#34;&lt;/span&gt;
                     &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&amp;lt;/font&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;#34;&lt;/span&gt;;
    fputs(protocol, fp);
    fputs(server, fp);
    fputs(cnt_len, fp);
    fputs(cnt_type, fp);
    fflush(fp);
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;error_handling&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *message)
{
    fputs(message, stderr);
    fputc(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;, stderr);
    exit(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc webserv_linux.c -D_REENTRANT -o web_serv -lpthread
./web_serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/07/5c5c107deba11.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/07/5c5c19cbb3718.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡æµ‹è¯•ï¼Œè¿™ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¯ä»¥æ­£å¸¸çš„æ˜¾ç¤ºå‡ºé¡µé¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;243-ä¹ é¢˜&#34;&gt;24.3 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äº Web æœåŠ¡å™¨ç«¯å’Œ Web æµè§ˆå™¨ç«¯çš„è¯´æ³•é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—é€‰é¡¹ä»£è¡¨æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Web æµè§ˆå™¨å¹¶ä¸æ˜¯é€šè¿‡è‡ªèº«åˆ›å»ºçš„å¥—æ¥å­—è¿æ¥æœåŠ¡ç«¯çš„å®¢æˆ·ç«¯&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Web æœåŠ¡å™¨ç«¯é€šè¿‡ TCP å¥—æ¥å­—æä¾›æœåŠ¡ï¼Œå› ä¸ºå®ƒå°†ä¿æŒè¾ƒé•¿çš„å®¢æˆ·ç«¯è¿æ¥å¹¶äº¤æ¢æ•°æ®&lt;/li&gt;
&lt;li&gt;è¶…æ–‡æœ¬ä¸æ™®é€šæ–‡æœ¬çš„æœ€å¤§åŒºåˆ«æ˜¯å…¶å…·æœ‰å¯è·³è½¬çš„ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;Web æµè§ˆå™¨å¯è§†ä¸ºå‘æµè§ˆå™¨æä¾›è¯·æ±‚æ–‡ä»¶çš„æ–‡ä»¶ä¼ è¾“æœåŠ¡å™¨ç«¯&lt;/li&gt;
&lt;li&gt;é™¤ Web æµè§ˆå™¨å¤–ï¼Œå…¶ä»–å®¢æˆ·ç«¯éƒ½æ— æ³•è®¿é—® Web æœåŠ¡å™¨ç«¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äº HTTP åè®®çš„æè¿°é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—é€‰é¡¹ä»£è¡¨æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ Stateless åè®®ï¼Œä¸ä»…å¯ä»¥é€šè¿‡ TCP å®ç°ï¼Œè¿˜å¯ä»¥é€šè¿‡ UDP æ¥å®ç°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ Stateless åè®®ï¼Œå› ä¸ºå…¶åœ¨ 1 æ¬¡è¯·æ±‚å’Œå“åº”è¿‡ç¨‹å®Œæˆåç«‹å³æ–­å¼€è¿æ¥ã€‚å› æ­¤ï¼Œå¦‚æœåŒä¸€æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éœ€è¦  3 æ¬¡è¯·æ±‚åŠå“åº”ï¼Œåˆ™æ„å‘³ç€éœ€è¦ç»è¿‡ 3 æ¬¡å¥—æ¥å­—çš„åˆ›å»ºè¿‡ç¨‹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯ä¼ é€’çš„çŠ¶æ€ç ä¸­å«æœ‰è¯·æ±‚å¤„ç†ç»“æœçš„ä¿¡æ¯&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP åè®®æ˜¯åŸºäºå› ç‰¹ç½‘çš„åè®®ï¼Œå› æ­¤ï¼Œä¸ºäº†åŒæ—¶å‘å¤§é‡å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼ŒHTTP åè®®è¢«è®¾è®¡ä¸º Stateless åè®®&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-24-%E7%AB%A0-%E5%88%B6%E4%BD%9C-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 18 ç«  å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯çš„å®ç° ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-18-%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%9A%84%E5%AE%9E%E7%8E%B0-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Sun, 10 Apr 2022 16:05:00 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-18-%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%9A%84%E5%AE%9E%E7%8E%B0-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-18-%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%9A%84%E5%AE%9E%E7%8E%B0-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-18-ç« -å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯çš„å®ç°&#34;&gt;ç¬¬ 18 ç«  å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯çš„å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;181-ç†è§£çº¿ç¨‹çš„æ¦‚å¿µ&#34;&gt;18.1 ç†è§£çº¿ç¨‹çš„æ¦‚å¿µ&lt;/h3&gt;
&lt;h4 id=&#34;1811-å¼•å…¥çº¿ç¨‹èƒŒæ™¯&#34;&gt;18.1.1 å¼•å…¥çº¿ç¨‹èƒŒæ™¯&lt;/h4&gt;
&lt;p&gt;ç¬¬ 10 ç« ä»‹ç»äº†å¤šè¿›ç¨‹æœåŠ¡ç«¯çš„å®ç°æ–¹æ³•ã€‚å¤šè¿›ç¨‹æ¨¡å‹ä¸ select å’Œ epoll ç›¸æ¯”çš„ç¡®æœ‰è‡ªèº«çš„ä¼˜ç‚¹ï¼Œä½†åŒæ—¶ä¹Ÿæœ‰é—®é¢˜ã€‚å¦‚å‰æ‰€è¿°ï¼Œåˆ›å»ºï¼ˆå¤åˆ¶ï¼‰è¿›ç¨‹çš„å·¥ä½œæœ¬èº«ä¼šç»™æ“ä½œç³»ç»Ÿå¸¦æ¥ç›¸å½“æ²‰é‡çš„è´Ÿæ‹…ã€‚è€Œä¸”ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å…·æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹é—´é€šä¿¡çš„å®ç°éš¾åº¦ä¹Ÿä¼šéšä¹‹æé«˜ã€‚æ¢è¨€ä¹‹ï¼Œå¤šè¿›ç¨‹çš„ç¼ºç‚¹å¯æ¦‚æ‹¬ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€&lt;/li&gt;
&lt;li&gt;ä¸ºäº†å®Œæˆè¿›ç¨‹é—´æ•°æ®äº¤æ¢ï¼Œéœ€è¦ç‰¹æ®Šçš„ IPC æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯æ›´å¤§çš„ç¼ºç‚¹æ˜¯ä¸‹é¢çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ç§’å°‘åˆ™ 10 æ¬¡ï¼Œå¤šåˆ™åƒæ¬¡çš„ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€æ˜¯åˆ›å»ºè¿›ç¨‹çš„æœ€å¤§å¼€é”€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªæœ‰ä¸€ä¸ª CPU çš„ç³»ç»Ÿæ˜¯å°†æ—¶é—´åˆ†æˆå¤šä¸ªå¾®å°çš„å—ååˆ†é…ç»™äº†å¤šä¸ªè¿›ç¨‹ã€‚ä¸ºäº†åˆ†æ—¶ä½¿ç”¨ CPU ï¼Œéœ€è¦ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€çš„è¿‡ç¨‹ã€‚ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€æ˜¯æŒ‡è¿è¡Œç¨‹åºå‰éœ€è¦å°†ç›¸åº”è¿›ç¨‹ä¿¡æ¯è¯»å…¥å†…å­˜ï¼Œå¦‚æœè¿è¡Œè¿›ç¨‹ A åç´§æ¥ç€éœ€è¦è¿è¡Œè¿›ç¨‹ B ï¼Œå°±åº”è¯¥å°†è¿›ç¨‹ A ç›¸å…³ä¿¡æ¯ç§»å‡ºå†…å­˜ï¼Œå¹¶è¯»å…¥è¿›ç¨‹ B ç›¸å…³ä¿¡æ¯ã€‚è¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä½†æ˜¯æ­¤æ—¶è¿›ç¨‹ A çš„æ•°æ®å°†è¢«ç§»åŠ¨åˆ°ç¡¬ç›˜ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡åˆ‡æ¢è¦å¾ˆé•¿æ—¶é—´ï¼Œå³ä½¿é€šè¿‡ä¼˜åŒ–åŠ å¿«é€Ÿåº¦ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„å±€é™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿æŒå¤šè¿›ç¨‹çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šå…‹æœå…¶ç¼ºç‚¹ï¼Œäººä»¬å¼•å…¥çš„çº¿ç¨‹ï¼ˆThreadï¼‰çš„æ¦‚å¿µã€‚è¿™æ˜¯ä¸ºäº†å°†è¿›ç¨‹çš„å„ç§åŠ£åŠ¿é™è‡³æœ€ä½ç¨‹åº¦ï¼ˆä¸æ˜¯ç›´æ¥æ¶ˆé™¤ï¼‰è€Œè®¾ç«‹çš„ä¸€ç§ã€Œè½»é‡çº§è¿›ç¨‹ã€ã€‚çº¿ç¨‹æ¯”è¿›ç¨‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¿›ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢æ›´å¿«&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹é—´äº¤æ¢æ•°æ®æ— éœ€ç‰¹æ®ŠæŠ€æœ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1812-çº¿ç¨‹å’Œè¿›ç¨‹çš„å·®å¼‚&#34;&gt;18.1.2 çº¿ç¨‹å’Œè¿›ç¨‹çš„å·®å¼‚&lt;/h4&gt;
&lt;p&gt;çº¿ç¨‹æ˜¯ä¸ºäº†è§£å†³ï¼šä¸ºäº†å¾—åˆ°å¤šæ¡ä»£ç æ‰§è¡Œæµè€Œå¤åˆ¶æ•´ä¸ªå†…å­˜åŒºåŸŸçš„è´Ÿæ‹…å¤ªé‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´éƒ½ç”±ä¿å­˜å…¨å±€å˜é‡çš„ã€Œæ•°æ®åŒºã€ã€å‘ malloc ç­‰å‡½æ•°åŠ¨æ€åˆ†é…æä¾›ç©ºé—´çš„å †ï¼ˆHeapï¼‰ã€å‡½æ•°è¿è¡Œæ—¶é—´ä½¿ç”¨çš„æ ˆï¼ˆStackï¼‰æ„æˆã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è¿™ç§ç©ºé—´ï¼Œå¤šä¸ªè¿›ç¨‹çš„å†…å­˜ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55aa57db3c7.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœä»¥è·å¾—å¤šä¸ªä»£ç æ‰§è¡Œæµä¸ºç›®çš„ï¼Œåˆ™ä¸åº”è¯¥åƒä¸Šå›¾é‚£æ ·å®Œå…¨åˆ†ç¦»å†…å­˜ç»“æ„ï¼Œè€Œåªéœ€åˆ†ç¦»æ ˆåŒºåŸŸã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥è·å¾—å¦‚ä¸‹ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¸éœ€è¦åˆ‡æ¢æ•°æ®åŒºå’Œå †&lt;/li&gt;
&lt;li&gt;å¯ä»¥åˆ©ç”¨æ•°æ®åŒºå’Œå †äº¤æ¢æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®é™…ä¸Šè¿™å°±æ˜¯çº¿ç¨‹ã€‚çº¿ç¨‹ä¸ºäº†ä¿æŒå¤šæ¡ä»£ç æ‰§è¡Œæµè€Œéš”å¼€äº†æ ˆåŒºåŸŸï¼Œå› æ­¤å…·æœ‰å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å†…å­˜ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55ab455e399.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«æ•°æ®åŒºå’Œå †ã€‚ä¸ºäº†ä¿æŒè¿™ç§ç»“æ„ï¼Œçº¿ç¨‹å°†åœ¨è¿›ç¨‹å†…åˆ›å»ºå¹¶è¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹å¯ä»¥å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿›ç¨‹ï¼šåœ¨æ“ä½œç³»ç»Ÿæ„æˆå•ç‹¬æ‰§è¡Œæµçš„å•ä½&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ï¼šåœ¨è¿›ç¨‹æ„æˆå•ç‹¬æ‰§è¡Œæµçš„å•ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¯´è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…éƒ¨ç”Ÿæˆå¤šä¸ªæ‰§è¡Œæµï¼Œé‚£ä¹ˆçº¿ç¨‹å°±åœ¨åŒä¸€è¿›ç¨‹å†…éƒ¨åˆ›å»ºå¤šæ¡æ‰§è¡Œæµã€‚å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿã€è¿›ç¨‹ã€çº¿ç¨‹ä¹‹é—´çš„å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55ac20aa776.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;182-çº¿ç¨‹åˆ›å»ºåŠè¿è¡Œ&#34;&gt;18.2 çº¿ç¨‹åˆ›å»ºåŠè¿è¡Œ&lt;/h3&gt;
&lt;p&gt;å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆè‹±è¯­ï¼šPortable Operating System Interfaceï¼Œç¼©å†™ä¸ºPOSIXï¼‰æ˜¯IEEEä¸ºè¦åœ¨å„ç§UNIXæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œè½¯ä»¶ï¼Œè€Œå®šä¹‰APIçš„ä¸€ç³»åˆ—äº’ç›¸å…³è”çš„æ ‡å‡†çš„æ€»ç§°ï¼Œå…¶æ­£å¼ç§°å‘¼ä¸ºIEEE Std 1003ï¼Œè€Œå›½é™…æ ‡å‡†åç§°ä¸ºISO/IEC 9945ã€‚æ­¤æ ‡å‡†æºäºä¸€ä¸ªå¤§çº¦å¼€å§‹äº1985å¹´çš„é¡¹ç›®ã€‚POSIXè¿™ä¸ªåç§°æ˜¯ç”±ç†æŸ¥å¾·Â·æ–¯æ‰˜æ›¼ï¼ˆRMSï¼‰åº”IEEEçš„è¦æ±‚è€Œæè®®çš„ä¸€ä¸ªæ˜“äºè®°å¿†çš„åç§°ã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯Portable Operating System Interfaceï¼ˆå¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼‰çš„ç¼©å†™ï¼Œè€ŒXåˆ™è¡¨æ˜å…¶å¯¹Unix APIçš„ä¼ æ‰¿ã€‚&lt;/p&gt;
&lt;p&gt;LinuxåŸºæœ¬ä¸Šé€æ­¥å®ç°äº†POSIXå…¼å®¹ï¼Œä½†å¹¶æ²¡æœ‰å‚åŠ æ­£å¼çš„POSIXè®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;å¾®è½¯çš„Windows NTå£°ç§°éƒ¨åˆ†å®ç°äº†POSIXæ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰çš„POSIXä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šBase Definitionsã€System Interfacesã€Shell and Utilitieså’ŒRationaleã€‚&lt;/p&gt;
&lt;h4 id=&#34;1821-çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œæµç¨‹&#34;&gt;18.2.1 çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œæµç¨‹&lt;/h4&gt;
&lt;p&gt;çº¿ç¨‹å…·æœ‰å•ç‹¬çš„æ‰§è¡Œæµï¼Œå› æ­¤éœ€è¦å•ç‹¬å®šä¹‰çº¿ç¨‹çš„ main å‡½æ•°ï¼Œè¿˜éœ€è¦è¯·æ±‚æ“ä½œç³»ç»Ÿåœ¨å•ç‹¬çš„æ‰§è¡Œæµä¸­æ‰§è¡Œè¯¥å‡½æ•°ï¼Œå®Œæˆå‡½æ•°åŠŸèƒ½çš„å‡½æ•°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_create&lt;/span&gt;(pthread_t *&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;restrict&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;thread&lt;/span&gt;,
                   &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; pthread_attr_t *&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;restrict&lt;/span&gt; attr,
                   &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *(*start_routine)(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *),
                   &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;restrict&lt;/span&gt; arg);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;thread : ä¿å­˜æ–°åˆ›å»ºçº¿ç¨‹ ID çš„å˜é‡åœ°å€å€¼ã€‚çº¿ç¨‹ä¸è¿›ç¨‹ç›¸åŒï¼Œä¹Ÿéœ€è¦ç”¨äºåŒºåˆ†ä¸åŒçº¿ç¨‹çš„ ID
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;attr : ç”¨äºä¼ é€’çº¿ç¨‹å±æ€§çš„å‚æ•°ï¼Œä¼ é€’ NULL æ—¶ï¼Œåˆ›å»ºé»˜è®¤å±æ€§çš„çº¿ç¨‹
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;start_routine : ç›¸å½“äºçº¿ç¨‹ main å‡½æ•°çš„ã€åœ¨å•ç‹¬æ‰§è¡Œæµä¸­æ‰§è¡Œçš„å‡½æ•°åœ°å€å€¼ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;arg : é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’çš„è°ƒç”¨å‡½æ•°æ—¶åŒ…å«ä¼ é€’å‚æ•°ä¿¡æ¯çš„å˜é‡åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹é¢é€šè¿‡ç®€å•ç¤ºä¾‹äº†è§£è¯¥å‡½æ•°åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread1.c&#34;&gt;thread1.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pthread_t t_id;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; thread_param = &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;;
    &lt;span style=&#34;color:#228b22&#34;&gt;// è¯·æ±‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä» thread_main è°ƒç”¨å¼€å§‹ï¼Œåœ¨å•ç‹¬çš„æ‰§è¡Œæµä¸­è¿è¡Œã€‚åŒæ—¶ä¼ é€’å‚æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pthread_create(&amp;amp;t_id, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_main, (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *)&amp;amp;thread_param) != &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;pthread_create() error&amp;#34;&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    }
    sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//å»¶è¿Ÿè¿›ç¨‹ç»ˆæ­¢æ—¶é—´
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;end of main&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg) &lt;span style=&#34;color:#228b22&#34;&gt;//ä¼ å…¥çš„å‚æ•°æ˜¯ pthread_create çš„ç¬¬å››ä¸ª
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; cnt = *((&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *)arg);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; cnt; i++)
    {
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;running thread&amp;#34;&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc thread1.c -o tr1 -lpthread &lt;span style=&#34;color:#228b22&#34;&gt;# çº¿ç¨‹ç›¸å…³ä»£ç ç¼–è¯‘æ—¶éœ€è¦æ·»åŠ  -lpthread é€‰é¡¹å£°æ˜éœ€è¦è¿æ¥åˆ°çº¿ç¨‹åº“&lt;/span&gt;
./tr1
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55b5eb4daf6.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°ç¨‹åºçš„æ‰§è¡Œå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55b6943255b.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºåœ¨ä¸»è¿›ç¨‹æ²¡æœ‰ç»“æŸæ—¶ï¼Œç”Ÿæˆçš„çº¿ç¨‹æ¯éš”ä¸€ç§’è¾“å‡ºä¸€æ¬¡ &lt;code&gt;running thread&lt;/code&gt; ï¼Œä½†æ˜¯å¦‚æœä¸»è¿›ç¨‹æ²¡æœ‰ç­‰å¾…åç§’ï¼Œè€Œæ˜¯ç›´æ¥ç»“æŸï¼Œè¿™æ ·ä¹Ÿä¼šå¼ºåˆ¶ç»“æŸçº¿ç¨‹ï¼Œä¸è®ºçº¿ç¨‹æœ‰æ²¡æœ‰è¿è¡Œå®Œæ¯•ã€‚&lt;/p&gt;
&lt;p&gt;é‚£æ˜¯å¦æ„å‘³ç€ä¸»è¿›ç¨‹å¿…é¡»æ¯æ¬¡éƒ½ sleep æ¥ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Ÿå¹¶ä¸éœ€è¦ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°è§£å†³ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_join&lt;/span&gt;(pthread_t &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;thread&lt;/span&gt;, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; **status);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;thread : è¯¥å‚æ•°å€¼ ID çš„çº¿ç¨‹ç»ˆæ­¢åæ‰ä¼šä»è¯¥å‡½æ•°è¿”å›
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;status : ä¿å­˜çº¿ç¨‹çš„ main å‡½æ•°è¿”å›å€¼çš„æŒ‡é’ˆçš„å˜é‡åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä½œç”¨å°±æ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰å°†è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒçŸ¥é“ç¬¬ä¸€ä¸ªå‚æ•°ä¸º ID çš„çº¿ç¨‹ç»ˆæ­¢ä¸ºæ­¢ã€‚è€Œä¸”å¯ä»¥å¾—åˆ°çº¿ç¨‹çš„ main å‡½æ•°çš„è¿”å›å€¼ã€‚ä¸‹é¢æ˜¯è¯¥å‡½æ•°çš„ç”¨æ³•ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread2.c&#34;&gt;thread2.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pthread_t t_id;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; thread_param = &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *thr_ret;
    &lt;span style=&#34;color:#228b22&#34;&gt;// è¯·æ±‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä» thread_main è°ƒç”¨å¼€å§‹ï¼Œåœ¨å•ç‹¬çš„æ‰§è¡Œæµä¸­è¿è¡Œã€‚åŒæ—¶ä¼ é€’å‚æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pthread_create(&amp;amp;t_id, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_main, (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *)&amp;amp;thread_param) != &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;pthread_create() error&amp;#34;&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#228b22&#34;&gt;//mainå‡½æ•°å°†ç­‰å¾… ID ä¿å­˜åœ¨ t_id å˜é‡ä¸­çš„çº¿ç¨‹ç»ˆæ­¢
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pthread_join(t_id, &amp;amp;thr_ret) != &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;pthread_join() error&amp;#34;&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    }
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Thread return message : %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *)thr_ret);
    free(thr_ret);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg) &lt;span style=&#34;color:#228b22&#34;&gt;//ä¼ å…¥çš„å‚æ•°æ˜¯ pthread_create çš„ç¬¬å››ä¸ª
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; cnt = *((&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *)arg);
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *msg = (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *)malloc(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt;) * &lt;span style=&#34;color:#b452cd&#34;&gt;50&lt;/span&gt;);
    strcpy(msg, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hello,I&amp;#39;am thread~ &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; cnt; i++)
    {
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;running thread&amp;#34;&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *)msg; &lt;span style=&#34;color:#228b22&#34;&gt;//è¿”å›å€¼æ˜¯ thread_main å‡½æ•°ä¸­å†…éƒ¨åŠ¨æ€åˆ†é…çš„å†…å­˜ç©ºé—´åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc thread2.c -o tr2 -lpthread 
./tr2
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55bd6032f1e.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹è¾“å‡ºäº†5æ¬¡å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŠŠè¿”å›å€¼ç»™äº†ä¸»è¿›ç¨‹&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è¯¥å‡½æ•°çš„æ‰§è¡Œæµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/02/5c55bdd3bb3c8.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1822-å¯åœ¨ä¸´ç•ŒåŒºå†…è°ƒç”¨çš„å‡½æ•°&#34;&gt;18.2.2 å¯åœ¨ä¸´ç•ŒåŒºå†…è°ƒç”¨çš„å‡½æ•°&lt;/h4&gt;
&lt;p&gt;åœ¨åŒæ­¥çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸´ç•ŒåŒºå—ï¼ˆCritical sectionï¼‰æŒ‡çš„æ˜¯ä¸€ä¸ªè®¿é—®å…±äº«èµ„æºï¼ˆä¾‹å¦‚ï¼šå…±äº«è®¾å¤‡æˆ–æ˜¯å…±äº«å­˜å‚¨å™¨ï¼‰çš„ç¨‹åºç‰‡æ®µï¼Œè€Œè¿™äº›å…±äº«èµ„æºæœ‰æ— æ³•åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“æœ‰çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºå—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æˆ–æ˜¯è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼ˆä¾‹å¦‚ï¼šbounded waiting ç­‰å¾…æ³•ï¼‰ï¼Œæœ‰ä¸€äº›åŒæ­¥çš„æœºåˆ¶å¿…é¡»åœ¨ä¸´ç•ŒåŒºå—çš„è¿›å…¥ç‚¹ä¸ç¦»å¼€ç‚¹å®ç°ï¼Œä»¥ç¡®ä¿è¿™äº›å…±äº«èµ„æºæ˜¯è¢«å¼‚æˆ–çš„ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šsemaphoreã€‚&lt;/p&gt;
&lt;p&gt;åªèƒ½è¢«å•ä¸€çº¿ç¨‹è®¿é—®çš„è®¾å¤‡ï¼Œä¾‹å¦‚ï¼šæ‰“å°æœºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæœ€ç®€å•çš„å®ç°æ–¹æ³•å°±æ˜¯å½“çº¿ç¨‹ï¼ˆThreadï¼‰è¿›å…¥ä¸´ç•ŒåŒºå—æ—¶ï¼Œç¦æ­¢æ”¹å˜å¤„ç†å™¨ï¼›åœ¨uni-processorç³»ç»Ÿä¸Šï¼Œå¯ä»¥ç”¨â€œç¦æ­¢ä¸­æ–­ï¼ˆCLIï¼‰â€æ¥å®Œæˆï¼Œé¿å…å‘ç”Ÿç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰å¯¼è‡´çš„ä¸Šä¸‹æ–‡äº¤æ¢ï¼ˆContext switchingï¼‰ï¼›å½“ç¦»å¼€ä¸´ç•ŒåŒºå—æ—¶ï¼Œå¤„ç†å™¨æ¢å¤åŸå…ˆçš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸´ç•ŒåŒºæ˜¯å¦å¼•èµ·é—®é¢˜ï¼Œå‡½æ•°å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ 2 ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹å®‰å…¨å‡½æ•°ï¼ˆThread-safe functionï¼‰&lt;/li&gt;
&lt;li&gt;éçº¿ç¨‹å®‰å…¨å‡½æ•°ï¼ˆThread-unsafe functionï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çº¿ç¨‹å®‰å…¨å‡½æ•°è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ä¹Ÿä¸ä¼šå‘ç”Ÿé—®é¢˜ã€‚åä¹‹ï¼Œéçº¿ç¨‹å®‰å…¨å‡½æ•°è¢«åŒæ—¶è°ƒç”¨æ—¶ä¼šå¼•å‘é—®é¢˜ã€‚ä½†è¿™å¹¶éæœ‰å…³äºä¸´ç•ŒåŒºçš„è®¨è®ºï¼Œçº¿ç¨‹å®‰å…¨çš„å‡½æ•°ä¸­åŒæ ·å¯èƒ½å­˜åœ¨ä¸´ç•ŒåŒºã€‚åªæ˜¯åœ¨çº¿ç¨‹å®‰å…¨çš„å‡½æ•°ä¸­ï¼ŒåŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è°ƒç”¨æ—¶å¯é€šè¿‡ä¸€äº›æªæ–½é¿å…é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œå¤§å¤šæ•°æ ‡å‡†å‡½æ•°éƒ½æ˜¯çº¿ç¨‹å®‰å…¨å‡½æ•°ã€‚æ“ä½œç³»ç»Ÿåœ¨å®šä¹‰éçº¿ç¨‹å®‰å…¨å‡½æ•°çš„åŒæ—¶ï¼Œæä¾›äº†å…·æœ‰ç›¸åŒåŠŸèƒ½çš„çº¿ç¨‹å®‰å…¨çš„å‡½æ•°ã€‚æ¯”å¦‚ï¼Œç¬¬ 8 ç« çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; hostent *&lt;span style=&#34;color:#008b45&#34;&gt;gethostbyname&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *hostname);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åŒæ—¶ï¼Œä¹Ÿæä¾›äº†åŒä¸€åŠŸèƒ½çš„å®‰å…¨å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; hostent *&lt;span style=&#34;color:#008b45&#34;&gt;gethostbyname_r&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *name,
                                &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; hostent *result,
                                &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *buffer,
                                &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; intbuflen,
                                &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *h_errnop);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;çº¿ç¨‹å®‰å…¨å‡½æ•°ç»“å°¾é€šå¸¸æ˜¯ &lt;code&gt;_r&lt;/code&gt; ã€‚ä½†æ˜¯ä½¿ç”¨çº¿ç¨‹å®‰å…¨å‡½æ•°ä¼šç»™ç¨‹åºå‘˜å¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è‡ªåŠ¨å°† gethostbyname å‡½æ•°è°ƒç”¨æ”¹ä¸º gethostbyname_r å‡½æ•°è°ƒç”¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å£°æ˜å¤´æ–‡ä»¶å‰å®šä¹‰ &lt;code&gt;_REENTRANT&lt;/code&gt; å®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ— éœ€ç‰¹æ„æ›´æ”¹æºä»£ç åŠ ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šç¼–è¯‘å‚æ•°å®šä¹‰å®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc -D_REENTRANT mythread.c -o mthread -lpthread
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;1823-å·¥ä½œworkerçº¿ç¨‹æ¨¡å‹&#34;&gt;18.2.3 å·¥ä½œï¼ˆWorkerï¼‰çº¿ç¨‹æ¨¡å‹&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢çš„ç¤ºä¾‹æ˜¯è®¡ç®—ä» 1 åˆ° 10 çš„å’Œï¼Œä½†å¹¶ä¸æ˜¯é€šè¿‡ main å‡½æ•°è¿›è¡Œè¿ç®—ï¼Œè€Œæ˜¯åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è®¡ç®— 1 åˆ° 5 çš„å’Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è®¡ç®— 6 åˆ° 10 çš„å’Œï¼Œmain å‡½æ•°åªè´Ÿè´£è¾“å‡ºè¿ç®—ç»“æœã€‚è¿™ç§æ–¹å¼çš„çº¿ç¨‹æ¨¡å‹ç§°ä¸ºã€Œå·¥ä½œçº¿ç¨‹ã€ã€‚æ˜¾ç¤ºè¯¥ç¨‹åºçš„æ‰§è¡Œæµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c55c330e8b5b.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread3.c&#34;&gt;thread3.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_summation&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sum = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pthread_t id_t1, id_t2;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; range1[] = {&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;};
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; range2[] = {&lt;span style=&#34;color:#b452cd&#34;&gt;6&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;};

    pthread_create(&amp;amp;id_t1, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_summation, (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *)range1);
    pthread_create(&amp;amp;id_t2, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_summation, (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *)range2);

    pthread_join(id_t1, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    pthread_join(id_t2, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;result: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, sum);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_summation&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; start = ((&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *)arg)[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; end = ((&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *)arg)[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;];
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;while&lt;/span&gt; (start &amp;lt;= end)
    {
        sum += start;
        start++;
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc thread3.c -D_REENTRANT -o tr3 -lpthread
./tr3
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c55c53d70494.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºè®¡ç®—ç»“æœæ­£ç¡®ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½ç”¨äº†å…¨å±€å˜é‡ sum ,è¯æ˜äº† 2 ä¸ªçº¿ç¨‹å…±äº«ä¿å­˜å…¨å±€å˜é‡çš„æ•°æ®åŒºã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœ¬ä¾‹å­æœ¬èº«å­˜åœ¨é—®é¢˜ã€‚å­˜åœ¨ä¸´ç•ŒåŒºç›¸å…³é—®é¢˜ï¼Œå¯ä»¥ä»ä¸‹é¢çš„ä»£ç çœ‹å‡ºï¼Œä¸‹é¢çš„ä»£ç å’Œä¸Šé¢çš„ä»£ç ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†å‘ç”Ÿä¸´ç•ŒåŒºé”™è¯¯çš„å¯èƒ½æ€§ï¼Œå³ä½¿åœ¨é«˜é…ç½®ç³»ç»Ÿç¯å¢ƒä¸‹ä¹Ÿå®¹æ˜“äº§ç”Ÿçš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread4.c&#34;&gt;thread4.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define NUM_THREAD 100
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_des&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; num = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pthread_t thread_id[NUM_THREAD];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;

    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;sizeof long long: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt;));
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; NUM_THREAD; i++)
    {
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (i % &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;)
            pthread_create(&amp;amp;(thread_id[i]), &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_inc, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
            pthread_create(&amp;amp;(thread_id[i]), &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_des, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    }

    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; NUM_THREAD; i++)
        pthread_join(thread_id[i], &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);

    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;result: %lld &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, num);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num += &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_des&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num -= &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc thread4.c -D_REENTRANT -o tr4 -lpthread
./tr4
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c55c884e7c11.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡è¿è¡Œçš„ç»“æœç«Ÿç„¶ä¸ä¸€æ ·ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œä¸Šé¢ä»£ç çš„æœ€åç»“æœåº”è¯¥æ˜¯ 0 ã€‚åŸå› æš‚æ—¶ä¸å¾—è€ŒçŸ¥ï¼Œä½†æ˜¯å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™å¯¹äºçº¿ç¨‹çš„åº”ç”¨æ˜¯ä¸ªå¤§é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;183-çº¿ç¨‹å­˜åœ¨çš„é—®é¢˜å’Œä¸´ç•ŒåŒº&#34;&gt;18.3 çº¿ç¨‹å­˜åœ¨çš„é—®é¢˜å’Œä¸´ç•ŒåŒº&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢åˆ†æ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread4.c&#34;&gt;thread4.c&lt;/a&gt; ä¸­äº§ç”Ÿé—®é¢˜çš„åŸå› ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;1831-å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å˜é‡æ˜¯é—®é¢˜&#34;&gt;18.3.1 å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å˜é‡æ˜¯é—®é¢˜&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread4.c&#34;&gt;thread4.c&lt;/a&gt; çš„é—®é¢˜å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2 ä¸ªçº¿ç¨‹æ­£åœ¨åŒæ—¶è®¿é—®å…¨å±€å˜é‡ num&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»»ä½•å†…å­˜ç©ºé—´ï¼Œåªè¦è¢«åŒæ—¶è®¿é—®ï¼Œéƒ½æœ‰å¯èƒ½å‘ç”Ÿé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œçº¿ç¨‹è®¿é—®å˜é‡ num æ—¶åº”è¯¥é˜»æ­¢å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œç›´åˆ°çº¿ç¨‹ 1 è¿ç®—å®Œæˆã€‚è¿™å°±æ˜¯åŒæ­¥ï¼ˆSynchronizationï¼‰&lt;/p&gt;
&lt;h4 id=&#34;1832-ä¸´ç•ŒåŒºä½ç½®&#34;&gt;18.3.2 ä¸´ç•ŒåŒºä½ç½®&lt;/h4&gt;
&lt;p&gt;é‚£ä¹ˆåœ¨åˆšæ‰ä»£ç ä¸­çš„ä¸´ç•ŒåŒºä½ç½®æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡½æ•°å†…åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹æ—¶å¼•å‘é—®é¢˜çš„å¤šæ¡è¯­å¥æ„æˆçš„ä»£ç å—&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¨å±€å˜é‡ num ä¸èƒ½è§†ä¸ºä¸´ç•ŒåŒºï¼Œå› ä¸ºä»–ä¸æ˜¯å¼•èµ·é—®é¢˜çš„è¯­å¥ï¼Œåªæ˜¯ä¸€ä¸ªå†…å­˜åŒºåŸŸçš„å£°æ˜ã€‚ä¸‹é¢æ˜¯åˆšæ‰ä»£ç çš„ä¸¤ä¸ª main å‡½æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num += &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;&lt;span style=&#34;color:#228b22&#34;&gt;//ä¸´ç•ŒåŒº
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_des&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num -= &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;&lt;span style=&#34;color:#228b22&#34;&gt;//ä¸´ç•ŒåŒº
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œä¸´ç•ŒåŒºå¹¶é num æœ¬èº«ï¼Œè€Œæ˜¯è®¿é—® num çš„ä¸¤æ¡è¯­å¥ï¼Œè¿™ä¸¤æ¡è¯­å¥å¯èƒ½ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œä¹Ÿæ˜¯å¼•èµ·è¿™ä¸ªé—®é¢˜çš„ç›´æ¥åŸå› ã€‚äº§ç”Ÿé—®é¢˜çš„åŸå› å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2 ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ thread_inc å‡½æ•°&lt;/li&gt;
&lt;li&gt;2 ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ thread_des å‡½æ•°&lt;/li&gt;
&lt;li&gt;2 ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ thread_inc å’Œ thread_des å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯”å¦‚å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;çº¿ç¨‹ 1 æ‰§è¡Œ thread_inc çš„ num+=1 è¯­å¥çš„åŒæ—¶ï¼Œçº¿ç¨‹ 2  æ‰§è¡Œ thread_des å‡½æ•°çš„ num-=1 è¯­å¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤æ¡ä¸åŒçš„è¯­å¥ç”±ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ„æˆä¸´ç•ŒåŒºã€‚å‰ææ˜¯è¿™ 2 æ¡è¯­å¥è®¿é—®åŒä¸€å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;184-çº¿ç¨‹åŒæ­¥&#34;&gt;18.4 çº¿ç¨‹åŒæ­¥&lt;/h3&gt;
&lt;p&gt;å‰é¢è®¨è®ºäº†çº¿ç¨‹ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä¸‹é¢å°±æ˜¯è§£å†³æ–¹æ³•ï¼Œçº¿ç¨‹åŒæ­¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1841-åŒæ­¥çš„ä¸¤é¢æ€§&#34;&gt;18.4.1 åŒæ­¥çš„ä¸¤é¢æ€§&lt;/h4&gt;
&lt;p&gt;çº¿ç¨‹åŒæ­¥ç”¨äºè§£å†³çº¿ç¨‹è®¿é—®é¡ºåºå¼•å‘çš„é—®é¢˜ã€‚éœ€è¦åŒæ­¥çš„æƒ…å†µå¯ä»¥ä»å¦‚ä¸‹ä¸¤æ–¹é¢è€ƒè™‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ç©ºé—´æ—¶å‘ç”Ÿçš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;éœ€è¦æŒ‡å®šè®¿é—®åŒä¸€å†…å­˜ç©ºé—´çš„çº¿ç¨‹é¡ºåºçš„æƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æƒ…å†µä¸€ä¹‹å‰å·²ç»è§£é‡Šè¿‡ï¼Œä¸‹é¢è®¨è®ºæƒ…å†µäºŒã€‚è¿™æ˜¯ã€Œæ§åˆ¶çº¿ç¨‹æ‰§è¡Œçš„é¡ºåºã€çš„ç›¸å…³å†…å®¹ã€‚å‡è®¾æœ‰ A B ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ A è´Ÿè´£å‘æŒ‡å®šçš„å†…å­˜ç©ºé—´å†…å†™å…¥æ•°æ®ï¼Œçº¿ç¨‹ B è´Ÿè´£å–èµ°è¯¥æ•°æ®ã€‚æ‰€ä»¥è¿™æ˜¯æœ‰é¡ºåºçš„ï¼Œä¸æŒ‰ç…§é¡ºåºå°±å¯èƒ½å‘ç”Ÿé—®é¢˜ã€‚æ‰€ä»¥è¿™ç§ä¹Ÿéœ€è¦è¿›è¡ŒåŒæ­¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1842-äº’æ–¥é‡&#34;&gt;18.4.2 äº’æ–¥é‡&lt;/h4&gt;
&lt;p&gt;äº’æ–¥é”ï¼ˆè‹±è¯­ï¼šè‹±è¯­ï¼šMutual exclusionï¼Œç¼©å†™ Mutexï¼‰æ˜¯ä¸€ç§ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œé˜²æ­¢ä¸¤æ¡çº¿ç¨‹åŒæ—¶å¯¹åŒä¸€å…¬å…±èµ„æºï¼ˆæ¯”å¦‚å…¨åŸŸå˜é‡ï¼‰è¿›è¡Œè¯»å†™çš„æœºåˆ¶ã€‚è¯¥ç›®çš„é€šè¿‡å°†ä»£ç åˆ‡ç‰‡æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸´ç•ŒåŒºåŸŸï¼ˆcritical sectionï¼‰è¾¾æˆã€‚ä¸´ç•ŒåŒºåŸŸæŒ‡çš„æ˜¯ä¸€å—å¯¹å…¬å…±èµ„æºè¿›è¡Œè®¿é—®çš„ä»£ç ï¼Œå¹¶éä¸€ç§æœºåˆ¶æˆ–æ˜¯ç®—æ³•ã€‚ä¸€ä¸ªç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªä¸´ç•ŒåŒºåŸŸï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šä¼šåº”ç”¨äº’æ–¥é”ã€‚&lt;/p&gt;
&lt;p&gt;é€šä¿—çš„è¯´å°±äº’æ–¥é‡å°±æ˜¯ä¸€æŠŠä¼˜ç§€çš„é”ï¼Œå½“ä¸´ç•ŒåŒºè¢«å æ®çš„æ—¶å€™å°±ä¸Šé”ï¼Œç­‰å ç”¨å®Œæ¯•ç„¶åå†æ”¾å¼€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯äº’æ–¥é‡çš„åˆ›å»ºåŠé”€æ¯å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_mutex_init&lt;/span&gt;(pthread_mutex_t *mutex,
                       &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; pthread_mutexattr_t *attr);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_mutex_destroy&lt;/span&gt;(pthread_mutex_t *mutex);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å›å…¶ä»–å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;mutex : åˆ›å»ºäº’æ–¥é‡æ—¶ä¼ é€’ä¿å­˜äº’æ–¥é‡çš„å˜é‡åœ°å€å€¼ï¼Œé”€æ¯æ—¶ä¼ é€’éœ€è¦é”€æ¯çš„äº’æ–¥é‡åœ°å€
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;attr : ä¼ é€’å³å°†åˆ›å»ºçš„äº’æ–¥é‡å±æ€§ï¼Œæ²¡æœ‰ç‰¹åˆ«éœ€è¦æŒ‡å®šçš„å±æ€§æ—¶ä¼ é€’ NULL
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»ä¸Šè¿°å‡½æ•°å£°æ˜ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†åˆ›å»ºç›¸å½“äºé”ç³»ç»Ÿçš„äº’æ–¥é‡ï¼Œéœ€è¦å£°æ˜å¦‚ä¸‹ pthread_mutex_t å‹å˜é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;pthread_mutex_t mutex
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¯¥å˜é‡çš„åœ°å€å€¼ä¼ é€’ç»™ pthread_mutex_init å‡½æ•°ï¼Œç”¨æ¥ä¿å­˜æ“ä½œç³»ç»Ÿåˆ›å»ºçš„äº’æ–¥é‡ï¼ˆé”ç³»ç»Ÿï¼‰ã€‚è°ƒç”¨ pthread_mutex_destroy å‡½æ•°æ—¶åŒæ ·éœ€è¦è¯¥ä¿¡æ¯ã€‚å¦‚æœä¸éœ€è¦é…ç½®ç‰¹æ®Šçš„äº’æ–¥é‡å±æ€§ï¼Œåˆ™å‘ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ NULL æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ PTHREAD_MUTEX_INITIALIZER è¿›è¡Œå¦‚ä¸‹å£°æ˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ¨èå°½å¯èƒ½çš„ä½¿ç”¨ pthread_mutex_init å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºé€šè¿‡å®è¿›è¡Œåˆå§‹åŒ–æ—¶å¾ˆéš¾å‘ç°å‘ç”Ÿçš„é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åˆ©ç”¨äº’æ–¥é‡é”ä½æˆ–é‡Šæ”¾ä¸´ç•ŒåŒºæ—¶ä½¿ç”¨çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_mutex_lock&lt;/span&gt;(pthread_mutex_t *mutex);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_mutex_unlock&lt;/span&gt;(pthread_mutex_t *mutex);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å›å…¶ä»–å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å‡½æ•°æœ¬èº«å«æœ‰ lock unlock ç­‰è¯æ±‡ï¼Œå¾ˆå®¹æ˜“ç†è§£å…¶å«ä¹‰ã€‚è¿›å…¥ä¸´ç•ŒåŒºå‰è°ƒç”¨çš„å‡½æ•°å°±æ˜¯ pthread_mutex_lock ã€‚è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå‘ç°æœ‰å…¶ä»–çº¿ç¨‹å·²ç»è¿›å…¥ä¸´ç•ŒåŒºï¼Œåˆ™ pthread_mutex_lock å‡½æ•°ä¸ä¼šè¿”å›ï¼Œç›´åˆ°é‡Œé¢çš„çº¿ç¨‹è°ƒç”¨ pthread_mutex_unlock å‡½æ•°é€€å‡ºä¸´ç•ŒåŒºä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»–çº¿ç¨‹è®©å‡ºä¸´ç•ŒåŒºä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚æ¥ä¸‹æ¥æ•´ç†ä¸€ä¸‹ä»£ç çš„ç¼–å†™æ–¹å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;pthread_mutex_lock(&amp;amp;mutex);
&lt;span style=&#34;color:#228b22&#34;&gt;//ä¸´ç•ŒåŒºå¼€å§‹
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;//...
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;//ä¸´ç•ŒåŒºç»“æŸ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;pthread_mutex_unlock(&amp;amp;mutex);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç®€è¨€ä¹‹ï¼Œå°±æ˜¯åˆ©ç”¨ lock å’Œ unlock å‡½æ•°å›´ä½ä¸´ç•ŒåŒºçš„ä¸¤ç«¯ã€‚æ­¤æ—¶äº’æ–¥é‡ç›¸å½“äºä¸€æŠŠé”ï¼Œé˜»æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œçº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºæ—¶ï¼Œå¦‚æœå¿˜äº†è°ƒç”¨ pthread_mutex_unlock å‡½æ•°ï¼Œé‚£ä¹ˆå…¶ä»–ä¸ºäº†è¿›å…¥ä¸´ç•ŒåŒºè€Œè°ƒç”¨ pthread_mutex_lock çš„å‡½æ•°æ— æ³•æ‘†è„±é˜»å¡çŠ¶æ€ã€‚è¿™ç§æƒ…å†µç§°ä¸ºã€Œæ­»é”ã€ã€‚éœ€è¦æ ¼å¤–æ³¨æ„ï¼Œä¸‹é¢æ˜¯åˆ©ç”¨äº’æ–¥é‡è§£å†³ç¤ºä¾‹ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/thread4.c&#34;&gt;thread4.c&lt;/a&gt; ä¸­é‡åˆ°çš„é—®é¢˜ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/mutex.c&#34;&gt;mutex.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;49
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;50
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;51
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define NUM_THREAD 100
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_des&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; num = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
pthread_mutex_t mutex; &lt;span style=&#34;color:#228b22&#34;&gt;//ä¿å­˜äº’æ–¥é‡è¯»å–å€¼çš„å˜é‡
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pthread_t thread_id[NUM_THREAD];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;

    pthread_mutex_init(&amp;amp;mutex, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//åˆ›å»ºäº’æ–¥é‡
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; NUM_THREAD; i++)
    {
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (i % &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;)
            pthread_create(&amp;amp;(thread_id[i]), &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_inc, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
            pthread_create(&amp;amp;(thread_id[i]), &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, thread_des, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    }

    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; NUM_THREAD; i++)
        pthread_join(thread_id[i], &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);

    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;result: %lld &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, num);
    pthread_mutex_destroy(&amp;amp;mutex); &lt;span style=&#34;color:#228b22&#34;&gt;//é”€æ¯äº’æ–¥é‡
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    pthread_mutex_lock(&amp;amp;mutex); &lt;span style=&#34;color:#228b22&#34;&gt;//ä¸Šé”
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num += &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    pthread_mutex_unlock(&amp;amp;mutex); &lt;span style=&#34;color:#228b22&#34;&gt;//è§£é”
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_des&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    pthread_mutex_lock(&amp;amp;mutex);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num -= &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    pthread_mutex_unlock(&amp;amp;mutex);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc mutex.c -D_REENTRANT -o mutex -lpthread
./mutex
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c567e4aafbb8.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡äº’æ–¥é‡æœºåˆ¶å¾—å‡ºäº†æ­£ç¡®çš„è¿è¡Œç»“æœã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä»£ç ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;thread_inc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    pthread_mutex_lock(&amp;amp;mutex); &lt;span style=&#34;color:#228b22&#34;&gt;//ä¸Šé”
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;50000000&lt;/span&gt;; i++)
        num += &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    pthread_mutex_unlock(&amp;amp;mutex); &lt;span style=&#34;color:#228b22&#34;&gt;//è§£é”
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šä»£ç çš„ä¸´ç•ŒåŒºåˆ’åˆ†èŒƒå›´è¾ƒå¤§ï¼Œä½†è¿™æ˜¯è€ƒè™‘å¦‚ä¸‹ä¼˜ç‚¹æ‰€åšçš„å†³å®š:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ€å¤§é™åº¦å‡å°‘äº’æ–¥é‡ lock unlock å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;1843-ä¿¡å·é‡&#34;&gt;18.4.3 ä¿¡å·é‡&lt;/h4&gt;
&lt;p&gt;ä¿¡å·é‡ï¼ˆè‹±è¯­ï¼šSemaphoreï¼‰åˆç§°ä¸ºä¿¡å·æ ‡ï¼Œæ˜¯ä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼Œç”¨äºä¿æŒåœ¨0è‡³æŒ‡å®šæœ€å¤§å€¼ä¹‹é—´çš„ä¸€ä¸ªè®¡æ•°å€¼ã€‚å½“çº¿ç¨‹å®Œæˆä¸€æ¬¡å¯¹è¯¥semaphoreå¯¹è±¡çš„ç­‰å¾…ï¼ˆwaitï¼‰æ—¶ï¼Œè¯¥è®¡æ•°å€¼å‡ä¸€ï¼›å½“çº¿ç¨‹å®Œæˆä¸€æ¬¡å¯¹semaphoreå¯¹è±¡çš„é‡Šæ”¾ï¼ˆreleaseï¼‰æ—¶ï¼Œè®¡æ•°å€¼åŠ ä¸€ã€‚å½“è®¡æ•°å€¼ä¸º0ï¼Œåˆ™çº¿ç¨‹ç­‰å¾…è¯¥semaphoreå¯¹è±¡ä¸å†èƒ½æˆåŠŸç›´è‡³è¯¥semaphoreå¯¹è±¡å˜æˆsignaledçŠ¶æ€ã€‚semaphoreå¯¹è±¡çš„è®¡æ•°å€¼å¤§äº0ï¼Œä¸ºsignaledçŠ¶æ€ï¼›è®¡æ•°å€¼ç­‰äº0ï¼Œä¸ºnonsignaledçŠ¶æ€.&lt;/p&gt;
&lt;p&gt;semaphoreå¯¹è±¡é€‚ç”¨äºæ§åˆ¶ä¸€ä¸ªä»…æ”¯æŒæœ‰é™ä¸ªç”¨æˆ·çš„å…±äº«èµ„æºï¼Œæ˜¯ä¸€ç§ä¸éœ€è¦ä½¿ç”¨å¿™ç¢Œç­‰å¾…ï¼ˆbusy waitingï¼‰çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¿¡å·é‡çš„æ¦‚å¿µæ˜¯ç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶è‰¾å…¹èµ«å°”Â·æˆ´å…‹æ–¯ç‰¹æ‹‰ï¼ˆEdsger W. Dijkstraï¼‰å‘æ˜çš„ï¼Œå¹¿æ³›çš„åº”ç”¨äºä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œç»™äºˆæ¯ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªä¿¡å·é‡ï¼Œä»£è¡¨æ¯ä¸ªè¿›ç¨‹å½“å‰çš„çŠ¶æ€ï¼Œæœªå¾—åˆ°æ§åˆ¶æƒçš„è¿›ç¨‹ä¼šåœ¨ç‰¹å®šåœ°æ–¹è¢«å¼ºè¿«åœä¸‹æ¥ï¼Œç­‰å¾…å¯ä»¥ç»§ç»­è¿›è¡Œçš„ä¿¡å·åˆ°æ¥ã€‚å¦‚æœä¿¡å·é‡æ˜¯ä¸€ä¸ªä»»æ„çš„æ•´æ•°ï¼Œé€šå¸¸è¢«ç§°ä¸ºè®¡æ•°ä¿¡å·é‡ï¼ˆCounting semaphoreï¼‰ï¼Œæˆ–ä¸€èˆ¬ä¿¡å·é‡ï¼ˆgeneral semaphoreï¼‰ï¼›å¦‚æœä¿¡å·é‡åªæœ‰äºŒè¿›åˆ¶çš„0æˆ–1ï¼Œç§°ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰ã€‚åœ¨linuxç³»ç»Ÿä¸­ï¼ŒäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰åˆç§°äº’æ–¥é”ï¼ˆMutexï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»‹ç»ä¿¡å·é‡ï¼Œåœ¨äº’æ–¥é‡çš„åŸºç¡€ä¸Šï¼Œå¾ˆå®¹æ˜“ç†è§£ä¿¡å·é‡ã€‚æ­¤å¤„åªæ¶‰åŠåˆ©ç”¨ã€ŒäºŒè¿›åˆ¶ä¿¡å·é‡ã€ï¼ˆåªç”¨ 0 å’Œ 1ï¼‰å®Œæˆã€Œæ§åˆ¶çº¿ç¨‹é¡ºåºã€ä¸ºä¸­å¿ƒçš„åŒæ­¥æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¿¡å·é‡çš„åˆ›å»ºåŠé”€æ¯æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;semaphore.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;sem_init&lt;/span&gt;(sem_t *sem, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; pshared, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; value);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;sem_destroy&lt;/span&gt;(sem_t *sem);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å›å…¶ä»–å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;sem : åˆ›å»ºä¿¡å·é‡æ—¶ä¿å­˜ä¿¡å·é‡çš„å˜é‡åœ°å€å€¼ï¼Œé”€æ¯æ—¶ä¼ é€’éœ€è¦é”€æ¯çš„ä¿¡å·é‡å˜é‡åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;pshared : ä¼ é€’å…¶ä»–å€¼æ—¶ï¼Œåˆ›å»ºå¯ç”±å¤šä¸ªç»§æ‰¿å…±äº«çš„ä¿¡å·é‡ï¼›ä¼ é€’ 0 æ—¶ï¼Œåˆ›å»ºåªå…è®¸ 1 ä¸ªè¿›ç¨‹å†…éƒ¨ä½¿ç”¨çš„ä¿¡å·é‡ã€‚éœ€è¦å®ŒæˆåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹åŒæ­¥ï¼Œæ•…ä¸º0
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;value : æŒ‡å®šåˆ›å»ºä¿¡å·é‡çš„åˆå§‹å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šè¿°çš„ shared å‚æ•°è¶…å‡ºäº†æˆ‘ä»¬çš„å…³æ³¨èŒƒå›´ï¼Œæ•…é»˜è®¤å‘å…¶ä¼ é€’ä¸º 0 ã€‚ä¸‹é¢æ˜¯ä¿¡å·é‡ä¸­ç›¸å½“äºäº’æ–¥é‡ lock unlock çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;semaphore.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;sem_post&lt;/span&gt;(sem_t *sem);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;sem_wait&lt;/span&gt;(sem_t *sem);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å›å…¶ä»–å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;sem : ä¼ é€’ä¿å­˜ä¿¡å·é‡è¯»å–å€¼çš„å˜é‡åœ°å€å€¼ï¼Œä¼ é€’ç»™ sem_post çš„ä¿¡å·é‡å¢1ï¼Œä¼ é€’ç»™ sem_wait æ—¶ä¿¡å·é‡å‡ä¸€
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨ sem_init å‡½æ•°æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†åˆ›å»ºä¿¡å·é‡å¯¹è±¡ï¼Œæ­¤å¯¹è±¡ä¸­è®°å½•è¿™ã€Œä¿¡å·é‡å€¼ã€ï¼ˆSemaphore Valueï¼‰æ•´æ•°ã€‚è¯¥å€¼åœ¨è°ƒç”¨ sem_post å‡½æ•°æ—¶å¢åŠ  1 ï¼Œè°ƒç”¨ wait_wait å‡½æ•°æ—¶å‡ä¸€ã€‚ä½†ä¿¡å·é‡çš„å€¼ä¸èƒ½å°äº 0 ï¼Œå› æ­¤ï¼Œåœ¨ä¿¡å·é‡ä¸º 0 çš„æƒ…å†µä¸‹è°ƒç”¨ sem_wait å‡½æ•°æ—¶ï¼Œè°ƒç”¨çš„çº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼ˆå› ä¸ºå‡½æ•°æœªè¿”å›ï¼‰ã€‚å½“ç„¶ï¼Œæ­¤æ—¶å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨ sem_post å‡½æ•°ï¼Œä¿¡å·é‡çš„å€¼å°†å˜ä¸º 1 ï¼Œè€ŒåŸæœ¬é˜»å¡çš„çº¿ç¨‹å¯ä»¥å°†è¯¥ä¿¡å·é‡æ–°å‡ä¸º 0 å¹¶è·³å‡ºé˜»å¡çŠ¶æ€ã€‚å®é™…ä¸Šå°±æ˜¯é€šè¿‡è¿™ç§ç‰¹æ€§å®Œæˆä¸´ç•ŒåŒºçš„åŒæ­¥æ“ä½œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å½¢å¼åŒæ­¥ä¸´ç•ŒåŒºï¼ˆå‡è®¾ä¿¡å·é‡çš„åˆå§‹å€¼ä¸º 1ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;sem_wait(&amp;amp;sem);&lt;span style=&#34;color:#228b22&#34;&gt;//ä¿¡å·é‡å˜ä¸º0...
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// ä¸´ç•ŒåŒºçš„å¼€å§‹
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;//...
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;//ä¸´ç•ŒåŒºçš„ç»“æŸ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;sem_post(&amp;amp;sem);&lt;span style=&#34;color:#228b22&#34;&gt;//ä¿¡å·é‡å˜ä¸º1...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šè¿°ä»£ç ç»“æ„ä¸­ï¼Œè°ƒç”¨ sem_wait å‡½æ•°è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹åœ¨è°ƒç”¨ sem_post å‡½æ•°å‰ä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚ä¿¡å·é‡çš„å€¼åœ¨ 0 å’Œ  1 ä¹‹é—´è·³è½¬ï¼Œå› æ­¤ï¼Œå…·æœ‰è¿™ç§ç‰¹æ€§çš„æœºåˆ¶ç§°ä¸ºã€ŒäºŒè¿›åˆ¶ä¿¡å·é‡ã€ã€‚æ¥ä¸‹æ¥çš„ä»£ç æ˜¯ä¿¡å·é‡æœºåˆ¶çš„ä»£ç ã€‚ä¸‹é¢ä»£ç å¹¶éæ˜¯åŒæ—¶è®¿é—®çš„åŒæ­¥ï¼Œè€Œæ˜¯å…³äºæ§åˆ¶è®¿é—®é¡ºåºçš„åŒæ­¥ï¼Œè¯¥åœºæ™¯ä¸ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;çº¿ç¨‹  A ä»ç”¨æˆ·è¾“å…¥å¾—åˆ°å€¼åå­˜å…¥å…¨å±€å˜é‡ num ï¼Œæ­¤æ—¶çº¿ç¨‹ B å°†å–èµ°è¯¥å€¼å¹¶ç´¯åŠ ã€‚è¯¥è¿‡ç¨‹ä¸€å…±è¿›è¡Œ 5 æ¬¡ï¼Œå®Œæˆåè¾“å‡ºæ€»å’Œå¹¶é€€å‡ºç¨‹åºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/semaphore.c&#34;&gt;semaphore.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;49
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;50
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;51
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;semaphore.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;read&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;accu&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg);
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;static&lt;/span&gt; sem_t sem_one;
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;static&lt;/span&gt; sem_t sem_two;
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; num;

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; *argv[])
{
    pthread_t id_t1, id_t2;
    sem_init(&amp;amp;sem_one, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
    sem_init(&amp;amp;sem_two, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);

    pthread_create(&amp;amp;id_t1, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, read, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    pthread_create(&amp;amp;id_t2, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;, accu, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);

    pthread_join(id_t1, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
    pthread_join(id_t2, &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);

    sem_destroy(&amp;amp;sem_one);
    sem_destroy(&amp;amp;sem_two);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;read&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;; i++)
    {
        fputs(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Input num: &amp;#34;&lt;/span&gt;, stdout);

        sem_wait(&amp;amp;sem_two);
        scanf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;%d&amp;#34;&lt;/span&gt;, &amp;amp;num);
        sem_post(&amp;amp;sem_one);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *&lt;span style=&#34;color:#008b45&#34;&gt;accu&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *arg)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sum = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;, i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;; i++)
    {
        sem_wait(&amp;amp;sem_one);
        sum += num;
        sem_post(&amp;amp;sem_two);
    }
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Result: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, sum);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc semaphore.c -D_REENTRANT -o sema -lpthread
./sema
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c568c2717d1e.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè®¾ç½®äº†ä¸¤ä¸ªä¿¡å·é‡ one çš„åˆå§‹å€¼ä¸º 0 ï¼Œtwo çš„åˆå§‹å€¼ä¸º 1ï¼Œç„¶ååœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œã€Œè¯»ã€çš„å‰ææ˜¯ two å¯ä»¥å‡ä¸€ï¼Œå¦‚æœä¸èƒ½å‡ä¸€å°±ä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œä¸€ç›´ç­‰åˆ°ã€Œè®¡ç®—ã€æ“ä½œå®Œæ¯•åï¼Œç»™ two åŠ ä¸€ï¼Œç„¶åå°±å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€å¥è¾“å…¥ã€‚å¯¹äºã€Œè®¡ç®—ã€å‡½æ•°ï¼Œä¹Ÿä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;185-çº¿ç¨‹çš„é”€æ¯å’Œå¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç«¯çš„å®ç°&#34;&gt;18.5 çº¿ç¨‹çš„é”€æ¯å’Œå¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç«¯çš„å®ç°&lt;/h3&gt;
&lt;p&gt;å…ˆä»‹ç»çº¿ç¨‹çš„é”€æ¯ï¼Œç„¶åå†ä»‹ç»å¤šçº¿ç¨‹æœåŠ¡ç«¯&lt;/p&gt;
&lt;h4 id=&#34;1851-é”€æ¯çº¿ç¨‹çš„-3-ç§æ–¹æ³•&#34;&gt;18.5.1 é”€æ¯çº¿ç¨‹çš„ 3 ç§æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;Linux çš„çº¿ç¨‹å¹¶ä¸æ˜¯åœ¨é¦–æ¬¡è°ƒç”¨çš„çº¿ç¨‹ main å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥åˆ©ç”¨å¦‚ä¸‹æ–¹æ³•ä¹‹ä¸€åŠ ä»¥æ˜ç¡®ã€‚å¦åˆ™ç”±çº¿ç¨‹åˆ›å»ºçš„å†…å­˜ç©ºé—´å°†ä¸€ç›´å­˜åœ¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨ pthread_join å‡½æ•°&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ pthread_detach å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹‹å‰è°ƒç”¨è¿‡ pthread_join å‡½æ•°ã€‚è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¸ä»…ä¼šç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ï¼Œè¿˜ä¼šå¼•å¯¼çº¿ç¨‹é”€æ¯ã€‚ä½†è¯¥å‡½æ•°çš„é—®é¢˜æ˜¯ï¼Œçº¿ç¨‹ç»ˆæ­¢å‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ã€‚å› æ­¤ï¼Œé€šè¿‡å¦‚ä¸‹å‡½æ•°è°ƒç”¨å¼•å¯¼çº¿ç¨‹é”€æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pthread_detach&lt;/span&gt;(pthread_t th);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å›å…¶ä»–å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;thread : ç»ˆæ­¢çš„åŒæ—¶éœ€è¦é”€æ¯çš„çº¿ç¨‹ ID
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨ä¸Šè¿°å‡½æ•°ä¸ä¼šå¼•èµ·çº¿ç¨‹ç»ˆæ­¢æˆ–è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡è¯¥å‡½æ•°å¼•å¯¼é”€æ¯çº¿ç¨‹åˆ›å»ºçš„å†…å­˜ç©ºé—´ã€‚è°ƒç”¨è¯¥å‡½æ•°åä¸èƒ½å†é’ˆå¯¹ç›¸åº”çº¿ç¨‹è°ƒç”¨ pthread_join å‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1852-å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç«¯çš„å®ç°&#34;&gt;18.5.2 å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç«¯çš„å®ç°&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥äº¤æ¢ä¿¡æ¯çš„ç®€å•èŠå¤©ç¨‹åºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/chat_server.c&#34;&gt;chat_server.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch18/chat_clnt.c&#34;&gt;chat_clnt.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„æœåŠ¡ç«¯ç¤ºä¾‹ä¸­ï¼Œéœ€è¦æŒæ¡ä¸´ç•ŒåŒºçš„æ„æˆï¼Œè®¿é—®å…¨å±€å˜é‡ clnt_cnt å’Œæ•°ç»„ clnt_socks çš„ä»£ç å°†æ„æˆä¸´ç•ŒåŒºï¼Œæ·»åŠ å’Œåˆ é™¤å®¢æˆ·ç«¯æ—¶ï¼Œå˜é‡ clnt_cnt å’Œæ•°ç»„ clnt_socks å°†åŒæ—¶å‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ä¸‹åˆ—æƒ…å½¢ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œä»è€Œå¼•å‘é”™è¯¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹ A ä»æ•°ç»„ clnt_socks ä¸­åˆ é™¤å¥—æ¥å­—ä¿¡æ¯ï¼ŒåŒæ—¶çº¿ç¨‹ B è¯»å– clnt_cnt å˜é‡&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ A è¯»å–å˜é‡ clnt_cnt ï¼ŒåŒæ—¶çº¿ç¨‹ B å°†å¥—æ¥å­—ä¿¡æ¯æ·»åŠ åˆ° clnt_socks æ•°ç»„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc chat_server.c -D_REENTRANT -o cserv -lpthread
gcc chat_clnt.c -D_REENTRANT -o cclnt -lpthread
./cserv &lt;span style=&#34;color:#b452cd&#34;&gt;9191&lt;/span&gt;
./cclnt 127.0.0.1 &lt;span style=&#34;color:#b452cd&#34;&gt;9191&lt;/span&gt; å¼ ä¸‰
./cclnt 127.0.0.1 &lt;span style=&#34;color:#b452cd&#34;&gt;9191&lt;/span&gt; æå››
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/03/5c569b70634ff.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;186-ä¹ é¢˜&#34;&gt;18.6 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å• CPU ç³»ç»Ÿä¸­å¦‚ä½•åŒæ—¶æ‰§è¡Œå¤šä¸ªè¿›ç¨‹ï¼Ÿè¯·è§£é‡Šè¯¥è¿‡ç¨‹ä¸­å‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šç³»ç»Ÿå°† CPU æ—¶é—´åˆ†æˆå¤šä¸ªå¾®ç¬‘çš„å—ååˆ†é…ç»™äº†å¤šä¸ªè¿›ç¨‹ã€‚ä¸ºäº†åˆ†æ—¶ä½¿ç”¨ CPU ï¼Œéœ€è¦ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€è¿‡ç¨‹ã€‚è¿è¡Œç¨‹åºå‰éœ€è¦å°†ç›¸åº”è¿›ç¨‹ä¿¡æ¯è¯»å…¥å†…å­˜ï¼Œå¦‚æœè¿è¡Œè¿›ç¨‹ A åéœ€è¦ç´§æ¥ç€è¿è¡Œè¿›ç¨‹ B ï¼Œå°±åº”è¯¥å°†è¿›ç¨‹ A ç›¸å…³ä»Šå¤•ç§»å‡ºå†…å­˜ï¼Œå¹¶è¯»å…¥è¿›ç¨‹ B çš„ä¿¡æ¯ã€‚è¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä½•çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é€Ÿåº¦ç›¸å¯¹æ›´å¿«ï¼Ÿçº¿ç¨‹é—´æ•°æ®äº¤æ¢ä¸ºä½•ä¸éœ€è¦ç±»ä¼¼ IPC ç‰¹åˆ«æŠ€æœ¯&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸éœ€è¦åˆ‡æ¢æ•°æ®åŒºå’Œå †ã€‚å¯ä»¥åˆ©ç”¨æ•°æ®åŒºå’Œå †äº¤æ¢æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·ä»æ‰§è¡Œæµè§’åº¦è¯´æ˜è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šè¿›ç¨‹ï¼šåœ¨æ“ä½œç³»ç»Ÿæ„æˆå•ç‹¬æ‰§è¡Œæµçš„å•ä½ã€‚çº¿ç¨‹ï¼šåœ¨è¿›ç¨‹å†…éƒ¨æ„æˆå•ç‹¬æ‰§è¡Œæµçš„å•ä½ã€‚çº¿ç¨‹ä¸ºäº†ä¿æŒå¤šæ¡ä»£ç æ‰§è¡Œæµè€Œéš”å¼€äº†æ ˆåŒºåŸŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹é¢å…³äºä¸´ç•ŒåŒºçš„è¯´æ³•é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä¸‹é¢åŠ ç²—çš„é€‰é¡¹ä¸ºè¯´æ³•æ­£ç¡®ã€‚ï¼ˆå…¨é”™ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸´ç•ŒåŒºæ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶å‘ç”Ÿé—®é¢˜çš„åŒºåŸŸ&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹å®‰å…¨çš„å‡½æ•°ä¸­ä¸å­˜åœ¨ä¸´ç•ŒåŒºï¼Œå³ä¾¿å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ä¹Ÿä¸ä¼šå‘ç”Ÿé—®é¢˜&lt;/li&gt;
&lt;li&gt;1 ä¸ªä¸´ç•ŒåŒºåªèƒ½ç”± 1 ä¸ªä»£ç å—ï¼Œè€Œéå¤šä¸ªä»£ç å—æ„æˆã€‚æ¢è¨€ä¹‹ï¼Œçº¿ç¨‹ A æ‰§è¡Œçš„ä»£ç å— A å’Œçº¿ç¨‹ B æ‰§è¡Œçš„ä»£ç å— B ä¹‹é—´ç»å¯¹ä¸ä¼šæ„æˆä¸´ç•ŒåŒºã€‚&lt;/li&gt;
&lt;li&gt;ä¸´ç•ŒåŒºç”±è®¿é—®å…¨å±€å˜é‡çš„ä»£ç æ„æˆã€‚å…¶ä»–å˜é‡ä¸­ä¸ä¼šå‘ç”Ÿé—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äºçº¿ç¨‹åŒæ­¥çš„è¯´æ³•é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä¸‹é¢åŠ ç²—çš„é€‰é¡¹ä¸ºè¯´æ³•æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¿ç¨‹åŒæ­¥å°±æ˜¯é™åˆ¶è®¿é—®ä¸´ç•ŒåŒº&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹åŒæ­¥ä¹Ÿå…·æœ‰æ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºçš„å«ä¹‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº’æ–¥é‡å’Œä¿¡å·é‡æ˜¯å…¸å‹çš„åŒæ­¥æŠ€æœ¯&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹åŒæ­¥æ˜¯ä»£æ›¿è¿›ç¨‹ IPC çš„æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·è¯´æ˜å®Œå…¨é”€æ¯ Linux çº¿ç¨‹çš„ 2 ç§åŠæ³•&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šâ‘ è°ƒç”¨ pthread_join å‡½æ•°â‘¡è°ƒç”¨ pthread_detach å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªä¼šé˜»å¡è°ƒç”¨çš„çº¿ç¨‹ï¼Œè€Œç¬¬äºŒä¸ªä¸é˜»å¡ã€‚éƒ½å¯ä»¥å¼•å¯¼çº¿ç¨‹é”€æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-18-%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%9A%84%E5%AE%9E%E7%8E%B0-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 17 ç«  ä¼˜äº select çš„ epoll ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-17-%E7%AB%A0-%E4%BC%98%E4%BA%8E-select-%E7%9A%84-epoll-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Sat, 09 Apr 2022 19:06:05 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-17-%E7%AB%A0-%E4%BC%98%E4%BA%8E-select-%E7%9A%84-epoll-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-17-%E7%AB%A0-%E4%BC%98%E4%BA%8E-select-%E7%9A%84-epoll-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-17-ç« -ä¼˜äº-select-çš„-epoll&#34;&gt;ç¬¬ 17 ç«  ä¼˜äº select çš„ epoll&lt;/h2&gt;
&lt;h3 id=&#34;171-epoll-ç†è§£åŠåº”ç”¨&#34;&gt;17.1 epoll ç†è§£åŠåº”ç”¨&lt;/h3&gt;
&lt;p&gt;select å¤ç”¨æ–¹æ³•ç”±æ¥å·²ä¹…ï¼Œå› æ­¤ï¼Œåˆ©ç”¨è¯¥æŠ€æœ¯åï¼Œæ— è®ºå¦‚ä½•ä¼˜åŒ–ç¨‹åºæ€§èƒ½ä¹Ÿæ— æ³•åŒæ—¶ä»‹å…¥ä¸Šç™¾ä¸ªå®¢æˆ·ç«¯ã€‚è¿™ç§ select æ–¹å¼å¹¶ä¸é€‚åˆä»¥ web æœåŠ¡å™¨ç«¯å¼€å‘ä¸ºä¸»æµçš„ç°ä»£å¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦å­¦ä¹  Linux ç¯å¢ƒä¸‹çš„ epoll&lt;/p&gt;
&lt;h4 id=&#34;1711-åŸºäº-select-çš„-io-å¤ç”¨æŠ€æœ¯é€Ÿåº¦æ…¢çš„åŸå› &#34;&gt;17.1.1 åŸºäº select çš„ I/O å¤ç”¨æŠ€æœ¯é€Ÿåº¦æ…¢çš„åŸå› &lt;/h4&gt;
&lt;p&gt;ç¬¬ 12 ç« å®ç°äº†åŸºäº select çš„ I/O å¤ç”¨æŠ€æœ¯æœåŠ¡ç«¯ï¼Œå…¶ä¸­æœ‰ä¸åˆç†çš„è®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨ select å‡½æ•°åå¸¸è§çš„é’ˆå¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å¾ªç¯è¯­å¥&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨ select å‡½æ•°æ—¶éƒ½éœ€è¦å‘è¯¥å‡½æ•°ä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šè¿°ä¸¤ç‚¹å¯ä»¥ä» &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch12/echo_selectserv.c&#34;&gt;echo_selectserv.c&lt;/a&gt; å¾—åˆ°ç¡®è®¤ï¼Œè°ƒç”¨ select å‡½æ•°åï¼Œå¹¶ä¸æ˜¯æŠŠå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦å•ç‹¬é›†ä¸­åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯é€šè¿‡ä½œä¸ºç›‘è§†å¯¹è±¡çš„ fd_set å˜é‡çš„å˜åŒ–ï¼Œæ‰¾å‡ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ54,56è¡Œï¼‰ï¼Œå› æ­¤æ— æ³•é¿å…é’ˆå¯¹æ‰€æœ‰ç›‘è§†å¯¹è±¡çš„å¾ªç¯è¯­å¥ã€‚è€Œä¸”ï¼Œä½œä¸ºç›‘è§†å¯¹è±¡çš„ fd_set ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥è°ƒç”¨ select å‡½æ•°å‰åº”è¯¥å¤åˆ¶å¹¶ä¿å­˜åŸæœ‰ä¿¡æ¯ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨ select å‡½æ•°æ—¶ä¼ é€’æ–°çš„ç›‘è§†å¯¹è±¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;select æ€§èƒ½ä¸Šæœ€å¤§çš„å¼±ç‚¹æ˜¯ï¼šæ¯æ¬¡ä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯ï¼Œå‡†ç¡®çš„è¯´ï¼Œselect æ˜¯ç›‘è§†å¥—æ¥å­—å˜åŒ–çš„å‡½æ•°ã€‚è€Œå¥—æ¥å­—æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„ï¼Œæ‰€ä»¥ select å‡½æ•°è¦å€ŸåŠ©æ“ä½œç³»ç»Ÿæ‰èƒ½å®ŒæˆåŠŸèƒ½ã€‚select å‡½æ•°çš„è¿™ä¸€ç¼ºç‚¹å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å¼¥è¡¥ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»…å‘æ“ä½œç³»ç»Ÿä¼ é€’ä¸€æ¬¡ç›‘è§†å¯¹è±¡ï¼Œç›‘è§†èŒƒå›´æˆ–å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶åªé€šçŸ¥å‘ç”Ÿå˜åŒ–çš„äº‹é¡¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ ·å°±æ— éœ€æ¯æ¬¡è°ƒç”¨ select å‡½æ•°æ—¶éƒ½æƒ³æ“ä½œç³»ç»Ÿä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯ï¼Œä½†æ˜¯å‰ææ“ä½œç³»ç»Ÿæ”¯æŒè¿™ç§å¤„ç†æ–¹å¼ã€‚Linux çš„æ”¯æŒæ–¹å¼æ˜¯ epoll ï¼ŒWindows çš„æ”¯æŒæ–¹å¼æ˜¯ IOCPã€‚&lt;/p&gt;
&lt;h4 id=&#34;1712-select-ä¹Ÿæœ‰æœ‰ç‚¹&#34;&gt;17.1.2 select ä¹Ÿæœ‰æœ‰ç‚¹&lt;/h4&gt;
&lt;p&gt;select çš„å…¼å®¹æ€§æ¯”è¾ƒé«˜ï¼Œè¿™æ ·å°±å¯ä»¥æ”¯æŒå¾ˆå¤šçš„æ“ä½œç³»ç»Ÿï¼Œä¸å—å¹³å°çš„é™åˆ¶ï¼Œä½¿ç”¨ select å‡½æ•°æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨æ¥å…¥è€…å°‘&lt;/li&gt;
&lt;li&gt;ç¨‹åºåº”è¯¥å…·æœ‰å…¼å®¹æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1713-å®ç°-epoll-æ—¶å¿…è¦çš„å‡½æ•°å’Œç»“æ„ä½“&#34;&gt;17.1.3 å®ç° epoll æ—¶å¿…è¦çš„å‡½æ•°å’Œç»“æ„ä½“&lt;/h4&gt;
&lt;p&gt;èƒ½å¤Ÿå…‹æœ select å‡½æ•°ç¼ºç‚¹çš„ epoll å‡½æ•°å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼Œè¿™äº›ä¼˜ç‚¹æ­£å¥½ä¸ä¹‹å‰çš„ select å‡½æ•°ç¼ºç‚¹ç›¸åã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ— éœ€ç¼–å†™ä»¥ç›‘è§†çŠ¶æ€å˜åŒ–ä¸ºç›®çš„çš„é’ˆå¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å¾ªç¯è¯­å¥&lt;/li&gt;
&lt;li&gt;è°ƒç”¨å¯¹åº”äº select å‡½æ•°çš„ epoll_wait å‡½æ•°æ—¶æ— éœ€æ¯æ¬¡ä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ epoll å‡½æ•°çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;epoll_createï¼šåˆ›å»ºä¿å­˜ epoll æ–‡ä»¶æè¿°ç¬¦çš„ç©ºé—´&lt;/li&gt;
&lt;li&gt;epoll_ctlï¼šå‘ç©ºé—´æ³¨å†Œå¹¶æ³¨é”€æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;epoll_waitï¼šä¸ select å‡½æ•°ç±»ä¼¼ï¼Œç­‰å¾…æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿå˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;select å‡½æ•°ä¸­ä¸ºäº†ä¿å­˜ç›‘è§†å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç›´æ¥å£°æ˜äº† fd_set å˜é‡ï¼Œä½† epoll æ–¹å¼ä¸‹çš„æ“ä½œç³»ç»Ÿè´Ÿè´£ä¿å­˜ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤éœ€è¦å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¿å­˜æ–‡ä»¶æè¿°ç¬¦çš„ç©ºé—´ï¼Œæ­¤æ—¶ç”¨çš„å‡½æ•°å°±æ˜¯ epoll_create ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œä¸ºäº†æ·»åŠ å’Œåˆ é™¤ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦ï¼Œselect æ–¹å¼ä¸­éœ€è¦ FD_SETã€FD_CLR å‡½æ•°ã€‚ä½†åœ¨ epoll æ–¹å¼ä¸­ï¼Œé€šè¿‡ epoll_ctl å‡½æ•°è¯·æ±‚æ“ä½œç³»ç»Ÿå®Œæˆã€‚æœ€åï¼Œselect æ–¹å¼ä¸‹è°ƒç”¨ select å‡½æ•°ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦çš„å˜åŒ–ï¼Œè€Œ epoll_wait è°ƒç”¨ epoll_wait å‡½æ•°ã€‚è¿˜æœ‰ï¼Œselect æ–¹å¼ä¸­é€šè¿‡ fd_set å˜é‡æŸ¥çœ‹ç›‘è§†å¯¹è±¡çš„çŠ¶æ€å˜åŒ–ï¼Œè€Œ epoll æ–¹å¼é€šè¿‡å¦‚ä¸‹ç»“æ„ä½“ epoll_event å°†å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦å•ç‹¬é›†ä¸­åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event
{
    __uint32_t events;
    epoll_data_t data;
};
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;union&lt;/span&gt; epoll_data {
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *ptr;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fd;
    __uint32_t u32;
    __uint64_t u64;
} epoll_data_t;

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å£°æ˜è¶³å¤Ÿå¤§çš„ epoll_event ç»“æ„ä½“æ•°ç»„å€™ï¼Œä¼ é€’ç»™ epoll_wait å‡½æ•°æ—¶ï¼Œå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯å°†è¢«å¡«å…¥æ•°ç»„ã€‚å› æ­¤ï¼Œæ— éœ€åƒ select å‡½æ•°é‚£æ ·é’ˆå¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå¾ªç¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1714-epoll_create&#34;&gt;17.1.4 epoll_create&lt;/h4&gt;
&lt;p&gt;epoll æ˜¯ä» Linux çš„ 2.5.44 ç‰ˆå†…æ ¸å¼€å§‹å¼•å…¥çš„ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ Linux å†…æ ¸ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;cat /proc/sys/kernel/osrelease
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ epoll_create å‡½æ•°çš„åŸå‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/epoll.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;epoll_create&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; size);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› epoll çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;sizeï¼šepoll å®ä¾‹çš„å¤§å°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨ epoll_create å‡½æ•°æ—¶åˆ›å»ºçš„æ–‡ä»¶æè¿°ç¬¦ä¿å­˜ç©ºé—´ç§°ä¸ºã€Œepoll ä¾‹ç¨‹ã€ï¼Œä½†æœ‰äº›æƒ…å†µä¸‹åç§°ä¸åŒï¼Œéœ€è¦ç¨åŠ æ³¨æ„ã€‚é€šè¿‡å‚æ•° size ä¼ é€’çš„å€¼å†³å®š epoll ä¾‹ç¨‹çš„å¤§å°ï¼Œä½†è¯¥å€¼åªæ˜¯å‘æ“ä½œç³»ç»Ÿæå‡ºçš„å»ºè®®ã€‚æ¢è¨€ä¹‹ï¼Œsize å¹¶ä¸ç”¨æ¥å†³å®š epoll çš„å¤§å°ï¼Œè€Œä»…ä¾›æ“ä½œç³»ç»Ÿå‚è€ƒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Linux 2.6.8 ä¹‹åçš„å†…æ ¸å°†å®Œå…¨ä¼ å…¥ epoll_create å‡½æ•°çš„ size å‡½æ•°ï¼Œå› æ­¤å†…æ ¸ä¼šæ ¹æ®æƒ…å†µè°ƒæ•´ epoll ä¾‹ç¨‹å¤§å°ã€‚ä½†æ˜¯æœ¬ä¹¦ç¨‹åºå¹¶æ²¡æœ‰å¿½ç•¥ size&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;epoll_create å‡½æ•°åˆ›å»ºçš„èµ„æºä¸å¥—æ¥å­—ç›¸åŒï¼Œä¹Ÿç”±æ“ä½œç³»ç»Ÿç®¡ç†ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°å’Œåˆ›å»ºå¥—æ¥å­—çš„æƒ…å†µç›¸åŒï¼Œä¹Ÿä¼šè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ä¸»è¦ç”¨äºåŒºåˆ† epoll ä¾‹ç¨‹ã€‚éœ€è¦ç»ˆæ­¢æ—¶ï¼Œä¸å…¶ä»–æ–‡ä»¶æè¿°ç¬¦ç›¸åŒï¼Œä¹Ÿè¦è°ƒç”¨ close å‡½æ•°&lt;/p&gt;
&lt;h4 id=&#34;1715-epoll_ctl&#34;&gt;17.1.5 epoll_ctl&lt;/h4&gt;
&lt;p&gt;ç”Ÿæˆä¾‹ç¨‹åï¼Œåº”åœ¨å…¶å†…éƒ¨æ³¨å†Œç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦ï¼Œæ­¤æ—¶ä½¿ç”¨ epoll_ctl å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/epoll.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;epoll_ctl&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; epfd, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; op, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fd, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event *event);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;epfdï¼šç”¨äºæ³¨å†Œç›‘è§†å¯¹è±¡çš„ epoll ä¾‹ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;opï¼šç”¨äºåˆ¶å®šç›‘è§†å¯¹è±¡çš„æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹ç­‰æ“ä½œ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;fdï¼šéœ€è¦æ³¨å†Œçš„ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;eventï¼šç›‘è§†å¯¹è±¡çš„äº‹ä»¶ç±»å‹
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸å…¶ä»– epoll å‡½æ•°ç›¸æ¯”ï¼Œè¯¥å‡½æ•°çœ‹èµ·æ¥æœ‰äº›å¤æ‚ï¼Œä½†é€šè¿‡è°ƒç”¨è¯­å¥å°±å¾ˆå®¹æ˜“ç†è§£ï¼Œå‡è®¾æŒ‰ç…§å¦‚ä¸‹å½¢å¼è°ƒç”¨ epoll_ctl å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-CQL&#34; data-lang=&#34;CQL&#34;&gt;epoll_ctl(A,EPOLL_CTL_ADD,B,C);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¬¬äºŒä¸ªå‚æ•° EPOLL_CTL_ADD æ„å‘³ç€ã€Œæ·»åŠ ã€ï¼Œä¸Šè¿°è¯­å¥æœ‰å¦‚ä¸‹æ„ä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;epoll  ä¾‹ç¨‹ A ä¸­æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦ B ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç›‘è§†å‚æ•° C ä¸­çš„äº‹ä»¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†ä»‹ç»ä¸€ä¸ªè°ƒç”¨è¯­å¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;epoll_ctl(A,EPOLL_CTL_DEL,B,&lt;span style=&#34;color:#658b00&#34;&gt;NULL&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šè¿°è¯­å¥ä¸­ç¬¬äºŒä¸ªå‚æ•°æ„å‘³è¿™ã€Œåˆ é™¤ã€ï¼Œæœ‰ä»¥ä¸‹å«ä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä» epoll ä¾‹ç¨‹ A ä¸­åˆ é™¤æ–‡ä»¶æè¿°ç¬¦ B&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ä¸Šè¿°ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œä»ç›‘è§†å¯¹è±¡ä¸­åˆ é™¤æ—¶ï¼Œä¸éœ€è¦ç›‘è§†ç±»å‹ï¼Œå› æ­¤å‘ç¬¬å››ä¸ªå‚æ•°å¯ä»¥ä¼ é€’ä¸º NULL&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç¬¬äºŒä¸ªå‚æ•°çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EPOLL_CTL_ADDï¼šå°†æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåˆ° epoll ä¾‹ç¨‹&lt;/li&gt;
&lt;li&gt;EPOLL_CTL_DELï¼šä» epoll ä¾‹ç¨‹ä¸­åˆ é™¤æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;EPOLL_CTL_MODï¼šæ›´æ”¹æ³¨å†Œçš„æ–‡ä»¶æè¿°ç¬¦çš„å…³æ³¨äº‹ä»¶å‘ç”Ÿæƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;epoll_event ç»“æ„ä½“ç”¨äºä¿å­˜äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ç»“åˆã€‚ä½†ä¹Ÿå¯ä»¥åœ¨ epoll ä¾‹ç¨‹ä¸­æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œç”¨äºæ³¨å†Œå…³æ³¨çš„äº‹ä»¶ã€‚è¯¥å‡½æ•°ä¸­ epoll_event ç»“æ„ä½“çš„å®šä¹‰å¹¶ä¸æ˜¾çœ¼ï¼Œå› æ­¤é€šè¿‡æ‰è‹±è¯­å‰§è¯´æ˜è¯¥ç»“æ„ä½“åœ¨ epoll_ctl å‡½æ•°ä¸­çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event event;
...
event.events=EPOLLIN;&lt;span style=&#34;color:#228b22&#34;&gt;//å‘ç”Ÿéœ€è¦è¯»å–æ•°æ®çš„æƒ…å†µæ—¶
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;event.data.fd=sockfd;
epoll_ctl(epfd,EPOLL_CTL_ADD,sockfd,&amp;amp;event);
...
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šè¿°ä»£ç å°† epfd æ³¨å†Œåˆ° epoll ä¾‹ç¨‹ epfd ä¸­ï¼Œå¹¶åœ¨éœ€è¦è¯»å–æ•°æ®çš„æƒ…å†µä¸‹äº§ç”Ÿç›¸åº”äº‹ä»¶ã€‚æ¥ä¸‹æ¥ç»™å‡º epoll_event çš„æˆå‘˜ events ä¸­å¯ä»¥ä¿å­˜çš„å¸¸é‡åŠæ‰€æŒ‡çš„äº‹ä»¶ç±»å‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EPOLLINï¼šéœ€è¦è¯»å–æ•°æ®çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;EPOLLOUTï¼šè¾“å‡ºç¼“å†²ä¸ºç©ºï¼Œå¯ä»¥ç«‹å³å‘é€æ•°æ®çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;EPOLLPRIï¼šæ”¶åˆ° OOB æ•°æ®çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;EPOLLRDHUPï¼šæ–­å¼€è¿æ¥æˆ–åŠå…³é—­çš„æƒ…å†µï¼Œè¿™åœ¨è¾¹ç¼˜è§¦å‘æ–¹å¼ä¸‹éå¸¸æœ‰ç”¨&lt;/li&gt;
&lt;li&gt;EPOLLERRï¼šå‘ç”Ÿé”™è¯¯çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;EPOLLETï¼šä»¥è¾¹ç¼˜è§¦å‘çš„æ–¹å¼å¾—åˆ°äº‹ä»¶é€šçŸ¥&lt;/li&gt;
&lt;li&gt;EPOLLONESHOTï¼šå‘ç”Ÿä¸€æ¬¡äº‹ä»¶åï¼Œç›¸åº”æ–‡ä»¶æè¿°ç¬¦ä¸å†æ”¶åˆ°äº‹ä»¶é€šçŸ¥ã€‚å› æ­¤éœ€è¦å‘ epoll_ctl å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ EPOLL_CTL_MOD ï¼Œå†æ¬¡è®¾ç½®äº‹ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é€šè¿‡ä½è¿ç®—åŒäº‹ä¼ é€’å¤šä¸ªä¸Šè¿°å‚æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1716-epoll_wait&#34;&gt;17.1.6 epoll_wait&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å‡½æ•°åŸå‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/epoll.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;epoll_wait&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; epfd, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event *events, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; maxevents, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; timeout);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;epfd : è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿç›‘è§†èŒƒå›´çš„ epoll ä¾‹ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;events : ä¿å­˜å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„ç»“æ„ä½“åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;maxevents : ç¬¬äºŒä¸ªå‚æ•°ä¸­å¯ä»¥ä¿å­˜çš„æœ€å¤§äº‹ä»¶æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;timeout : ä»¥ 1/1000 ç§’ä¸ºå•ä½çš„ç­‰å¾…æ—¶é—´ï¼Œä¼ é€’ -1 æ—¶ï¼Œä¸€ç›´ç­‰å¾…ç›´åˆ°å‘ç”Ÿäº‹ä»¶
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¯¥å‡½æ•°è°ƒç”¨æ–¹å¼å¦‚ä¸‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰€æŒ‡ç¼“å†²éœ€è¦åŠ¨æ€åˆ†é…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; event_cnt;
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event *ep_events;
...
ep_events=malloc(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; epoll_event)*EPOLL_SIZE);&lt;span style=&#34;color:#228b22&#34;&gt;//EPOLL_SIZEæ˜¯å®å¸¸é‡
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;...
event_cnt=epoll_wait(epfd,ep_events,EPOLL_SIZE,-&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
...
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨å‡½æ•°åï¼Œè¿”å›å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼ŒåŒæ—¶åœ¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å‘çš„ç¼“å†²ä¸­ä¿å­˜å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚å› æ­¤ï¼Œæ— éœ€åƒ select ä¸€æ ·æ’å…¥é’ˆå¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å¾ªç¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1717-åŸºäº-epoll-çš„å›å£°æœåŠ¡å™¨ç«¯&#34;&gt;17.1.7 åŸºäº epoll çš„å›å£°æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å›å£°æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼ˆä¿®æ”¹è‡ªç¬¬ 12 ç«  &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch12/echo_selectserv.c&#34;&gt;echo_selectserv.c&lt;/a&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch17/echo_epollserv.c&#34;&gt;echo_epollserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_epollserv.c -o serv
./serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/01/5c53f5b6d4acf.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºè¿è¡Œç»“æœå’Œä»¥å‰ select å®ç°çš„å’Œ fork å®ç°çš„ç»“æœä¸€æ ·ï¼Œéƒ½å¯ä»¥æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™é‡Œè¿ç”¨äº† epoll æ•ˆç‡é«˜äº select&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹ epoll çš„æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;epoll_create åˆ›å»ºä¸€ä¸ªä¿å­˜ epoll æ–‡ä»¶æè¿°ç¬¦çš„ç©ºé—´ï¼Œå¯ä»¥æ²¡æœ‰å‚æ•°&lt;/li&gt;
&lt;li&gt;åŠ¨æ€åˆ†é…å†…å­˜ï¼Œç»™å°†è¦ç›‘è§†çš„ epoll_wait&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ epoll_ctl æ§åˆ¶ æ·»åŠ  åˆ é™¤ï¼Œç›‘å¬äº‹ä»¶&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ epoll_wait æ¥è·å–æ”¹å˜çš„æ–‡ä»¶æè¿°ç¬¦,æ¥æ‰§è¡Œç¨‹åº&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;select å’Œ epoll çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨ select å‡½æ•°éƒ½ä¼šå‘æ“ä½œç³»ç»Ÿä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯ï¼Œæµªè´¹å¤§é‡æ—¶é—´&lt;/li&gt;
&lt;li&gt;epoll ä»…å‘æ“ä½œç³»ç»Ÿä¼ é€’ä¸€æ¬¡ç›‘è§†å¯¹è±¡ï¼Œç›‘è§†èŒƒå›´æˆ–å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶åªé€šçŸ¥å‘ç”Ÿå˜åŒ–çš„äº‹é¡¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;172-æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&#34;&gt;17.2 æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&lt;/h3&gt;
&lt;p&gt;å­¦ä¹  epoll æ—¶è¦äº†è§£æ¡ä»¶è§¦å‘ï¼ˆLevel Triggerï¼‰å’Œè¾¹ç¼˜è§¦å‘ï¼ˆEdge Triggerï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1721-æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘çš„åŒºåˆ«åœ¨äºå‘ç”Ÿäº‹ä»¶çš„æ—¶é—´ç‚¹&#34;&gt;17.2.1 æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘çš„åŒºåˆ«åœ¨äºå‘ç”Ÿäº‹ä»¶çš„æ—¶é—´ç‚¹&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶è§¦å‘çš„ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¡ä»¶è§¦å‘æ–¹å¼ä¸­ï¼Œåªè¦è¾“å…¥ç¼“å†²æœ‰æ•°æ®å°±ä¼šä¸€ç›´é€šçŸ¥è¯¥äº‹ä»¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨ç«¯è¾“å…¥ç¼“å†²æ”¶åˆ° 50 å­—èŠ‚æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ç«¯æ“ä½œç³»ç»Ÿå°†é€šçŸ¥è¯¥äº‹ä»¶ï¼ˆæ³¨å†Œåˆ°å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚ä½†æ˜¯æœåŠ¡å™¨ç«¯è¯»å– 20 å­—èŠ‚åè¿˜å‰©ä¸‹ 30 å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œä»ä¼šæ³¨å†Œäº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¡ä»¶è§¦å‘æ–¹å¼ä¸­ï¼Œåªè¦è¾“å…¥ç¼“å†²ä¸­è¿˜å‰©æœ‰æ•°æ®ï¼Œå°±å°†ä»¥äº‹ä»¶æ–¹å¼å†æ¬¡æ³¨å†Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¾¹ç¼˜è§¦å‘ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è¾¹ç¼˜è§¦å‘ä¸­è¾“å…¥ç¼“å†²æ”¶åˆ°æ•°æ®æ—¶ä»…æ³¨å†Œ 1 æ¬¡è¯¥äº‹ä»¶ã€‚å³ä½¿è¾“å…¥ç¼“å†²ä¸­è¿˜ç•™æœ‰æ•°æ®ï¼Œä¹Ÿä¸ä¼šå†è¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;
&lt;h4 id=&#34;1722-æŒæ¡æ¡ä»¶è§¦å‘çš„äº‹ä»¶ç‰¹æ€§&#34;&gt;17.2.2 æŒæ¡æ¡ä»¶è§¦å‘çš„äº‹ä»¶ç‰¹æ€§&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢ä»£ç ä¿®æ”¹è‡ª &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch17/echo_epollserv.c&#34;&gt;echo_epollserv.c&lt;/a&gt; ã€‚epoll é»˜è®¤ä»¥æ¡ä»¶è§¦å‘çš„æ–¹å¼å·¥ä½œï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¯¥ç¤ºä¾‹éªŒè¯æ¡ä»¶è§¦å‘çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch17/echo_EPLTserv.c&#34;&gt;echo_EPLTserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç æŠŠè°ƒç”¨ read å‡½æ•°æ—¶ä½¿ç”¨çš„ç¼“å†²å¤§å°ç¼©å°åˆ°äº† 4 ä¸ªå­—èŠ‚ï¼Œæ’å…¥äº†éªŒè¯ epoll_wait è°ƒç”¨æ¬¡æ•°çš„éªŒè¯å‡½æ•°ã€‚å‡å°‘ç¼“å†²å¤§å°æ˜¯ä¸ºäº†é˜»æ­¢æœåŠ¡å™¨ç«¯ä¸€æ¬¡æ€§è¯»å–æ¥æ”¶çš„æ•°æ®ã€‚æ¢è¨€ä¹‹ï¼Œè°ƒç”¨ read å‡½æ•°åï¼Œè¾“å…¥ç¼“å†²ä¸­ä»æœ‰æ•°æ®è¦è¯»å–ï¼Œè€Œä¸”ä¼šå› æ­¤æ³¨å†Œæ–°çš„äº‹ä»¶å¹¶ä» epoll_wait å‡½æ•°è¿”å›æ—¶å°†å¾ªç¯è¾“å‡ºã€Œreturn epoll_waitã€å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_EPLTserv.c -o serv
./serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/01/5c540825ae415.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ¯å½“æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®æ—¶ï¼Œéƒ½å›æ³¨å†Œè¯¥äº‹ä»¶ï¼Œå¹¶å› æ­¤è°ƒç”¨ epoll_wait å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ä»£ç æ˜¯ä¿®æ”¹åçš„è¾¹ç¼˜è§¦å‘æ–¹å¼çš„ä»£ç ï¼Œä»…ä»…æ˜¯æŠŠä¸Šé¢çš„ä»£ç æ”¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; event.events = EPOLLIN | EPOLLET;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch17/echo_EDGEserv.c&#34;&gt;echo_EDGEserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_EDGEserv.c -o serv
./serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/01/5c54097b6469f.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ä¾‹å­çœ‹å‡ºï¼Œæ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ—¶ï¼Œåªè¾“å‡ºä¸€æ¬¡ã€Œreturn epoll_waitã€å­—ç¬¦ä¸²ï¼Œè¿™è¯æ˜ä»…æ³¨å†Œäº†ä¸€æ¬¡äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;select æ¨¡å‹æ˜¯ä»¥æ¡ä»¶è§¦å‘çš„æ–¹å¼å·¥ä½œçš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1723-è¾¹ç¼˜è§¦å‘çš„æœåŠ¡å™¨ç«¯å¿…çŸ¥çš„ä¸¤ç‚¹&#34;&gt;17.2.3 è¾¹ç¼˜è§¦å‘çš„æœåŠ¡å™¨ç«¯å¿…çŸ¥çš„ä¸¤ç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ errno å˜é‡éªŒè¯é”™è¯¯åŸå› &lt;/li&gt;
&lt;li&gt;ä¸ºäº†å®Œæˆéé˜»å¡ï¼ˆNon-blockingï¼‰I/O ï¼Œæ›´æ”¹äº†å¥—æ¥å­—ç‰¹æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linux å¥—æ¥å­—ç›¸å…³å‡½æ•°ä¸€èˆ¬é€šè¿‡ -1 é€šçŸ¥å‘ç”Ÿäº†é”™è¯¯ã€‚è™½ç„¶çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ï¼Œä½†ä»…å‡­è¿™äº›å†…å®¹æ— æ³•å¾—çŸ¥äº§ç”Ÿé”™è¯¯çš„åŸå› ã€‚å› æ­¤ï¼Œä¸ºäº†åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æé¢å¤–çš„ä¿¡æ¯ï¼ŒLinux å£°æ˜äº†å¦‚ä¸‹å…¨å±€å˜é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; errno;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸ºäº†è®¿é—®è¯¥å˜é‡ï¼Œéœ€è¦å¼•å…¥ &lt;code&gt;error.h&lt;/code&gt; å¤´æ–‡ä»¶ï¼Œå› æ­¤æ­¤å¤´æ–‡ä»¶æœ‰ä¸Šè¿°å˜é‡çš„ extren å£°æ˜ã€‚å¦å¤–ï¼Œæ¯ç§å‡½æ•°å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¿å­˜åœ¨ errno å˜é‡ä¸­çš„å€¼éƒ½ä¸åŒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;read å‡½æ•°å‘ç°è¾“å…¥ç¼“å†²ä¸­æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è¿”å› -1ï¼ŒåŒæ—¶åœ¨ errno ä¸­ä¿å­˜ EAGAIN å¸¸é‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Linux ä¸­æä¾›çš„æ”¹å˜å’Œæ›´æ”¹æ–‡ä»¶å±æ€§çš„åŠæ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;fcntl&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fields, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; cmd, ...);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› cmd å‚æ•°ç›¸å…³å€¼ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;filedes : å±æ€§æ›´æ”¹ç›®æ ‡çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;cmd : è¡¨ç¤ºå‡½æ•°è°ƒç”¨ç›®çš„
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»ä¸Šè¿°å£°æ˜å¯ä»¥çœ‹å‡º fcntl æœ‰å¯å˜å‚æ•°çš„å½¢å¼ã€‚å¦‚æœå‘ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ F_GETFL ï¼Œå¯ä»¥è·å¾—ç¬¬ä¸€ä¸ªå‚æ•°æ‰€æŒ‡çš„æ–‡ä»¶æè¿°ç¬¦å±æ€§ï¼ˆint å‹ï¼‰ã€‚åä¹‹ï¼Œå¦‚æœä¼ é€’ F_SETFL ï¼Œå¯ä»¥æ›´æ”¹æ–‡ä»¶æè¿°ç¬¦å±æ€§ã€‚è‹¥å¸Œæœ›å°†æ–‡ä»¶ï¼ˆå¥—æ¥å­—ï¼‰æ”¹ä¸ºéé˜»å¡æ¨¡å¼ï¼Œéœ€è¦å¦‚ä¸‹  2 æ¡è¯­å¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; flag = fcntl(fd,F_GETFL,&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
fcntl(fd,F_SETFL | O_NONBLOCK)
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é€šè¿‡ç¬¬ä¸€æ¡è¯­å¥ï¼Œè·å–ä¹‹å‰è®¾ç½®çš„å±æ€§ä¿¡æ¯ï¼Œé€šè¿‡ç¬¬äºŒæ¡è¯­å¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ éé˜»å¡ O_NONBLOCK æ ‡å¿—ã€‚è°ƒç”¨ read/write å‡½æ•°æ—¶ï¼Œæ— è®ºæ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œéƒ½ä¼šå½¢æˆéé˜»å¡æ–‡ä»¶ï¼ˆå¥—æ¥å­—ï¼‰ã€‚fcntl å‡½æ•°çš„é€‚ç”¨èŒƒå›´å¾ˆå¹¿ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1724-å®ç°è¾¹ç¼˜è§¦å‘å›å£°æœåŠ¡å™¨ç«¯&#34;&gt;17.2.4 å®ç°è¾¹ç¼˜è§¦å‘å›å£°æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;é€šè¿‡ errno ç¡®è®¤é”™è¯¯çš„åŸå› æ˜¯ï¼šè¾¹ç¼˜è§¦å‘æ–¹å¼ä¸­ï¼Œæ¥æ”¶æ•°æ®ä»…æ³¨å†Œä¸€æ¬¡è¯¥äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™ç§ç‰¹ç‚¹ï¼Œä¸€æ—¦å‘ç”Ÿè¾“å…¥ç›¸å…³äº‹ä»¶æ—¶ï¼Œå°±åº”è¯¥è¯»å–è¾“å…¥ç¼“å†²ä¸­çš„å…¨éƒ¨æ•°æ®ã€‚å› æ­¤éœ€è¦éªŒè¯è¾“å…¥ç¼“å†²æ˜¯å¦ä¸ºç©ºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;read å‡½æ•°è¿”å› -1ï¼Œå˜é‡ errno ä¸­çš„å€¼å˜æˆ EAGAIN æ—¶ï¼Œè¯´æ˜æ²¡æœ‰æ•°æ®å¯è¯»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆè¦å°†å¥—æ¥å­—å˜æˆéé˜»å¡æ¨¡å¼ï¼Ÿè¾¹ç¼˜è§¦å‘æ¡ä»¶ä¸‹ï¼Œä»¥é˜»å¡æ–¹å¼å·¥ä½œçš„ read &amp;amp; write å‡½æ•°æœ‰å¯èƒ½å¼•èµ·æœåŠ¡ç«¯çš„é•¿æ—¶é—´åœé¡¿ã€‚å› æ­¤ï¼Œè¾¹ç¼˜è§¦å‘æ–¹å¼ä¸­ä¸€å®šè¦é‡‡ç”¨éé˜»å¡ read &amp;amp; write å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»¥è¾¹ç¼˜è§¦å‘æ–¹å¼å·¥ä½œçš„å›å£°æœåŠ¡ç«¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch17/echo_EPETserv.c&#34;&gt;echo_EPETserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_EPETserv.c -o serv
./serv
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/01/5c542149c0cee.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1725-æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘å­°ä¼˜å­°åŠ£&#34;&gt;17.2.5 æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘å­°ä¼˜å­°åŠ£&lt;/h4&gt;
&lt;p&gt;è¾¹ç¼˜è§¦å‘æ–¹å¼å¯ä»¥åšåˆ°è¿™ç‚¹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ä»¥åˆ†ç¦»æ¥æ”¶æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ—¶é—´ç‚¹ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è¾¹ç¼˜è§¦å‘çš„å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/02/01/5c5421e3b3f2b.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯åˆ†åˆ«ä» A B C æ¥æ”¶æ•°æ®&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯æŒ‰ç…§  A B C çš„é¡ºåºé‡æ–°ç»„åˆæ¥æ”¶åˆ°çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;ç»„åˆçš„æ•°æ®å°†å‘é€ç»™ä»»æ„ä¸»æœºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æµç¨‹è¿è¡Œï¼ŒæœåŠ¡ç«¯çš„å®ç°å¹¶ä¸éš¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯æŒ‰ç…§ A B C çš„é¡ºåºè¿æ¥æœåŠ¡å™¨ï¼Œå¹¶ä¸”æŒ‰ç…§æ¬¡åºå‘æœåŠ¡å™¨å‘é€æ•°æ®&lt;/li&gt;
&lt;li&gt;éœ€è¦æ¥æ”¶æ•°æ®çš„å®¢æˆ·ç«¯åº”åœ¨å®¢æˆ·ç«¯ A B C ä¹‹å‰è¿æ¥åˆ°æœåŠ¡å™¨ç«¯å¹¶ç­‰å¾…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯å®é™…æƒ…å†µä¸­å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯ C å’Œ B æ­£åœ¨å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä½†æ˜¯ A å¹¶æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ A B C ä¹±åºå‘é€æ•°æ®&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å·²ç»æ¥æ”¶åˆ°æ•°æ®ï¼Œä½†æ˜¯è¦æ¥æ”¶æ•°æ®çš„ç›®æ ‡å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œå³ä½¿è¾“å…¥ç¼“å†²æ”¶åˆ°æ•°æ®ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿèƒ½å†³å®šè¯»å–å’Œå¤„ç†è¿™äº›æ•°æ®çš„æ—¶é—´ç‚¹ï¼Œè¿™æ ·å°±ç»™æœåŠ¡å™¨ç«¯çš„å®ç°å¸¦æ¥å¾ˆå¤§çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;173-ä¹ é¢˜&#34;&gt;17.3 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨ select å‡½æ•°å®ç°æœåŠ¡å™¨ç«¯æ—¶ï¼Œä»£ç å±‚é¢å­˜åœ¨çš„ä¸¤ä¸ªç¼ºç‚¹æ˜¯ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šâ‘ è°ƒç”¨ select å‡½æ•°åå¸¸è§çš„é’ˆå¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å¾ªç¯è¯­å¥â‘¡æ¯æ¬¡è°ƒç”¨ select å‡½æ•°æ—¶éƒ½è¦ä¼ é€’ç›‘è§†å¯¹è±¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ— è®ºæ˜¯ select æ–¹å¼è¿˜æ˜¯ epoll æ–¹å¼ï¼Œéƒ½éœ€è¦å°†ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯é€šè¿‡å‡½æ•°è°ƒç”¨ä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚è¯·è§£é‡Šä¼ é€’è¯¥ä¿¡æ¯çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šæ–‡ä»¶æè¿°ç¬¦æ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„ï¼Œæ‰€ä»¥å¿…é¡»è¦å€ŸåŠ©æ“ä½œç³»ç»Ÿæ‰èƒ½å®Œæˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;select æ–¹å¼å’Œ epoll æ–¹å¼çš„æœ€å¤§å·®å¼‚åœ¨äºç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™æ“ä½œç³»ç»Ÿçš„æ–¹å¼ã€‚è¯·è¯´æ˜å…·ä½“å·®å¼‚ï¼Œå¹¶è§£é‡Šä¸ºä½•å­˜åœ¨è¿™ç§å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šselect å‡½æ•°æ¯æ¬¡è°ƒç”¨éƒ½è¦ä¼ é€’æ‰€æœ‰çš„ç›‘è§†å¯¹è±¡ä¿¡æ¯ï¼Œè€Œ epoll å‡½æ•°ä»…å‘æ“ä½œç³»ç»Ÿä¼ é€’ 1 æ¬¡ç›‘è§†å¯¹è±¡ï¼Œç›‘è§†èŒƒå›´æˆ–å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶åªé€šçŸ¥å‘ç”Ÿå˜åŒ–çš„äº‹é¡¹ã€‚select é‡‡ç”¨è¿™ç§æ–¹æ³•æ˜¯ä¸ºäº†ä¿æŒå…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è™½ç„¶ epoll æ˜¯ select çš„æ”¹è¿›æ–¹æ¡ˆï¼Œä½† select ä¹Ÿæœ‰è‡ªå·±çš„ä¼˜ç‚¹ã€‚åœ¨ä½•ç§æƒ…å†µä¸‹ä½¿ç”¨ select æ›´åŠ åˆç†ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šâ‘ æœåŠ¡å™¨ç«¯æ¥å…¥è€…å°‘â‘¡ç¨‹åºåº”å…·æœ‰å…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;epoll æ˜¯ä»¥æ¡ä»¶è§¦å‘å’Œè¾¹ç¼˜è§¦å‘æ–¹å¼å·¥ä½œã€‚äºŒè€…æœ‰ä½•å·®åˆ«ï¼Ÿä»è¾“å…¥ç¼“å†²çš„è§’åº¦è¯´æ˜è¿™ä¸¤ç§æ–¹å¼é€šçŸ¥äº‹ä»¶çš„æ—¶é—´ç‚¹å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šåœ¨æ¡ä»¶è§¦å‘ä¸­ï¼Œåªè¦è¾“å…¥ç¼“å†²æœ‰æ•°æ®ï¼Œå°±ä¼šä¸€ç›´é€šçŸ¥è¯¥äº‹ä»¶ã€‚è¾¹ç¼˜è§¦å‘ä¸­è¾“å…¥ç¼“å†²æ”¶åˆ°æ•°æ®æ—¶ä»…æ³¨å†Œ 1 æ¬¡è¯¥äº‹ä»¶ï¼Œå³ä½¿è¾“å…¥ç¼“å†²ä¸­è¿˜ç•™æœ‰æ•°æ®ï¼Œä¹Ÿä¸ä¼šå†è¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡‡ç”¨è¾¹ç¼˜è§¦å‘æ—¶å¯ä»¥åˆ†ç¦»æ•°æ®çš„æ¥æ”¶å’Œå¤„ç†æ—¶é—´ç‚¹ã€‚è¯·è¯´æ˜å…¶ä¼˜ç‚¹å’ŒåŸå› ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šåˆ†ç¦»æ¥æ”¶æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ—¶é—´ç‚¹ï¼Œç»™æœåŠ¡ç«¯çš„å®ç°å¸¦æ¥å¾ˆå¤§çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-17-%E7%AB%A0-%E4%BC%98%E4%BA%8E-select-%E7%9A%84-epoll-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 16 ç«  å…³äº I/O æµåˆ†ç¦»çš„å…¶ä»–å†…å®¹ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-16-%E7%AB%A0-%E5%85%B3%E4%BA%8E-i-o-%E6%B5%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Fri, 08 Apr 2022 14:38:38 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-16-%E7%AB%A0-%E5%85%B3%E4%BA%8E-i-o-%E6%B5%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-16-%E7%AB%A0-%E5%85%B3%E4%BA%8E-i-o-%E6%B5%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-16-ç« -å…³äº-io-æµåˆ†ç¦»çš„å…¶ä»–å†…å®¹&#34;&gt;ç¬¬ 16 ç«  å…³äº I/O æµåˆ†ç¦»çš„å…¶ä»–å†…å®¹&lt;/h2&gt;
&lt;h3 id=&#34;161-åˆ†ç¦»-io-æµ&#34;&gt;16.1 åˆ†ç¦» I/O æµ&lt;/h3&gt;
&lt;p&gt;ã€Œåˆ†ç¦» I/O æµã€æ˜¯ä¸€ç§å¸¸ç”¨è¡¨è¾¾ã€‚æœ‰ I/O å·¥å…·å¯åŒºåˆ†äºŒè€…ï¼Œæ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯åˆ†ç¦»äº† I/O æµã€‚&lt;/p&gt;
&lt;h4 id=&#34;1611-2æ¬¡--io-æµåˆ†ç¦»&#34;&gt;16.1.1 2æ¬¡  I/O æµåˆ†ç¦»&lt;/h4&gt;
&lt;p&gt;ä¹‹å‰æœ‰ä¸¤ç§åˆ†ç¦»æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ç§æ˜¯ç¬¬ 10 ç« çš„ã€ŒTCP I/O è¿‡ç¨‹ã€åˆ†ç¦»ã€‚é€šè¿‡è°ƒç”¨ fork å‡½æ•°å¤åˆ¶å‡ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥åŒºåˆ†è¾“å…¥å’Œè¾“å‡ºä¸­ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è™½ç„¶æ–‡ä»¶æè¿°ç¬¦æœ¬èº«ä¸ä¼šæ ¹æ®è¾“å…¥å’Œè¾“å‡ºè¿›è¡ŒåŒºåˆ†ï¼Œä½†æˆ‘ä»¬åˆ†å¼€äº† 2 ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ç”¨é€”ï¼Œå› æ­¤ï¼Œè¿™ä¹Ÿå±äºã€Œæµã€çš„åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒç§åˆ†ç¦»æ˜¯åœ¨ç¬¬ 15 ç« ã€‚é€šè¿‡ 2 æ¬¡ fdopen å‡½æ•°çš„è°ƒç”¨ï¼Œåˆ›å»ºè¯»æ¨¡å¼ FILE æŒ‡é’ˆï¼ˆFILE ç»“æ„ä½“æŒ‡é’ˆï¼‰å’Œå†™æ¨¡å¼ FILE æŒ‡é’ˆã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬åˆ†ç¦»äº†è¾“å…¥å·¥å…·å’Œè¾“å‡ºå·¥å…·ï¼Œå› æ­¤ä¹Ÿå¯è§†ä¸ºã€Œæµã€çš„åˆ†ç¦»ã€‚ä¸‹é¢æ˜¯åˆ†ç¦»çš„ç†ç”±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1612-åˆ†ç¦»æµçš„å¥½å¤„&#34;&gt;16.1.2 åˆ†ç¦»ã€Œæµã€çš„å¥½å¤„&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ç¬¬ 10 ç« ã€Œæµã€çš„åˆ†ç¦»ç›®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡åˆ†å¼€è¾“å…¥è¿‡ç¨‹ï¼ˆä»£ç ï¼‰å’Œè¾“å‡ºè¿‡ç¨‹é™ä½å®ç°éš¾åº¦&lt;/li&gt;
&lt;li&gt;ä¸è¾“å…¥æ— å…³çš„è¾“å‡ºæ“ä½œå¯ä»¥æé«˜é€Ÿåº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç¬¬ 15 ç« ã€Œæµã€åˆ†ç¦»çš„ç›®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºäº†å°† FILE æŒ‡é’ˆæŒ‰è¯»æ¨¡å¼å’Œå†™æ¨¡å¼åŠ ä»¥åŒºåˆ†&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡åŒºåˆ†è¯»å†™æ¨¡å¼é™ä½å®ç°éš¾åº¦&lt;/li&gt;
&lt;li&gt;é€šè¿‡åŒºåˆ† I/O ç¼“å†²æé«˜ç¼“å†²æ€§èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1613-æµåˆ†ç¦»å¸¦æ¥çš„-eof-é—®é¢˜&#34;&gt;16.1.3 ã€Œæµã€åˆ†ç¦»å¸¦æ¥çš„ EOF é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ç¬¬ 7 ç« ä»‹ç»è¿‡ EOF çš„ä¼ é€’æ–¹æ³•å’ŒåŠå…³é—­çš„å¿…è¦æ€§ã€‚æœ‰ä¸€ä¸ªè¯­å¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;shutdown(sock,SHUT_WR);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å½“æ—¶è¯´è¿‡è°ƒç”¨ shutdown å‡½æ•°çš„åŸºäºåŠå…³é—­çš„ EOF ä¼ é€’æ–¹æ³•ã€‚ç¬¬åç« çš„ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/echo_mpclient.c&#34;&gt;echo_mpclient.c&lt;/a&gt; æ·»åŠ äº†åŠå…³é—­çš„ç›¸å…³ä»£ç ã€‚ä½†æ˜¯è¿˜æ²¡æœ‰è®²é‡‡ç”¨ fdopen å‡½æ•°æ€ä¹ˆåŠå…³é—­ã€‚é‚£ä¹ˆæ˜¯å¦æ˜¯é€šè¿‡ fclose å‡½æ•°å…³é—­æµå‘¢ï¼Ÿæˆ‘ä»¬å…ˆè¯•è¯•&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_clnt.c&#34;&gt;sep_clnt.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_serv.c&#34;&gt;sep_serv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc sep_clnt.c -o clnt
gcc sep_serv.c -o serv
./serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
./clnt 127.0.0.1 &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c512086a75d9.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯æœ€ç»ˆæ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯ã€‚é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯ï¼šæœåŠ¡ç«¯ä»£ç çš„ &lt;code&gt;fclose(writefp);&lt;/code&gt; è¿™ä¸€å¥ï¼Œå®Œå…¨å…³é—­äº†å¥—æ¥å­—è€Œä¸æ˜¯åŠå…³é—­ã€‚è¿™æ‰æ˜¯è¿™ä¸€ç« éœ€è¦è§£å†³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;162-æ–‡ä»¶æè¿°ç¬¦çš„çš„å¤åˆ¶å’ŒåŠå…³é—­&#34;&gt;16.2 æ–‡ä»¶æè¿°ç¬¦çš„çš„å¤åˆ¶å’ŒåŠå…³é—­&lt;/h3&gt;
&lt;h4 id=&#34;1621-ç»ˆæ­¢æµæ—¶æ— æ³•åŠå…³é—­åŸå› &#34;&gt;16.2.1 ç»ˆæ­¢ã€Œæµã€æ—¶æ— æ³•åŠå…³é—­åŸå› &lt;/h4&gt;
&lt;p&gt;ä¸‹é¢çš„å›¾æè¿°çš„æ˜¯æœåŠ¡ç«¯ä»£ç ä¸­çš„ä¸¤ä¸ªFILE æŒ‡é’ˆã€æ–‡ä»¶æè¿°ç¬¦å’Œå¥—æ¥å­—ä¸­çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c5121da89955.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªæŒ‡é’ˆéƒ½æ˜¯åŸºäºåŒä¸€æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºçš„ã€‚å› æ­¤ï¼Œé’ˆå¯¹äºä»»ä½•ä¸€ä¸ª FILE æŒ‡é’ˆè°ƒç”¨ fclose å‡½æ•°éƒ½ä¼šå…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c51224051802.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­çœ‹åˆ°ï¼Œé”€æ¯å¥—æ¥å­—æ—¶å†ä¹Ÿæ— æ³•è¿›è¡Œæ•°æ®äº¤æ¢ã€‚é‚£å¦‚ä½•è¿›å…¥å¯ä»¥è¿›å…¥ä½†æ˜¯æ— æ³•è¾“å‡ºçš„åŠå…³é—­çŠ¶æ€å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c5122a45c5f1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;åªéœ€è¦åˆ›å»º FILE æŒ‡é’ˆå‰å…ˆå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦å³å¯ã€‚å¤åˆ¶åå¦å¤–åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶ååˆ©ç”¨å„è‡ªçš„æ–‡ä»¶æè¿°ç¬¦ç”Ÿæˆè¯»æ¨¡å¼çš„ FILE æŒ‡é’ˆå’Œå†™æ¨¡å¼çš„ FILE æŒ‡é’ˆã€‚è¿™å°±ä¸ºåŠå…³é—­åˆ›é€ å¥½äº†ç¯å¢ƒï¼Œå› ä¸ºå¥—æ¥å­—å’Œæ–‡ä»¶æè¿°ç¬¦å…·æœ‰å¦‚ä¸‹å…³ç³»ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é”€æ¯æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦å€™æ‰èƒ½é”€æ¯å¥—æ¥å­—&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé’ˆå¯¹å†™æ¨¡å¼ FILE æŒ‡é’ˆè°ƒç”¨ fclose å‡½æ•°æ—¶ï¼Œåªèƒ½é”€æ¯ä¸è¯¥ FILE æŒ‡é’ˆç›¸å…³çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ— æ³•é”€æ¯å¥—æ¥å­—ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c5123ad7df31.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè°ƒç”¨ fclose å‡½æ•°å€™è¿˜å‰©ä¸‹ 1 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æ²¡æœ‰é”€æ¯å¥—æ¥å­—ã€‚é‚£æ­¤æ—¶çš„çŠ¶æ€æ˜¯å¦ä¸ºåŠå…³é—­çŠ¶æ€ï¼Ÿä¸æ˜¯ï¼åªæ˜¯å‡†å¤‡å¥½äº†è¿›å…¥åŠå…³é—­çŠ¶æ€ï¼Œè€Œä¸æ˜¯å·²ç»è¿›å…¥äº†åŠå…³é—­çŠ¶æ€ã€‚ä»”ç»†è§‚å¯Ÿï¼Œè¿˜å‰©ä¸‹ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è€Œè¯¥æ–‡ä»¶æè¿°ç¬¦å¯ä»¥åŒæ—¶è¿›è¡Œ I/O ã€‚å› æ­¤ï¼Œä¸ä½†æ²¡æœ‰å‘é€ EOF ï¼Œè€Œä¸”ä»ç„¶å¯ä»¥åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè¾“å‡ºã€‚&lt;/p&gt;
&lt;h4 id=&#34;1622-å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦&#34;&gt;16.2.2 å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦&lt;/h4&gt;
&lt;p&gt;ä¸è°ƒç”¨ fork å‡½æ•°ä¸åŒï¼Œè°ƒç”¨ fork å‡½æ•°å°†å¤åˆ¶æ•´ä¸ªè¿›ç¨‹ï¼Œæ­¤å¤„è®¨è®ºçš„æ˜¯åŒä¸€è¿›ç¨‹å†…å®Œæˆå¯¹å®Œæˆæè¿°ç¬¦çš„å¤åˆ¶ã€‚å¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c512579c45b6.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¤åˆ¶å®Œæˆåï¼Œä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½å¯ä»¥è®¿é—®æ–‡ä»¶ï¼Œä½†æ˜¯ç¼–å·ä¸åŒã€‚&lt;/p&gt;
&lt;h4 id=&#34;1623-dup-å’Œ-dup2&#34;&gt;16.2.3 dup å’Œ dup2&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸¤ä¸ªå‡½æ•°åŸå‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;dup&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fildes);
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;dup2&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fildes, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fildes2);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;fildes : éœ€è¦å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;fildes2 : æ˜ç¡®æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦çš„æ•´æ•°å€¼ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;dup2 å‡½æ•°æ˜ç¡®æŒ‡å®šå¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•´æ•°å€¼ã€‚å‘å…¶ä¼ é€’å¤§äº 0 ä¸”å°äºè¿›ç¨‹èƒ½ç”Ÿæˆçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦å€¼æ—¶ï¼Œè¯¥å€¼å°†æˆä¸ºå¤åˆ¶å‡ºçš„æ–‡ä»¶æè¿°ç¬¦å€¼ã€‚ä¸‹é¢æ˜¯ä»£ç ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/dup.c&#34;&gt;dup.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; cfd1, cfd2;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str1[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hi~ &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str2[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;It&amp;#39;s nice day~ &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;;

    cfd1 = dup(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);        &lt;span style=&#34;color:#228b22&#34;&gt;//å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ 1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    cfd2 = dup2(cfd1, &lt;span style=&#34;color:#b452cd&#34;&gt;7&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//å†æ¬¡å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦,å®šä¸ºæ•°å€¼ 7
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;fd1=%d , fd2=%d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, cfd1, cfd2);
    write(cfd1, str1, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str1));
    write(cfd2, str2, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str2));

    close(cfd1);
    close(cfd2); &lt;span style=&#34;color:#228b22&#34;&gt;//ç»ˆæ­¢å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½†æ˜¯ä»æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    write(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, str1, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str1));
    close(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;);
    write(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, str2, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str2)); &lt;span style=&#34;color:#228b22&#34;&gt;//æ— æ³•å®Œæˆè¾“å‡º
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;gcc dup.c -o dup
./dup
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c5135574d89a.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1624-å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦åæµçš„åˆ†ç¦»&#34;&gt;16.2.4 å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦åã€Œæµã€çš„åˆ†ç¦»&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ›´æ”¹ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_clnt.c&#34;&gt;sep_clnt.c&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_serv.c&#34;&gt;sep_serv.c&lt;/a&gt; å¯ä»¥ä½¿å¾—è®©å®ƒæ­£å¸¸å·¥ä½œï¼Œæ­£å¸¸å·¥ä½œæ˜¯æŒ‡é€šè¿‡æœåŠ¡å™¨çš„åŠå…³é—­çŠ¶æ€æ¥æ”¶å®¢æˆ·ç«¯æœ€åå‘é€çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_serv2.c&#34;&gt;sep_serv2.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªä»£ç å¯ä»¥ä¸ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch16/sep_clnt.c&#34;&gt;sep_clnt.c&lt;/a&gt; é…åˆèµ·æ¥ä½¿ç”¨ï¼Œç¼–è¯‘è¿‡ç¨‹å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿è¡Œç»“æœä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/30/5c513d54a27e0.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;163-ä¹ é¢˜&#34;&gt;16.3 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äº FILE ç»“æ„ä½“æŒ‡é’ˆå’Œæ–‡ä»¶æè¿°ç¬¦çš„è¯´æ³•é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—å†…å®¹ä»£è¡¨è¯´æ³•æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ FILE ç»“æ„ä½“æŒ‡é’ˆç›¸åŒï¼Œæ–‡ä»¶æè¿°ç¬¦ä¹Ÿåˆ†è¾“å…¥æè¿°ç¬¦å’Œè¾“å‡ºæè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦æ—¶å°†ç”Ÿæˆç›¸åŒå€¼çš„æè¿°ç¬¦ï¼Œå¯ä»¥é€šè¿‡è¿™ 2 ä¸ªæè¿°ç¬¦è¿›è¡Œ I/O&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ä»¥åˆ©ç”¨åˆ›å»ºå¥—æ¥å­—æ—¶è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œ I/O ï¼Œä¹Ÿå¯ä»¥ä¸é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œç›´æ¥é€šè¿‡ FILE ç»“æ„ä½“æŒ‡é’ˆå®Œæˆ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ä»¥ä»æ–‡ä»¶æè¿°ç¬¦ç”Ÿæˆ FILE ç»“æ„ä½“æŒ‡é’ˆï¼Œè€Œä¸”å¯ä»¥åˆ©ç”¨è¿™ç§ FILE ç»“æ„ä½“æŒ‡é’ˆè¿›è¡Œå¥—æ¥å­— I/O&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;è‹¥æ–‡ä»¶æè¿°ç¬¦ä¸ºè¯»æ¨¡å¼ï¼Œåˆ™åŸºäºè¯¥æè¿°ç¬¦ç”Ÿæˆçš„ FILE ç»“æ„ä½“æŒ‡é’ˆåŒæ ·æ˜¯è¯»æ¨¡å¼ï¼›è‹¥æ–‡ä»¶æè¿°ç¬¦ä¸ºå†™æ¨¡å¼ï¼Œåˆ™åŸºäºè¯¥æè¿°ç¬¦ç”Ÿæˆçš„ FILE ç»“æ„ä½“æŒ‡é’ˆåŒæ ·æ˜¯å†™æ¨¡å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;EOF çš„å‘é€ç›¸å…³æè¿°ä¸­é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—å†…å®¹ä»£è¡¨è¯´æ³•æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»ˆæ­¢æ–‡ä»¶æè¿°ç¬¦æ—¶å‘é€ EOF&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å³ä½¿æœªå®Œæˆç»ˆæ­¢æ–‡ä»¶æè¿°ç¬¦ï¼Œå…³é—­è¾“å‡ºæµæ—¶ä¹Ÿä¼šå‘é€ EOF&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ™åŒ…æ‹¬å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦åœ¨å†…ï¼Œæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦éƒ½ç»ˆæ­¢æ—¶æ‰ä¼šå‘é€ EOF&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å³ä½¿å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ shutdown å‡½æ•°è¿›å…¥åŠå…³é—­çŠ¶æ€å¹¶å‘é€ EOF&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-16-%E7%AB%A0-%E5%85%B3%E4%BA%8E-i-o-%E6%B5%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 15 ç«  å¥—æ¥å­—å’Œæ ‡å‡†I/O ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-15-%E7%AB%A0-%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86i-o-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Wed, 06 Apr 2022 17:53:25 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-15-%E7%AB%A0-%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86i-o-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-15-%E7%AB%A0-%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86i-o-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-15-ç« -å¥—æ¥å­—å’Œæ ‡å‡†io&#34;&gt;ç¬¬ 15 ç«  å¥—æ¥å­—å’Œæ ‡å‡†I/O&lt;/h2&gt;
&lt;h3 id=&#34;151-æ ‡å‡†-io-çš„ä¼˜ç‚¹&#34;&gt;15.1 æ ‡å‡† I/O çš„ä¼˜ç‚¹&lt;/h3&gt;
&lt;h4 id=&#34;1511-æ ‡å‡†-io-å‡½æ•°çš„ä¸¤ä¸ªä¼˜ç‚¹&#34;&gt;15.1.1 æ ‡å‡† I/O å‡½æ•°çš„ä¸¤ä¸ªä¼˜ç‚¹&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ ‡å‡† I/O å‡½æ•°çš„ä¸¤ä¸ªä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ‡å‡† I/O å‡½æ•°å…·æœ‰è‰¯å¥½çš„ç§»æ¤æ€§&lt;/li&gt;
&lt;li&gt;æ ‡å‡† I/O å‡½æ•°å¯ä»¥åˆ©ç”¨ç¼“å†²æé«˜æ€§èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ›å»ºå¥—æ¥å­—æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‡†å¤‡ I/O ç¼“å†²ã€‚æ­¤ç¼“å†²åœ¨æ‰§è¡Œ TCP åè®®æ—¶å‘æŒ¥ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚æ­¤æ—¶è‹¥ä½¿ç”¨æ ‡å‡† I/O å‡½æ•°ï¼Œå°†å¾—åˆ°é¢å¤–çš„ç¼“å†²æ”¯æŒã€‚å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/29/5c500e53ad9aa.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½¿ç”¨ fputs å‡½æ•°è¿›è¡Œä¼ è¾“å­—ç¬¦ä¸² ã€ŒHelloã€æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®ä¼ é€’åˆ°æ ‡å‡† I/O ç¼“å†²ï¼Œç„¶åå°†æ•°æ®ç§»åŠ¨åˆ°å¥—æ¥å­—è¾“å‡ºç¼“å†²ï¼Œæœ€åå°†å­—ç¬¦ä¸²å‘é€åˆ°å¯¹æ–¹ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®ç¼“å†²çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚ä»ä»¥ä¸‹ä¸¤ç‚¹å¯ä»¥è¯´æ˜æ€§èƒ½çš„æé«˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ è¾“çš„æ•°æ®é‡&lt;/li&gt;
&lt;li&gt;æ•°æ®å‘è¾“å‡ºç¼“å†²ç§»åŠ¨çš„æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯”è¾ƒ 1 ä¸ªå­—èŠ‚çš„æ•°æ®å‘é€ 10 æ¬¡çš„æƒ…å†µå’Œ 10 ä¸ªæ•°æ®åŒ…å‘é€ 1 æ¬¡çš„æƒ…å†µã€‚å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®åŒ…ä¸­å«æœ‰å¤´ä¿¡æ¯ã€‚å¤´ä¿¡ä¸æ•°æ®å¤§å°æ— å…³ï¼Œæ˜¯æŒ‰ç…§ä¸€å®šçš„æ ¼å¼å¡«å…¥çš„ã€‚å‡è®¾å¤´ä¿¡æ¯å  40 ä¸ªå­—èŠ‚ï¼Œéœ€è¦ä¼ è¾“çš„æ•°æ®é‡ä¹Ÿå­˜åœ¨è¾ƒå¤§åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 ä¸ªå­—èŠ‚ 10 æ¬¡ï¼š40*10=400 å­—èŠ‚&lt;/li&gt;
&lt;li&gt;10ä¸ªå­—èŠ‚ 1 æ¬¡ï¼š40*1=40 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1512-æ ‡å‡†-io-å‡½æ•°å’Œç³»ç»Ÿå‡½æ•°ä¹‹é—´çš„æ€§èƒ½å¯¹æ¯”&#34;&gt;15.1.2 æ ‡å‡† I/O å‡½æ•°å’Œç³»ç»Ÿå‡½æ•°ä¹‹é—´çš„æ€§èƒ½å¯¹æ¯”&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åˆ©ç”¨ç³»ç»Ÿå‡½æ•°çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/syscpy.c&#34;&gt;syscpy.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨æ ‡å‡† I/O å‡½æ•°å¤åˆ¶æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/stdcpy.c&#34;&gt;stdcpy.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºä»¥ä¸Šä¸¤ä¸ªä»£ç è¿›è¡Œæµ‹è¯•ï¼Œæ˜æ˜¾åŸºäºæ ‡å‡† I/O å‡½æ•°çš„ä»£ç è·‘çš„æ›´å¿«&lt;/p&gt;
&lt;h4 id=&#34;1513-æ ‡å‡†-io-å‡½æ•°çš„å‡ ä¸ªç¼ºç‚¹&#34;&gt;15.1.3 æ ‡å‡† I/O å‡½æ•°çš„å‡ ä¸ªç¼ºç‚¹&lt;/h4&gt;
&lt;p&gt;æ ‡å‡† I/O å‡½æ•°å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å®¹æ˜“è¿›è¡ŒåŒå‘é€šä¿¡&lt;/li&gt;
&lt;li&gt;æœ‰æ—¶å¯èƒ½é¢‘ç¹è°ƒç”¨ fflush å‡½æ•°&lt;/li&gt;
&lt;li&gt;éœ€è¦ä»¥ FILE ç»“æ„ä½“æŒ‡é’ˆçš„å½¢å¼è¿”å›æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;152-ä½¿ç”¨æ ‡å‡†-io-å‡½æ•°&#34;&gt;15.2 ä½¿ç”¨æ ‡å‡† I/O å‡½æ•°&lt;/h3&gt;
&lt;h4 id=&#34;1521-åˆ©ç”¨-fdopen-å‡½æ•°è½¬æ¢ä¸º-file-ç»“æ„ä½“æŒ‡é’ˆ&#34;&gt;15.2.1 åˆ©ç”¨ fdopen å‡½æ•°è½¬æ¢ä¸º FILE ç»“æ„ä½“æŒ‡é’ˆ&lt;/h4&gt;
&lt;p&gt;å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;FILE *&lt;span style=&#34;color:#008b45&#34;&gt;fdopen&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fildes, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *mode);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›è½¬æ¢çš„ FILE ç»“æ„ä½“æŒ‡é’ˆï¼Œå¤±è´¥æ—¶è¿”å› NULL
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;fildes ï¼š éœ€è¦è½¬æ¢çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;mode ï¼š å°†è¦åˆ›å»ºçš„ FILE ç»“æ„ä½“æŒ‡é’ˆçš„æ¨¡å¼ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹ä¸ºç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/desto.c&#34;&gt;desto.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;()
{
    FILE *fp;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fd = open(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;data.dat&amp;#34;&lt;/span&gt;, O_WRONLY | O_CREAT | O_TRUNC); &lt;span style=&#34;color:#228b22&#34;&gt;//åˆ›å»ºæ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (fd == -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;)
    {
        fputs(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;file open error&amp;#34;&lt;/span&gt;, stdout);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    }
    fd = fdopen(fd, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//è¿”å› å†™ æ¨¡å¼çš„ FILE æŒ‡é’ˆ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    fputs(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;NetWork C programming &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, fp);
    fclose(fp);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;gcc desto.c -o desto
./desto
cat data.dat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/29/5c5018ff07b29.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶æè¿°ç¬¦è½¬æ¢ä¸º FILE æŒ‡é’ˆï¼Œå¹¶å¯ä»¥é€šè¿‡è¯¥æŒ‡é’ˆè°ƒç”¨æ ‡å‡† I/O å‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1522-åˆ©ç”¨-fileno-å‡½æ•°è½¬æ¢ä¸ºæ–‡ä»¶æè¿°ç¬¦&#34;&gt;15.2.2 åˆ©ç”¨ fileno å‡½æ•°è½¬æ¢ä¸ºæ–‡ä»¶æè¿°ç¬¦&lt;/h4&gt;
&lt;p&gt;å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;fileno&lt;/span&gt;(FILE *stream);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/todes.c&#34;&gt;todes.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;()
{
    FILE *fp;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fd = open(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;data.dat&amp;#34;&lt;/span&gt;, O_WRONLY | O_CREAT | O_TRUNC);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (fd == -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;)
    {
        fputs(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;file open error&amp;#34;&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; -&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;;
    }

    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;First file descriptor : %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, fd);
    fp = fdopen(fd, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//è½¬æˆ file æŒ‡é’ˆ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    fputs(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;TCP/IP SOCKET PROGRAMMING &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, fp);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Second file descriptor: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, fileno(fp)); &lt;span style=&#34;color:#228b22&#34;&gt;//è½¬å›æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    fclose(fp);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;153-åŸºäºå¥—æ¥å­—çš„æ ‡å‡†-io-å‡½æ•°ä½¿ç”¨&#34;&gt;15.3 åŸºäºå¥—æ¥å­—çš„æ ‡å‡† I/O å‡½æ•°ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;æŠŠç¬¬å››ç« çš„å›å£°å®¢æˆ·ç«¯å’Œå›å£°æœåŠ¡ç«¯çš„å†…å®¹æ”¹ä¸ºåŸºäºæ ‡å‡† I/O å‡½æ•°çš„æ•°æ®äº¤æ¢å½¢å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/echo_client.c&#34;&gt;echo_client.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch15/echo_stdserv.c&#34;&gt;echo_stdserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_client.c -o eclient
gcc echo_stdserv.c -o eserver
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/29/5c502001581bc.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œè¿è¡Œç»“æœå’Œç¬¬å››ç« ç›¸åŒï¼Œè¿™æ˜¯åˆ©ç”¨æ ‡å‡† I/O å®ç°çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;154-ä¹ é¢˜&#34;&gt;15.4 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·è¯´æ˜æ ‡å‡† I/O çš„ 2 ä¸ªä¼˜ç‚¹ã€‚ä»–ä¸ºä½•æ‹¥æœ‰è¿™ 2 ä¸ªä¼˜ç‚¹ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šâ‘ å…·æœ‰å¾ˆé«˜çš„ç§»æ¤æ€§â‘¡æœ‰è‰¯å¥½çš„ç¼“å†²æé«˜æ€§èƒ½ã€‚å› ä¸ºè¿™äº›å‡½æ•°æ˜¯ç”± ANSI C æ ‡å‡†å®šä¹‰çš„ã€‚é€‚åˆæ‰€æœ‰ç¼–ç¨‹é¢†åŸŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ©ç”¨æ ‡å‡† I/O å‡½æ•°ä¼ è¾“æ•°æ®æ—¶ï¼Œä¸‹é¢çš„è¯´æ³•æ˜¯é”™è¯¯çš„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è°ƒç”¨ fputs å‡½æ•°ä¼ è¾“æ•°æ®æ—¶ï¼Œè°ƒç”¨ååº”ç«‹å³å¼€å§‹å‘é€ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä½•ä¸Šè¿°è¯´æ³•æ˜¯é”™è¯¯çš„ï¼Ÿä¸ºè¾¾åˆ°è¿™ç§æ•ˆæœåº”è¯¥æ·»åŠ å“ªäº›å¤„ç†è¿‡ç¨‹ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šåªæ˜¯ä¼ è¾“åˆ°äº†ç¼“å†²ä¸­ï¼Œåº”è¯¥åˆ©ç”¨ fflush æ¥åˆ·æ–°ç¼“å†²åŒºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-15-%E7%AB%A0-%E5%A5%97%E6%8E%A5%E5%AD%97%E5%92%8C%E6%A0%87%E5%87%86i-o-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 14 ç«  å¤šæ’­ä¸å¹¿æ’­ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-14-%E7%AB%A0-%E5%A4%9A%E6%92%AD%E4%B8%8E%E5%B9%BF%E6%92%AD-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Tue, 05 Apr 2022 13:54:59 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-14-%E7%AB%A0-%E5%A4%9A%E6%92%AD%E4%B8%8E%E5%B9%BF%E6%92%AD-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-14-%E7%AB%A0-%E5%A4%9A%E6%92%AD%E4%B8%8E%E5%B9%BF%E6%92%AD-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-14-ç« -å¤šæ’­ä¸å¹¿æ’­&#34;&gt;ç¬¬ 14 ç«  å¤šæ’­ä¸å¹¿æ’­&lt;/h2&gt;
&lt;h3 id=&#34;141-å¤šæ’­&#34;&gt;14.1 å¤šæ’­&lt;/h3&gt;
&lt;p&gt;å¤šæ’­ï¼ˆMulticastï¼‰æ–¹å¼çš„æ•°æ®ä¼ è¾“æ˜¯åŸºäº UDP å®Œæˆçš„ã€‚å› æ­¤ ï¼Œä¸ UDP æœåŠ¡å™¨ç«¯/å®¢æˆ·ç«¯çš„å®ç°æ–¹å¼éå¸¸æ¥è¿‘ã€‚åŒºåˆ«åœ¨äºï¼ŒUDP æ•°æ®ä¼ è¾“ä»¥å•ä¸€ç›®æ ‡è¿›è¡Œï¼Œè€Œå¤šæ’­æ•°æ®åŒæ—¶ä¼ é€’åˆ°åŠ å…¥ï¼ˆæ³¨å†Œï¼‰ç‰¹å®šç»„çš„å¤§é‡ä¸»æœºã€‚æ¢è¨€ä¹‹ï¼Œé‡‡ç”¨å¤šæ’­æ–¹å¼æ—¶ï¼Œå¯ä»¥åŒæ—¶å‘å¤šä¸ªä¸»æœºä¼ é€’æ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1411-å¤šæ’­çš„æ•°æ®ä¼ è¾“æ–¹å¼ä»¥åŠæµé‡æ–¹é¢çš„ä¼˜ç‚¹&#34;&gt;14.1.1 å¤šæ’­çš„æ•°æ®ä¼ è¾“æ–¹å¼ä»¥åŠæµé‡æ–¹é¢çš„ä¼˜ç‚¹&lt;/h4&gt;
&lt;p&gt;å¤šæ’­çš„æ•°æ®ä¼ è¾“ç‰¹ç‚¹å¯æ•´ç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šæ’­æœåŠ¡å™¨ç«¯é’ˆå¯¹ç‰¹å®šå¤šæ’­ç»„ï¼Œåªå‘é€ 1 æ¬¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å³ä½¿åªå‘é€ 1 æ¬¡æ•°æ®ï¼Œä½†è¯¥ç»„å†…çš„æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šæ¥æ”¶æ•°æ®&lt;/li&gt;
&lt;li&gt;å¤šæ’­ç»„æ•°å¯ä»¥åœ¨ IP åœ°å€èŒƒå›´å†…ä»»æ„å¢åŠ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤šæ’­ç»„æ˜¯ D ç±»IPåœ°å€ï¼ˆ224.0.0.0~239.255.255.255ï¼‰ï¼Œã€ŒåŠ å…¥å¤šæ’­ç»„ã€å¯ä»¥ç†è§£ä¸ºé€šè¿‡ç¨‹åºå®Œæˆå¦‚ä¸‹å£°æ˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ D ç±»IPåœ°å€ä¸­ï¼Œæˆ‘å¸Œæœ›æ¥æ”¶å‘å¾€ç›®æ ‡ 239.234.218.234 çš„å¤šæ’­æ•°æ®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤šæ’­æ˜¯åŸºäº UDP å®Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šæ’­æ•°æ®åŒ…çš„æ ¼å¼ä¸ UDP æ•°æ®åŒ…ç›¸åŒã€‚åªæ˜¯ä¸ä¸€èˆ¬çš„ UDP æ•°æ®åŒ…ä¸åŒã€‚å‘ç½‘ç»œä¼ é€’ 1 ä¸ªå¤šæ’­æ•°æ®åŒ…æ—¶ï¼Œè·¯ç”±å™¨å°†å¤åˆ¶è¯¥æ•°æ®åŒ…å¹¶ä¼ é€’åˆ°å¤šä¸ªä¸»æœºã€‚åƒè¿™æ ·ï¼Œå¤šæ’­éœ€è¦å€ŸåŠ©è·¯ç”±å™¨å®Œæˆã€‚å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/27/5c4d310daa6be.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è‹¥é€šè¿‡ TCP æˆ– UDP å‘ 1000 ä¸ªä¸»æœºå‘é€æ–‡ä»¶ï¼Œåˆ™å…±éœ€è¦ä¼ é€’ 1000 æ¬¡ã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœç”¨å¤šæ’­ç½‘ç»œä¼ è¾“æ–‡ä»¶ï¼Œåˆ™åªéœ€è¦å‘é€ä¸€æ¬¡ã€‚è¿™æ—¶ç”± 1000 å°ä¸»æœºæ„æˆçš„ç½‘ç»œä¸­çš„è·¯ç”±å™¨è´Ÿè´£å¤åˆ¶æ–‡ä»¶å¹¶ä¼ é€’åˆ°ä¸»æœºã€‚å°±å› ä¸ºè¿™ç§ç‰¹æ€§ï¼Œå¤šæ’­ä¸»è¦ç”¨äºã€Œå¤šåª’ä½“æ•°æ®å®æ—¶ä¼ è¾“ã€ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç†è®ºä¸Šå¯ä»¥å®Œæˆå¤šæ’­é€šä¿¡ï¼Œä½†æ˜¯ä¸å°‘è·¯ç”±å™¨å¹¶ä¸æ”¯æŒå¤šæ’­ï¼Œæˆ–å³ä¾¿æ”¯æŒä¹Ÿå› ç½‘ç»œæ‹¥å µé—®é¢˜æ•…æ„é˜»æ–­å¤šæ’­ã€‚å› æ­¤ï¼Œä¸ºäº†åœ¨ä¸æ”¯æŒå¤šæ’­çš„è·¯ç”±å™¨ä¸­å®Œæˆå¤šæ’­é€šä¿¡ï¼Œä¹Ÿä¼šä½¿ç”¨éš§é“ï¼ˆTunnelingï¼‰æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1412-è·¯ç”±routingå’Œ-ttltime-to-liveç”Ÿå­˜æ—¶é—´ä»¥åŠåŠ å…¥ç»„çš„åŠæ³•&#34;&gt;14.1.2 è·¯ç”±ï¼ˆRoutingï¼‰å’Œ TTLï¼ˆTime to Live,ç”Ÿå­˜æ—¶é—´ï¼‰ï¼Œä»¥åŠåŠ å…¥ç»„çš„åŠæ³•&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†ä¼ é€’å¤šæ’­æ•°æ®åŒ…ï¼Œå¿…é¡»è®¾ç½® TTL ã€‚TTL æ˜¯ Time to Liveçš„ç®€å†™ï¼Œæ˜¯å†³å®šã€Œæ•°æ®åŒ…ä¼ é€’è·ç¦»ã€çš„ä¸»è¦å› ç´ ã€‚TTL ç”¨æ•´æ•°è¡¨ç¤ºï¼Œå¹¶ä¸”æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡ä¸€ã€‚TTL å˜ä¸º 0 æ—¶ï¼Œè¯¥æ•°æ®åŒ…å°±æ— æ³•å†è¢«ä¼ é€’ï¼Œåªèƒ½é”€æ¯ã€‚å› æ­¤ï¼ŒTTL çš„å€¼è®¾ç½®è¿‡å¤§å°†å½±å“ç½‘ç»œæµé‡ã€‚å½“ç„¶ï¼Œè®¾ç½®è¿‡å°ï¼Œä¹Ÿæ— æ³•ä¼ é€’åˆ°ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/27/5c4d3960001eb.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ TTL çš„è®¾ç½®æ–¹æ³•ã€‚TTL æ˜¯å¯ä»¥é€šè¿‡ç¬¬ä¹ç« çš„å¥—æ¥å­—å¯é€‰é¡¹å®Œæˆçš„ã€‚ä¸è®¾ç½® TTL ç›¸å…³çš„åè®®å±‚ä¸º IPPROTO_IP ï¼Œé€‰é¡¹åä¸º IP_MULTICAST_TTLã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç æŠŠ TTL è®¾ç½®ä¸º 64&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; send_sock;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; time_live = &lt;span style=&#34;color:#b452cd&#34;&gt;64&lt;/span&gt;;
...
send_sock=socket(PF_INET,SOCK_DGRAM,&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
setsockopt(send_sock,IPPROTO_IP,IP_MULTICAST_TTL,(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt;*)&amp;amp;time_live,&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(time_live);
...
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åŠ å…¥å¤šæ’­ç»„ä¹Ÿé€šè¿‡è®¾ç½®è®¾ç½®å¥—æ¥å­—å¯é€‰é¡¹æ¥å®Œæˆã€‚åŠ å…¥å¤šæ’­ç»„ç›¸å…³çš„åè®®å±‚ä¸º IPPROTO_IPï¼Œé€‰é¡¹åä¸º IP_ADD_MEMBERSHIP ã€‚å¯é€šè¿‡å¦‚ä¸‹ä»£ç åŠ å…¥å¤šæ’­ç»„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; recv_sock;
&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; ip_mreq join_adr;
...
recv_sock=socket(PF_INET,SOCK_DGRAM,&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
...
join_adr.imr_multiaddr.s_addr=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;å¤šæ’­ç»„åœ°å€ä¿¡æ¯&amp;#34;&lt;/span&gt;;
join_adr.imr_interface.s_addr=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;åŠ å…¥å¤šæ’­ç»„çš„ä¸»æœºåœ°å€ä¿¡æ¯&amp;#34;&lt;/span&gt;;
setsockopt(recv_sock,IPPROTO_IP,IP_ADD_MEMBERSHIP,(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt;*)&amp;amp;join_adr,&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(time_live);
...
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ ip_mreq ç»“æ„ä½“çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; ip_mreq
{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; in_addr imr_multiaddr; &lt;span style=&#34;color:#228b22&#34;&gt;//å†™å…¥åŠ å…¥ç»„çš„IPåœ°å€
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; in_addr imr_interface; &lt;span style=&#34;color:#228b22&#34;&gt;//åŠ å…¥è¯¥ç»„çš„å¥—æ¥å­—æ‰€å±ä¸»æœºçš„IPåœ°å€
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;1413-å®ç°å¤šæ’­-sender-å’Œ-receiver&#34;&gt;14.1.3 å®ç°å¤šæ’­ Sender å’Œ Receiver&lt;/h4&gt;
&lt;p&gt;å¤šæ’­ä¸­ç”¨ã€Œå‘é€è€…ã€ï¼ˆä»¥ä¸‹ç§°ä¸º Senderï¼‰ å’Œã€Œæ¥æ”¶è€…ã€ï¼ˆä»¥ä¸‹ç§°ä¸º Receiverï¼‰æ›¿ä»£æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ã€‚é¡¾åæ€ä¹‰ï¼Œæ­¤å¤„çš„ Sender æ˜¯å¤šæ’­æ•°æ®çš„å‘é€ä¸»ä½“ï¼ŒReceiver æ˜¯éœ€è¦å¤šæ’­ç»„åŠ å…¥è¿‡ç¨‹çš„æ•°æ®æ¥æ”¶ä¸»ä½“ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ï¼Œç¤ºä¾‹çš„è¿è¡Œåœºæ™¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sender : å‘ AAA ç»„å¹¿æ’­ï¼ˆBroadcastingï¼‰æ–‡ä»¶ä¸­ä¿å­˜çš„æ–°é—»ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;Receiver : æ¥æ”¶ä¼ é€’åˆ° AAA ç»„çš„æ–°é—»ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸¤ä¸ªä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch14/news_sender.c&#34;&gt;news_sender.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch14/news_receiver.c&#34;&gt;news_receiver.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;gcc news_sender.c -o sender
gcc news_receiver.c -o receiver
./sender 224.1.1.2 9190
./receiver 224.1.1.2 9190
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/28/5c4e85a9aabcc.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç»“æœå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ sender å¤šæ’­ä¿¡æ¯ï¼Œé€šè¿‡ receiver æ¥æ”¶å¹¿æ’­ï¼Œå¦‚æœå»¶è¿Ÿè¿è¡Œ receiver å°†æ— æ³•æ¥å—ä¹‹å‰å‘é€çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;142-å¹¿æ’­&#34;&gt;14.2 å¹¿æ’­&lt;/h3&gt;
&lt;p&gt;å¹¿æ’­ï¼ˆBroadcastï¼‰åœ¨ã€Œä¸€æ¬¡æ€§å‘å¤šä¸ªä¸»æœºå‘é€æ•°æ®ã€è¿™ä¸€ç‚¹ä¸Šä¸å¤šæ’­ç±»ä¼¼ï¼Œä½†ä¼ è¾“æ•°æ®çš„èŒƒå›´æœ‰åŒºåˆ«ã€‚å¤šæ’­å³ä½¿åœ¨è·¨è¶Šä¸åŒç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œåªè¦åŠ å…¥å¤šæ’­ç»„å°±èƒ½æ¥å—æ•°æ®ã€‚ç›¸åï¼Œå¹¿æ’­åªèƒ½å‘åŒä¸€ç½‘ç»œä¸­çš„ä¸»æœºä¼ è¾“æ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1421-å¹¿æ’­çš„ç†è§£å’Œå®ç°æ–¹æ³•&#34;&gt;14.2.1 å¹¿æ’­çš„ç†è§£å’Œå®ç°æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;å¹¿æ’­æ˜¯å‘åŒä¸€ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºä¼ è¾“æ•°æ®çš„æ–¹æ³•ã€‚ä¸å¤šæ’­ç›¸åŒï¼Œå¹¿æ’­ä¹Ÿæ˜¯é€šè¿‡ UDP æ¥å®Œæˆçš„ã€‚æ ¹æ®ä¼ è¾“æ•°æ®æ—¶ä½¿ç”¨çš„IPåœ°å€å½¢å¼ï¼Œå¹¿æ’­åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥å¹¿æ’­ï¼ˆDirected Broadcastï¼‰&lt;/li&gt;
&lt;li&gt;æœ¬åœ°å¹¿æ’­ï¼ˆLocal Broadcastï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºŒè€…åœ¨å®ç°ä¸Šçš„å·®åˆ«ä¸»è¦åœ¨äºIPåœ°å€ã€‚ç›´æ¥å¹¿æ’­çš„IPåœ°å€ä¸­é™¤äº†ç½‘ç»œåœ°å€å¤–ï¼Œå…¶ä½™ä¸»æœºåœ°å€å…¨éƒ¨è®¾ç½®æˆ 1ã€‚ä¾‹å¦‚ï¼Œå¸Œæœ›å‘ç½‘ç»œåœ°å€ 192.12.34 ä¸­çš„æ‰€æœ‰ä¸»æœºä¼ è¾“æ•°æ®æ—¶ï¼Œå¯ä»¥å‘ 192.12.34.255 ä¼ è¾“ã€‚æ¢è¨€ä¹‹ï¼Œå¯ä»¥é‡‡å–ç›´æ¥å¹¿æ’­çš„æ–¹å¼å‘ç‰¹å®šåŒºåŸŸå†…æ‰€æœ‰ä¸»æœºä¼ è¾“æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åä¹‹ï¼Œæœ¬åœ°å¹¿æ’­ä¸­ä½¿ç”¨çš„IPåœ°å€é™å®šä¸º 255.255.255.255 ã€‚ä¾‹å¦‚ï¼Œ192.32.24 ç½‘ç»œä¸­çš„ä¸»æœºå‘ 255.255.255.255 ä¼ è¾“æ•°æ®æ—¶ï¼Œæ•°æ®å°†ä¼ è¾“åˆ° 192.32.24 ç½‘ç»œä¸­æ‰€æœ‰ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®é€šä¿¡ä¸­ä½¿ç”¨çš„IPåœ°å€æ˜¯ä¸ UDP ç¤ºä¾‹çš„å”¯ä¸€åŒºåˆ«ã€‚é»˜è®¤ç”Ÿæˆçš„å¥—æ¥å­—ä¼šé˜»æ­¢å¹¿æ’­ï¼Œå› æ­¤ï¼Œåªéœ€é€šè¿‡å¦‚ä¸‹ä»£ç æ›´æ”¹é»˜è®¤è®¾ç½®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; send_sock;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; bcast;
...
send_sock=socket(PF_INET,SOCK_DGRAM,&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);
...
setsockopt(send_sock,SOL_SOCKET,SO_BROADCAST,(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt;*)&amp;amp;bcast,&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(bcast));
...
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;1422-å®ç°å¹¿æ’­æ•°æ®çš„-sender-å’Œ-receiver&#34;&gt;14.2.2 å®ç°å¹¿æ’­æ•°æ®çš„ Sender å’Œ Receiver&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¹¿æ’­æ•°æ®çš„ Sender å’Œ Receiverçš„ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch14/news_sender_brd.c&#34;&gt;news_sender_brd.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch14/news_receiver_brd.c&#34;&gt;news_receiver_brd.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;gcc news_receiver_brd.c -o receiver
gcc news_sender_brd.c -o sender
./sender 255.255.255.255 9190
./receiver 9190
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/28/5c4e9113368dd.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;143-åŸºäº-windows-çš„å®ç°&#34;&gt;14.3 åŸºäº Windows çš„å®ç°&lt;/h3&gt;
&lt;p&gt;æš‚ç•¥&lt;/p&gt;
&lt;h3 id=&#34;144-ä¹ é¢˜&#34;&gt;14.4 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TTL çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè¯·ä»è·¯ç”±å™¨çš„è§’åº¦è¯´æ˜è¾ƒå¤§çš„ TTL å€¼ä¸è¾ƒå°çš„ TTL å€¼ä¹‹é—´çš„åŒºåˆ«åŠé—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šTTL æ˜¯å†³å®šã€Œæ•°æ®åŒ…ä¼ é€’è·ç¦»ã€çš„ä¸»è¦å› ç´ ã€‚TTL æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡ä¸€ã€‚TTL å˜ä¸º 0 æ—¶ï¼Œæ•°æ®åŒ…å°±æ— æ³•å†è¢«ä¼ é€’ï¼Œåªèƒ½é”€æ¯ã€‚å› æ­¤ï¼ŒTTLè®¾ç½®è¿‡å¤§ä¼šå½±å“ç½‘ç»œæµé‡ã€‚å½“ç„¶ï¼Œè®¾ç½®è¿‡å°æ— æ³•ä¼ é€’åˆ°ç›®æ ‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ’­ä¸å¹¿æ’­çš„å¼‚åŒç‚¹æ˜¯ä»€ä¹ˆï¼Ÿè¯·ä»æ•°æ®é€šä¿¡çš„è§’åº¦è¿›è¡Œè¯´æ˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šåœ¨ã€Œä¸€æ¬¡æ€§å‘å¤šä¸ªä¸»æœºå‘é€æ•°æ®ã€è¿™ä¸€ç‚¹ä¸Šä¸å¤šæ’­ç±»ä¼¼ï¼Œä½†ä¼ è¾“çš„æ•°æ®èŒƒå›´æœ‰åŒºåˆ«ã€‚å¤šæ’­å³ä½¿åœ¨è·¨è¶Šä¸åŒç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œåªè¦åŠ å…¥å¤šæ’­ç»„å°±èƒ½æ¥å—æ•°æ®ã€‚ç›¸åï¼Œå¹¿æ’­åªèƒ½å‘åŒä¸€ç½‘ç»œä¸­çš„ä¸»æœºä¼ è¾“æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹é¢å…³äºå¤šæ’­çš„è¯´æ³•æè¿°é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹å†…å®¹åŠ ç²—çš„ä¸ºæè¿°æ­£ç¡®&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šæ’­æ˜¯ç”¨æ¥åŠ å…¥å¤šæ’­ç»„çš„æ‰€æœ‰ä¸»æœºä¼ è¾“æ•°æ®çš„åè®®&lt;/li&gt;
&lt;li&gt;ä¸»æœºè¿æ¥åˆ°åŒä¸€ç½‘ç»œæ‰èƒ½åŠ å…¥åˆ°å¤šæ’­ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šæ’­ç»„æ— æ³•è·¨è¶Šå¤šä¸ªç½‘ç»œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èƒ½å¤ŸåŠ å…¥å¤šæ’­ç»„çš„ä¸»æœºæ•°å¹¶æ— é™åˆ¶ï¼Œä½†åªèƒ½æœ‰ 1ä¸ªä¸»æœºï¼ˆSenderï¼‰å‘è¯¥ç»„å‘é€æ•°æ®&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ’­æ—¶ä½¿ç”¨çš„å¥—æ¥å­—æ˜¯ UDP å¥—æ¥å­—ï¼Œå› ä¸ºå¤šæ’­æ˜¯åŸºäº UDP è¿›è¡Œæ•°æ®é€šä¿¡çš„ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ’­ä¹Ÿå¯¹ç½‘ç»œæµé‡æœ‰åˆ©ï¼Œè¯·æ¯”è¾ƒ TCP äº¤æ¢æ–¹å¼è§£é‡Šå…¶åŸå› &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šTCP æ˜¯å¿…é¡»å»ºç«‹ä¸€å¯¹ä¸€çš„è¿æ¥ï¼Œå¦‚æœè¦å‘1000ä¸ªä¸»æœºå‘é€æ–‡ä»¶ï¼Œå°±å¾—ä¼ é€’1000æ¬¡ã€‚ä½†æ˜¯æ­¤æ—¶ç”¨å¤šæ’­æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œå°±åªéœ€è¦å‘é€ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ’­æ–¹å¼çš„æ•°æ®é€šä¿¡éœ€è¦ MBone è™šæ‹Ÿç½‘ç»œã€‚æ¢è¨€ä¹‹ï¼ŒMBone æ˜¯ç”¨äºå¤šæ’­çš„ç½‘ç»œï¼Œä½†å®ƒæ˜¯è™šæ‹Ÿç½‘ç»œã€‚è¯·è§£é‡Šæ­¤å¤„çš„ã€Œè™šæ‹Ÿç½‘ç»œã€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šå¯ä»¥ç†è§£ä¸ºã€Œé€šè¿‡ç½‘ç»œä¸­çš„ç‰¹æ®Šåè®®å·¥ä½œçš„è½¯ä»¶æ¦‚å¿µä¸Šçš„ç½‘ç»œã€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ MBone å¹¶éå¯ä»¥è§¦åŠçš„ç‰©ç†ç½‘ç»œã€‚ä»–æ˜¯ä»¥ç‰©ç†ç½‘ç»œä¸ºåŸºç¡€ï¼Œé€šè¿‡è½¯ä»¶æ–¹æ³•å®ç°çš„å¤šæ’­é€šä¿¡å¿…å¤‡è™šæ‹Ÿç½‘ç»œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-14-%E7%AB%A0-%E5%A4%9A%E6%92%AD%E4%B8%8E%E5%B9%BF%E6%92%AD-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 13 ç«  å¤šç§ I/O å‡½æ•° ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-13-%E7%AB%A0-%E5%A4%9A%E7%A7%8D-i-o-%E5%87%BD%E6%95%B0-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Mon, 04 Apr 2022 23:08:00 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-13-%E7%AB%A0-%E5%A4%9A%E7%A7%8D-i-o-%E5%87%BD%E6%95%B0-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-13-%E7%AB%A0-%E5%A4%9A%E7%A7%8D-i-o-%E5%87%BD%E6%95%B0-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-13-ç« -å¤šç§-io-å‡½æ•°&#34;&gt;ç¬¬ 13 ç«  å¤šç§ I/O å‡½æ•°&lt;/h2&gt;
&lt;h3 id=&#34;131-send--recv-å‡½æ•°&#34;&gt;13.1 send &amp;amp; recv å‡½æ•°&lt;/h3&gt;
&lt;h4 id=&#34;1311-linux-ä¸­çš„-send--recv&#34;&gt;13.1.1 Linux ä¸­çš„ send &amp;amp; recv&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆçœ‹ sned å‡½æ•°å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;ssize_t &lt;span style=&#34;color:#008b45&#34;&gt;send&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sockfd, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *buf, size_t nbytes, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; flags);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›å‘é€çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;sockfd: è¡¨ç¤ºä¸æ•°æ®ä¼ è¾“å¯¹è±¡çš„è¿æ¥çš„å¥—æ¥å­—å’Œæ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;buf: ä¿å­˜å¸¦ä¼ è¾“æ•°æ®çš„ç¼“å†²åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;nbytes: å¾…ä¼ è¾“å­—èŠ‚æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;flags: ä¼ è¾“æ•°æ®æ—¶æŒ‡å®šçš„å¯é€‰é¡¹ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ recv å‡½æ•°çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;ssize_t &lt;span style=&#34;color:#008b45&#34;&gt;recv&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sockfd, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *buf, size_t nbytes, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; flags);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼ˆæ”¶åˆ° EOF è¿”å› 0ï¼‰ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;sockfd: è¡¨ç¤ºæ•°æ®æ¥å—å¯¹è±¡çš„è¿æ¥çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;buf: ä¿å­˜æ¥å—æ•°æ®çš„ç¼“å†²åœ°å€å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;nbytes: å¯æ¥æ”¶çš„æœ€å¤§å­—èŠ‚æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;flags: æ¥æ”¶æ•°æ®æ—¶æŒ‡å®šçš„å¯é€‰é¡¹å‚æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;send å’Œ recv å‡½æ•°éƒ½æ˜¯æœ€åä¸€ä¸ªå‚æ•°æ˜¯æ”¶å‘æ•°æ®çš„å¯é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å¯ä»¥ç”¨ä½æˆ–ï¼ˆbit ORï¼‰è¿ç®—ç¬¦ï¼ˆ| è¿ç®—ç¬¦ï¼‰åŒæ—¶ä¼ é€’å¤šä¸ªä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;send &amp;amp; recv å‡½æ•°çš„å¯é€‰é¡¹æ„ä¹‰ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯é€‰é¡¹ï¼ˆOptionï¼‰&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;th&gt;send&lt;/th&gt;
&lt;th&gt;recv&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;MSG_OOB&lt;/td&gt;
&lt;td&gt;ç”¨äºä¼ è¾“å¸¦å¤–æ•°æ®ï¼ˆOut-of-band dataï¼‰&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MSG_PEEK&lt;/td&gt;
&lt;td&gt;éªŒè¯è¾“å…¥ç¼“å†²ä¸­æ˜¯å¦å­˜åœ¨æ¥å—çš„æ•°æ®&lt;/td&gt;
&lt;td&gt;X&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MSG_DONTROUTE&lt;/td&gt;
&lt;td&gt;æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä¸å‚ç…§æœ¬åœ°è·¯ç”±ï¼ˆRoutingï¼‰è¡¨ï¼Œåœ¨æœ¬åœ°ï¼ˆLocalï¼‰ç½‘ç»œä¸­å¯»æ‰¾ç›®çš„åœ°&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;td&gt;X&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MSG_DONTWAIT&lt;/td&gt;
&lt;td&gt;è°ƒç”¨ I/O å‡½æ•°æ—¶ä¸é˜»å¡ï¼Œç”¨äºä½¿ç”¨éé˜»å¡ï¼ˆNon-blockingï¼‰I/O&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MSG_WAITALL&lt;/td&gt;
&lt;td&gt;é˜²æ­¢å‡½æ•°è¿”å›ï¼Œç›´åˆ°æ¥æ”¶åˆ°å…¨éƒ¨è¯·æ±‚çš„å­—èŠ‚æ•°&lt;/td&gt;
&lt;td&gt;X&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;1312-msg_oobå‘é€ç´§æ€¥æ¶ˆæ¯&#34;&gt;13.1.2 MSG_OOBï¼šå‘é€ç´§æ€¥æ¶ˆæ¯&lt;/h4&gt;
&lt;p&gt;MSG_OOB å¯é€‰é¡¹ç”¨äºåˆ›å»ºç‰¹æ®Šå‘é€æ–¹æ³•å’Œé€šé“ä»¥å‘é€ç´§æ€¥æ¶ˆæ¯ã€‚ä¸‹é¢ä¸º MSG_OOB çš„ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/oob_recv.c&#34;&gt;oob_recv.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/oob_send.c&#34;&gt;oob_send.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc oob_send.c -o send
gcc oob_recv.c -o recv
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4bda167ae08.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4bdb4d99823.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œsend æ˜¯å®¢æˆ·ç«¯ï¼Œrecv æ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶å®Œæ¶ˆæ¯ä¹‹åæ˜¾ç¤ºå‡ºæ¥ã€‚å¯ä»¥ä»å›¾ä¸­çœ‹å‡ºï¼Œæ¯æ¬¡è¿è¡Œçš„æ•ˆæœï¼Œå¹¶ä¸æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç ä¸­å…³äº:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;fcntl(recv_sock, F_SETOWN, getpid());
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;çš„æ„æ€æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ–‡ä»¶æè¿°ç¬¦ recv_sock æŒ‡å‘çš„å¥—æ¥å­—å¼•å‘çš„ SIGURG ä¿¡å·å¤„ç†è¿›ç¨‹å˜ä¸º getpid å‡½æ•°è¿”å›å€¼ç”¨ä½œ ID è¿›ç¨‹.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šè¿°æè¿°ä¸­çš„ã€Œå¤„ç† SIGURG ä¿¡å·ã€æŒ‡çš„æ˜¯ã€Œè°ƒç”¨ SIGURG ä¿¡å·å¤„ç†å‡½æ•°ã€ã€‚ä½†æ˜¯ä¹‹å‰è®²è¿‡ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰ 1 ä¸ªå¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨ fork å‡½æ•°åˆ›å»ºå­è¿›ç¨‹å¹¶åŒæ—¶å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ã€‚æ­¤æ—¶å¦‚æœå‘ç”Ÿ SIGURG ä¿¡å·ï¼Œåº”è¯¥è°ƒç”¨å“ªä¸ªè¿›ç¨‹çš„ä¿¡å·å¤„ç†å‡½æ•°å‘¢ï¼Ÿå¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œä¸ä¼šè°ƒç”¨æ‰€æœ‰è¿›ç¨‹çš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚å› æ­¤ï¼Œå¤„ç† SIGURG ä¿¡å·æ—¶å¿…é¡»æŒ‡å®šå¤„ç†ä¿¡å·æ‰€ç”¨çš„è¿›ç¨‹ï¼Œè€Œ getpid è¿”å›çš„æ˜¯è°ƒç”¨æ­¤å‡½æ•°çš„è¿›ç¨‹ ID ã€‚ä¸Šè¿°è°ƒç”¨è¯­å¥æŒ‡å½“å‰ä¸ºå¤„ç† SIGURG ä¿¡å·çš„ä¸»ä½“ã€‚&lt;/p&gt;
&lt;p&gt;è¾“å‡ºç»“æœï¼Œå¯èƒ½å‡ºä¹æ„æ–™ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ MSG_OOB å¯é€‰é¡¹ä¼ é€’æ•°æ®æ—¶åªè¿”å› 1 ä¸ªå­—èŠ‚ï¼Œè€Œä¸”ä¹Ÿä¸å¿«&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çš„ç¡®ï¼Œé€šè¿‡ MSG_OOB å¹¶ä¸ä¼šåŠ å¿«ä¼ è¾“é€Ÿåº¦ï¼Œè€Œé€šè¿‡ä¿¡å·å¤„ç†å‡½æ•° urg_handler ä¹Ÿåªèƒ½è¯»å–ä¸€ä¸ªå­—èŠ‚ã€‚å‰©ä½™æ•°æ®åªèƒ½é€šè¿‡æœªè®¾ç½® MSG_OOB å¯é€‰é¡¹çš„æ™®é€šè¾“å…¥å‡½æ•°è¯»å–ã€‚å› ä¸º TCP ä¸å­˜åœ¨çœŸæ­£æ„ä¹‰ä¸Šçš„ã€Œå¤–å¸¦æ•°æ®ã€ã€‚å®é™…ä¸Šï¼ŒMSG_OOB ä¸­çš„ OOB æŒ‡çš„æ˜¯ Out-of-band ï¼Œè€Œã€Œå¤–å¸¦æ•°æ®ã€çš„å«ä¹‰æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡å»å®Œå…¨ä¸åŒçš„é€šä¿¡è·¯å¾„ä¼ è¾“çš„æ•°æ®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å³çœŸæ­£æ„ä¹‰ä¸Šçš„ Out-of-band éœ€è¦é€šè¿‡å•ç‹¬çš„é€šä¿¡è·¯å¾„é«˜é€Ÿä¼ è¾“æ•°æ®ï¼Œä½†æ˜¯ TCP ä¸å¦å¤–æä¾›ï¼Œåªåˆ©ç”¨ TCP çš„ç´§æ€¥æ¨¡å¼ï¼ˆUrgent modeï¼‰è¿›è¡Œä¼ è¾“ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1313-ç´§æ€¥æ¨¡å¼å·¥ä½œåŸç†&#34;&gt;13.1.3 ç´§æ€¥æ¨¡å¼å·¥ä½œåŸç†&lt;/h4&gt;
&lt;p&gt;MSG_OOB çš„çœŸæ­£æ„ä¹‰åœ¨äºç£ä¿ƒæ•°æ®æ¥æ”¶å¯¹è±¡å°½å¿«å¤„ç†æ•°æ®ã€‚è¿™æ˜¯ç´§æ€¥æ¨¡å¼çš„å…¨éƒ¨å†…å®¹ï¼Œè€Œ TCP ã€Œä¿æŒä¼ è¾“é¡ºåºã€çš„ä¼ è¾“ç‰¹æ€§ä¾ç„¶æˆç«‹ã€‚TCP çš„ç´§æ€¥æ¶ˆæ¯æ— æ³•ä¿è¯åŠæ—¶åˆ°è¾¾ï¼Œä½†æ˜¯å¯ä»¥è¦æ±‚æ€¥æ•‘ã€‚ä¸‹é¢æ˜¯ MSG_OOB å¯é€‰é¡¹çŠ¶æ€ä¸‹çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4be222845cc.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢æ˜¯:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;send(sock, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;890&amp;#34;&lt;/span&gt;, strlen(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;890&amp;#34;&lt;/span&gt;), MSG_OOB);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å›¾ä¸Šæ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ç¼“å†²çŠ¶æ€ã€‚å¦‚æœç¼“å†²æœ€å·¦ç«¯çš„ä½ç½®è§†ä½œåç§»é‡ 0 ã€‚å­—ç¬¦ 0 ä¿å­˜äºåç§»é‡ 2 çš„ä½ç½®ã€‚å¦å¤–ï¼Œå­—ç¬¦ 0 å³ä¾§åç§»é‡ä¸º 3 çš„ä½ç½®å­˜æœ‰ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ã€‚ç´§æ€¥æŒ‡é’ˆæŒ‡å‘ç´§æ€¥æ¶ˆæ¯çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼ˆåç§»é‡åŠ ä¸€ï¼‰ï¼ŒåŒæ—¶å‘å¯¹æ–¹ä¸»æœºä¼ é€’ä¸€ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç´§æ€¥æŒ‡é’ˆæŒ‡å‘çš„åç§»é‡ä¸º 3 ä¹‹å‰çš„éƒ¨åˆ†å°±æ˜¯ç´§æ€¥æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šåªç”¨äº†ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºç´§æ€¥æ¶ˆæ¯ã€‚è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡å›¾ä¸­ç”¨äºä¼ è¾“æ•°æ®çš„ TCP æ•°æ®åŒ…ï¼ˆæ®µï¼‰çš„ç»“æ„çœ‹å¾—æ›´æ¸…æ¥šï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4beeae46b4e.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;TCP æ•°æ®åŒ…å®é™…åŒ…å«æ›´å¤šä¿¡æ¯ã€‚TCP å¤´éƒ¨åŒ…å«å¦‚ä¸‹ä¸¤ç§ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URG=1ï¼šè½½æœ‰ç´§æ€¥æ¶ˆæ¯çš„æ•°æ®åŒ…&lt;/li&gt;
&lt;li&gt;URGæŒ‡é’ˆï¼šç´§æ€¥æŒ‡é’ˆä½äºåç§»é‡ä¸º 3 çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŒ‡å®š MSG_OOB é€‰é¡¹çš„æ•°æ®åŒ…æœ¬èº«å°±æ˜¯ç´§æ€¥æ•°æ®åŒ…ï¼Œå¹¶é€šè¿‡ç´§æ€¥æŒ‡é’ˆè¡¨ç¤ºç´§æ€¥æ¶ˆæ¯æ‰€åœ¨çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç´§æ€¥æ¶ˆæ¯çš„æ„ä¹‰åœ¨äºç£ä¿ƒæ¶ˆæ¯å¤„ç†ï¼Œè€Œéç´§æ€¥ä¼ è¾“å½¢å¼å—é™çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1314-æ£€æŸ¥è¾“å…¥ç¼“å†²&#34;&gt;13.1.4 æ£€æŸ¥è¾“å…¥ç¼“å†²&lt;/h4&gt;
&lt;p&gt;åŒæ—¶è®¾ç½® MSG_PEEK é€‰é¡¹å’Œ MSG_DONTWAIT é€‰é¡¹ï¼Œä»¥éªŒè¯è¾“å…¥ç¼“å†²æ˜¯å¦å­˜åœ¨æ¥æ”¶çš„æ•°æ®ã€‚è®¾ç½® MSG_PEEK é€‰é¡¹å¹¶è°ƒç”¨ recv å‡½æ•°æ—¶ï¼Œå³ä½¿è¯»å–äº†è¾“å…¥ç¼“å†²çš„æ•°æ®ä¹Ÿä¸ä¼šåˆ é™¤ã€‚å› æ­¤ï¼Œè¯¥é€‰é¡¹é€šå¸¸ä¸ MSG_DONTWAIT åˆä½œï¼Œç”¨äºè°ƒç”¨ä»¥éé˜»å¡æ–¹å¼éªŒè¯å¾…è¯»æ•°æ®å­˜ä¸å¦çš„å‡½æ•°ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¯äºŒè€…çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/peek_recv.c&#34;&gt;peek_recv.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/peek_send.c&#34;&gt;peek_send.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;gcc peek_recv.c -o recv
gcc peek_send.c -o send
./recv 9190
./send 127.0.0.1 9190
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4c0d1dc83af.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ç»“æœéªŒè¯ï¼Œä»…å‘é€äº†ä¸€æ¬¡çš„æ•°æ®è¢«è¯»å–äº† 2 æ¬¡ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ recv å‡½æ•°æ—¶è®¾ç½®äº† MSG_PEEK å¯é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;132-readv--writev-å‡½æ•°&#34;&gt;13.2 readv &amp;amp; writev å‡½æ•°&lt;/h3&gt;
&lt;h4 id=&#34;1321-ä½¿ç”¨-readv--writev-å‡½æ•°&#34;&gt;13.2.1 ä½¿ç”¨ readv &amp;amp; writev å‡½æ•°&lt;/h4&gt;
&lt;p&gt;readv &amp;amp; writev å‡½æ•°çš„åŠŸèƒ½å¯æ¦‚æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹æ•°æ®è¿›è¡Œæ•´åˆä¼ è¾“åŠå‘é€çš„å‡½æ•°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ writev å‡½æ•°å¯ä»¥å°†åˆ†æ•£ä¿å­˜åœ¨å¤šä¸ªç¼“å†²ä¸­çš„æ•°æ®ä¸€å¹¶å‘é€ï¼Œé€šè¿‡ readv å‡½æ•°å¯ä»¥ç”±å¤šä¸ªç¼“å†²åˆ†åˆ«æ¥æ”¶ã€‚å› æ­¤ï¼Œé€‚ç”¨è¿™ 2 ä¸ªå‡½æ•°å¯ä»¥å‡å°‘ I/O å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€‚ä¸‹é¢å…ˆä»‹ç» writev å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/uio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;ssize_t &lt;span style=&#34;color:#008b45&#34;&gt;writev&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; filedes, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; iovec *iov, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; iovcnt);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›å‘é€çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;filedes: è¡¨ç¤ºæ•°æ®ä¼ è¾“å¯¹è±¡çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚ä½†è¯¥å‡½æ•°å¹¶ä¸ä»…é™äºå¥—æ¥å­—ï¼Œå› æ­¤ï¼Œå¯ä»¥åƒ read ä¸€æ ·å‘å‘å…¶ä¼ é€’æ–‡ä»¶æˆ–æ ‡å‡†è¾“å‡ºæè¿°ç¬¦.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;iov: iovec ç»“æ„ä½“æ•°ç»„çš„åœ°å€å€¼ï¼Œç»“æ„ä½“ iovec ä¸­åŒ…å«å¾…å‘é€æ•°æ®çš„ä½ç½®å’Œå¤§å°ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;iovcnt: å‘ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’æ•°ç»„é•¿åº¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šè¿°ç¬¬äºŒä¸ªå‚æ•°ä¸­å‡ºç°çš„æ•°ç»„ iovec ç»“æ„ä½“çš„å£°æ˜å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; iovec
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; *iov_base; &lt;span style=&#34;color:#228b22&#34;&gt;//ç¼“å†²åœ°å€
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    size_t iov_len; &lt;span style=&#34;color:#228b22&#34;&gt;//ç¼“å†²å¤§å°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;};
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹å›¾æ˜¯è¯¥å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4c61b07d207.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;writev çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤å‘æ§åˆ¶å°è¾“å‡ºæ•°æ®ï¼Œptr æ˜¯å­˜æœ‰å¾…å‘é€æ•°æ®ä¿¡æ¯çš„ iovec æ•°ç»„æŒ‡é’ˆã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º 2ï¼Œå› æ­¤ï¼Œä» ptr æŒ‡å‘çš„åœ°å€å¼€å§‹ï¼Œå…±æµè§ˆ 2 ä¸ª iovec ç»“æ„ä½“å˜é‡ï¼Œå‘é€è¿™äº›æŒ‡é’ˆæŒ‡å‘çš„ç¼“å†²æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ writev å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/writev.c&#34;&gt;writev.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/uio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; iovec vec[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf1[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;ABCDEFG&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf2[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;1234567&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; str_len;

    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;].iov_base = buf1;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;].iov_len = &lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;].iov_base = buf2;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;].iov_len = &lt;span style=&#34;color:#b452cd&#34;&gt;4&lt;/span&gt;;

    str_len = writev(&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, vec, &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;);
    puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Write bytes: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, str_len);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc writev.c -o writev
./writevi
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ABC1234
Write bytes: 7
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸‹é¢ä»‹ç» readv å‡½æ•°ï¼ŒåŠŸèƒ½å’Œ writev å‡½æ•°æ­£å¥½ç›¸å.å‡½æ•°ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/uio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;ssize_t &lt;span style=&#34;color:#008b45&#34;&gt;readv&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; filedes, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; iovc *iov, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; iovcnt);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;filedes: è¡¨ç¤ºæ•°æ®ä¼ è¾“å¯¹è±¡çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚ä½†è¯¥å‡½æ•°å¹¶ä¸ä»…é™äºå¥—æ¥å­—ï¼Œå› æ­¤ï¼Œå¯ä»¥åƒ read ä¸€æ ·å‘å‘å…¶ä¼ é€’æ–‡ä»¶æˆ–æ ‡å‡†è¾“å‡ºæè¿°ç¬¦.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;iov: iovec ç»“æ„ä½“æ•°ç»„çš„åœ°å€å€¼ï¼Œç»“æ„ä½“ iovec ä¸­åŒ…å«å¾…å‘é€æ•°æ®çš„ä½ç½®å’Œå¤§å°ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;iovcnt: å‘ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’æ•°ç»„é•¿åº¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch13/readv.c&#34;&gt;readv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/uio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define BUF_SIZE 100
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; iovec vec[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf1[BUF_SIZE] = {
        &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;,
    };
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf2[BUF_SIZE] = {
        &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;,
    };
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; str_len;

    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;].iov_base = buf1;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;].iov_len = &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;].iov_base = buf2;
    vec[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;].iov_len = BUF_SIZE;

    str_len = readv(&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;, vec, &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Read bytes: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, str_len);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;First message: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf1);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Second message: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf2);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc readv.c -o rv
./rv
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4c718555398.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆæˆªå–äº†é•¿åº¦ä¸º 5 çš„æ•°æ®è¾“å‡ºï¼Œç„¶åå†è¾“å‡ºå‰©ä¸‹çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1322-åˆç†ä½¿ç”¨-readv--writev-å‡½æ•°&#34;&gt;13.2.2 åˆç†ä½¿ç”¨ readv &amp;amp; writev å‡½æ•°&lt;/h4&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œèƒ½ä½¿ç”¨è¯¥å‡½æ•°çš„æ‰€æœ‰æƒ…å†µéƒ½é€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä¼ è¾“çš„æ•°æ®åˆ†åˆ«ä½äºä¸åŒç¼“å†²ï¼ˆæ•°ç»„ï¼‰æ—¶ï¼Œéœ€è¦å¤šæ¬¡è°ƒç”¨ write å‡½æ•°ã€‚æ­¤æ—¶å¯é€šè¿‡ 1 æ¬¡ writev å‡½æ•°è°ƒç”¨æ›¿ä»£æ“ä½œï¼Œå½“ç„¶ä¼šæé«˜æ•ˆç‡ã€‚åŒæ ·ï¼Œéœ€è¦å°†è¾“å…¥ç¼“å†²ä¸­çš„æ•°æ®è¯»å…¥ä¸åŒä½ç½®æ—¶ï¼Œå¯ä»¥ä¸å¿…å¤šæ¬¡è°ƒç”¨ read å‡½æ•°ï¼Œè€Œæ˜¯åˆ©ç”¨ 1 æ¬¡ readv å‡½æ•°å°±èƒ½å¤§å¤§æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ„ä¹‰åœ¨äºå‡å°‘æ•°æ®åŒ…ä¸ªæ•°ã€‚å‡è®¾ä¸ºäº†æé«˜æ•ˆç‡åœ¨æœåŠ¡å™¨ç«¯æ˜ç¡®ç¦ç”¨äº† Nagle ç®—æ³•ã€‚å…¶å® writev å‡½æ•°åœ¨ä¸é‡‡ç”¨ Nagle ç®—æ³•æ—¶æ›´æœ‰ä»·å€¼ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/26/5c4c731323e19.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;133-åŸºäº-windows-çš„å®ç°&#34;&gt;13.3 åŸºäº Windows çš„å®ç°&lt;/h3&gt;
&lt;p&gt;æš‚ç•¥&lt;/p&gt;
&lt;h3 id=&#34;134-ä¹ é¢˜&#34;&gt;13.4 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äº MSG_OOB å¯é€‰é¡¹çš„è¯´æ³•é”™è¯¯çš„æ˜¯&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—çš„å­—ä½“ä»£è¡¨è¯´æ³•æ­£ç¡®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MSG_OOB æŒ‡ä¼ è¾“ Out-of-band æ•°æ®ï¼Œæ˜¯é€šè¿‡å…¶ä»–è·¯å¾„é«˜é€Ÿä¼ è¾“æ•°æ®&lt;/li&gt;
&lt;li&gt;MSG_OOB æŒ‡é€šè¿‡å…¶ä»–è·¯å¾„é«˜é€Ÿä¼ è¾“æ•°æ®ï¼Œå› æ­¤ TCP ä¸­è®¾ç½®è¯¥é€‰é¡¹çš„æ•°æ®å…ˆåˆ°è¾¾å¯¹æ–¹ä¸»æœº&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾ç½® MSG_OOB æ˜¯æ•°æ®å…ˆåˆ°è¾¾å¯¹æ–¹ä¸»æœºåï¼Œä»¥æ™®é€šæ•°æ®çš„å½¢å¼å’Œé¡ºåºè¯»å–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæ˜¯æé«˜äº†ä¼ è¾“é€Ÿåº¦ï¼Œæ¥æ”¶æ–¹æ— æ³•è¯†åˆ«è¿™ä¸€ç‚¹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MSG_OOB æ— æ³•è„±ç¦» TCP çš„é»˜è®¤æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œå³ä½¿è„±ç¦»äº† MSG_OOB ï¼Œä¹Ÿä¼šä¿æŒåŸæœ‰çš„ä¼ è¾“é¡ºåºã€‚è¯¥é€‰é¡¹åªç”¨äºè¦æ±‚æ¥æ”¶æ–¹ç´§æ€¥å¤„ç†&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ©ç”¨ readv &amp;amp; writev å‡½æ•°æ”¶å‘æ•°æ®æœ‰ä½•ä¼˜ç‚¹ï¼Ÿåˆ†åˆ«ä»å‡½æ•°è°ƒç”¨æ¬¡æ•°å’Œ I/O ç¼“å†²çš„è§’åº¦ç»™å‡ºè¯´æ˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šéœ€è¦ä¼ è¾“çš„æ•°æ®åˆ†åˆ«ä½äºä¸åŒç¼“å†²ï¼ˆæ•°ç»„ï¼‰æ—¶ï¼Œéœ€è¦å¤šæ¬¡è°ƒç”¨ write å‡½æ•°ã€‚æ­¤æ—¶å¯é€šè¿‡ 1 æ¬¡ writev å‡½æ•°è°ƒç”¨æ›¿ä»£æ“ä½œï¼Œå½“ç„¶ä¼šæé«˜æ•ˆç‡ã€‚åŒæ ·ï¼Œéœ€è¦å°†è¾“å…¥ç¼“å†²ä¸­çš„æ•°æ®è¯»å…¥ä¸åŒä½ç½®æ—¶ï¼Œå¯ä»¥ä¸å¿…å¤šæ¬¡è°ƒç”¨ read å‡½æ•°ï¼Œè€Œæ˜¯åˆ©ç”¨ 1 æ¬¡ readv å‡½æ•°å°±èƒ½å¤§å¤§æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ recv å‡½æ•°éªŒè¯è¾“å…¥ç¼“å†²ä¸­æ˜¯å¦å­˜åœ¨æ•°æ®æ—¶ï¼ˆç¡®è®¤åç«‹å³è¿”å›æ—¶ï¼‰ï¼Œå¦‚ä½•è®¾ç½® recv å‡½æ•°æœ€åä¸€ä¸ªå‚æ•°ä¸­çš„å¯é€‰é¡¹ï¼Ÿåˆ†åˆ«è¯´æ˜å„å¯é€‰é¡¹çš„å«ä¹‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä½¿ç”¨ MSG_PEEK æ¥éªŒè¯è¾“å…¥ç¼“å†²ä¸­æ˜¯å¦å­˜åœ¨å¾…æ¥æ”¶çš„æ•°æ®ã€‚å„ä¸ªå¯é€‰é¡¹çš„æ„ä¹‰å‚è§ä¸Šé¢å¯¹åº”ç« èŠ‚çš„è¡¨æ ¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-13-%E7%AB%A0-%E5%A4%9A%E7%A7%8D-i-o-%E5%87%BD%E6%95%B0-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 12 ç«  I/O å¤ç”¨ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-12-%E7%AB%A0-i-o-%E5%A4%8D%E7%94%A8-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Sat, 02 Apr 2022 17:38:29 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-12-%E7%AB%A0-i-o-%E5%A4%8D%E7%94%A8-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-12-%E7%AB%A0-i-o-%E5%A4%8D%E7%94%A8-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-12-ç« -io-å¤ç”¨&#34;&gt;ç¬¬ 12 ç«  I/O å¤ç”¨&lt;/h2&gt;
&lt;h3 id=&#34;121-åŸºäº-io-å¤ç”¨çš„æœåŠ¡å™¨ç«¯&#34;&gt;12.1 åŸºäº I/O å¤ç”¨çš„æœåŠ¡å™¨ç«¯&lt;/h3&gt;
&lt;h4 id=&#34;1211-å¤šè¿›ç¨‹æœåŠ¡ç«¯çš„ç¼ºç‚¹å’Œè§£å†³æ–¹æ³•&#34;&gt;12.1.1 å¤šè¿›ç¨‹æœåŠ¡ç«¯çš„ç¼ºç‚¹å’Œè§£å†³æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†æ„å»ºå¹¶å‘æœåŠ¡å™¨ï¼Œåªè¦æœ‰å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚å°±ä¼šåˆ›å»ºæ–°è¿›ç¨‹ã€‚è¿™çš„ç¡®æ˜¯å®é™…æ“ä½œä¸­é‡‡ç”¨çš„ä¸€ç§æ–¹æ¡ˆï¼Œä½†å¹¶éåå…¨åç¾ï¼Œå› ä¸ºåˆ›å»ºè¿›ç¨‹è¦ä»˜å‡ºå¾ˆå¤§çš„ä»£ä»·ã€‚è¿™éœ€è¦å¤§é‡çš„è¿ç®—å’Œå†…å­˜ç©ºé—´ï¼Œç”±äºæ¯ä¸ªè¿›ç¨‹éƒ½å…·æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ç›¸äº’é—´çš„æ•°æ®äº¤æ¢ä¹Ÿè¦é‡‡ç”¨ç›¸å¯¹å¤æ‚çš„æ–¹æ³•ï¼ˆIPC å±äºç›¸å¯¹å¤æ‚çš„é€šä¿¡æ–¹æ³•ï¼‰&lt;/p&gt;
&lt;p&gt;I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1212-ç†è§£å¤ç”¨&#34;&gt;12.1.2 ç†è§£å¤ç”¨&lt;/h4&gt;
&lt;p&gt;ã€Œå¤ç”¨ã€åœ¨ç”µå­åŠé€šä¿¡å·¥ç¨‹é¢†åŸŸå¾ˆå¸¸è§ï¼Œå‘è¿™äº›é¢†åŸŸçš„ä¸“å®¶è¯¢é—®å…¶æ¦‚å¿µï¼Œå¯èƒ½ä¼šå¾—åˆ°å¦‚ä¸‹ç­”å¤ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ 1 ä¸ªé€šä¿¡é¢‘é“ä¸­ä¼ é€’å¤šä¸ªæ•°æ®ï¼ˆä¿¡å·ï¼‰çš„æŠ€æœ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ã€Œå¤ç”¨ã€çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†æé«˜ç‰©ç†è®¾å¤‡çš„æ•ˆç‡ï¼Œåªç”¨æœ€å°‘çš„ç‰©ç†è¦ç´ ä¼ é€’æœ€å¤šæ•°æ®æ—¶ä½¿ç”¨çš„æŠ€æœ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šè¿°ä¸¤ç§æ–¹æ³•çš„å†…å®¹å®Œå…¨ä¸€è‡´ã€‚å¯ä»¥ç”¨çº¸ç”µè¯æ¨¡å‹åšä¸€ä¸ªç±»æ¯”ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kA8H81.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ä¸€ä¸ªçº¸æ¯ç”µè¯ç³»ç»Ÿï¼Œä¸ºäº†ä½¿å¾—ä¸‰äººåŒæ—¶é€šè¯ï¼Œè¯´è¯æ—¶è¦åŒäº‹å¯¹ç€ä¸¤ä¸ªçº¸æ¯ï¼Œæ¥å¬æ—¶ä¹Ÿéœ€è¦è€³æœµåŒæ—¶å¯¹å‡†ä¸¤ä¸ªçº¸æ¯ã€‚ä¸ºäº†å®Œæˆ 3 äººé€šè¯ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹å›¾çš„æ”¹è¿›ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kA8bgx.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾åšå‡ºæ”¹è¿›ï¼Œå°±æ˜¯å¼•å…¥äº†å¤ç”¨æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¤ç”¨æŠ€æœ¯çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘è¿çº¿é•¿åº¦&lt;/li&gt;
&lt;li&gt;å‡å°‘çº¸æ¯ä¸ªæ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å³ä½¿å‡å°‘äº†è¿çº¿å’Œçº¸æ¯çš„é‡ä»ç„¶å¯ä»¥è¿›è¡Œä¸‰äººåŒæ—¶è¯´è¯ï¼Œä½†æ˜¯å¦‚æœç¢°åˆ°ä»¥ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ã€Œå¥½åƒä¸èƒ½åŒæ—¶è¯´è¯ï¼Ÿã€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œå› ä¸ºæ˜¯åœ¨è¿›è¡Œå¯¹è¯ï¼Œæ‰€ä»¥å¾ˆå°‘å‘ç”ŸåŒæ—¶è¯´è¯çš„æƒ…å†µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šè¿°ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯**ã€Œæ—¶åˆ†å¤ç”¨ã€**æŠ€æœ¯ã€‚å› ä¸ºè¯´è¯äººå£°é¢‘ç‡ä¸åŒï¼Œå³ä½¿åœ¨åŒæ—¶è¯´è¯ä¹Ÿèƒ½è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„åŒºåˆ†ï¼ˆæ‚éŸ³ä¹Ÿéšä¹‹å¢å¤šï¼‰ã€‚å› æ­¤ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ã€Œé¢‘åˆ†å¤ç”¨æŠ€æœ¯ã€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1213-å¤ç”¨æŠ€æœ¯åœ¨æœåŠ¡å™¨ç«¯çš„åº”ç”¨&#34;&gt;12.1.3 å¤ç”¨æŠ€æœ¯åœ¨æœåŠ¡å™¨ç«¯çš„åº”ç”¨&lt;/h4&gt;
&lt;p&gt;çº¸æ¯ç”µè¯ç³»ç»Ÿå¼•å…¥å¤ç”¨æŠ€æœ¯ä¹‹åå¯ä»¥å‡å°‘çº¸æ¯æ•°é‡å’Œè¿çº¿é•¿åº¦ã€‚æœåŠ¡å™¨ç«¯å¼•å…¥å¤ç”¨æŠ€æœ¯å¯ä»¥å‡å°‘æ‰€éœ€è¿›ç¨‹æ•°ã€‚ä¸‹å›¾æ˜¯å¤šè¿›ç¨‹æœåŠ¡ç«¯çš„æ¨¡å‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kAGBM6.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯å¼•å…¥å¤ç”¨æŠ€æœ¯ä¹‹åçš„æ¨¡å‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kAGrqO.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå¼•å…¥å¤ç”¨æŠ€æœ¯ä¹‹åï¼Œå¯ä»¥å‡å°‘è¿›ç¨‹æ•°ã€‚é‡è¦çš„æ˜¯ï¼Œæ— è®ºè¿æ¥å¤šå°‘å®¢æˆ·ç«¯ï¼Œæä¾›æœåŠ¡çš„è¿›ç¨‹åªæœ‰ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;h3 id=&#34;122-ç†è§£-select-å‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯&#34;&gt;12.2 ç†è§£ select å‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯&lt;/h3&gt;
&lt;p&gt;select å‡½æ•°æ˜¯æœ€å…·ä»£è¡¨æ€§çš„å®ç°å¤ç”¨æœåŠ¡å™¨çš„æ–¹æ³•ã€‚åœ¨ Windows å¹³å°ä¸‹ä¹Ÿæœ‰åŒåå‡½æ•°ï¼Œæ‰€ä»¥å…·æœ‰å¾ˆå¥½çš„ç§»æ¤æ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1221-select-å‡½æ•°çš„åŠŸèƒ½å’Œè°ƒç”¨é¡ºåº&#34;&gt;12.2.1 select å‡½æ•°çš„åŠŸèƒ½å’Œè°ƒç”¨é¡ºåº&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ select å‡½æ•°æ—¶å¯ä»¥å°†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦é›†ä¸­åˆ°ä¸€èµ·ç»Ÿä¸€ç›‘è§†ï¼Œé¡¹ç›®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯å¦å­˜åœ¨å¥—æ¥å­—æ¥æ”¶æ•°æ®ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ— éœ€é˜»å¡ä¼ è¾“æ•°æ®çš„å¥—æ¥å­—æœ‰å“ªäº›ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å“ªäº›å¥—æ¥å­—å‘ç”Ÿäº†å¼‚å¸¸ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¯è¯­ï¼šã€Œäº‹ä»¶ã€ã€‚å½“å‘ç”Ÿç›‘è§†é¡¹å¯¹åº”æƒ…å†µæ—¶ï¼Œç§°ã€Œå‘ç”Ÿäº†äº‹ä»¶ã€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;select å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ä¸ä¸€èˆ¬å‡½æ•°çš„åŒºåˆ«å¹¶ä¸å¤§ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œä»–å¾ˆéš¾ä½¿ç”¨ã€‚ä½†æ˜¯ä¸ºäº†å®ç° I/O å¤ç”¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬åº”è¯¥æŒæ¡ select å‡½æ•°ï¼Œå¹¶è¿ç”¨äºå¥—æ¥å­—ç¼–ç¨‹å½“ä¸­ã€‚è®¤ä¸ºã€Œselect å‡½æ•°æ˜¯ I/O å¤ç”¨çš„å…¨éƒ¨å†…å®¹ã€ä¹Ÿå¹¶ä¸ä¸ºè¿‡ã€‚select å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kAtdRs.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1222-è®¾ç½®æ–‡ä»¶æè¿°ç¬¦&#34;&gt;12.2.2 è®¾ç½®æ–‡ä»¶æè¿°ç¬¦&lt;/h4&gt;
&lt;p&gt;åˆ©ç”¨ select å‡½æ•°å¯ä»¥åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å½“ç„¶ï¼Œç›‘è§†æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è§†ä¸ºç›‘è§†å¥—æ¥å­—ã€‚æ­¤æ—¶é¦–å…ˆéœ€è¦å°†è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦é›†ä¸­åœ¨ä¸€èµ·ã€‚é›†ä¸­æ—¶ä¹Ÿè¦æŒ‰ç…§ç›‘è§†é¡¹ï¼ˆæ¥æ”¶ã€ä¼ è¾“ã€å¼‚å¸¸ï¼‰è¿›è¡ŒåŒºåˆ†ï¼Œå³æŒ‰ç…§ä¸Šè¿° 3 ç§ç›‘è§†é¡¹åˆ†æˆ 3 ç±»ã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨ fd_set æ•°ç»„å˜é‡æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œè¯¥æ•°ç»„æ˜¯å­˜æœ‰0å’Œ1çš„ä½æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kAt2i4.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­æœ€å·¦ç«¯çš„ä½è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦ 0ï¼ˆæ‰€åœ¨ä½ç½®ï¼‰ã€‚å¦‚æœè¯¥ä½è®¾ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºè¯¥æ–‡ä»¶æè¿°ç¬¦æ˜¯ç›‘è§†å¯¹è±¡ã€‚é‚£ä¹ˆå›¾ä¸­å“ªäº›æ–‡ä»¶æè¿°ç¬¦æ˜¯ç›‘è§†å¯¹è±¡å‘¢ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œæ˜¯æè¿°ç¬¦ 1 å’Œ 3ã€‚åœ¨ fd_set å˜é‡ä¸­æ³¨å†Œæˆ–æ›´æ”¹å€¼çš„æ“ä½œéƒ½ç”±ä¸‹åˆ—å®å®Œæˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FD_ZERO(fd_set *fdset)&lt;/code&gt;ï¼šå°† fd_set å˜é‡æ‰€æŒ‡çš„ä½å…¨éƒ¨åˆå§‹åŒ–æˆ0&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FD_SET(int fd,fd_set *fdset)&lt;/code&gt;ï¼šåœ¨å‚æ•° fdset æŒ‡å‘çš„å˜é‡ä¸­æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦ fd çš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FD_SLR(int fd,fd_set *fdset)&lt;/code&gt;ï¼šä»å‚æ•° fdset æŒ‡å‘çš„å˜é‡ä¸­æ¸…é™¤æ–‡ä»¶æè¿°ç¬¦ fd çš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FD_ISSET(int fd,fd_set *fdset)&lt;/code&gt;ï¼šè‹¥å‚æ•° fdset æŒ‡å‘çš„å˜é‡ä¸­åŒ…å«æ–‡ä»¶æè¿°ç¬¦ fd çš„ä¿¡æ¯ï¼Œåˆ™è¿”å›ã€ŒçœŸã€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šè¿°å‡½æ•°ä¸­ï¼ŒFD_ISSET ç”¨äºéªŒè¯ select å‡½æ•°çš„è°ƒç”¨ç»“æœï¼Œé€šè¿‡ä¸‹å›¾è§£é‡Šè¿™äº›å‡½æ•°çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kANR78.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1223-è®¾ç½®æ£€æŸ¥ç›‘è§†èŒƒå›´åŠè¶…æ—¶&#34;&gt;12.2.3 è®¾ç½®æ£€æŸ¥ï¼ˆç›‘è§†ï¼‰èŒƒå›´åŠè¶…æ—¶&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ select å‡½æ•°çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/select.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/time.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;select&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; maxfd, fd_set *readset, fd_set *writeset,
           fd_set *exceptset, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; timeval *timeout);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›å¤§äº 0 çš„å€¼ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;maxfd: ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦æ•°é‡
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;readset: å°†æ‰€æœ‰å…³æ³¨ã€Œæ˜¯å¦å­˜åœ¨å¾…è¯»å–æ•°æ®ã€çš„æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåˆ° fd_set å‹å˜é‡ï¼Œå¹¶ä¼ é€’å…¶åœ°å€å€¼ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;writeset: å°†æ‰€æœ‰å…³æ³¨ã€Œæ˜¯å¦å¯ä¼ è¾“æ— é˜»å¡æ•°æ®ã€çš„æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåˆ° fd_set å‹å˜é‡ï¼Œå¹¶ä¼ é€’å…¶åœ°å€å€¼ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;exceptset: å°†æ‰€æœ‰å…³æ³¨ã€Œæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ã€çš„æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåˆ° fd_set å‹å˜é‡ï¼Œå¹¶ä¼ é€’å…¶åœ°å€å€¼ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;timeout: è°ƒç”¨ select å‡½æ•°åï¼Œä¸ºé˜²æ­¢é™·å…¥æ— é™é˜»å¡çš„çŠ¶æ€ï¼Œä¼ é€’è¶…æ—¶(time-out)ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;è¿”å›å€¼: å‘ç”Ÿé”™è¯¯æ—¶è¿”å› -1,è¶…æ—¶æ—¶è¿”å›0,ã€‚å› å‘ç”Ÿå…³æ³¨çš„æ—¶é—´è¿”å›æ—¶ï¼Œè¿”å›å¤§äº0çš„å€¼ï¼Œè¯¥å€¼æ˜¯å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦æ•°ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œselect å‡½æ•°ç”¨æ¥éªŒè¯ 3 ç§ç›‘è§†çš„å˜åŒ–æƒ…å†µï¼Œæ ¹æ®ç›‘è§†é¡¹å£°æ˜ 3 ä¸ª fd_set å‹å˜é‡ï¼Œåˆ†åˆ«å‘å…¶æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ï¼Œå¹¶æŠŠå˜é‡çš„åœ°å€å€¼ä¼ é€’åˆ°ä¸Šè¿°å‡½æ•°çš„ç¬¬äºŒåˆ°ç¬¬å››ä¸ªå‚æ•°ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼ˆè°ƒç”¨ select å‡½æ•°ä¹‹å‰ï¼‰éœ€è¦å†³å®šä¸‹é¢ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ–‡ä»¶æè¿°ç¬¦çš„ç›‘è§†ï¼ˆæ£€æŸ¥ï¼‰èŒƒå›´æ˜¯ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•è®¾å®š select å‡½æ•°çš„è¶…æ—¶æ—¶é—´ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸€ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„ç›‘è§†èŒƒå›´å’Œ select çš„ç¬¬ä¸€ä¸ªå‚æ•°æœ‰å…³ã€‚å®é™…ä¸Šï¼Œselect å‡½æ•°è¦æ±‚é€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç›‘è§†å¯¹è±¡æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ã€‚å› æ­¤ï¼Œéœ€è¦å¾—åˆ°æ³¨å†Œåœ¨ fd_set å˜é‡ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ•°ã€‚ä½†æ¯æ¬¡æ–°å»ºæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå…¶å€¼å°±ä¼šå¢åŠ  1 ï¼Œæ•…åªéœ€å°†æœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦å€¼åŠ  1 å†ä¼ é€’ç»™ select å‡½æ•°å³å¯ã€‚åŠ  1 æ˜¯å› ä¸ºæ–‡ä»¶æè¿°ç¬¦çš„å€¼æ˜¯ä» 0 å¼€å§‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒï¼Œselect å‡½æ•°çš„è¶…æ—¶æ—¶é—´ä¸ select å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æœ‰å…³ï¼Œå…¶ä¸­ timeval ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; timeval
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; tv_sec;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;long&lt;/span&gt; tv_usec;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æœ¬æ¥ select å‡½æ•°åªæœ‰åœ¨ç›‘è§†æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿå˜åŒ–æ—¶æ‰è¿”å›ã€‚å¦‚æœæœªå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚æŒ‡å®šè¶…æ—¶æ—¶é—´å°±æ˜¯ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚é€šè¿‡ä¸Šè¿°ç»“æ„ä½“å˜é‡ï¼Œå°†ç§’æ•°å¡«å…¥ tv_sec çš„æˆå‘˜ï¼Œå°†å¾®å¦™æ•°å¡«å…¥ tv_usec çš„æˆå‘˜ï¼Œç„¶åå°†ç»“æ„ä½“çš„åœ°å€å€¼ä¼ é€’åˆ° select å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚æ­¤æ—¶ï¼Œå³ä½¿æ–‡ä»¶æè¿°ç¬¦æœªå‘ç”Ÿå˜åŒ–ï¼Œåªè¦è¿‡äº†æŒ‡å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä»å‡½æ•°ä¸­è¿”å›ã€‚ä¸è¿‡è¿™ç§æƒ…å†µä¸‹ï¼Œ select å‡½æ•°è¿”å› 0 ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡è¿”å›å€¼äº†è§£åŸå› ã€‚å¦‚æœä¸å‘è®¾ç½®è¶…æ—¶ï¼Œåˆ™ä¼ é€’ NULL å‚æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1224-è°ƒç”¨-select-å‡½æ•°æŸ¥çœ‹ç»“æœ&#34;&gt;12.2.4 è°ƒç”¨ select å‡½æ•°æŸ¥çœ‹ç»“æœ&lt;/h4&gt;
&lt;p&gt;select è¿”å›æ­£æ•´æ•°æ—¶ï¼Œæ€æ ·è·çŸ¥å“ªäº›æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†å˜åŒ–ï¼Ÿå‘ select å‡½æ•°çš„ç¬¬äºŒåˆ°ç¬¬å››ä¸ªå‚æ•°ä¼ é€’çš„ fd_set å˜é‡ä¸­å°†äº§ç”Ÿå¦‚å›¾æ‰€ç¤ºçš„å˜åŒ–ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kA06dx.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç”±å›¾å¯çŸ¥ï¼Œselect å‡½æ•°è°ƒç”¨å®Œæˆå€™ï¼Œå‘å…¶ä¼ é€’çš„ fd_set å˜é‡å°†å‘ç”Ÿå˜åŒ–ã€‚åŸæ¥ä¸º 1 çš„æ‰€æœ‰ä½å°†å˜æˆ 0ï¼Œä½†æ˜¯å‘ç”Ÿäº†å˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦é™¤å¤–ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºå€¼ä»ä¸º 1 çš„ä½ç½®ä¸Šçš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†å˜åŒ–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1225-select-å‡½æ•°è°ƒç”¨ç¤ºä¾‹&#34;&gt;12.2.5 select å‡½æ•°è°ƒç”¨ç¤ºä¾‹&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ª select å‡½æ•°çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch12/select.c&#34;&gt;select.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;select&lt;/span&gt;.c -o &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;select&lt;/span&gt;
./select
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kAjgW6.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè¿è¡Œååœ¨æ ‡å‡†è¾“å…¥æµè¾“å…¥æ•°æ®ï¼Œå°±ä¼šåœ¨æ ‡å‡†è¾“å‡ºæµè¾“å‡ºæ•°æ®ï¼Œä½†æ˜¯å¦‚æœ 5 ç§’æ²¡æœ‰è¾“å…¥æ•°æ®ï¼Œå°±æç¤ºè¶…æ—¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1226-å®ç°-io-å¤ç”¨æœåŠ¡å™¨ç«¯&#34;&gt;12.2.6 å®ç° I/O å¤ç”¨æœåŠ¡å™¨ç«¯&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡ select å‡½æ•°å®ç° I/O å¤ç”¨æœåŠ¡å™¨ç«¯ã€‚ä¸‹é¢æ˜¯åŸºäº I/O å¤ç”¨çš„å›å£°æœåŠ¡å™¨ç«¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch12/echo_selectserv.c&#34;&gt;echo_selectserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_selectserv.c -o selserv
./selserv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/23/kEkV8H.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶åªç”¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯å´å®ç°äº†å¯ä»¥å’Œå¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œè¿™éƒ½æ˜¯åˆ©ç”¨äº† select çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;123-åŸºäº-windows-çš„å®ç°&#34;&gt;12.3 åŸºäº Windows çš„å®ç°&lt;/h3&gt;
&lt;p&gt;æš‚ç•¥&lt;/p&gt;
&lt;h3 id=&#34;124-ä¹ é¢˜&#34;&gt;12.4 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·è§£é‡Šå¤ç”¨æŠ€æœ¯çš„é€šç”¨å«ä¹‰ï¼Œå¹¶è¯´æ˜ä½•ä¸º I/O å¤ç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šé€šç”¨å«ä¹‰ï¼šåœ¨ 1 ä¸ªé€šä¿¡é¢‘é“ä¸­ä¼ é€’å¤šä¸ªæ•°æ®ï¼ˆä¿¡å·ï¼‰çš„æŠ€æœ¯ã€‚IOå¤ç”¨å°±æ˜¯è¿›ç¨‹é¢„å…ˆå‘Šè¯‰å†…æ ¸éœ€è¦ç›‘è§†çš„IOæ¡ä»¶ï¼Œä½¿å¾—å†…æ ¸ä¸€æ—¦å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªIOæ¡ä»¶å°±ç»ªï¼Œå°±é€šè¿‡è¿›ç¨‹è¿›ç¨‹å¤„ç†ï¼Œä»è€Œä¸ä¼šåœ¨å•ä¸ªIOä¸Šé˜»å¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;a href=&#34;https://www.cnblogs.com/luoxn28/p/6220372.html&#34;&gt;Linuxç½‘ç»œç¼–ç¨‹-IOå¤ç”¨æŠ€æœ¯&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šè¿›ç¨‹å¹¶å‘æœåŠ¡å™¨çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿå¦‚ä½•åœ¨ I/O å¤ç”¨æœåŠ¡å™¨ä¸­å¼¥è¡¥ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šå¤šè¿›ç¨‹éœ€è¦è¿›è¡Œå¤§é‡çš„è¿ç®—å’Œå¤§é‡çš„å†…å­˜ç©ºé—´ã€‚åœ¨ I/O å¤ç”¨æœåŠ¡å™¨ä¸­é€šè¿‡ select å‡½æ•°ç›‘è§†æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡åˆ¤æ–­å˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¥å¾—çŸ¥å˜åŒ–çš„å¥—æ¥å­—æ˜¯å“ªä¸ªï¼Œä»è€Œå®æ—¶åº”ç­”æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤ç”¨æœåŠ¡å™¨ç«¯éœ€è¦ select å‡½æ•°ã€‚ä¸‹åˆ—å…³äº select  å‡½æ•°ä½¿ç”¨æ–¹æ³•çš„æè¿°é”™è¯¯çš„æ˜¯ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—çš„ä¸ºæ­£ç¡®çš„æè¿°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨ select å‡½æ•°å‰éœ€è¦é›†ä¸­ I/O ç›‘è§†å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‹¥å·²é€šè¿‡ select å‡½æ•°æ³¨å†Œä¸ºç›‘è§†å¯¹è±¡ï¼Œåˆ™åç»­è°ƒç”¨ select å‡½æ•°æ—¶æ— éœ€é‡å¤æ³¨å†Œ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¤ç”¨æœåŠ¡å™¨ç«¯åŒä¸€æ—¶é—´åªèƒ½æœåŠ¡äº 1 ä¸ªå®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œéœ€è¦æœåŠ¡çš„å®¢æˆ·ç«¯æ¥å…¥æœåŠ¡å™¨ç«¯ååªèƒ½ç­‰å¾…&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¤šçº¿ç¨‹æœåŠ¡ç«¯ä¸åŒï¼ŒåŸºäº select çš„å¤ç”¨æœåŠ¡å™¨åªéœ€è¦ 1 ä¸ªè¿›ç¨‹ã€‚å› æ­¤ï¼Œå¯ä»¥å‡å°‘å› åˆ›å»ºå¤šè¿›ç¨‹äº§ç”Ÿçš„æœåŠ¡å™¨ç«¯çš„è´Ÿæ‹…&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;select å‡½æ•°çš„è§‚å¯Ÿå¯¹è±¡ä¸­åº”åŒ…å«æœåŠ¡ç«¯å¥—æ¥å­—ï¼ˆç›‘å¬å¥—æ¥å­—ï¼‰ï¼Œé‚£ä¹ˆåº”å°†å…¶åŒ…å«åˆ°å“ªä¸€ç±»ç›‘å¬å¯¹è±¡é›†åˆï¼Ÿè¯·è¯´æ˜åŸå› &lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç­”ï¼šåº”è¯¥åŒ…å«åˆ°ã€Œæ˜¯å¦å­˜åœ¨å¾…è¯»å–æ•°æ®ã€ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯éœ€è¦æŸ¥çœ‹å¥—æ¥å­—ä¸­æœ‰æ²¡æœ‰å¯ä»¥è¯»å–çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-12-%E7%AB%A0-i-o-%E5%A4%8D%E7%94%A8-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 11 ç«  è¿›ç¨‹é—´é€šä¿¡ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-11-%E7%AB%A0-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Fri, 01 Apr 2022 11:40:18 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-11-%E7%AB%A0-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-11-%E7%AB%A0-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-11-ç« -è¿›ç¨‹é—´é€šä¿¡&#34;&gt;ç¬¬ 11 ç«  è¿›ç¨‹é—´é€šä¿¡&lt;/h2&gt;
&lt;p&gt;è¿›ç¨‹é—´é€šä¿¡ï¼Œæ„å‘³ç€ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹ä¸­å¯ä»¥äº¤æ¢æ•°æ®&lt;/p&gt;
&lt;h3 id=&#34;111-è¿›ç¨‹é—´é€šä¿¡çš„åŸºæœ¬æ¦‚å¿µ&#34;&gt;11.1 è¿›ç¨‹é—´é€šä¿¡çš„åŸºæœ¬æ¦‚å¿µ&lt;/h3&gt;
&lt;h4 id=&#34;1111-é€šè¿‡ç®¡é“å®ç°è¿›ç¨‹é—´é€šä¿¡&#34;&gt;11.1.1 é€šè¿‡ç®¡é“å®ç°è¿›ç¨‹é—´é€šä¿¡&lt;/h4&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯åŸºäºç®¡é“ï¼ˆPIPEï¼‰çš„è¿›ç¨‹é—´é€šä¿¡çš„æ¨¡å‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kFlk0s.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†å®Œæˆè¿›ç¨‹é—´é€šä¿¡ï¼Œéœ€è¦åˆ›å»ºè¿›ç¨‹ã€‚ç®¡é“å¹¶éå±äºè¿›ç¨‹çš„èµ„æºï¼Œè€Œæ˜¯å’Œå¥—æ¥å­—ä¸€æ ·ï¼Œå±äºæ“ä½œç³»ç»Ÿï¼ˆä¹Ÿå°±ä¸æ˜¯ fork å‡½æ•°çš„å¤åˆ¶å¯¹è±¡ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸¤ä¸ªè¿›ç¨‹é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„å†…å­˜ç©ºé—´è¿›è¡Œé€šä¿¡ã€‚ä¸‹é¢æ˜¯åˆ›å»ºç®¡é“çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;pipe&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; filedes[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;]);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;filedes[0]: é€šè¿‡ç®¡é“æ¥æ”¶æ•°æ®æ—¶ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³ç®¡é“å‡ºå£
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;filedes[1]: é€šè¿‡ç®¡é“ä¼ è¾“æ•°æ®æ—¶ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³ç®¡é“å…¥å£
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;çˆ¶è¿›ç¨‹åˆ›å»ºå‡½æ•°æ—¶å°†åˆ›å»ºç®¡é“ï¼ŒåŒæ—¶è·å–å¯¹åº”äºå‡ºå…¥å£çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹å¯ä»¥è¯»å†™åŒä¸€ç®¡é“ã€‚ä½†çˆ¶è¿›ç¨‹çš„ç›®çš„æ˜¯ä¸å­è¿›ç¨‹è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå› æ­¤éœ€è¦å°†å…¥å£æˆ–å‡ºå£ä¸­çš„ 1 ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯å…³äºè¯¥å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch11/pipe1.c&#34;&gt;pipe1.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define BUF_SIZE 30
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fds[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Who are you?&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf[BUF_SIZE];
    pid_t pid;
    &lt;span style=&#34;color:#228b22&#34;&gt;// è°ƒç”¨  pipe å‡½æ•°åˆ›å»ºç®¡é“ï¼Œfds æ•°ç»„ä¸­ä¿å­˜ç”¨äº I/O çš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    pipe(fds);
    pid = fork(); &lt;span style=&#34;color:#228b22&#34;&gt;//å­è¿›ç¨‹å°†åŒæ—¶æ‹¥æœ‰åˆ›å»ºç®¡é“è·å–çš„2ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤åˆ¶çš„å¹¶éç®¡é“ï¼Œè€Œæ˜¯æ–‡ä»¶æè¿°ç¬¦
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        write(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;], str, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str));
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        read(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;], buf, BUF_SIZE);
        puts(buf);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc pipe1.c -o pipe1
./pipe1
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Who are you?
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥ä»ç¨‹åºä¸­çœ‹å‡ºï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå­è¿›ç¨‹é€šè¿‡ fds[1] æŠŠæ•°æ®å†™å…¥ç®¡é“ï¼Œçˆ¶è¿›ç¨‹ä» fds[0] å†æŠŠæ•°æ®è¯»å‡ºæ¥ã€‚å¯ä»¥ä»ä¸‹å›¾çœ‹å‡ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kF8A7d.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1112-é€šè¿‡ç®¡é“è¿›è¡Œè¿›ç¨‹é—´åŒå‘é€šä¿¡&#34;&gt;11.1.2 é€šè¿‡ç®¡é“è¿›è¡Œè¿›ç¨‹é—´åŒå‘é€šä¿¡&lt;/h4&gt;
&lt;p&gt;ä¸‹å›¾å¯ä»¥çœ‹å‡ºåŒå‘é€šä¿¡æ¨¡å‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kF84De.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åŒå‘é€šä¿¡çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch11/pipe2.c&#34;&gt;pipe2.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define BUF_SIZE 30
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fds[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str1[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Who are you?&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str2[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Thank you for your message&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf[BUF_SIZE];
    pid_t pid;

    pipe(fds);
    pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        write(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;], str1, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str1));
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;);
        read(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;], buf, BUF_SIZE);
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child proc output: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        read(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;], buf, BUF_SIZE);
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Parent proc output: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf);
        write(fds[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;], str2, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str2));
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc pipe2.c -o pipe2
./pipe2
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Parent proc output: Who are you?
Child proc output: Thank you for your message
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœæ³¨é‡Šæ‰ç¬¬18è¡Œçš„ä»£ç ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå¯¼è‡´ä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚å› ä¸ºæ•°æ®è¿›å…¥ç®¡é“åå˜æˆäº†æ— ä¸»æ•°æ®ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡ read å‡½æ•°å…ˆè¯»å–æ•°æ®çš„è¿›ç¨‹å°†å¾—åˆ°æ•°æ®ï¼Œå³ä½¿è¯¥è¿›ç¨‹å°†æ•°æ®ä¼ åˆ°äº†ç®¡é“ã€‚å› ä¸ºï¼Œæ³¨é‡Šç¬¬18è¡Œä¼šäº§ç”Ÿé—®é¢˜ã€‚ç¬¬19è¡Œï¼Œè‡ªå·±æˆå°†è¯»å›è‡ªå·±åœ¨ç¬¬ 17 è¡Œå‘ç®¡é“å‘é€çš„æ•°æ®ã€‚ç»“æœçˆ¶è¿›ç¨‹è°ƒç”¨ read å‡½æ•°åï¼Œæ— é™æœŸç­‰å¾…æ•°æ®è¿›å…¥ç®¡é“ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç®¡é“ä¸æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå°±éœ€è¦åˆ›å»ºä¸¤ä¸ªç®¡é“ï¼Œå„è‡ªè´Ÿè´£ä¸åŒçš„æ•°æ®æµåŠ¨ï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kFJW0e.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é‡‡ç”¨ä¸Šè¿°æ¨¡å‹æ”¹è¿› &lt;code&gt;pipe2.c&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch11/pipe3.c&#34;&gt;pipe3.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#define BUF_SIZE 30
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; fds1[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;], fds2[&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;];
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str1[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Who are you?&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; str2[] = &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Thank you for your message&amp;#34;&lt;/span&gt;;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; buf[BUF_SIZE];
    pid_t pid;

    pipe(fds1), pipe(fds2);
    pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        write(fds1[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;], str1, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str1));
        read(fds2[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;], buf, BUF_SIZE);
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child proc output: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        read(fds1[&lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;], buf, BUF_SIZE);
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Parent proc output: %s &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, buf);
        write(fds2[&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;], str2, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(str2));
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸Šé¢é€šè¿‡åˆ›å»ºä¸¤ä¸ªç®¡é“å®ç°äº†åŠŸèƒ½ï¼Œæ­¤æ—¶ï¼Œä¸éœ€è¦é¢å¤–å†ä½¿ç”¨ sleep å‡½æ•°ã€‚è¿è¡Œç»“æœå’Œä¸Šé¢ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;112-è¿ç”¨è¿›ç¨‹é—´é€šä¿¡&#34;&gt;11.2 è¿ç”¨è¿›ç¨‹é—´é€šä¿¡&lt;/h3&gt;
&lt;h4 id=&#34;1121-ä¿å­˜æ¶ˆæ¯çš„å›å£°æœåŠ¡å™¨&#34;&gt;11.2.1 ä¿å­˜æ¶ˆæ¯çš„å›å£°æœåŠ¡å™¨&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢å¯¹ç¬¬ 10 ç« çš„ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/echo_mpserv.c&#34;&gt;echo_mpserv.c&lt;/a&gt; è¿›è¡Œæ”¹è¿›ï¼Œæ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å°†å›å£°å®¢æˆ·ç«¯ä¼ è¾“çš„å­—ç¬¦ä¸²æŒ‰åºä¿å­˜åˆ°æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®ç°è¯¥ä»»åŠ¡å°†åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œä»å‘å®¢æˆ·ç«¯æä¾›æœåŠ¡çš„è¿›ç¨‹è¯»å–å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch11/echo_storeserv.c&#34;&gt;echo_storeserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_storeserv.c -o serv
./serv &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ­¤æœåŠ¡ç«¯é…åˆç¬¬ 10 ç« çš„å®¢æˆ·ç«¯ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/echo_mpclient.c&#34;&gt;echo_mpclient.c&lt;/a&gt; ä½¿ç”¨ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹å›¾:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kFUCct.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/22/kFUAHS.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯å·²ç»ç”Ÿæˆäº†æ–‡ä»¶ï¼ŒæŠŠå®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¿å­˜å¯ä¸‹æ¥ï¼Œåªä¿å­˜äº†10æ¬¡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;113-ä¹ é¢˜&#34;&gt;11.3 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼Ÿåˆ†åˆ«ä»æ¦‚å¿µå’Œå†…å­˜çš„è§’åº¦è¿›è¡Œè¯´æ˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šè¿›ç¨‹é—´é€šä¿¡æ„å‘³ç€ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹é—´å¯ä»¥äº¤æ¢æ•°æ®ã€‚ä»å†…å­˜ä¸Šæ¥è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œç„¶åé€šè¿‡è¿™ä¸ªå†…å­˜åŒºåŸŸæ•°æ®çš„å˜åŒ–æ¥è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹é—´é€šä¿¡éœ€è¦ç‰¹æ®Šçš„ IPC æœºåˆ¶ï¼Œè¿™æ˜¯ç”±äºæ“ä½œç³»ç»Ÿæä¾›çš„ã€‚è¿›ç¨‹é—´é€šä¿¡æ—¶ä¸ºä½•éœ€è¦æ“ä½œç³»ç»Ÿçš„å¸®åŠ©ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä¸ºäº†è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œéœ€è¦ç®¡é“çš„å¸®åŠ©ï¼Œä½†æ˜¯ç®¡é“ä¸æ˜¯è¿›ç¨‹çš„èµ„æºï¼Œå®ƒå±äºä»æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ï¼Œä¸¤ä¸ªè¿›ç¨‹é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„å†…å­˜ç©ºé—´è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ã€Œç®¡é“ã€æ˜¯å…¸å‹çš„ IPC æŠ€æ³•ã€‚å…³äºç®¡é“ï¼Œè¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç®¡é“æ˜¯è¿›ç¨‹é—´äº¤æ¢æ•°æ®çš„è·¯å¾„ã€‚å¦‚ä½•åˆ›å»ºæ­¤è·¯å¾„ï¼Ÿç”±è°åˆ›å»ºï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä½¿ç”¨ pipe å‡½æ•°è¿›è¡Œåˆ›å»ºï¼Œç”±æ“ä½œç³»ç»Ÿåˆ›å»ºã€‚çˆ¶è¿›ç¨‹è°ƒç”¨è¯¥å‡½æ•°æ—¶å°†åˆ›å»ºç®¡é“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºäº†å®Œæˆè¿›ç¨‹é—´é€šä¿¡ã€‚2 ä¸ªè¿›ç¨‹è¦åŒæ—¶è¿æ¥ç®¡é“ã€‚é‚£2 ä¸ªè¿›ç¨‹å¦‚ä½•è¿æ¥åˆ°åŒä¸€ç®¡é“ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šæ•°ç»„ä¸­æœ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œçˆ¶å­è¿›ç¨‹è°ƒç”¨ç›¸å…³å‡½æ•°æ—¶ï¼Œé€šè¿‡ fork å‡½æ•°ï¼ŒæŠŠ 1 ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç®¡é“å…è®¸ 2 ä¸ªè¿›ç¨‹é—´çš„åŒå‘é€šä¿¡ã€‚åŒå‘é€šä¿¡ä¸­éœ€è¦æ³¨æ„å“ªäº›å†…å®¹ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šå‘ç®¡é“ä¼ è¾“æ•°æ®æ—¶ï¼Œå…ˆè¯»çš„è¿›ç¨‹ä¼šæŠŠæ•°æ®å–èµ°ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯æ•°æ®è¿›å…¥ç®¡é“å€™ä¼šå˜æˆæ— ä¸»æ•°æ®ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¸ºäº†é˜²æ­¢é”™è¯¯ï¼Œéœ€è¦å¤šä¸ªç®¡é“æ¥è¿›ç¨‹é€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-11-%E7%AB%A0-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
    
        <item>
        <title>ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹ç¬¬ 10 ç«  å¤šè¿›ç¨‹æœåŠ¡å™¨ç«¯ ç¬”è®°</title>
        <link>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-10-%E7%AB%A0-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Wed, 30 Mar 2022 15:59:25 +0800</pubDate>
        
        <guid>https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-10-%E7%AB%A0-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/</guid>
        <description>ğŸŒ€Jarson Cai&#39;s Blog https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-10-%E7%AB%A0-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/ -&lt;h2 id=&#34;ç¬¬-10-ç« -å¤šè¿›ç¨‹æœåŠ¡å™¨ç«¯&#34;&gt;ç¬¬ 10 ç«  å¤šè¿›ç¨‹æœåŠ¡å™¨ç«¯&lt;/h2&gt;
&lt;h3 id=&#34;101-è¿›ç¨‹æ¦‚å¿µåŠåº”ç”¨&#34;&gt;10.1 è¿›ç¨‹æ¦‚å¿µåŠåº”ç”¨&lt;/h3&gt;
&lt;h4 id=&#34;1011-å¹¶å‘æœåŠ¡ç«¯çš„å®ç°æ–¹æ³•&#34;&gt;10.1.1 å¹¶å‘æœåŠ¡ç«¯çš„å®ç°æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;é€šè¿‡æ”¹è¿›æœåŠ¡ç«¯ï¼Œä½¿å…¶åŒæ—¶å‘æ‰€æœ‰å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œä»¥æé«˜å¹³å‡æ»¡æ„åº¦ã€‚è€Œä¸”ï¼Œç½‘ç»œç¨‹åºä¸­æ•°æ®é€šä¿¡æ—¶é—´æ¯” CPU è¿ç®—æ—¶é—´å æ¯”æ›´å¤§ï¼Œå› æ­¤ï¼Œå‘å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡æ˜¯ä¸€ç§æœ‰æ•ˆçš„åˆ©ç”¨ CPU çš„æ–¹å¼ã€‚æ¥ä¸‹æ¥è®¨è®ºåŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡çš„å¹¶å‘æœåŠ¡å™¨ç«¯ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯å…·æœ‰ä»£è¡¨æ€§çš„å¹¶å‘æœåŠ¡ç«¯çš„å®ç°æ¨¡å‹å’Œæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šè¿›ç¨‹æœåŠ¡å™¨ï¼šé€šè¿‡åˆ›å»ºå¤šä¸ªè¿›ç¨‹æä¾›æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¤šè·¯å¤ç”¨æœåŠ¡å™¨ï¼šé€šè¿‡æ†ç»‘å¹¶ç»Ÿä¸€ç®¡ç† I/O å¯¹è±¡æä¾›æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¤šçº¿ç¨‹æœåŠ¡å™¨ï¼šé€šè¿‡ç”Ÿæˆä¸å®¢æˆ·ç«¯ç­‰é‡çš„çº¿ç¨‹æä¾›æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆæ˜¯ç¬¬ä¸€ç§æ–¹æ³•ï¼šå¤šè¿›ç¨‹æœåŠ¡å™¨&lt;/p&gt;
&lt;h4 id=&#34;1012-ç†è§£è¿›ç¨‹&#34;&gt;10.1.2 ç†è§£è¿›ç¨‹&lt;/h4&gt;
&lt;p&gt;è¿›ç¨‹çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å ç”¨å†…å­˜ç©ºé—´çš„æ­£åœ¨è¿è¡Œçš„ç¨‹åº&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‡å¦‚ä½ ä¸‹è½½äº†ä¸€ä¸ªæ¸¸æˆåˆ°ç”µè„‘ä¸Šï¼Œæ­¤æ—¶çš„æ¸¸æˆä¸æ˜¯è¿›ç¨‹ï¼Œè€Œæ˜¯ç¨‹åºã€‚åªæœ‰å½“æ¸¸æˆè¢«åŠ è½½åˆ°ä¸»å†…å­˜å¹¶è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œè¿™æ˜¯æ‰å¯ç§°ä¸ºè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1013-è¿›ç¨‹-id&#34;&gt;10.1.3 è¿›ç¨‹ ID&lt;/h4&gt;
&lt;p&gt;åœ¨è¯´è¿›ç¨‹åˆ›å»ºæ–¹æ³•ä¹‹å‰ï¼Œå…ˆè¦ç®€è¦è¯´æ˜è¿›ç¨‹ IDã€‚æ— è®ºè¿›ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿåˆ†é…ä¸€ä¸ª IDã€‚æ­¤ ID è¢«ç§°ä¸ºã€Œè¿›ç¨‹IDã€ï¼Œå…¶å€¼ä¸ºå¤§äº 2 çš„è¯ä¹¦ã€‚1 è¦åˆ†é…ç»™æ“ä½œç³»ç»Ÿå¯åŠ¨åçš„ï¼ˆç”¨äºååŠ©æ“ä½œç³»ç»Ÿï¼‰é¦–ä¸ªè¿›ç¨‹ï¼Œå› æ­¤ç”¨æˆ·æ— æ³•å¾—åˆ° ID å€¼ä¸º 1 ã€‚æ¥ä¸‹æ¥è§‚å¯Ÿåœ¨ Linux ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;ps au
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„å‘½ä»¤å¯æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å‘½ä»¤åŒæ—¶åˆ—å‡ºäº† PIDï¼ˆè¿›ç¨‹IDï¼‰ã€‚å‚æ•° a å’Œ uåˆ—å‡ºäº†æ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c43d7c1f2a8b.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1014-é€šè¿‡è°ƒç”¨-fork-å‡½æ•°åˆ›å»ºè¿›ç¨‹&#34;&gt;10.1.4 é€šè¿‡è°ƒç”¨ fork å‡½æ•°åˆ›å»ºè¿›ç¨‹&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼å¾ˆå¤šï¼Œæ­¤å¤„åªä»‹ç»ç”¨äºåˆ›å»ºå¤šè¿›ç¨‹æœåŠ¡ç«¯çš„ fork å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;pid_t &lt;span style=&#34;color:#008b45&#34;&gt;fork&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt;);
&lt;span style=&#34;color:#228b22&#34;&gt;// æˆåŠŸæ—¶è¿”å›è¿›ç¨‹ID,å¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;fork å‡½æ•°å°†åˆ›å»ºè°ƒç”¨çš„è¿›ç¨‹å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶éæ ¹æ®å®Œå…¨ä¸åŒçš„ç¨‹åºåˆ›å»ºè¿›ç¨‹ï¼Œè€Œæ˜¯å¤åˆ¶æ­£åœ¨è¿è¡Œçš„ã€è°ƒç”¨ fork å‡½æ•°çš„è¿›ç¨‹ã€‚å¦å¤–ï¼Œä¸¤ä¸ªè¿›ç¨‹éƒ½æ‰§è¡Œ fork å‡½æ•°è°ƒç”¨åçš„è¯­å¥ï¼ˆå‡†ç¡®çš„è¯´æ˜¯åœ¨ fork å‡½æ•°è¿”å›åï¼‰ã€‚ä½†å› ä¸ºæ˜¯é€šè¿‡åŒä¸€ä¸ªè¿›ç¨‹ã€å¤åˆ¶ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¹‹åçš„ç¨‹åºæµè¦æ ¹æ® fork å‡½æ•°çš„è¿”å›å€¼åŠ ä»¥åŒºåˆ†ã€‚å³åˆ©ç”¨ fork å‡½æ•°çš„å¦‚ä¸‹ç‰¹ç‚¹åŒºåˆ†ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çˆ¶è¿›ç¨‹ï¼šfork å‡½æ•°è¿”å›å­è¿›ç¨‹ ID&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹ï¼šfork å‡½æ•°è¿”å› 0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤„ï¼Œã€Œçˆ¶è¿›ç¨‹ã€ï¼ˆParent Processï¼‰æŒ‡åŸè¿›ç¨‹ï¼Œå³è°ƒç”¨ fork å‡½æ•°çš„ä¸»ä½“ï¼Œè€Œã€Œå­è¿›ç¨‹ã€ï¼ˆChild Processï¼‰æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹è°ƒç”¨ fork å‡½æ•°å¤åˆ¶å‡ºçš„è¿›ç¨‹ã€‚æ¥ä¸‹æ¥æ˜¯è°ƒç”¨ fork å‡½æ•°åçš„ç¨‹åºè¿è¡Œæµç¨‹ã€‚å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c43da5412b90.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ fork å‡½æ•°çš„åŒæ—¶å¤åˆ¶å‡ºå­è¿›ç¨‹ï¼Œå¹¶åˆ†åˆ«å¾—åˆ° fork å‡½æ•°çš„è¿”å›å€¼ã€‚ä½†å¤åˆ¶å‰ï¼Œçˆ¶è¿›ç¨‹å°†å…¨å±€å˜é‡ gval å¢åŠ åˆ° 11,å°†å±€éƒ¨å˜é‡ lval çš„å€¼å¢åŠ åˆ° 25ï¼Œå› æ­¤åœ¨è¿™ç§çŠ¶æ€ä¸‹å®Œæˆè¿›ç¨‹å¤åˆ¶ã€‚å¤åˆ¶å®Œæˆåæ ¹æ® fork å‡½æ•°çš„è¿”å›ç±»å‹åŒºåˆ†çˆ¶å­è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹çš„ lval çš„å€¼å¢åŠ  1 ï¼Œä½†è¿™ä¸ä¼šå½±å“å­è¿›ç¨‹çš„ lval å€¼ã€‚åŒæ ·å­è¿›ç¨‹å°† gval çš„å€¼å¢åŠ  1 ä¹Ÿä¸ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹çš„ gval ã€‚å› ä¸º fork å‡½æ•°è°ƒç”¨ååˆ†æˆäº†å®Œå…¨ä¸åŒçš„è¿›ç¨‹ï¼Œåªæ˜¯äºŒè€…å…±äº«åŒä¸€æ®µä»£ç è€Œå·²ã€‚æ¥ä¸‹æ¥ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/fork.c&#34;&gt;fork.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; gval = &lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pid_t pid;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; lval = &lt;span style=&#34;color:#b452cd&#34;&gt;20&lt;/span&gt;;
    gval++, lval += &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;;
    pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
        gval += &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;, lval += &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        gval -= &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;, lval -= &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child Proc: [%d,%d] &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, gval, lval);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Parent Proc: [%d,%d] &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, gval, lval);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc fork.c -o fork
./fork
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c43e054e7f6f.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œå½“æ‰§è¡Œäº† fork å‡½æ•°ä¹‹åï¼Œæ­¤åå°±ç›¸å½“äºæœ‰äº†ä¸¤ä¸ªç¨‹åºåœ¨æ‰§è¡Œä»£ç ï¼Œå¯¹äºçˆ¶è¿›ç¨‹æ¥è¯´ï¼Œfork å‡½æ•°è¿”å›çš„æ˜¯å­è¿›ç¨‹çš„IDï¼Œå¯¹äºå­è¿›ç¨‹æ¥è¯´ï¼Œfork å‡½æ•°è¿”å› 0ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªå˜é‡ï¼Œçˆ¶è¿›ç¨‹è¿›è¡Œäº† +2 æ“ä½œ ï¼Œè€Œå­è¿›ç¨‹è¿›è¡Œäº† -2 æ“ä½œï¼Œæ‰€ä»¥ç»“æœæ˜¯è¿™æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;102-è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹&#34;&gt;10.2 è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹&lt;/h3&gt;
&lt;p&gt;æ–‡ä»¶æ“ä½œä¸­ï¼Œå…³é—­æ–‡ä»¶å’Œæ‰“å¼€æ–‡ä»¶åŒç­‰é‡è¦ã€‚åŒæ ·ï¼Œè¿›ç¨‹é”€æ¯å’Œè¿›ç¨‹åˆ›å»ºä¹ŸåŒç­‰é‡è¦ã€‚å¦‚æœæœªè®¤çœŸå¯¹å¾…è¿›ç¨‹é”€æ¯ï¼Œä»–ä»¬å°†å˜æˆåƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1021-åƒµå°¸zombieè¿›ç¨‹&#34;&gt;10.2.1 åƒµå°¸ï¼ˆZombieï¼‰è¿›ç¨‹&lt;/h4&gt;
&lt;p&gt;è¿›ç¨‹çš„å·¥ä½œå®Œæˆåï¼ˆæ‰§è¡Œå®Œ main å‡½æ•°ä¸­çš„ç¨‹åºåï¼‰åº”è¢«é”€æ¯ï¼Œä½†æœ‰æ—¶è¿™äº›è¿›ç¨‹å°†å˜æˆåƒµå°¸è¿›ç¨‹ï¼Œå ç”¨ç³»ç»Ÿä¸­çš„é‡è¦èµ„æºã€‚è¿™ç§çŠ¶æ€ä¸‹çš„è¿›ç¨‹ç§°ä½œã€Œåƒµå°¸è¿›ç¨‹ã€ï¼Œè¿™ä¹Ÿæ˜¯ç»™ç³»ç»Ÿå¸¦æ¥è´Ÿæ‹…çš„åŸå› ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åƒµå°¸è¿›ç¨‹æ˜¯å½“å­è¿›ç¨‹æ¯”çˆ¶è¿›ç¨‹å…ˆç»“æŸï¼Œè€Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å›æ”¶å­è¿›ç¨‹ï¼Œé‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œæ­¤æ—¶å­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚å¦‚æœçˆ¶è¿›ç¨‹å…ˆé€€å‡º ï¼Œå­è¿›ç¨‹è¢«initæ¥ç®¡ï¼Œå­è¿›ç¨‹é€€å‡ºåinitä¼šå›æ”¶å…¶å ç”¨çš„ç›¸å…³èµ„æº&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»´åŸºç™¾ç§‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ç±»UNIXç³»ç»Ÿä¸­ï¼Œåƒµå°¸è¿›ç¨‹æ˜¯æŒ‡å®Œæˆæ‰§è¡Œï¼ˆé€šè¿‡exitç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–è¿è¡Œæ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯æˆ–æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ‰€è‡´ï¼‰ä½†åœ¨æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è¡¨ä¸­ä»ç„¶æœ‰ä¸€ä¸ªè¡¨é¡¹ï¼ˆè¿›ç¨‹æ§åˆ¶å—PCBï¼‰ï¼Œå¤„äº&amp;quot;ç»ˆæ­¢çŠ¶æ€&amp;quot;çš„è¿›ç¨‹ã€‚è¿™å‘ç”Ÿäºå­è¿›ç¨‹éœ€è¦ä¿ç•™è¡¨é¡¹ä»¥å…è®¸å…¶çˆ¶è¿›ç¨‹è¯»å–å­è¿›ç¨‹çš„exit statusï¼šä¸€æ—¦é€€å‡ºæ€é€šè¿‡waitç³»ç»Ÿè°ƒç”¨è¯»å–ï¼Œåƒµå°¸è¿›ç¨‹æ¡ç›®å°±ä»è¿›ç¨‹è¡¨ä¸­åˆ é™¤ï¼Œç§°ä¹‹ä¸º&amp;quot;å›æ”¶ï¼ˆreapedï¼‰&amp;quot;ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç›´æ¥è¢«å…¶çˆ¶è¿›ç¨‹waitå¹¶ç”±ç³»ç»Ÿå›æ”¶ã€‚è¿›ç¨‹é•¿æ—¶é—´ä¿æŒåƒµå°¸çŠ¶æ€ä¸€èˆ¬æ˜¯é”™è¯¯çš„å¹¶å¯¼è‡´èµ„æºæ³„æ¼ã€‚&lt;/p&gt;
&lt;p&gt;è‹±æ–‡æœ¯è¯­zombie processæºè‡ªä¸§å°¸ â€” ä¸æ­»ä¹‹äººï¼Œéšå–»å­è¿›ç¨‹å·²æ­»ä½†ä»ç„¶æ²¡æœ‰è¢«æ”¶å‰²ã€‚ä¸æ­£å¸¸è¿›ç¨‹ä¸åŒï¼Œkillå‘½ä»¤å¯¹åƒµå°¸è¿›ç¨‹æ— æ•ˆã€‚å­¤å„¿è¿›ç¨‹ä¸åŒäºåƒµå°¸è¿›ç¨‹ï¼Œå…¶çˆ¶è¿›ç¨‹å·²ç»æ­»æ‰ï¼Œä½†å­¤å„¿è¿›ç¨‹ä»èƒ½æ­£å¸¸æ‰§è¡Œï¼Œä½†å¹¶ä¸ä¼šå˜ä¸ºåƒµå°¸è¿›ç¨‹ï¼Œå› ä¸ºè¢«initï¼ˆè¿›ç¨‹IDå·ä¸º1ï¼‰æ”¶å…»å¹¶waitå…¶é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;å­è¿›ç¨‹æ­»åï¼Œç³»ç»Ÿä¼šå‘é€SIGCHLD ä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å¯¹å…¶é»˜è®¤å¤„ç†æ˜¯å¿½ç•¥ã€‚å¦‚æœæƒ³å“åº”è¿™ä¸ªæ¶ˆæ¯ï¼Œçˆ¶è¿›ç¨‹é€šå¸¸åœ¨SIGCHLD ä¿¡å·äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œä½¿ç”¨waitç³»ç»Ÿè°ƒç”¨æ¥å“åº”å­è¿›ç¨‹çš„ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;åƒµå°¸è¿›ç¨‹è¢«æ”¶å‰²åï¼Œå…¶è¿›ç¨‹å·(PID)ä¸åœ¨è¿›ç¨‹è¡¨ä¸­çš„è¡¨é¡¹éƒ½å¯ä»¥è¢«ç³»ç»Ÿé‡ç”¨ã€‚ä½†å¦‚æœçˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨waitï¼Œåƒµå°¸è¿›ç¨‹å°†ä¿ç•™è¿›ç¨‹è¡¨ä¸­çš„è¡¨é¡¹ï¼Œå¯¼è‡´äº†èµ„æºæ³„æ¼ã€‚æŸäº›æƒ…å†µä¸‹è¿™åå€’æ˜¯æœŸæœ›çš„ï¼šçˆ¶è¿›ç¨‹åˆ›å»ºäº†å¦å¤–ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶å¸Œæœ›å…·æœ‰ä¸åŒçš„è¿›ç¨‹å·ã€‚å¦‚æœçˆ¶è¿›ç¨‹é€šè¿‡è®¾ç½®äº‹ä»¶å¤„ç†å‡½æ•°ä¸ºSIG_IGNæ˜¾å¼å¿½ç•¥SIGCHLDä¿¡å·ï¼Œè€Œä¸æ˜¯éšå¼é»˜è®¤å¿½ç•¥è¯¥ä¿¡å·ï¼Œæˆ–è€…å…·æœ‰SA_NOCLDWAITæ ‡å¿—ï¼Œæ‰€æœ‰å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¿¡æ¯å°†è¢«æŠ›å¼ƒå¹¶ä¸”ç›´æ¥è¢«ç³»ç»Ÿå›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;UNIXå‘½ä»¤psåˆ—å‡ºçš„è¿›ç¨‹çš„çŠ¶æ€ï¼ˆ&amp;ldquo;STAT&amp;rdquo;ï¼‰æ æ ‡ç¤ºä¸º &amp;ldquo;Z&amp;quot;åˆ™ä¸ºåƒµå°¸è¿›ç¨‹ã€‚[1]&lt;/p&gt;
&lt;p&gt;æ”¶å‰²åƒµå°¸è¿›ç¨‹çš„æ–¹æ³•æ˜¯é€šè¿‡killå‘½ä»¤æ‰‹å·¥å‘å…¶çˆ¶è¿›ç¨‹å‘é€SIGCHLDä¿¡å·ã€‚å¦‚æœå…¶çˆ¶è¿›ç¨‹ä»ç„¶æ‹’ç»æ”¶å‰²åƒµå°¸è¿›ç¨‹ï¼Œåˆ™ç»ˆæ­¢çˆ¶è¿›ç¨‹ï¼Œä½¿å¾—initè¿›ç¨‹æ”¶å…»åƒµå°¸è¿›ç¨‹ã€‚initè¿›ç¨‹å‘¨æœŸæ‰§è¡Œwaitç³»ç»Ÿè°ƒç”¨æ”¶å‰²å…¶æ”¶å…»çš„æ‰€æœ‰åƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;1022-äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› &#34;&gt;10.2.2 äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› &lt;/h4&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢åƒµå°¸è¿›ç¨‹äº§ç”Ÿï¼Œå…ˆè§£é‡Šäº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› ã€‚åˆ©ç”¨å¦‚ä¸‹ä¸¤ä¸ªç¤ºä¾‹å±•ç¤ºè°ƒç”¨ fork å‡½æ•°äº§ç”Ÿå­è¿›ç¨‹çš„ç»ˆæ­¢æ–¹å¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ é€’å‚æ•°å¹¶è°ƒç”¨ exit() å‡½æ•°&lt;/li&gt;
&lt;li&gt;main å‡½æ•°ä¸­æ‰§è¡Œ return è¯­å¥å¹¶è¿”å›å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;**å‘ exit å‡½æ•°ä¼ é€’çš„å‚æ•°å€¼å’Œ main å‡½æ•°çš„ return è¯­å¥è¿”å›çš„å€¼éƒ½å›ä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚è€Œæ“ä½œç³»ç»Ÿä¸ä¼šé”€æ¯å­è¿›ç¨‹ï¼Œç›´åˆ°æŠŠè¿™äº›å€¼ä¼ é€’ç»™äº§ç”Ÿè¯¥å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å¤„åœ¨è¿™ç§çŠ¶æ€ä¸‹çš„è¿›ç¨‹å°±æ˜¯åƒµå°¸è¿›ç¨‹ã€‚**ä¹Ÿå°±æ˜¯è¯´å°†å­è¿›ç¨‹å˜æˆåƒµå°¸è¿›ç¨‹çš„æ­£æ˜¯æ“ä½œç³»ç»Ÿã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåƒµå°¸è¿›ç¨‹ä½•æ—¶è¢«é”€æ¯å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åº”è¯¥å‘åˆ›å»ºå­è¿›ç¨‹å†Œçˆ¶è¿›ç¨‹ä¼ é€’å­è¿›ç¨‹çš„ exit å‚æ•°å€¼æˆ– return è¯­å¥çš„è¿”å›å€¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä½•å‘çˆ¶è¿›ç¨‹ä¼ é€’è¿™äº›å€¼å‘¢ï¼Ÿæ“ä½œç³»ç»Ÿä¸ä¼šä¸»åŠ¨æŠŠè¿™äº›å€¼ä¼ é€’ç»™çˆ¶è¿›ç¨‹ã€‚åªæœ‰çˆ¶è¿›ç¨‹ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šä¼ é€’è¯¥å€¼ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æœªä¸»åŠ¨è¦æ±‚è·å¾—å­è¿›ç¨‹ç»“æŸçŠ¶æ€å€¼ï¼Œæ“ä½œç³»ç»Ÿå°†ä¸€ç›´ä¿å­˜ï¼Œå¹¶è®©å­è¿›ç¨‹é•¿æ—¶é—´å¤„äºåƒµå°¸è¿›ç¨‹çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçˆ¶æ¯è¦è´Ÿè´£æ”¶å›è‡ªå·±ç”Ÿçš„å­©å­ã€‚æ¥ä¸‹æ¥çš„ç¤ºä¾‹æ˜¯åˆ›å»ºåƒµå°¸è¿›ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/zombie.c&#34;&gt;zombie.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pid_t pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hi, I am a child Process&amp;#34;&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child Process ID: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, pid);
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;30&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;End child proess&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;End parent process&amp;#34;&lt;/span&gt;);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc zombie.c -o zombie
./zombie
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c443890f1781.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºæš‚åœäº† 30 ç§’ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ—¶é—´å†…å¯ä»¥éªŒè¯ä¸€ä¸‹å­è¿›ç¨‹æ˜¯å¦ä¸ºåƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c4439a751b11.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;ps au&lt;/code&gt; å‘½ä»¤å¯ä»¥çœ‹å‡ºï¼Œå­è¿›ç¨‹ä»ç„¶å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œåƒµå°¸è¿›ç¨‹åœ¨è¿™é‡Œæ˜¾ç¤ºä¸º &lt;code&gt;Z+&lt;/code&gt;.30ç§’åï¼Œçº¢æ¡†é‡Œé¢çš„ä¸¤ä¸ªè¿›ç¨‹ä¼šåŒæ—¶è¢«é”€æ¯ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åˆ©ç”¨ &lt;code&gt;./zombie &amp;amp;&lt;/code&gt;å¯ä»¥ä½¿ç¨‹åºåœ¨åå°è¿è¡Œï¼Œä¸ç”¨æ‰“å¼€æ–°çš„å‘½ä»¤è¡Œçª—å£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;1023-é”€æ¯åƒµå°¸è¿›ç¨‹-1åˆ©ç”¨-wait-å‡½æ•°&#34;&gt;10.2.3 é”€æ¯åƒµå°¸è¿›ç¨‹ 1ï¼šåˆ©ç”¨ wait å‡½æ•°&lt;/h4&gt;
&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œä¸ºäº†é”€æ¯å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹åº”è¯¥ä¸»åŠ¨è¯·æ±‚è·å–å­è¿›ç¨‹çš„è¿”å›å€¼ã€‚ä¸‹é¢æ˜¯å‘èµ·è¯·æ±‚çš„å…·ä½“æ–¹æ³•ã€‚æœ‰ä¸¤ç§ï¼Œä¸‹é¢çš„å‡½æ•°æ˜¯å…¶ä¸­ä¸€ç§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;pid_t &lt;span style=&#34;color:#008b45&#34;&gt;wait&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *statloc);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›ç»ˆæ­¢çš„å­è¿›ç¨‹ ID ,å¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨æ­¤å‡½æ•°æ—¶å¦‚æœå·²æœ‰å­è¿›ç¨‹ç»ˆæ­¢ï¼Œé‚£ä¹ˆå­è¿›ç¨‹ç»ˆæ­¢æ—¶ä¼ é€’çš„è¿”å›å€¼ï¼ˆexit å‡½æ•°çš„å‚æ•°è¿”å›å€¼ï¼Œmain å‡½æ•°çš„ return è¿”å›å€¼ï¼‰å°†ä¿å­˜åˆ°è¯¥å‡½æ•°çš„å‚æ•°æ‰€æŒ‡çš„å†…å­˜ç©ºé—´ã€‚ä½†å‡½æ•°å‚æ•°æŒ‡å‘çš„å•å…ƒä¸­è¿˜åŒ…å«å…¶ä»–ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦ç”¨ä¸‹åˆ—å®è¿›è¡Œåˆ†ç¦»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WIFEXITED å­è¿›ç¨‹æ­£å¸¸ç»ˆæ­¢æ—¶è¿”å›ã€ŒçœŸã€&lt;/li&gt;
&lt;li&gt;WEXITSTATUS è¿”å›å­è¿›ç¨‹æ—¶çš„è¿”å›å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ wait å‡½æ•°ä¼ é€’å˜é‡ status çš„åœ°å€æ—¶ï¼Œè°ƒç”¨ wait å‡½æ•°ååº”ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (WIFEXITED(status))
{
    puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Normal termination&amp;#34;&lt;/span&gt;);
    printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child pass num: %d&amp;#34;&lt;/span&gt;, WEXITSTATUS(status));
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ ¹æ®ä»¥ä¸Šå†…å®¹ï¼Œæœ‰å¦‚ä¸‹ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/wait.c&#34;&gt;wait.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; status;
    pid_t pid = fork(); &lt;span style=&#34;color:#228b22&#34;&gt;//è¿™é‡Œçš„å­è¿›ç¨‹å°†åœ¨ç¬¬13è¡Œé€šè¿‡ return è¯­å¥ç»ˆæ­¢
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child PID: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, pid);
        pid = fork(); &lt;span style=&#34;color:#228b22&#34;&gt;//è¿™é‡Œçš„å­è¿›ç¨‹å°†åœ¨ 21 è¡Œé€šè¿‡ exit() å‡½æ•°ç»ˆæ­¢
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
        {
            exit(&lt;span style=&#34;color:#b452cd&#34;&gt;7&lt;/span&gt;);
        }
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        {
            printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child PID: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, pid);
            wait(&amp;amp;status);         &lt;span style=&#34;color:#228b22&#34;&gt;//ä¹‹é—´ç»ˆæ­¢çš„å­è¿›ç¨‹ç›¸å…³ä¿¡æ¯å°†è¢«ä¿å­˜åˆ° status ä¸­ï¼ŒåŒæ—¶ç›¸å…³å­è¿›ç¨‹è¢«å®Œå…¨é”€æ¯
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (WIFEXITED(status)) &lt;span style=&#34;color:#228b22&#34;&gt;//é€šè¿‡ WIFEXITED æ¥éªŒè¯å­è¿›ç¨‹æ˜¯å¦æ­£å¸¸ç»ˆæ­¢ã€‚å¦‚æœæ­£å¸¸ç»ˆæ­¢ï¼Œåˆ™è°ƒç”¨ WEXITSTATUS å®è¾“å‡ºå­è¿›ç¨‹è¿”å›å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;                printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child send one: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, WEXITSTATUS(status));

            wait(&amp;amp;status); &lt;span style=&#34;color:#228b22&#34;&gt;//å› ä¸ºä¹‹å‰åˆ›å»ºäº†ä¸¤ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨ wait å‡½æ•°å’Œå®
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (WIFEXITED(status))
                printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child send two: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, WEXITSTATUS(status));
            sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;30&lt;/span&gt;);
        }
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc wait.c -o &lt;span style=&#34;color:#658b00&#34;&gt;wait&lt;/span&gt;
./wait
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c4441951df43.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œç³»ç»Ÿä¸­å¹¶æ²¡æœ‰ä¸Šè¿° PID å¯¹åº”çš„è¿›ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºè°ƒç”¨äº† wait å‡½æ•°ï¼Œå®Œå…¨é”€æ¯äº†è¯¥å­è¿›ç¨‹ã€‚å¦å¤–ä¸¤ä¸ªå­è¿›ç¨‹è¿”å›æ—¶è¿”å›çš„ 3 å’Œ 7 ä¼ é€’åˆ°äº†çˆ¶è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯é€šè¿‡ wait å‡½æ•°æ¶ˆç­åƒµå°¸è¿›ç¨‹çš„æ–¹æ³•ï¼Œè°ƒç”¨ wait å‡½æ•°æ—¶ï¼Œå¦‚æœæ²¡æœ‰å·²ç»ç»ˆæ­¢çš„å­è¿›ç¨‹ï¼Œé‚£ä¹ˆç¨‹åºå°†é˜»å¡ï¼ˆBlockingï¼‰ç›´åˆ°æœ‰å­è¿›ç¨‹ç»ˆæ­¢ï¼Œå› æ­¤è¦è°¨æ…è°ƒç”¨è¯¥å‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1024-é”€æ¯åƒµå°¸è¿›ç¨‹-2ä½¿ç”¨-waitpid-å‡½æ•°&#34;&gt;10.2.4 é”€æ¯åƒµå°¸è¿›ç¨‹ 2ï¼šä½¿ç”¨ waitpid å‡½æ•°&lt;/h4&gt;
&lt;p&gt;wait å‡½æ•°ä¼šå¼•èµ·ç¨‹åºé˜»å¡ï¼Œè¿˜å¯ä»¥è€ƒè™‘è°ƒç”¨ waitpid å‡½æ•°ã€‚è¿™æ˜¯é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ç¬¬äºŒç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯é˜²æ­¢é˜»å¡çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;pid_t &lt;span style=&#34;color:#008b45&#34;&gt;waitpid&lt;/span&gt;(pid_t pid, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; *statloc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; options);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å›ç»ˆæ­¢çš„å­è¿›ç¨‹ID æˆ– 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;pid: ç­‰å¾…ç»ˆæ­¢çš„ç›®æ ‡å­è¿›ç¨‹çš„ID,è‹¥ä¼  -1ï¼Œåˆ™ä¸ wait å‡½æ•°ç›¸åŒï¼Œå¯ä»¥ç­‰å¾…ä»»æ„å­è¿›ç¨‹ç»ˆæ­¢
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;statloc: ä¸ wait å‡½æ•°çš„ statloc å‚æ•°å…·æœ‰ç›¸åŒå«ä¹‰
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;options: ä¼ é€’å¤´æ–‡ä»¶ sys/wait.h å£°æ˜çš„å¸¸é‡ WNOHANG ,å³ä½¿æ²¡æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹ä¹Ÿä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å› 0 é€€å‡ºå‡½æ•°ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ waitpid çš„ä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/waitpid.c&#34;&gt;waitpid.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; status;
    pid_t pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
    {
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;15&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//ç”¨ sleep æ¨è¿Ÿå­è¿›ç¨‹çš„æ‰§è¡Œ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;24&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
    {
        &lt;span style=&#34;color:#228b22&#34;&gt;//è°ƒç”¨waitpid ä¼ é€’å‚æ•° WNOHANG ï¼Œè¿™æ ·ä¹‹å‰æœ‰æ²¡æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹åˆ™è¿”å›0
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;while&lt;/span&gt; (!waitpid(-&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, &amp;amp;status, WNOHANG))
        {
            sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;);
            puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;sleep 3 sec.&amp;#34;&lt;/span&gt;);
        }
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (WIFEXITED(status))
            printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child send %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, WEXITSTATUS(status));
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc waitpid.c -o waitpid
./waitpid
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c444785a16ae.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨ while å¾ªç¯ä¸­æ­£å¥½æ‰§è¡Œäº† 5 æ¬¡ã€‚è¿™ä¹Ÿè¯æ˜äº† waitpid å‡½æ•°å¹¶æ²¡æœ‰é˜»å¡&lt;/p&gt;
&lt;h3 id=&#34;103-ä¿¡å·å¤„ç†&#34;&gt;10.3 ä¿¡å·å¤„ç†&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¿›ç¨‹çš„åˆ›å»ºåŠé”€æ¯çš„åŠæ³•ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å­è¿›ç¨‹ç©¶ç«Ÿä½•æ—¶ç»ˆæ­¢ï¼Ÿè°ƒç”¨ waitpid å‡½æ•°åè¦æ— ä¼‘æ­¢çš„ç­‰å¾…å—ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;1031-å‘æ“ä½œç³»ç»Ÿæ±‚åŠ©&#34;&gt;10.3.1 å‘æ“ä½œç³»ç»Ÿæ±‚åŠ©&lt;/h4&gt;
&lt;p&gt;å­è¿›ç¨‹ç»ˆæ­¢çš„è¯†åˆ«ä¸»é¢˜æ˜¯æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ï¼Œè‹¥æ“ä½œç³»ç»Ÿèƒ½æŠŠå¦‚ä¸‹ä¿¡æ¯å‘Šè¯‰æ­£å¿™äºå·¥ä½œçš„çˆ¶è¿›ç¨‹ï¼Œå°†æœ‰åŠ©äºæ„å»ºæ›´é«˜æ•ˆçš„ç¨‹åº&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°ä¸Šè¿°çš„åŠŸèƒ½ï¼Œå¼•å…¥ä¿¡å·å¤„ç†æœºåˆ¶ï¼ˆSignal Handingï¼‰ã€‚æ­¤å¤„ã€Œä¿¡å·ã€æ˜¯åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ç”±æ“ä½œç³»ç»Ÿå‘è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ã€‚å¦å¤–ï¼Œä¸ºäº†å“åº”è¯¥æ¶ˆæ¯ï¼Œæ‰§è¡Œä¸æ¶ˆæ¯ç›¸å…³çš„è‡ªå®šä¹‰æ“ä½œçš„è¿‡ç¨‹è¢«ç§°ä¸ºã€Œå¤„ç†ã€æˆ–ã€Œä¿¡å·å¤„ç†ã€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1032-ä¿¡å·ä¸-signal-å‡½æ•°&#34;&gt;10.3.2 ä¿¡å·ä¸ signal å‡½æ•°&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢è¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„å¯¹è¯å¯ä»¥å¸®åŠ©ç†è§£ä¿¡å·å¤„ç†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿›ç¨‹ï¼šæ“ä½œç³»ç»Ÿï¼Œå¦‚æœæˆ‘ä¹‹å‰åˆ›å»ºçš„å­è¿›ç¨‹ç»ˆæ­¢ï¼Œå°±å¸®æˆ‘è°ƒç”¨ zombie_handler å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿï¼šå¥½çš„ï¼Œå¦‚æœä½ çš„å­è¿›ç¨‹ç»ˆæ­¢ï¼Œæˆ‘èˆ…å¸®ä½ è°ƒç”¨ zombie_handler å‡½æ•°ï¼Œä½ å…ˆæŠŠè¦å‡½æ•°è¦æ‰§è¡Œçš„è¯­å¥å†™å¥½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šè¿°çš„å¯¹è¯ï¼Œç›¸å½“äºã€Œæ³¨å†Œä¿¡å·ã€çš„è¿‡ç¨‹ã€‚å³è¿›ç¨‹å‘ç°è‡ªå·±çš„å­è¿›ç¨‹ç»“æŸæ—¶ï¼Œè¯·æ±‚æ“ä½œç³»ç»Ÿè°ƒç”¨çš„ç‰¹å®šå‡½æ•°ã€‚è¯¥è¯·æ±‚å¯ä»¥é€šè¿‡å¦‚ä¸‹å‡½æ•°è°ƒç”¨å®Œæˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; (*signal(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; signo, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; (*func)(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt;)))(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt;);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;ä¸ºäº†åœ¨äº§ç”Ÿä¿¡å·æ—¶è°ƒç”¨ï¼Œè¿”å›ä¹‹å‰æ³¨å†Œçš„å‡½æ•°æŒ‡é’ˆ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;å‡½æ•°å: signal
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;å‚æ•°ï¼šint signo,void(*func)(int)
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;è¿”å›ç±»å‹ï¼šå‚æ•°ç±»å‹ä¸ºintå‹ï¼Œè¿”å› void å‹å‡½æ•°æŒ‡é’ˆ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è°ƒç”¨ä¸Šè¿°å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç‰¹æ®Šæƒ…å†µä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç‰¹æ®Šæƒ…å†µä¸‹å°†è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€å€¼ï¼ˆæŒ‡é’ˆï¼‰ã€‚å‘ç”Ÿç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æƒ…å†µæ—¶ï¼Œè°ƒç”¨ç¬¬äºŒä¸ªå‚æ•°æ‰€æŒ‡çš„å‡½æ•°ã€‚ä¸‹é¢ç»™å‡ºå¯ä»¥åœ¨ signal å‡½æ•°ä¸­æ³¨å†Œçš„éƒ¨åˆ†ç‰¹æ®Šæƒ…å†µå’Œå¯¹åº”çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SIGALRMï¼šå·²åˆ°é€šè¿‡è°ƒç”¨ alarm å‡½æ•°æ³¨å†Œæ—¶é—´&lt;/li&gt;
&lt;li&gt;SIGINTï¼šè¾“å…¥ ctrl+c&lt;/li&gt;
&lt;li&gt;SIGCHLDï¼šå­è¿›ç¨‹ç»ˆæ­¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥ç¼–å†™è°ƒç”¨ signal å‡½æ•°çš„è¯­å¥å®Œæˆå¦‚ä¸‹è¯·æ±‚ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ã€Œå­è¿›ç¨‹ç»ˆæ­¢åˆ™è°ƒç”¨ mychild å‡½æ•°ã€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ­¤æ—¶ mychild å‡½æ•°çš„å‚æ•°åº”ä¸º int ï¼Œè¿”å›å€¼ç±»å‹åº”ä¸º void ã€‚åªæœ‰è¿™æ ·æ‰èƒ½ç§°ä¸º signal å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚å¦å¤–ï¼Œå¸¸æ•° SIGCHLD å®šä¹‰äº†å­è¿›ç¨‹ç»ˆæ­¢çš„æƒ…å†µï¼Œåº”æˆä¸º signal å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsignal å‡½æ•°è°ƒç”¨è¯­å¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;signal(SIGCHLD , mychild);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ç¼–å†™ signal å‡½æ•°çš„è°ƒç”¨è¯­å¥ï¼Œåˆ†åˆ«å®Œæˆå¦‚ä¸‹ä¸¤ä¸ªè¯·æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·²åˆ°é€šè¿‡ alarm å‡½æ•°æ³¨å†Œæ—¶é—´ï¼Œè¯·è°ƒç”¨ timeout å‡½æ•°&lt;/li&gt;
&lt;li&gt;è¾“å…¥ ctrl+c æ—¶è°ƒç”¨ keycontrol å‡½æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»£è¡¨è¿™ 2 ç§æƒ…å†µçš„å¸¸æ•°åˆ†åˆ«ä¸º SIGALRM å’Œ SIGINT ï¼Œå› æ­¤æŒ‰å¦‚ä¸‹æ–¹å¼è°ƒç”¨ signal å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;signal(SIGALRM , timeout);
signal(SIGINT , keycontrol);
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ä¿¡å·æ³¨å†Œè¿‡ç¨‹ã€‚æ³¨å†Œå¥½ä¿¡å·ä¹‹åï¼Œå‘ç”Ÿæ³¨å†Œä¿¡å·æ—¶ï¼ˆæ³¨å†Œçš„æƒ…å†µå‘ç”Ÿæ—¶ï¼‰ï¼Œæ“ä½œç³»ç»Ÿå°†è°ƒç”¨è¯¥ä¿¡å·å¯¹åº”çš„å‡½æ•°ã€‚å…ˆä»‹ç» alarm å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;alarm&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; seconds);
&lt;span style=&#34;color:#228b22&#34;&gt;// è¿”å›0æˆ–ä»¥ç§’ä¸ºå•ä½çš„è· SIGALRM ä¿¡å·å‘ç”Ÿæ‰€å‰©æ—¶é—´
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœè°ƒç”¨è¯¥å‡½æ•°çš„åŒæ—¶å‘å®ƒä¼ é€’ä¸€ä¸ªæ­£æ•´å‹å‚æ•°ï¼Œç›¸åº”æ—¶é—´åï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰å°†äº§ç”Ÿ SIGALRM ä¿¡å·ã€‚è‹¥å‘è¯¥å‡½æ•°ä¼ é€’ä¸º 0 ï¼Œåˆ™ä¹‹å‰å¯¹ SIGALRM ä¿¡å·çš„é¢„çº¦å°†å–æ¶ˆã€‚å¦‚æœé€šè¿‡æ”¹å‡½æ•°é¢„çº¦ä¿¡å·åæœªæŒ‡å®šè¯¥ä¿¡å·å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œåˆ™ï¼ˆé€šè¿‡è°ƒç”¨ signal å‡½æ•°ï¼‰ç»ˆæ­¢è¿›ç¨‹ï¼Œä¸åšä»»ä½•å¤„ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/signal.c&#34;&gt;signal.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;timeout&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sig) &lt;span style=&#34;color:#228b22&#34;&gt;//ä¿¡å·å¤„ç†å™¨
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (sig == SIGALRM)
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Time out!&amp;#34;&lt;/span&gt;);
    alarm(&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//ä¸ºäº†æ¯éš” 2 ç§’é‡å¤äº§ç”Ÿ SIGALRM ä¿¡å·ï¼Œåœ¨ä¿¡å·å¤„ç†å™¨ä¸­è°ƒç”¨ alarm å‡½æ•°
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;keycontrol&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sig) &lt;span style=&#34;color:#228b22&#34;&gt;//ä¿¡å·å¤„ç†å™¨
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (sig == SIGINT)
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;CTRL+C pressed&amp;#34;&lt;/span&gt;);
}
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    signal(SIGALRM, timeout); &lt;span style=&#34;color:#228b22&#34;&gt;//æ³¨å†Œä¿¡å·åŠç›¸åº”å¤„ç†å™¨
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    signal(SIGINT, keycontrol);
    alarm(&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//é¢„çº¦ 2 ç§’å€™å‘ç”Ÿ SIGALRM ä¿¡å·
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;; i++)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;wait...&amp;#34;&lt;/span&gt;);
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;100&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc signal.c -o signal
./signal
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c446c877acb7.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°ç»“æœæ˜¯æ²¡æœ‰ä»»ä½•è¾“å…¥çš„è¿è¡Œç»“æœã€‚å½“è¾“å…¥ ctrl+c æ—¶:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/20/5c446ce0b1143.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°±å¯ä»¥çœ‹åˆ° &lt;code&gt;CTRL+C pressed&lt;/code&gt; çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‘ç”Ÿä¿¡å·æ—¶å°†å”¤é†’ç”±äºè°ƒç”¨ sleep å‡½æ•°è€Œè¿›å…¥é˜»å¡çŠ¶æ€çš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è°ƒç”¨å‡½æ•°çš„ä¸»é¢˜çš„ç¡®æ˜¯æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯è¿›ç¨‹å¤„äºç¡çœ çŠ¶æ€æ—¶æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œå› æ­¤ï¼Œäº§ç”Ÿä¿¡å·æ—¶ï¼Œä¸ºäº†è°ƒç”¨ä¿¡å·å¤„ç†å™¨ï¼Œå°†å”¤é†’ç”±äºè°ƒç”¨ sleep å‡½æ•°è€Œè¿›å…¥é˜»å¡çŠ¶æ€çš„è¿›ç¨‹ã€‚è€Œä¸”ï¼Œè¿›ç¨‹ä¸€æ—¦è¢«å”¤é†’ï¼Œå°±ä¸ä¼šå†è¿›å…¥ç¡çœ çŠ¶æ€ã€‚å³ä½¿è¿˜æœªåˆ° sleep ä¸­è§„å®šçš„æ—¶é—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥ä¸Šè¿°ç¤ºä¾‹è¿è¡Œä¸åˆ° 10 ç§’åå°±ä¼šç»“æŸï¼Œè¿ç»­è¾“å…¥ CTRL+C å¯èƒ½è¿ä¸€ç§’éƒ½ä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€è¨€ä¹‹ï¼Œå°±æ˜¯æœ¬æ¥ç³»ç»Ÿè¦ç¡çœ 100ç§’ï¼Œä½†æ˜¯åˆ°äº† alarm(2) è§„å®šçš„ä¸¤ç§’ä¹‹åï¼Œå°±ä¼šå”¤é†’ç¡çœ çš„è¿›ç¨‹ï¼Œè¿›ç¨‹è¢«å”¤é†’äº†å°±ä¸ä¼šå†è¿›å…¥ç¡çœ çŠ¶æ€äº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨ç­‰å¾…100ç§’ã€‚å¦‚æœæŠŠ timeout() å‡½æ•°ä¸­çš„ alarm(2) æ³¨é‡Šæ‰ï¼Œå°±ä¼šå…ˆè¾“å‡º&lt;code&gt;wait...&lt;/code&gt;ï¼Œç„¶åå†è¾“å‡º&lt;code&gt;Time out!&lt;/code&gt; (è¿™æ—¶å·²ç»è·³è¿‡äº†ç¬¬ä¸€æ¬¡çš„ sleep(100) ç§’),ç„¶åå°±çœŸçš„ä¼šç¡çœ 100ç§’ï¼Œå› ä¸ºæ²¡æœ‰å†å‘å‡º alarm(2)  çš„ä¿¡å·ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;1033-åˆ©ç”¨-sigaction-å‡½æ•°è¿›è¡Œä¿¡å·å¤„ç†&#34;&gt;10.3.3 åˆ©ç”¨ sigaction å‡½æ•°è¿›è¡Œä¿¡å·å¤„ç†&lt;/h4&gt;
&lt;p&gt;å‰é¢æ‰€å­¦çš„å†…å®¹å¯ä»¥é˜²æ­¢åƒµå°¸è¿›ç¨‹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå«åš sigaction å‡½æ•°ï¼Œä»–ç±»ä¼¼äº signal å‡½æ•°ï¼Œè€Œä¸”å¯ä»¥å®Œå…¨ä»£æ›¿åè€…ï¼Œä¹Ÿæ›´ç¨³å®šã€‚ä¹‹æ‰€ä»¥ç¨³å®šï¼Œæ˜¯å› ä¸ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;signal å‡½æ•°åœ¨ Unix ç³»åˆ—çš„ä¸åŒæ“ä½œç³»ç»Ÿå¯èƒ½å­˜åœ¨åŒºåˆ«ï¼Œä½† sigaction å‡½æ•°å®Œå…¨ç›¸åŒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®é™…ä¸Šç°åœ¨å¾ˆå°‘ç”¨ signal å‡½æ•°ç¼–å†™ç¨‹åºï¼Œä»–åªæ˜¯ä¸ºäº†ä¿æŒå¯¹æ—§ç¨‹åºçš„å…¼å®¹ï¼Œä¸‹é¢ä»‹ç» sigaction å‡½æ•°ï¼Œåªè®²è§£å¯ä»¥æ›¿æ¢ signal å‡½æ•°çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;sigaction&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; signo, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sigaction *act, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sigaction *oldact);
&lt;span style=&#34;color:#228b22&#34;&gt;/*
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;act: å¯¹äºç¬¬ä¸€ä¸ªå‚æ•°çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆä¿¡å·å¤„ç†å™¨ï¼‰ä¿¡æ¯ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;oldact: é€šè¿‡æ­¤å‚æ•°è·å–ä¹‹å‰æ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œè‹¥ä¸éœ€è¦åˆ™ä¼ é€’ 0
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å£°æ˜å¹¶åˆå§‹åŒ– sigaction ç»“æ„ä½“å˜é‡ä»¥è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼Œè¯¥ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sigaction
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; (*sa_handler)(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt;);
    sigset_t sa_mask;
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sa_flags;
};
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ­¤ç»“æ„ä½“çš„æˆå‘˜ sa_handler ä¿å­˜ä¿¡å·å¤„ç†çš„å‡½æ•°æŒ‡é’ˆå€¼ï¼ˆåœ°å€å€¼ï¼‰ã€‚sa_mask å’Œ sa_flags çš„æ‰€æœ‰ä½åˆå§‹åŒ– 0 å³å¯ã€‚è¿™ 2 ä¸ªæˆå‘˜ç”¨äºæŒ‡å®šä¿¡å·ç›¸å…³çš„é€‰é¡¹å’Œç‰¹æ€§ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œæ•…çœç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ç¤ºä¾‹æ˜¯å…³äº sigaction å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/sigaction.c&#34;&gt;sigaction.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;timeout&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sig)
{
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (sig == SIGALRM)
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Time out!&amp;#34;&lt;/span&gt;);
    alarm(&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;);
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sigaction act;
    act.sa_handler = timeout;    &lt;span style=&#34;color:#228b22&#34;&gt;//ä¿å­˜å‡½æ•°æŒ‡é’ˆ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    sigemptyset(&amp;amp;act.sa_mask);   &lt;span style=&#34;color:#228b22&#34;&gt;//å°† sa_mask å‡½æ•°çš„æ‰€æœ‰ä½åˆå§‹åŒ–æˆ0
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    act.sa_flags = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;            &lt;span style=&#34;color:#228b22&#34;&gt;//sa_flags åŒæ ·åˆå§‹åŒ–æˆ 0
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    sigaction(SIGALRM, &amp;amp;act, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//æ³¨å†Œ SIGALRM ä¿¡å·çš„å¤„ç†å™¨ã€‚
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    alarm(&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;); &lt;span style=&#34;color:#228b22&#34;&gt;//2 ç§’åå‘ç”Ÿ SIGALRM ä¿¡å·
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;; i++)
    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;wait...&amp;#34;&lt;/span&gt;);
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;100&lt;/span&gt;);
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc sigaction.c -o sigaction
./sigaction
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wait...
Time out!
wait...
Time out!
wait...
Time out!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥å‘ç°ï¼Œç»“æœå’Œä¹‹å‰ç”¨ signal å‡½æ•°çš„ç»“æœæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä»¥ä¸Šå°±æ˜¯ä¿¡å·å¤„ç†çš„ç›¸å…³ç†è®ºã€‚&lt;/p&gt;
&lt;h4 id=&#34;1034-åˆ©ç”¨ä¿¡å·å¤„ç†æŠ€æœ¯æ¶ˆç­åƒµå°¸è¿›ç¨‹&#34;&gt;10.3.4 åˆ©ç”¨ä¿¡å·å¤„ç†æŠ€æœ¯æ¶ˆç­åƒµå°¸è¿›ç¨‹&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢åˆ©ç”¨å­è¿›ç¨‹ç»ˆæ­¢æ—¶äº§ç”Ÿ SIGCHLD ä¿¡å·è¿™ä¸€ç‚¹ï¼Œæ¥ç”¨ä¿¡å·å¤„ç†æ¥æ¶ˆç­åƒµå°¸è¿›ç¨‹ã€‚çœ‹ä»¥ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/remove_zomebie.c&#34;&gt;remove_zomebie.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;49
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;50
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;51
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;52
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;53
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;54
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;55
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;56
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#1e889b&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#1e889b&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;read_childproc&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; sig)
{
    &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; status;
    pid_t id = waitpid(-&lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;, &amp;amp;status, WNOHANG);
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (WIFEXITED(status))
    {
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Removed proc id: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, id);             &lt;span style=&#34;color:#228b22&#34;&gt;//å­è¿›ç¨‹çš„ pid
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child send: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, WEXITSTATUS(status)); &lt;span style=&#34;color:#228b22&#34;&gt;//å­è¿›ç¨‹çš„è¿”å›å€¼
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    }
}

&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;char&lt;/span&gt; *argv[])
{
    pid_t pid;
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; sigaction act;
    act.sa_handler = read_childproc;
    sigemptyset(&amp;amp;act.sa_mask);
    act.sa_flags = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
    sigaction(SIGCHLD, &amp;amp;act, &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;);

    pid = fork();
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#228b22&#34;&gt;//å­è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    {
        puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hi I&amp;#39;m child process&amp;#34;&lt;/span&gt;);
        sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;);
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;12&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#228b22&#34;&gt;//çˆ¶è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    {
        printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child proc id: %d&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, pid);
        pid = fork();
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; (pid == &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;)
        {
            puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hi! I&amp;#39;m child process&amp;#34;&lt;/span&gt;);
            sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;);
            exit(&lt;span style=&#34;color:#b452cd&#34;&gt;24&lt;/span&gt;);
        }
        &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;else&lt;/span&gt;
        {
            &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt; i;
            printf(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Child proc id: %d &lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;, pid);
            &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; (i = &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;; i++)
            {
                puts(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;wait&amp;#34;&lt;/span&gt;);
                sleep(&lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;);
            }
        }
    }
    &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc remove_zomebie.c -o zombie
./zombie
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Child proc id: 11211
Hi I&#39;m child process
Child proc id: 11212 
wait
Hi! I&#39;m child process

wait

wait
Removed proc id: 11211 
Child send: 12 
wait
Removed proc id: 11212 
Child send: 24 
wait
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¯·è‡ªä¹ è§‚å¯Ÿç»“æœï¼Œç»“æœä¸­çš„æ¯ä¸€ä¸ªç©ºè¡Œä»£è¡¨é—´éš”äº†5 ç§’ï¼Œç¨‹åºæ˜¯å…ˆåˆ›å»ºäº†ä¸¤ä¸ªå­è¿›ç¨‹ï¼Œç„¶åå­è¿›ç¨‹ 10  ç§’ä¹‹åä¼šè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ª wait ç”±äºå­è¿›ç¨‹åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥ç›´æ¥è¢«å”¤é†’ï¼Œç„¶åè¿™ä¸¤ä¸ªå­è¿›ç¨‹æ­£åœ¨ç¡ 10 ç§’ï¼Œæ‰€ä»¥ 5 ç§’ä¹‹åç¬¬äºŒä¸ª wait å¼€å§‹æ‰§è¡Œï¼Œåˆè¿‡äº† 5 ç§’ï¼Œä¸¤ä¸ªå­è¿›ç¨‹åŒæ—¶è¢«å”¤é†’ã€‚æ‰€ä»¥å‰©ä¸‹çš„ wait ä¹Ÿè¢«å”¤é†’ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨æœ¬ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œå½“å­è¿›ç¨‹ç»ˆæ­¢æ—¶å€™ï¼Œä¼šå‘ç³»ç»Ÿå‘é€ä¸€ä¸ªä¿¡å·ï¼Œç„¶åè°ƒç”¨æˆ‘ä»¬æå‰å†™å¥½çš„å¤„ç†å‡½æ•°ï¼Œåœ¨å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨ waitpid æ¥å¤„ç†åƒµå°¸è¿›ç¨‹ï¼Œè·å–å­è¿›ç¨‹è¿”å›å€¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;104-åŸºäºå¤šä»»åŠ¡çš„å¹¶å‘æœåŠ¡å™¨&#34;&gt;10.4 åŸºäºå¤šä»»åŠ¡çš„å¹¶å‘æœåŠ¡å™¨&lt;/h3&gt;
&lt;h4 id=&#34;1041-åŸºäºè¿›ç¨‹çš„å¹¶å‘æœåŠ¡å™¨æ¨¡å‹&#34;&gt;10.4.1 åŸºäºè¿›ç¨‹çš„å¹¶å‘æœåŠ¡å™¨æ¨¡å‹&lt;/h4&gt;
&lt;p&gt;ä¹‹å‰çš„å›å£°æœåŠ¡å™¨æ¯æ¬¡åªèƒ½åŒäº‹å‘ 1 ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚å› æ­¤ï¼Œéœ€è¦æ‰©å±•å›å£°æœåŠ¡å™¨ï¼Œä½¿å…¶å¯ä»¥åŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚ä¸‹å›¾æ˜¯åŸºäºå¤šè¿›ç¨‹çš„å›å£°æœåŠ¡å™¨çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2019/01/21/5c453664cde26.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ˆè¿æ¥è¯·æ±‚ï¼‰ï¼Œå›å£°æœåŠ¡å™¨éƒ½åˆ›å»ºå­è¿›ç¨‹ä»¥æä¾›æœåŠ¡ã€‚å¦‚æœè¯·æ±‚çš„å®¢æˆ·ç«¯æœ‰ 5 ä¸ªï¼Œåˆ™å°†åˆ›å»º 5 ä¸ªå­è¿›ç¨‹æ¥æä¾›æœåŠ¡ï¼Œä¸ºäº†å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œéœ€è¦ç»è¿‡å¦‚ä¸‹è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€é˜¶æ®µï¼šå›å£°æœåŠ¡å™¨ç«¯ï¼ˆçˆ¶è¿›ç¨‹ï¼‰é€šè¿‡è°ƒç”¨ accept å‡½æ•°å—ç†è¿æ¥è¯·æ±‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒé˜¶æ®µï¼šæ­¤æ—¶è·å–çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºå¹¶ä¼ é€’ç»™å­è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰é˜¶æ®µï¼šè¿›ç¨‹åˆ©ç”¨ä¼ é€’æ¥çš„æ–‡ä»¶æè¿°ç¬¦æä¾›æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;1042-å®ç°å¹¶å‘æœåŠ¡å™¨&#34;&gt;10.4.2 å®ç°å¹¶å‘æœåŠ¡å™¨&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åŸºäºå¤šè¿›ç¨‹å®ç°çš„å¹¶å‘çš„å›å£°æœåŠ¡å™¨çš„æœåŠ¡ç«¯ï¼Œå¯ä»¥ç»“åˆç¬¬å››ç« çš„ &lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch04/echo_client.c&#34;&gt;echo_client.c&lt;/a&gt; å›å£°å®¢æˆ·ç«¯æ¥è¿è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/echo_mpserv.c&#34;&gt;echo_mpserv.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_mpserv.c -o eserver
./eserver
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;å’Œç¬¬å››ç« çš„å‡ ä¹ä¸€æ ·ï¼Œå¯ä»¥è‡ªå·±æµ‹è¯•ï¼Œæ­¤æ—¶çš„æœåŠ¡ç«¯æ”¯æŒåŒæ—¶ç»™å¤šä¸ªå®¢æˆ·ç«¯è¿›è¡ŒæœåŠ¡ï¼Œæ¯æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯ï¼Œå°±ä¼šå¤šå¼€ä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1043-é€šè¿‡-fork-å‡½æ•°å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦&#34;&gt;10.4.3 é€šè¿‡ fork å‡½æ•°å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦&lt;/h4&gt;
&lt;p&gt;ç¤ºä¾‹ä¸­ç»™å‡ºäº†é€šè¿‡ fork å‡½æ•°å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦çš„è¿‡ç¨‹ã€‚çˆ¶è¿›ç¨‹å°† 2 ä¸ªå¥—æ¥å­—ï¼ˆä¸€ä¸ªæ˜¯æœåŠ¡ç«¯å¥—æ¥å­—å¦ä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯å¥—æ¥å­—ï¼‰æ–‡ä»¶æè¿°ç¬¦å¤åˆ¶ç»™äº†å­è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;è°ƒç”¨ fork å‡½æ•°æ—¶èµ‹å€¼çˆ¶è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œä½†æ˜¯å¥—æ¥å­—ä¸æ˜¯å½’è¿›ç¨‹æ‰€æœ‰çš„ï¼Œè€Œæ˜¯å½’æ“ä½œç³»ç»Ÿæ‰€æœ‰ï¼Œåªæ˜¯è¿›ç¨‹æ‹¥æœ‰ä»£è¡¨ç›¸åº”å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kP7Rjx.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œ1 ä¸ªå¥—æ¥å­—å­˜åœ¨ 2 ä¸ªæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œåªæœ‰ 2 ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½ç»ˆæ­¢ï¼ˆé”€æ¯ï¼‰åï¼Œæ‰èƒ½é”€æ¯å¥—æ¥å­—ã€‚å¦‚æœç»´æŒå›¾ä¸­çš„çŠ¶æ€ï¼Œå³ä½¿å­è¿›ç¨‹é”€æ¯äº†ä¸å®¢æˆ·ç«¯è¿æ¥çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿæ— æ³•é”€æ¯å¥—æ¥å­—ï¼ˆæœåŠ¡å™¨å¥—æ¥å­—åŒæ ·å¦‚æ­¤ï¼‰ã€‚å› æ­¤è°ƒç”¨ fork å‡½æ•°å€™ï¼Œè¦å°†æ— å…³ç´§è¦çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦å…³æ‰ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kPH7ZT.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;105-åˆ†å‰²-tcp-çš„-io-ç¨‹åº&#34;&gt;10.5 åˆ†å‰² TCP çš„ I/O ç¨‹åº&lt;/h3&gt;
&lt;h4 id=&#34;1051-åˆ†å‰²-io-çš„ä¼˜ç‚¹&#34;&gt;10.5.1 åˆ†å‰² I/O çš„ä¼˜ç‚¹&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»å®ç°çš„å›å£°å®¢æˆ·ç«¯çš„æ•°æ®å›å£°æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‘æœåŠ¡å™¨ä¼ è¾“æ•°æ®ï¼Œå¹¶ç­‰å¾…æœåŠ¡å™¨ç«¯å›å¤ã€‚æ— æ¡ä»¶ç­‰å¾…ï¼Œç›´åˆ°æ¥æ”¶å®ŒæœåŠ¡å™¨ç«¯çš„å›å£°æ•°æ®åï¼Œæ‰èƒ½ä¼ è¾“ä¸‹ä¸€æ‰¹æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¼ è¾“æ•°æ®åè¦ç­‰å¾…æœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®ï¼Œå› ä¸ºç¨‹åºä»£ç ä¸­é‡å¤è°ƒç”¨äº† read å’Œ write å‡½æ•°ã€‚åªèƒ½è¿™ä¹ˆå†™çš„åŸå› ä¹‹ä¸€æ˜¯ï¼Œç¨‹åºåœ¨ 1 ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œç°åœ¨å¯ä»¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œå› æ­¤å¯ä»¥åˆ†å‰²æ•°æ®æ”¶å‘è¿‡ç¨‹ã€‚é»˜è®¤åˆ†å‰²è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kPbhkD.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®¢æˆ·ç«¯çš„çˆ¶è¿›ç¨‹è´Ÿè´£æ¥æ”¶æ•°æ®ï¼Œé¢å¤–åˆ›å»ºçš„å­è¿›ç¨‹è´Ÿè´£å‘é€æ•°æ®ï¼Œåˆ†å‰²åï¼Œä¸åŒè¿›ç¨‹åˆ†åˆ«è´Ÿè´£è¾“å…¥è¾“å‡ºï¼Œè¿™æ ·ï¼Œæ— è®ºå®¢æˆ·ç«¯æ˜¯å¦ä»æœåŠ¡å™¨ç«¯æ¥æ”¶å®Œæ•°æ®éƒ½å¯ä»¥è¿›ç¨‹ä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†å‰² I/O ç¨‹åºçš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥æé«˜é¢‘ç¹äº¤æ¢æ•°æ®çš„ç¨‹åºæ€§èƒ½ï¼Œå›¾ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kPbvtg.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸Šå›¾æ˜¾ç¤ºå¯ä»¥çœ‹å‡ºï¼Œå†ç½‘ç»œä¸å¥½çš„æƒ…å†µä¸‹ï¼Œæ˜æ˜¾æå‡é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1052-å›å£°å®¢æˆ·ç«¯çš„-io-ç¨‹åºåˆ†å‰²&#34;&gt;10.5.2 å›å£°å®¢æˆ·ç«¯çš„ I/O ç¨‹åºåˆ†å‰²&lt;/h4&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å›å£°å®¢æˆ·ç«¯çš„ I/O åˆ†å‰²çš„ä»£ç å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/riba2534/TCP-IP-NetworkNote/blob/master/ch10/echo_mpclient.c&#34;&gt;echo_mpclient.c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥é…åˆåˆšæ‰çš„å¹¶å‘æœåŠ¡å™¨è¿›è¡Œæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;gcc echo_mpclient.c -o eclient
./eclient 127.0.0.1 &lt;span style=&#34;color:#b452cd&#34;&gt;9190&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kPOcXn.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼ŒåŸºæœ¬å’Œä»¥å‰çš„ä¸€æ ·ï¼Œä½†æ˜¯é‡Œé¢çš„å†…éƒ¨ç»“æ„å´å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–&lt;/p&gt;
&lt;h3 id=&#34;106-ä¹ é¢˜&#34;&gt;10.6 ä¹ é¢˜&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹åˆ—å…³äºè¿›ç¨‹çš„è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—çš„å†…å®¹ä¸ºæ­£ç¡®çš„&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ä¸Šè¯´ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºè¿è¡Œçš„å•ä½&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹æ ¹æ®åˆ›å»ºæ–¹å¼å»ºç«‹çˆ¶å­å…³ç³»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿›ç¨‹å¯ä»¥åŒ…å«å…¶ä»–è¿›ç¨‹ï¼Œå³ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´å¯ä»¥åŒ…å«å…¶ä»–è¿›ç¨‹&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­è¿›ç¨‹å¯ä»¥åˆ›å»ºå…¶ä»–å­è¿›ç¨‹ï¼Œè€Œåˆ›å»ºå‡ºæ¥çš„å­è¿›ç¨‹è¿˜å¯ä»¥åˆ›å»ºå…¶ä»–å­è¿›ç¨‹ï¼Œä½†æ‰€æœ‰è¿™äº›è¿›ç¨‹åªä¸ä¸€ä¸ªçˆ¶è¿›ç¨‹å»ºç«‹çˆ¶å­å…³ç³»ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨ fork å‡½æ•°å°†åˆ›å»ºå­è¿›ç¨‹ï¼Œä¸€ä¸‹å…³äºå­è¿›ç¨‹é”™è¯¯çš„æ˜¯ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»¥ä¸‹åŠ ç²—çš„å†…å®¹ä¸ºæ­£ç¡®çš„&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çˆ¶è¿›ç¨‹é”€æ¯æ—¶ä¹Ÿä¼šåŒæ—¶é”€æ¯å­è¿›ç¨‹&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­è¿›ç¨‹æ˜¯å¤åˆ¶çˆ¶è¿›ç¨‹æ‰€æœ‰èµ„æºåˆ›å»ºå‡ºçš„è¿›ç¨‹&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;çˆ¶å­è¿›ç¨‹å…±äº«å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;é€šè¿‡ fork å‡½æ•°åˆ›å»ºçš„å­è¿›ç¨‹å°†æ‰§è¡Œä»å¼€å§‹åˆ° fork å‡½æ•°è°ƒç”¨ä¸ºæ­¢çš„ä»£ç ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºå­è¿›ç¨‹æ—¶å¤åˆ¶çˆ¶è¿›ç¨‹æ‰€æœ‰å†…å®¹ï¼Œæ­¤æ—¶å¤åˆ¶å¯¹è±¡ä¹ŸåŒ…å«å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚ç¼–å†™ç¨‹åºéªŒè¯èµ‹å€¼çš„æ–‡ä»¶æè¿°ç¬¦æ•´æ•°å€¼æ˜¯å¦ä¸åŸæ–‡ä»¶æè¿°ç¬¦æ•°å€¼ç›¸åŒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šä»£ç ä¸ºå¤šè¿›ç¨‹æœåŠ¡å™¨ä¿®æ”¹è€Œæ¥ï¼Œä»£ç ï¼š&lt;a href=&#34;https://github.com/caixiongjiang/TCPIP/blob/master/ch10/test_server.c&#34;&gt;test_server.c&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œæˆªå›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.ax1x.com/2019/01/21/kPj3Md.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œæ•°å€¼ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·è¯´æ˜è¿›ç¨‹å˜ä¸ºåƒµå°¸è¿›ç¨‹çš„è¿‡ç¨‹ä»¥åŠé¢„é˜²æªæ–½ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”ï¼šå½“ä¸€ä¸ªçˆ¶è¿›ç¨‹ä»¥fork()ç³»ç»Ÿè°ƒç”¨å»ºç«‹ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹åï¼Œæ ¸å¿ƒè¿›ç¨‹å°±ä¼šåœ¨è¿›ç¨‹è¡¨ä¸­ç»™è¿™ä¸ªå­è¿›ç¨‹åˆ†é…ä¸€ä¸ªè¿›å…¥ç‚¹ï¼Œç„¶åå°†ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨è¯¥è¿›å…¥ç‚¹æ‰€å¯¹åº”çš„è¿›ç¨‹è¡¨å†…ã€‚è¿™äº›ä¿¡æ¯ä¸­æœ‰ä¸€é¡¹æ˜¯å…¶çˆ¶è¿›ç¨‹çš„è¯†åˆ«ç ã€‚è€Œå½“è¿™ä¸ªå­è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼ˆæ¯”å¦‚è°ƒç”¨exitå‘½ä»¤ç»“æŸï¼‰ï¼Œå…¶å®ä»–å¹¶æ²¡æœ‰çœŸæ­£çš„è¢«é”€æ¯ï¼Œè€Œæ˜¯ç•™ä¸‹ä¸€ä¸ªç§°ä¸ºåƒµå°¸è¿›ç¨‹ï¼ˆZombieï¼‰çš„æ•°æ®ç»“æ„ï¼ˆç³»ç»Ÿè°ƒç”¨exitçš„ä½œç”¨æ˜¯ä½¿è¿›ç¨‹é€€å‡ºï¼Œä½†æ˜¯ä¹Ÿä»…ä»…é™äºä¸€ä¸ªæ­£å¸¸çš„è¿›ç¨‹å˜æˆäº†ä¸€ä¸ªåƒµå°¸è¿›ç¨‹ï¼Œå¹¶ä¸èƒ½å®Œå…¨å°†å…¶é”€æ¯ï¼‰ã€‚&lt;strong&gt;é¢„é˜²æªæ–½&lt;/strong&gt;ï¼šé€šè¿‡ wait å’Œ waitpid å‡½æ•°åŠ ä¸Šä¿¡å·å‡½æ•°å†™ä»£ç æ¥é¢„é˜²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://caixiongjiang.github.io/blog/2022/tcp-ip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%AC-10-%E7%AB%A0-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-%E7%AC%94%E8%AE%B0/ - </description>
        </item>
    
    
  </channel>
</rss> 